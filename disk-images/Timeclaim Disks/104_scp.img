ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее fcb data */
/*======================================================================*/
 
{

LOCAL
struct	fcb	*tfcb;			/* Pointer to a fcb structure	*/

LOCAL
BYTE	*ptr;				/* GP pointer			*/

LOCAL
WORD	i,				/* GP counter			*/
	n;				/* GP counter			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Point fcb pointer to the file entry in the dma			*/
/* If sys bit set or not first extent or file has been erased forget it	*/
if (((tfcb = 0x80 + (code << 5))->extn[1] & 0x80) != 0
	|| (tfcb->ext & 0xff) >= n_ext || (tfcb->drv & 0xff) == 0xe5)
							     return(FAIL);

ptr = string;

/* Start at end of extension and work backwards for 3 characters or	*/
/* until a non space is found then copy up to 3 characters to 'string'	*/
/* If there was a character to copy insert a '.'  Then do the same for	*/
/* 8 characters of the file name.  Finally add '\nnRESU' if required	*/
/* Then reverse the string in situ					*/

i = 3;
n = 0;
while ((*(tfcb->extn + --i) & 0x7f) == ' ' && i >= 0) ;
if (i >= 0) {
    n = 1;					/* '.' required		*/
    *ptr++ = *(tfcb->extn + i) & 0x7f;
    while (--i >= 0)  *ptr++ = *(tfcb->extn + i) & 0x7f;
}
if (n != 0)  *ptr++ = '.';
i = 8;
while ((*(tfcb->name + --i) & 0x7f) == ' ' && i >= 0) ;
if (i >= 0) {
    *ptr++ = *(tfcb->name + i) & 0x7f;
    while (--i >= 0)  *ptr++ = *(tfcb->name + i) & 0x7f;
}

if (cpm_user != 0) {
    *ptr++ = '\\';
    *ptr++ = tfcb->drv % 10 + '0';
    *ptr++ = tfcb->drv / 10 + '0';
    strcpy(ptr,"RESU");
    ptr += strlen("RESU");
}

*ptr++ = NULL;

i = -1;
n = strlen(string);
while (++i < --n) {
    *(string + i) = *(string + i) + *(string + n);
    *(string + n) = *(string + i) - *(string + n);
    *(string + i) = *(string + i) - *(string + n);
}

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                              AMIE (GETDV)
.paЉ*/
#include	"dd.h"

EXTERN
WORD	floppy[],	/* AMIE global holding Source/dest drive nos	*/
	valdrvs[];	/* Array holding valid drive letters		*/

EXTERN
BYTE	*cpmsgs[],	/* CP/M messages				*/ 
	*swnames[],	/* Switch names					*/
	*swvals[];	/* Switch values				*/

/*======================================================================*/
STATUS                                         /*			*/
getdv(target,cpmdrv,cpmusr,switches,gendir)    /* Get target CP/M drive */
WORD	target;		/* SOURCE or DEST				*/
BYTE	*cpmdrv;	/* Pointer to drive identifier in CP/M function	*/
WORD	*cpmusr;	/* Pointer to CP/M User number			*/
BYTE	*switches;	/* Pointer to switch list			*/
BOOLEAN	gendir;		/* TRUE - get user number else don't		*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	All CP/M Processors
Revision History:-
17/04/89 User numbers added - ICFO
25/03/87 Extracted from dvspec listing - DAR
*/

{

LOCAL
STATUS	rv;		/* Return value					*/

LOCAL
WORD	swtot,		/* Total no of switches for this driver		*/
	cpm_user,	/* CP/M User number				*/
	index;		/* Index into switch array			*/

LOCAL
BYTE	user[3],	/* For user input of CP/M User number		*/
	*ptr;		/* Used to manipulate errst contents		*/

STATIC
BYTE	*errst = "DV:?";/* Output in error condition report		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* FAIL if we have no switches						*/
if (switches == NULLPTR)  return(FAIL);

/* Set the switches up for access					*/
swtot = setswt(20,switches,swnames,swvals);

/* If no drive specifier then use default floppy disk (minflop {+1})	*/
if ((index = fndswt(swtot,swnames,"DV")) == FAIL)
					   *cpmdrv = floppy[target] + 'A';
else {

/* Create list of valid non floppy drive letters			*/
    get_valdrvs();

/* Point to 1st byte of the switch contents				*/
    ptr = swvals[index];

/* If it is null get it from operator if valid alternatives available	*/
    if (*ptr == NULL) {
	if (valdrvs[0] != 0) {
	    if (dv_from_op(target,cpmdrv) == FAIL) {
		return(FAIL);
	    }
	}
	else return(flerr(errst,23));
    }
    else {

/* Convert to upper case						*/
	*ptr = toupper(*ptr);

/* Validate								*/
	if (dvalid(*ptr) != 0)  *cpmdrv = *ptr;
	else {

/* Invalid switch value for drive so report error & return fail		*/
	    ptr = errst;		/* Point at error string	*/
	    while (*ptr != '?')  ++ptr;	/* Locate the position of drv ID*/
	    *ptr = *cpmdrv;		/* Put in drive ID		*/
	    flerr(errst,23);		/* Output the error message	*/
	    *ptr = '?';			/* Restore error string		*/
	    return(FAIL);		/* Exit from routine		*/
	}
    }
}

if (cpmusr == NULLPTR) {	/* Called from UTILITY overlay		*/
    *cpmdrv |= 16;		/* Stops 'getdir' setting user number	*/
    return(SUCCESS);
}

rv = SUCCESS;

if ((index = fndswt(swtot,swnames,"UN")) != FAIL) {
    if (*swvals[iееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееndex] == '*')  cpm_user = -2;		/* All users	*/
    else if (*swvals[index] != NULL)  cpm_user = atoi(swvals[index]);
    else {

/* Loop until a suitable new value is input				*/
	cpm_user = (WORD) FAIL;
	while (cpm_user == FAIL) {

/* Ask the operator for the new user number				*/
	    dframe[0] = cpmsgs[27 + target];
	    dframe[1] = cpmsgs[29];
	    dialogue(NULL,NULL,2,dframe,2);
	    cur_on();
	    kflush();
	    if (getlin(user,sizeof(user)) != 0) {
		cur_of();
		cpm_user = 0;
		rv = FAIL;
		break;
	    }
	    cur_of();

/* If return only - use User 0						*/
	   if (strlen(user) == 0) {
		cpm_user = 0;
		break;
	    }

/* If user has input '*' set to -2 and return success			*/
	    if (user[0] == '*') {
		cpm_user = -2;
		break;
	    }

/* Test if all characters are digits					*/
	    cpm_user = 0;
	    while (cpm_user < sizeof(user) && user[cpm_user] != NULL) {
		if (isdigit(user[cpm_user++]) == FALSE) {
		    cpm_user = (WORD) FAIL;
		    break;
		}
	    }
	    if (cpm_user != (WORD) FAIL)  cpm_user = atoi(user);

/* If the user is invalid output an error message ("Invalid input")	*/
	    if (cpm_user == (WORD) FAIL || cpm_user < 0 || cpm_user > 63)
						     cpm_user = nferr(12);
	}
	chat(19,20,NULL,NULL);			/* Please Wait		*/
    }
}
else cpm_user = 0;

*cpmusr = cpm_user;

return(rv);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееAMIECOM SVC  .          AMST    C    z	
        AMST    H                    AMST    REL   >              AMSTBL1 SUB                  AMSTBLD SUB                  AMSTLNK SUB                  C       COM  4      RDWT005 C                    RDWT005 REL                   RUNAMIE C     !               RUNAMIE REL   	"               SETDATE C    #$%&'           SETDATE REL   (               AMIE    ERR   )               SHOWTIMEC     b-./0            SHOWTIMEREL   1               BFINIT  C     
2               CHSEFN  C     3               CHUSER  C     4               CPM     H     5               CPM     INP   6               CPM     IRL  789:;           CPM     MAN   <               CPM     MS1   =               CPM     OUT   >               CPM     OV1   "?@              CPM     OV2   FABC             CPMBL1  SUB   D               CPMBL2  SUB   E               CPMBLD  SUB   F               CPMINP  C     &GH              CPMINP  REL   I               CPMLN1  SUB   J               CPMLNK  SUB   K               CPMMAN  C     *LM              CPMMAN  REL   N               CPMOUT  C     %OP              CPMOUT  REL   Q               CPMOV1  C     R               CPMOV1  REL   S               CPMOV2  C     T               CPMOV2  REL   U               DIR     C     6VW              DMPBUF  C     X               DSPUSR  C     	Y               DVALID  C     Z               DVFROP  C     [               ENDIT   C     
\               ERASE   C     ]               FNCHEK  C     ^               GETATR  C     _               GETDIR  C     @`a              GETDV   C     $bc              GETFNM  C     d               GETVDT  C     e               GETVFD  C     f               GVALDV  C     
g               INPDRV  C     h               ISFCHR  C     i               MANDRV  C     
j               OUTDRV  C     
k               RDDATA  C     l               REN     C     +mn              SELPRC  C     	o               SETDRF  C     p               SETUSR  C     q               SIEVE   C     r               SWCLSE  C     s               SWOPEN  C     	t               SZEFIL  C     u               WTDATA  C     v               WTREC   C     w               RCUTLBL1SUB   x               RCUTLBLDSUB   y               RCUTLLN1SUB   z               RCUTLLNKSUB   {               RCUTLOV1C    %|}~ЂЃ          RCUTLOV1REL   #‚ѓ              RCUTLPRCC    „…†‡€           RCUTLPRCREL   ‰               RECUTL  ERR   Љ               RECUTL  H     ‹               RECUTL  MS1   Њ               RECUTL  OV1   #ЌЋ              RECUTL  PRC   Џ               ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееГ:QAMIE is being checked V05.20 05-03-91                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               !  е!  еНЅLББН§@НA! е! еНЛLБ. |жgНхOКI! ГL!  еНЅLББ! еНЛLБ. |жgНхOКl! Гo!  "‰+НPК! Г‚!  еНHБ"у*‰НPВ¬*‰+НPК©!чеНЭ
Б#НхOНхOНхOК<! 9Н®PюНVPЪ<НС#НPКПНџН@НAН¦!яеН|Б!яе! е! еНl"еН#ББББ!яе! е! еНя&БББ!яеНSБ! еНQHБН§@!
 е!
 е! еН~KБББНл@!#еНќEБНџ!+"!џ"RR!®R"я е*я НЁPС}*я е*я НЁPС}! 9Н®P++НPКќ! 9Н®P##Н®Pе!2еНщKББНPНхOКґ!чеНЭ
Б#|µКґНџ!  е!
 е!еН~KБББ!  е!( е!еН~KБББ!  е!7 е! еН~KБББ!8еНm@Б!O "х*хяНV/*
.he                                                             AMIE (GETFNM)
.pa
*/
#include	"dd.h"

EXTERN
FILE	dirfd;			/* Ffile descriptor for directory file	*/

EXTERN
WORD	cur_file,		/* Current file in file list		*/
	tot_files;		/* Total number of files in list	*/

EXTERN
BYTE	filnam[20],		/* Name of current file			*/
	cpm_drive,		/* Source drive ID			*/
	*sel_frame;		/* Address of allocated answer frame	*/

/*======================================================================*/
WORD                           /*					*/
getfname(lev)                  /* Get next filename from directory list	*/
struct	lvl	*lev;				/* AMIE Level structure	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMINP CP/M input driver
Revision History:
10/07/89 Number of bytes got by 'getstr' increased to 20 from 19 because
         the maximum number has to include the NULL terminator.  This
         allows for a file name of 8.3 plus the user number (ie
         'USERnn\12345678.123') - ICFO
21/04/89 Tidied up - ICFO
13/02/87 Modification for minflop access - DAR
*/

{

LOCAL
BYTE	*dptr;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*;

/* Prefix filename with the source drive ID				*/
filnam[0] = cpm_drive;
filnam[1] = ':';

do {

/* Check for the last file in the sequence				*/
	if (cur_file >= tot_files) {
		lev->err_action = RELEASE;
		return(FAIL);
	}


/* Get a name that is flagged for entry	or return FAIL if none left	*/
	if (getstr(dirfd,&filnam[2],20) == FAIL)  return(FAIL);

/* Repeat until a selected file is found in the selection frame		*/
} while(sel_frame[cur_file++] == FALSE);


return(SUCCESS);

}

/*======================================================================*/
ile in the sequence				*/
	if (cur_file >= tot_files) {
		lev->err_action = RELEASE;
		return(FAIL);
	}


/* Get a name tееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(GETVDT)
.pa
*/
#include	"dd.h"
#include	"cpm.h"

struct fname	{
	BYTE	preamble[2];
	BYTE	name[20];
} ;

EXTERN
WORD	cpm_user,		/* CP/M User Number as input		*/
	user,			/* Copy of CP/M User Number		*/
	organised;		/* Type of source file organisation	*/

EXTERN
struct	lvl	*lev;		/* level descriptor			*/

EXTERN
struct	fname	filnam;		/* CP/M filename held globally		*/

/*======================================================================*/
STATUS                               /*					*/
get_vdets(vfdpkt)                    /* Extract details from VFD packet	*/
struct	pkthdr	*vfdpkt;		/* Pointer to VFD packet	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMOUT CP/M output driver
Revision History:-
26/04/89 User numbers included - ICFO
*/

{

LOCAL
struct	tvfd	*vfd;	/* Pointer to VFD itself in packet		*/

LOCAL
BYTE	tname[20]PТГ*х+"хГш!= еНоAБГ! е!
 е!:еН~KБББНbDКНVPЪ_!
 е!  еНKAББНл@!
 е!
 е!WеН~KБББНџ! е!
 е!yеН~KБББ*‰+НPК†!‡еНm@БГЋ!ЏеНm@Б! @еН%BБ"I*‰НPКґ!
 е!
 е!›еН~KБББ!Ѕе!ЖеНTББ"ыНPКи!Ие!ЖеНTББ"ыНPКи!ЅеН#	Б*ые! е!ЃеНFБББ#|µВ4!
 е!  еНЅ@ББ!
 е!
 е!УеН~KБББ! е!
 е!теН~KБББНџ!Ѓе!е! еНEБББ|µК!
 е!  еНЅ@ББ!
 е!
 е!ЅеН~KБББ! е!
 е!еН~KБББНџ*ые! е!еНFБББ#НPВ¦!еНљFБ
 Н9PНхOКО!
 е!  еНЅ@ББ!
 е!
 е!еН~KБББНџ!е*ыеНББ*IеН*CБ*‰+НPК°!KеНќEБ!YеНќEБ!dеН	БеНЎБ"щ!rеН	Б еНЎБл*щ"щ!Ђ еНЎБл*щ"щ!Ђ еНЎБл*щ"щ! еНЎБл*щ"щ!Ђ еНЎБл*щ"щ! еН9GБНВOЕХ
   НQMЕХ*щНВOЕХ*уНВOНХMН®MКћ! "Г°! е!  е!zеН~KБББ*еНЩБНС#НPКЕНџНі!че!ЈеНTББеНаTБН§@НЙ! Й                                 ! 9Н®PеНљFБ"е*еяНVPТ
	Г/*е+"е#Г! 9Н®Pе! е!щеНFБББ#|µВNГ	!
 е!
 еНЅ@ББ!  "з*зщеНЁP& }жoС}НхOК’*з#"з+щНЁPеНоAБГa!йе!¦еНLББ!йе!щеНґKББ*‰+НPКВ!йеНЭ
Б#НхOНхOНPК	!A }2й!йеНЭ
Б#|µВл!щеН#	БГТ*‰+НPК	!ще!©е!¦еН~БББГ$!dеНЭ
Б#|µВ 	!MеН#	БЙ  !ня9щ*!	е!  }2ђRНФD"!	! 9е!¬еНLББ! 9е*!	С}! 9е! 9еНLББ! 9е! 9Н®PеНґKББ*!	їя НХPл*©е!ЇеНщKББ|µКБ	!
 е!
 е!·еН~KБББ*!	еНоAБНл@!Се!ЧеНqIББНџ!
 е!  еНЅ@ББ! |µКј
! е!
 е!пеН~KБББ! 9Н®PеНm@Б! е! е!яеН~KБББ!еНm@Б!!еНm@Б*!	їя НХPл*©	 еНm@Б!&еНm@Б! е! е!DеН~KБББ! е! еНKAББНЧAея|µВj
Н§@Нџ! е!  еНЅ@ББ! 9еНЭ
Б#|µК‰
Гј
!
 е!  еНЅ@ББ! е!
 е!fеН~KБББ! 9еНm@Б!zеНm@БГО	! 9Н®Pе! 9е!©еН~БББб"!	! 9щЙ! 9Н®Pе!«еН(KББ! е!Ђ еНЅLББ! е!«еНЅLББЙ! 9Н®Pе!«еН(KББ! е!«еНЅLББ#|µВ1!яяЙ!# е!«еНЅLББ*МЙ    !  "B! 9Н®P+л*BН9PК№Гk*B#"BГL! 9Н®PеНrUБ"D#НPК“! 9Н®Pл*B6 !яяЙ!
 е*DНэOКЈГ№! 9Н®Pл*Bе*DС}Гa! 9Н®Pл*B6 *B+"B*BяНVPТ+! 9Н®Pл*BНЁPаяНPВ	! 9Н®Pл*BНЁPчяНPНхOК%*B+"B#л! 9Н®P6 Г(Г+ГО*Dця|µКT! 9Н®PеНrUБ"D#НPКQ!яяЙГ+!  Й                                      !^е! 9Н®PеНLББ!^е! 9Н®PеНґKББ!^е!љеНTББ"XНPКУ!
 е!
 е!ќеН~KБББ!^еНm@БНџ!nе! 9Н®PеНLББ!nе! 9Н®PеНґKББ!nе!ЈеНTББ"ZНPК(!
 е!
 е!ґеН~KБББ!nеНm@БНџ! е!
 е!МеН~KБББ!^еНm@БНл@! |µКџ*Xе*Iе! @еН¬VБББ"\НPКkГџ*Zе*Iе*\еН|VБББе*\НPКњ! е!
 е!ЪеН~KБББНџГE*XеНаTБ*ZеНаTБ!  Й! е!  еНФLББ!$ е!Ђ еНФLББ! е! еНФLББ!! е! еНФLББ!' е!  еНФLББ!ч е!еНLББ!* е!  еНФLББ!! е!  еНФLББ!' е!  еНФLББ! е! еНЛLБеНиLББЙ                                                                                                                                                              !
 е!  еНЅ@ББ!
 е!
 е!	еН~KБББ!dе!«еН(KББ! е!«еНЅLББ#|µВ#!"еНm@БНџ!# е!«еНЅLББ*М"Л! е!Ђ еНЅLББ! е!«еНЅLББ!Ђ "С*С#"С+НЁPе*СНЁP НХPС"=*Ле*=Н–P"A*A НХPЂ е*A НХPл!Ђ НцPлН–PеН%BБ"У"Х*AеН%BБ"П*=Ђ НХPеН%BБ"Н"Се!яяНэOКб!=еНm@БНџ!Ђ е*Не!Ђ еНcIБББ! 9Н®P+НPК_!Kе!ПеН(KББ! е!ПеНЅLББ! е!ПеНЅLББ#|µВ9!QеНm@БНџ!  }2п}2Ы! 9Н®P+НPК_! е!ПеНЅLББ*="C*C+"CяНVPТ·*СЂ "С! е*СеНЅLББ! е!«еНЅLББ! 9Н®P+НPКґ! е!ПеНЅLББГe! "?! е!Ђ еНЅLББ! е!«еНЅLББ! 9Н®P+НPКт! е!ПеНЅLББ!Ў "С*Aл*?Н9PКc! е!«еНЅLББ*?#"?+л*Пе*СНЁP& }ж?oС}*СНЁP& }ж?o)K6#6 ! 9Н®P+НPК`! е!ПеНЅLББГш! е!«еНЅLББ! 9Н®P+НPК‹! е!ПеНЅLББ!Ђ ";!  "E*EАНVPЪЈГ±*E#"E+Г—*E)KН®P+НPК‘! "?*Aл*?Н9PК‘*Пл*?НЁPе*EНэOКь*?)))л*ННЁPНхOНхOК‡!  "C*CшНVPЪ<*Х#"Х+е*?)))л*Не*C#"C+СНЁPС}Г*Х#"Х+6 *Х#"Х+е*=л*?л! НцPлС}*Х#"Х+е*=л*?л! НцPС}*; ";*?#"?ГЙ*E)Kе*;НіPГ¦![е!«еН(KББ! е!«еНЅLББ! е!«еНЅLББ#|µВЫ!mеНm@БНџ!  }2Л}2·! е!KеНЅLББ! е!«еНЅLББ*У"Х*A НХPл*УЂ е*A НХPл!Ђ НцPлН–P"Ч*Чл*ХНnPКd! е*ХеНЅLББ! е!«еНЅLББ*ХЂ "ХГ0! е!«еНЅLББ*УеН*CБ*ПеН*CБ*НеН*CБ!
 е!
 е!€еН~KБББНл@ЙНAНуQЙ! "Џ!Ї"‘!  е!  е! е!Џе!  еН(1БББББЙ  !rеН	Б еНЎБ"П!Ђ еНЎБл*П"П! еНЎБл*П"П!Ђ еНЎБл*П"П*‰+НPК%! Г(!  еН9GБНВOЕХ
   НQMЕХ*ПНВOЕХ*уНВOНХMНЃMК›!
 е!  еНЅ@ББ!
 е!
 е!»еН~KБББ*‰+НPКѓ! Г†!  A еНоAБ!ЦеНm@Б!яяЙ!  Й  ! 9Н®PНВOЕХЂ   НХMЕХ*уНВOНANл"џ! 9Н®PНВOЕХЂ   НХMЕХ*уНВOН<NлНхOКу*џ#"џ*џЙAMIE.CHK Failed to boot from system track 1 $$$.SUB Search START 
 Checking AMIE - Please wait. Wrong version of operating system Memory drive  exists. not fitted. Getting list of files to be used. AMIE.FLE r A:AMIE.FLE Error in Startup file AMIE.FLE Trouble with version number Wrong version Number of files error in Startup file AMIE.FLE M:FORMATS.DAT M:AMIE.FRM A:FORMATS.DAT AMIE.AS Insufficient space on M: for FORMATS.DAT wb M: A: @: GEMQDDS Setting GEMQDDS on drive  A:SET -fGEMQDDS/ -eAMIE CHECK File missing -  Put one of the discs marked AMIE   in   and press a key to continue. <ESC> to exit to operating system Cannot find file -   - try again using another disc rb Failed to open file -  File opening failure -  Copying from  Disc or directory full - cannot run AMIE

 005 Indexing format database 
Cannot open A:FORMATS.DAT 
Not enough memory
 Cannot create M:FORMATS.DAT 
Cannot create output file Format database indexed Timeclaim AMIE Please Wait Not enough space on Drive  : to run AMIE                             ;	/* Temporary filename				*/

STATIC
WORD	setusr();	/* Set any user number				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Request a buffer in a multiple of 128 bytes please			*/
lev->bfsize = 128;

/* Point vfd at the start of the VFD contained in the packet		*/
/* Set 'organised' depending on structure of source file data		*/
organised = (vfd = vfdpkt->d_start)->v_struct;

/* Copy the filename in VFD into temp array				*/
strncpy(tname,vfd->v_ifile,20);

/* Set up the User Number if it is in the VFD				*/
/* ie the file name ends with ...USERnn\ABCDEFGH.IJK			*/
user = setusr(tname);

/* Source name is 'tname'						*/
/* Destination name is 'filnam' 
/* Request 'sieve' to take source name and make a legal CP/M name in	*/
/* destination								*/
sieve(tname,filnam.name);

/* Copy legal name back to the VFD					*/
if (cpm_user != 0) {
    strcpy(vfd->v_ifile,"USER");
    if (user < 10)  strcat(vfd->v_ifile,"0");
    itoa(user,vfd->v_ifile + strlen(vfd->v_ifile));
    strcat(vfd->v_ifile,"\\");
}
else *vfd->v_ifile = NULL;
strncpy(vfd->v_ifile + strlen(vfd->v_ifile),filnam.name,13);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                      CPM(GETVDT / SETUSR)
.pa
*/
/*======================================================================*/
STATIC WORD                 /*						*/
setusr(fn)                  /* Set up the new file name and user number */
BYTE	*fn;	/* File name (including "USERnn\" where relevant)	*/
/*======================================================================*/

{


LOCAL
WORD	u_num,		/* CP/M User Number				*/
	i,j;		/* Loop counters				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Remove User Number from file name and set user number if necessary	*/
u_num = 0;
i = strlen(fn) - 1;
while (i >= 0 && *(fn + i) != '\\')  --i;

if (*(fn + i) == '\\') {
    *(fn + i) = NULL;
    if (strncmp(fn + i - 6,"USER",4) == MATCH
	      && isdigit(*(fn + i - 2)) == TRUE
	      && isdigit(*(fn + i - 1)) == TRUE)  u_num = atoi(fn + i - 2);
    if (u_num < 0 || u_num > 63)  u_num = 0;
}
j = 0;
while (*(fn + ++i) != 0)  *(fn + j++) = *(fn + i);
*(fn + j) = NULL;

if (cpm_user >= 0)  u_num = cpm_user;		/* Over-ride USERnn\	*/

return(u_num);

}Љ
/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                           S.P.I.T(GETVFD)
.pa
*/
#include	"dd.h"

/*======================================================================*/
struct pkthdr                        /*					*/
*get_vfd()                           /* Get the Virtual File Descriptor */
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = CPMOUT CP/M output driver
Revision History:-
19/3/87 - uses nferr not err_handle DAR
*/
{
EXTERN
struct	lvl	*lev;

/* Get packet containing the VFD					*/
return(qget(lev->in_q));
}
/*====================== end of get_vfd ================================*/
/* Routines called:- nferr						*/
/*======================================================================*/
=*/
/*USE
Portability   = level 1
Parent module = CPMOUT CP/M output driver
Revision History:-
19/3/87 - uses nferr not errееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее                                                                                                                                                                                                                                                                              Н@НA!r"ш!w"ъ!‰"ь!’"ю!ў" !ш"! "! "! "! |µКq! е! е!  еНl5БББГUН§@Н¦!деН|Б!де!де! еНl"еН#ББББ!де!де! еНя&БББ!деНSБ! еНQHБН§@!
 е!
 е!ІеН~KБББНл@! е!
 е!ОеН~KБББНл@НљAея|µВт!хеНќEБНџН§@ГnНw!Гn!хеНќEБН§@НџН§@Н¦!эеНќEБН§@!"Џ!"‘!-"“!  е!  е! е!Џе!  еН(1БББББНAуНy=ГnН»Pg  ш ю юяя   ГJЙAMIE Set Time and Date Run CP/M System Shutdown Initial Options Failed to boot from track 1 Press any key to continue - ESC aborts $$$.SUB AMIE.CHK Timeclaim A.M.I.E System has shut down Now turn power off or press Reset button                                       !Hе!VеН(KББ! е!VеНЅLББ#НPКЛ!
 е!
 е!QеН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙ!  }2v!  "z*z НVPЪMГф*zЂ "zГШ! е! 9Н®Pл*zеНЅLББ! е!VеНЅLББ|µКJ!
 е!
 е!‡еН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙГз!  Й  !  }2v!  "Q*QюНVPЪШГy*Q#"QГ`! е*QЂ НХPл! 9Н®PеНЅLББ! е!VеНЅLББ|µКХ!
 е!
 е!§еН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙГo! е!VеНЅLББ#НPК!
 е!
 е!ИеН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙ! еНЛLБ. |жgНхOКD!ее!VеН(KББ! е!VеНЅLББ#НPК}!
 е!
 е!реН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙ!  }2v!  "Q*QюНVPЪГЈ*Q#"QГЉ! е*QЂ НХPл! 9Н®PеНЅLББ! е!VеНЅLББ|µКя!
 е!
 е! еН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙГ™! е!VеНЅLББ#НPКD!
 е!
 е!1 еН~KБББ! е!
 е!mеН~KБББНљAН§@!яяЙ!  ЙAMIE.005 Cannot open file - AMIE.005 Press any key to continue Read failure on file - AMIE.005 Write failure on file - AMIE.005 Cannot close file - AMIE.005 A:AMIE.005 Cannot open file - A:AMIE.005 Write failure on file - A:AMIE.005 Cannot close file - A:AMIE.005 JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                                                                                                                                                                                                                                                   Н§@!u еН|Б#НPКЌ!!яяЙ!u еНж!Б#НPК !!яяЙН§@Н¦!u еНSБ"u!Н§@*u!#НPКД!!яяГЗ!!  Й                        Ѓ(’(±(Н¦Нl""И!Н§@!
 е!
 е*И!)а!Н®PеН~KБББНл@! 9Н®Pе!М!е! е*И!еН#ББББ!  }2Я!! 9Н®Pе*И!е!М!еНn)БББ#НPКR"!яяЙ! 9Н®Pе!М!е! еНя&БББ!  ЙЫ/ж! И>НЉ">vНЉ"Н”"!  Шю@Ш#ЙхЫІ8ысУ±ЙЫІ0НЈ"ЫІШЫ±Й!– еН§LБЙ    T] bkнў ыbk~жю(иw#хЙ!­"Нн"W!Ї"Нн"є0Жd’ю(ю(Ї<ЙЇЙ~Л'_Л'Л'ѓ+†ЙЙ                 б%1%Л$! 9Н®Pл! 9Н®P"	#! 9Н®P)#Н®Pе!ъ"ге*	#ге!C#гйББ*	##НЁP}2#*	#НЁP}2#!  "#*#нНVPЪЉ#Гy#*##"#Г`#! 9Н®Pл*#6 Гo#! 9Н®Pе:#Н©PС}! 9Н®P#е: #Н©PС}:#Н©PРя
 НХPе:#Н©PРяС+"#! 9Н®P###е*# НХPP е! еН8LБББ! 9Н®P######6 ! 9Н®P е:#Н©PС}! 9Н®P #е:#Н©PС}! 9Н®P
 е:я"Н©PС}! 9Н®P
 #е:ю"Н©PС}! 9Н®P е:э"Н©PС}! 9Н®P #е:ь"Н©PС}! 9Н®P е:ы"Н©PС}! 9Н®P #е:ъ"Н©PС}! 9Н®P
 ##6:! 9Н®P ##6:ЙСБбеЕХ"т$!нў ы*т$~жю(вЖ0w#уГф$ ! 9Н®P е! 9Н®P	 НЁPС}! 9Н®P	 е! 9Н®P
 НЁPС}Й  !Й(еНm@Б! "/%*/% ЂНVPТn%ГX%*/%+"/%Г?%! 9Н®Pл*/%еНгAС}ГN%! 9Н®P е! 9Н®P #НЁPС}! 9Н®P е! 9Н®P НЁPС}! 9Н®P е! 9Н®P###НЁPС}! 9Н®P	 е! 9Н®P##НЁPС}Й! 9Н®Pе! 9Н®P
 #НЁPС}! 9Н®P#е! 9Н®P
 НЁPС}! 9Н®P##е! 9Н®P #НЁPС}! 9Н®P###е! 9Н®P НЁPС}! 9Н®P е! 9Н®P #НЁPС}! 9Н®P е! 9Н®P НЁPС}! 9Н®P е! 9Н®P #НЁPС}! 9Н®P е! 9Н®P НЁPС}! 9Н®P е! 9Н®P###НЁPС}! 9Н®P	 е! 9Н®P##НЁPС}Й    ! 9Н®Pл! 9Н®P"ы&*ы&е! 9Н®P НЁPС}*ы&#е! 9Н®P #НЁPС}!  "э&*э&фНVPЪ‹'Г]'*э&#"э&ГD'! 9Н®P###е*э& НХPP е! еНEБББ|µВ€'Г‹'ГS'*э&#"э&цНVPЪ¶'*ы&##60*ы&###е*э&0 С}ГТ'*ы&##61*ы&###е*э&ця0 С}*ы& е! 9Н®PНЁPС}*ы& #е! 9Н®P#НЁPС}*ы& е! 9Н®P
 НЁPС}*ы& #е! 9Н®P
 #НЁPС}*ы& е! 9Н®P НЁPС}*ы& #е! 9Н®P #НЁPС}*ы&
 е*ы&
 #е!0 С}С}ЙNo clock present Super Video Controller present Real Time Clock present t? JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                             к+   к+   ц- яяк+   к+   к+   ц- яяк+   к+   ц- яяк+   к+   ц- яяк+   к+тя  ц-сяяя!  ")!  "
)!  ")!т(е! 9Н®Pе! 9Н®PеН&LБьяеН8LБББ! |µК›+НzA|µК¶)Г«)! |µК *! 9Н®Pе*
)е! 9Н®Pе! 9Н®PеНщ/ББББ!2 еН§LБНzAеНЏLБ")НхOКэ)Г *Г¶)!  ")*)ея|µВ*Н§@!яяЙ*)уя|µВj**)НPКM*Н§@! 9Н®Pе! 9Н®PеН&.ББ!  ЙГg*!  е!т(е*
)е*)еНц-ББББГЈ)Гы*Нa@е*)НэOК‡**
)т(НЁP")Гы*Н]@е*)НэOКы*! ")*
)яНVPТ°**
)+"
)Г¶*! "
)*
) НХP) Н®P|µКо**
)яНVPТе**
)+"
)Гл*! "
)Г¶**
)т(НЁP")*)еНKБНPК+*)еНKБНPНхOК+ГЈ)*
) НХP)Н®Pе*)ге!т(ге*
)ге*)ге!G+гйББББ#НхOКX+!  Г[+! ")*)НPКt+! е!
 еНЅ@ББ*)+НхOК+*
) НХP)##Н®Pл*
)"
)ГЈ)Й             
                               ! 9Н®Pл! 9Н®Pе!
 9Н®PС}!  "ў+*ў+шНVPЪM,Г$,*ў+#"ў+Г,*ў+)¤+Н®Pл! 9Н®PНЁPеНKБНPКJ,!яяЙГ,!  "ў+*ў+эНVPЪ•,Гl,*ў+#"ў+ГS,*ў+)ґ+Н®Pл! 9Н®PНЁPеНKБНPК’,!яяЙГb,! 9Н®P
 НЁPРя
 НХPе! 9Н®P
 #НЁPРяС Н:PКР,!яяЙ! 9Н®P НЁP5 Н:PКл,!яяЙ!  "ў+*ў+фНVPЪ8-Г
-ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее
/*
.he                                                        AMIE (GET_VALDRVS)
.paЉ.po6
*/
#include dd.h	/* standard device driver header			*/

/*======================================================================*/
STATUS
get_valdrvs()	/* get drive letters of non floppy drives not inc A:	*/
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = DVSPEC CP/M initialisation
Revision History:-
25/3/87		Extracted from dvspec listing - DAR
*/

{
LOCAL
WORD	index,	/* indexes into valdrvs					*/
	n;	/* loop counter taking values of drives < minflop	*/

EXTERN
WORD	valdrvs[],	/* array of valid drive letters			*/
	floppy[];	/* drive identifiers global in AMIE main	*/

index = 0;	/* put drive letters in valdrvs				*/

/* get letters of drives < minflop not inc 'A'				*/
for(n=1;n<floppy[0];n++) valdrvs[index++] = n + 'A';

/* add ': if it exists							*/
if((is_mdrive())) valdrvs[index++] = 'M';

/* terminate the valid drive array with a zero				*/
valdrvs[index] = 0;

/* if index = 0 then return a FAIL as there are no valid alternate drvs	*/
return(index ? SUCCESS : FAIL);
}
/*====================== END OF GET_VALDRVS ============================*/

index = 0;	/* put drive letters in valdrvs				*/

/* get letters of drives < minflop not inc 'A'				*/
for(n=1;n<floppy[0];n++) valdrvs[index++] = n + 'A';

/* add ': if it exists							*/
if((is_mdrive())) valdrvs[index++] = 'M';

/* terminate tееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее*ў+#"ў+Гс,! 9Н®P###е*ў+ НХPН(е! еНEБББ|µВ5-Г8-Г -*ў+фя|µВH-!яяЙ! 9Н®PНЁPРя
 НХPе! 9Н®P#НЁPРяС"њ+! 9Н®P НЁPРя
 НХPе! 9Н®P #НЁPРяС" +* +л! НцPлНPК№-! Гј-!  "ћ+*ћ+ НХPє+е*ў+)СН®Pл*њ+Н:PВж-*њ+НPНхOКт-!яяГх-!  Й! 9Н®P+НPК.Нф@! е!
 е!ѓ0еН~KБББНэ@!  Йш/X/s.! 9Н®Pе!т(еНLББ! 9Н®P) .Н®Pе! 9Н®Pге!U.гйБЙ       
    ) ( ' & % $ !  "W.*W.фНVPЪА.Г’.*W.#"W.Гy.! 9Н®P###е*W. НХPН(е! еНEБББ|µВЅ.ГА.Г€.ЇУ.У У/*W.#"W.цНVPТк.! "Y.*W.ця"W.Гр.!  "Y.*Y.}У,*W.}У+!  "W.*W.ъНVPЪS/Г/*W.#"W.Г/*W.)[.Н®Pл! 9Н®PНЁPРя"Y.е*W.)g.Н®P"Y.}2O/б}У Г/>У.Й! 9Н®P е! 9Н®P #е!0 С}С}!0еНm@Б! 9Н®P
 НЁPеНоAБ! 9Н®P
 #НЁPеНоAБ! 9Н®P НЁPеНоAБ! 9Н®P #НЁPеНоAБ! 9Н®P НЁPеНоAБ! 9Н®P #НЁPеНоAБЙЙ! 9Н®Pе! 9Н®Pе! е!
 9Н®PеН#ББББ! е!
 е!›0еН~KБББ! 9Н®PеНm@Б! е!
 е!·0еН~KБББ!т(еНm@Б! е! 9Н®P% еНKAББНф@! 9Н®Pт(НЁPеНоAБНэ@ЙInvalid Date or Time t Current date and time are:      Set new date and time:      ! 9Н®P"У0!  "Х0*У0+"У0 ЂНVPТ1*Х0е*У0)л! 9Н®PН®PеН&LБеН2KББ"Х0Гз0*Х0Й        ! 9Н®Pе! 9Н®Pе!
 9Н®PеНЧ0ББеН2KББ " 1! 9Н®P)е! 9Н®PНхOКn1! Гq1! С""1!
 9Н®P|µВЈ1!
 9еНY@ыяе*"1Н–Pл! НцP НіP! 9Н®P|µВИ1! 9е!P е* 1Н–Pл! НцPНіP!
 9еН®P+НіPл*"1+"$1!
 9еН®P#НіP+е!
 9еН®P+НіPе* 1е*"1еНIББББ*$1е!
 9Н®Pе* 1е*"1еНA3ББББ!
 9еН®P#НіP+е!
 9Н®Pе* 1е!
 9Н®PН®PеН›3БББеНKAББ! 9Н®PН®PеНm@Б! "&1! 9Н®Pл*&1Н9PКН2!
 9еН®P##НіPе!
 9Н®Pе* 1е*&1)л!
 9Н®PН®PеН›3БББеНKAББ*&1#"&1+)л! 9Н®PН®PеНm@БГh2! 9Н®P|µК@3! 9еН®P#НіP+е* 1гН–Pл! НцPл! 9Н®P"&1Н'?*$1+"$1е*&1е! 9еН®P#НіPе! еНТ3ББББН?*$1+"$1е*&1#"&1еНKAББЙН'?! 9Н®Pе! 9Н®Pе! 9Н®Pе! 9Н®PеНТ3ББББ! 9Н®Pе! 9Н®PН–P###е! 9Н®Pе! 9Н®PеНл4БББН?Й! 9Н®PеН&LБе! 9Н®PгН–Pл! НцPл! 9Н®PЙ              ! 9Н®P++"О3! 9Н®P++"Р3! 9Н®P"К3! 9Н®P"М3*К3е*М3еНKAББ*?еНоAБ!  "Д3*О3л*Д3Н9PК>4Г34*Д3#"Д3Г4*
?еНоAБГ)4*?еНоAБ*К3е*Р3Н–P+е*М3еНKAББ*?еНоAБ!  "Д3*О3л*Д3Н9PКЋ4Гѓ4*Д3#"Д3Гi4*
?еНоAБГy4*?еНоAБ*К3+"Ж3*М3л*О3#"И3*Р3+"Р3#|µКк4*Ж3е*И3еНKAББ*?еНоAБ*Ж3е*М3еНKAББ*?еНоAБ*Ж3+"Ж3Г©4Й! 9Н®Pе! 9Н®PеНKAББ*?еНоAБ! 9еН®P++НіP! 9еН®P+НіP#|µК25*
?еНоAБГ5*?еНоAБЙ                                                 ! 9Н®P";5*"`5*;5 Н®PюНVPТЇ5*;5 Н®Pе*;5 Н®Pе!  еН KБББ*;5##Н®Pе*;5 Н®PеНЧ0ББ е*;5Н®PеН&LБеН2KББ "G5*;5 Н®PеНY@фяе*;5 Н®PСНцP+"h5#еНXKББе*;5 Н®PСНХP "O5НY@ъяе*O5Н–Pл! НцP "Q5л*O5+"S5*Q5е!P е*G5Н–Pл! НцP#"C5е*G5##е*O5еНIББББ*S5е*C5е*G5#е*O5еНA3ББББ*Q5#е*C5е*G5е*;5Н®PеН›3БББ"?5еНKAББ*;5Н®PеНm@Б*C5#"I5*Q5 "A5*G5"K5*O5ыя"O5!  "M5"Q5!яя"U5! 9Н®P"E5*;5 Н®P+е*h5еНXKББ"S5! "j5*j5е! 9Н®PеНT;ББ"j5*M5|µВ77НљA"M5*M5уя|µВЯ7Н>=*;5 Н®PюНVPТЫ7*;5
 е!  "d5НіP*;5 Н®Pл*d5Н9PКЇ7*;5 Н®Pе*d5#"d5+СНЁP+НPК¬7*;5
 еН®P#НіPГj7*;5
 Н®P|µВЫ7*;5
 6#6 *;5 Н®Pл*E56*E5ЙНe@е*M5НэOКm8Н>=*E5+"E5*E5 ЂНVPЪ08!  е*;5 Н®P+"S5"E5е*h5Н–PеН2KББ"Q5! "j5Гj8*Q5л*E5Н9PКj8!  е*E5еН2KББ"S5!  е*E5е*h5Н–PеН2KББ"Q5! "j5ГJ;Нi@е*M5НэOВљ8*M5аяНPК—8*;5 Н®P Н:PНхOНхOКY9Нi@е*M5НPКЫ8*;5 Н®Pл*E5е*;5 Н®Pл*E5НЁPНPС}! "j5Н>=*E5#"E5*;5 Н®Pл*E5Н*PК#9!  "Q5"E5*;5 Н®P+е*h5еНXKББ"S5! "j5ГV9*S5л*E5Н:PКV9*;5 Н®P+е*E5"Q5л*h5еНXKББ"S5! "j5ГJ;*M5Г2;*U5яНVPТq9!  "U5!  "M5*U5 ЂНVPТН9! е!  е!`5е! еНЧ0ББ е! еНIББББ*U5+"U5 ЂНVPЪѕ9!  "U5*U5W56 ! "j5ГJ;!  "M5*;5 Н®PюНVPТ#:!  "d5*;5 Н®Pл*d5Н9PК:*;5 Н®Pе*d5#"d5+С6Гп9! "j5ГJ;Н>=!яяЙ*M5  Н)PВB:*M5 Н*PНхOВQ:*U5 Н*PНхOК`:!  "M5ГJ;*U5#|µВo:!  "U5*U5#"U5+W5е*M5С}*U5W56 !  "d5*;5 Н®Pл*d5Н9PКз:НzA"M5НхOКґ:Гз:*;5##Н®Pе*d5)СН®Pе!W5е*U5еНEБББ|µВЭ:Гз:*d5#"d5Г‘:*M5|µКт:ГJ;! "j5*;5 Н®Pл*d5Н9PК/;*;5 Н®P+е*d5"E5"Q5л*h5еНXKББ"S5ГJ;Н»P_9 q9 Р9* &:   Г-:Г7Й      ! 9Н®P+НPКќ<*A5"=5е*I5е*K5е*O5еНIББББ*;5##Н®Pе*Q5"N;)Се*S5е*Q5Н–P#еНЧ0ББ"G5л! НцP( ХН–P"C5*S5л*N;Н)PКr<*=5е! 9Н®P+НPКч;*C5е*G5е*;5##Н®Pе*N;)СН®PеН›3БББГъ;*C5еНKAББ*;5 Н®P Н:PК%<*;5 Н®Pл*N;НЁPНхOК.<Нф@!  еНоAБ*;5##Н®Pе*N;#"N;+)СН®PеНm@Б!  еНоAБНэ@*;5 Н®Pл*=5"=5Гґ;!W5"b5*U5#|µКќ<! е! е! е!`5е!  еН(1БББББ*A5"=5*Q5"N;*S5л*N;Н)PК:=*N;#"N;+е*E5НэOКЧ<!> "P;!< "R;Га<!  "R;"P;*=5е*C5+++еНKAББ*P;еНоAБ*P;еНоAБ*=5е*C5л*G5###еНKAББ*R;еНоAБ*R;еНоAБ*;5 Н®Pл*=5"=5Г©<!  Й!  "M5*U5#|µКx=!яя"U5! е!  е!`5е! еНЧ0ББ е! еНIББББЙГК=

STOP Version 1.1

       Parking the head on the Winchester..
      $	Г БбнCЁ>>gУеНQ>     !>Н{>·ДA>:>ю (ю(!НQ> W  Н{>>gУеНQ>     Н{> v!яяенKЁ>ЕЙ‘   Ђ

Command not completed

$НQ>     !>Н{>ЙЫеца<ВQ>>юУж>хУеЫеж ъ>чУебЫе8ы~/Уж#фйЫе8ы8
0Ыж/w#о~/Уж#зЫж/хЫе8ыЫжсжЙ                                                                                                   ЙЉ … Џ ‰ Њ ѓ † ‹ Ћ Й           ЙЙ           ЙC
      C     я          Cя      C	           C     р      C          Cр          C      Cр      Cя          C     я        !E@еНm@БН§@!  "@*@/НVPЪD@Г2@*@#"@+Г@*@4?НЁPеНоAБГ'@ЙO>0aEHp0fd ! Й!Ѓ Й!‚ Й!ѓ Й!„ ЙСбеХ~·Ию
  Н…@_Н…@#мехХНоAСсбЙЙ  Ѓ‚ѓ„…†‡€‰ *ђ@е!  еНKAББ!ыAеНm@БЙ! 9Н®P ЂНVPТв@! 9Н®Pе! 9Н®PеНKAББ!ыAеНm@БЙ!юAеНm@БЙ!BеНm@БЙ!Bееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                             AMIE (INPDRV)
.paЉ*/
#include	"dd.h"

EXTERN
WORD	cpm_user;		/* CP/M User number			*/

EXTERN
BYTE	cpm_drive;		/* CP/M drive letter			*/

/*======================================================================*/
STATUS                      /*						*/
inpdrv(lev)                 /* Find input drive by running init overlay */
struct	lvl	*lev;				/* Level descriptor	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CP/M INPUT DRIVER
Revision History:-
17/04/89 Brought up to date and user numbers added - ICFO
25/03/87 Extracted from cpmin listing - DAR
*/

{

STATIC
BYTE	*ovname = "CPM.OV1";	/* Init overlay name			*/

LOCAL
WORD	(*cpmovl)(),		/* Function pointer			*/
	rv;			/* Return value				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load overlay								*/
if ((cpmovl = ldprl(ovname)) == (BYTE *) FAIL)  return(flerr(ovname,4));

/* Call overlay & return result, create AMIE.DIR as well		*/
rv = (*cpmovl)(SOURCE,&cpm_drive,&cpm_user,lev->switches,TRUE);

free(cpmovl);

return(rv);

}

/*=====================================================================*/
 - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load overlay								*/
if ((cpmovl = ldprl(ovname)) == (BYTE *) FAILеееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееНm@БЙ!BеНm@БЙ!BеНm@БЙ! 9Н®Pе!  еНKAББ!BеНm@Б! 9Н®P"ђ@Й!BеНm@Б!  "ђ@ЙЫІ8ы>У±ЫІ8ы>=У±ЫІ8ыб;БсЖ У±ЫІ8ыxЖ У±!ыя9щЙ!BеНm@БНгA|µК‘AНљAЙГ•A!  ЙЙ    НЧA"–A!‘@"A*A#"A~·КУA*A#"A+НЁPе*–AНэOКРA*AНЁP& ЙГ¦A*–AЙ!BеНm@БНгAЙЫІ8ыЫ±o& Й! 9ЫІ8ы~У±Й% * A N E  D  M O k K яяяя     *B#|µВ1BНDF! 9еН®P НіP*B"!B! |µК—B*!B Н®PНPКrB*!B##Н®Pе! 9Н®PСН\PНхOК{BГ—B*!BН®P#|µВ‹B!яяЙ*!BН®P"!BГFB*!B##Н®Pе! 9Н®P СН\PКC*!Bл! 9Н®P"#B*#B##е*!B##Н®Pе! 9Н®PН–PНіP*#Bе*!BН®PНіP*#B 6 #6 *!B##е! 9Н®PНіP*!Bе*#BНіP*!B 6#6 *!B Й      !  е! 9Н®PНPКFC! 9Н®P#НхOНхOК^D*B"$C! 9еН®PъяНіP! 9Н®Pе*$CНPКЏC*$C"&C*$CН®P"$C#НPКЊC!яяЙГaC*$CН®P"(C*$Cе*$C##Н®PСе*(CНэOКЅC*(C Н®PНPНхOКуC*$C##еН®Pе*(C##Н®PСНіP*$Cе*(CН®PНіP*$C 6 #6 *&Cе*&C##Н®PСе*$CНэOКD*&C Н®PНPНхOК(D*Bе*$CНPНхOКRD*&C##еН®Pе*$C##Н®PСНіP*&Cе*$CН®PНіP*$C 6 #6 !  ЙНГD"Ў*Ў Н®P"Ј*Ў	 Н®P"§*Ў Н®P"Ґ*Ў Н®P"©*Ўе!їDеНщKББ|µКґD!яяГѕD*Ў НЁPЙMFB *  	НРD`iЙйЙ  !  "ТD*Ў НЁPл*ТDН9PКE*ТD#"ТD+))))л*ЈНЁP& }ж@oНPКE*ТD+A ЙГЪD!  Й ! 9Н®PяНVPЪ3E! Й! 9еН®P+НіP#|µК•E! 9еН®P#НіP+НЁPеНЏLБ}2E! 9еН®P#НіP+НЁPеНЏLБе:EН©PНPК„E! Й:EН©P|µВ’EГ•EГ3E!  Й    !Ья9щ!& 9Н®Pе! 9еН(KББ! е!Ђ еНЅLББ! е! 9еНЅLББ"›E#НPКдE!яял!$ 9щлЙ*›E)))))‰ "™E*™EНЁP& }жЂo|µВF*™E#НЁP& }жЂoНхOКF!яяГЬE! е! 9еНЅLББ#НPК8F!яяГ;F!  ГЬE      !  еНYRБ"BFНЊF"@F!  "B*BF"B">F*>F##е*@Fе*BFН–PНіP*>F6я#6я*>F 6 #6 Й!  9И нRЙ    ! "F!  "–F! 9Н®PНЁPГИF!яя"F! 9еН®P#НіPГХFН»PіF- №F+   ! 9Н®PНЁP0 Н*PКшF! 9Н®PНЁP9 Н)PНхOК$G*–F
 НХPе! 9еН®P#НіP+НЁPСРя"–FГХF*Fл*–FНХPЙ          ! е!  еНЅLББ"/G! еНЛLБ! 9Н®P Н:PВuG! е! 9Н®PеНиLББНPНхOКG!яяЙ! е! 9Н®PеНЅLББ! еНЛLБ"3G! еНЛLБ"7G*7G Н®Pл! НсP#"1G*3Gл*1G"5G! е*/GеНЅLББ*7G Н®P#е!1GеНљHБН–Pе*7G##НЁP+++л! лНЏPСНХPЙ    ! е!  еНЅLББ"H! е! 9Н®PеНЅLББ! еНЛLБ##НЁPл!Ђ лНЏP"H! е*HеНЅLББ*HЙ Н ! 9N НЋH   НЋHЂ ! НЋH$ НЋH·АЂ :ђ WX`iн°gЇ.й* йЙ      ! 9Н®P##Н®P"–H!  "H! 9Н®P Н®Pл*–HНnPКI*–H#"–H+НЁP& "”HНPКаHГI*”Hя|µВщH*H "HГI*H#"H*”H+е*”HНлO"”HНхOВщHГЇH*HЙ  ! 9еН®P+НіP,И! 9еН®P#НіP+е! 9Н®PеНKAББ! 9Н®P"I!I5КI!  еНоAБГPIЙсБСбеХЕхx±Ин°ЙГЂI            ! 9^#V!Дя9еееНJWб	 	6C#6O#6MСН юяВ®Iб!яяЙ! 9~#foНbJ*tI|µВПItIХ!\ НJWбГбIл!\ НJW*vI|µВбI!vIл!l НJWЃ ! 9~#fo |µКюI¶ВJГJ> ~юaъJЦ #·ВJ!Ђ p8J!Ц *w#В$JБ* щ!  еГЦ  ХЕН СХН БС·Кш Ђ Н Г !Ђ лГЩ лњJ!tIю КjJю	КjJю КJq#p#ю К’Jю К’Jю	ВJЇГiJw#wЙ                                                                                                    Й! 9~!  юAШю{Р,юaРю[Ш-Й! 9~!  ю0Шю:Р,ЙБбСХеЕНJWЙ! 9Н®Pе! 9Н®PСН9PКPK! 9Н®PЙ! 9Н®PЙ! 9Н®Pе! 9Н®PСН:PВvK! 9Н®PЙ! 9Н®PЙ! 9Н®Pе! 9Н®PеНKAББ! 9Н®PеНm@БЙсСБбеЕХхx±КіKs#ГЁKЙ! 9Н®P~·КПK! 9еН®P#НіPГґK! 9еН®P#НіP+е! 9еН®P#НіP+НЁPС}|µКшKГПKЙБбСХеЕѕВL#·ВяK!  Й!яяШ! ЙБбСХеЕ+#~·ВLЙБСХЕ!  ·К7L#Г-LЙ! 9еН®P+НіP#НхOКlL! 9еН®P#НіP+е! 9еН®P#НіP+НЁPС}НхOКuLГ8L! 9Н®P ЂНVPЪЋL! 9Н®P6 Й! 9n& }юaШю{Ро oЙ* йЙ! 9F* 7 ~гг= ышЙЙбСБЕХеН oџgЙ! 9NН ЙбБСХЕе* kНжLoџgЙйЙбБСХЕе* kйЙ! 9~Ј_#~ўW#~ЎO#~ Gб33гЙЇ°±ІВ:MіК6M{ю Т:M! 9Ї~·т*M7~w+В*MВMбСБй! 9~·> тFM=w+ВHMГ6MЇ°±ІВxMіК6M{ю ТxM! 9Ї~w#ВiMВbMГ6M! 9ЇГFMЙ! Н•O! еНґMбхН¦OВљMсГўMс! ТўM-СББХ-Й! Н•O! ГЉM! 9~“_#~љW#~™O#~hgGх|­тТMс?ЙсЙЙЕХ  ХХ! 9Ї~w+ВгMТN!
 9л!  9ЇЋw#ВъM! E|9¶ВN#В	NГ'N!
 9Ї~w#ВNГЬM! 9^#V###s#rСБ! 9щЙ. ГCN.еЕХx·тPNНO>ях!  ее.9F+N+V+^ЕХx·тlNНO>я!	 9®w!  ее> х! 9Ї~w#ВЃN! 9л! 9 ѕЪ¤NВЈN+В•N?х! 9с~w#В­Ny·КРN! 9л!
 9Їлћ#ВЗNс=ВyN! 9~·ВтN! 9л!  9л~#ВкN! 9~·ьOСБ! 9щб33гЙеЕ ! 9Їyћw#ВOБбЙ! 9~і_#~ІW#~±O#~°GГO! 9~«_#~ЄW#~©O#~ЁGГOЙ^#V#N#F#ЙгНIOгs#r#q#pЙбЕГjOбЕ Хе! 9л! 9ѕ#В†OВwOЇГ€O>бСССг& ©oЙ! 9~s_#~rW#~qO#~pGЙx±ІіЙ! Н¦OА-Йл  Й}НКO]WOGЙ|НКOлOGЙ·>яш<ЙлЙлГ©PЙБСЕ}іo|ІgЙБСЕ}«o|ЄgЙБСЕ}Јo|ўgЙ|µИ!  ,ЙБСЕ|є}!  ВP»ВP,ЙЇЙ|µКыO!  ЇЙБСЕ|є}! А»А-ЙлzјВ;P{ЅВFP!  ,Йлz¬ъLPzјВFP{Ѕ! Ш-Й|§! ъJPµЙ|оЂgЙл|єВdP}»! ТlP-ЙµЙлzјВvP{Ѕ! Ш-Йл|ш|g}oГ}PлЇГPлш)ГђPБСЕ{•ozњgЙ+|/g}/oЙ~oџgЙ~#foЙлбгs#rлЙлбN#F#x±КФP~#»~#ВЅPєВЅP`iйDM!  z·>ВдPS\)л)лТмP	=ВдPЙЇхГQz¬х¬ль Pл|·ф PMD!  x<ВQzЃ>ЪQjS\>)л)лТ"Q#е	бТ*Q	=ВQлсрлН PлГ PЙ  * +%"•S%"“S%"‘SЬя	"вS	"аS	"ЮSyя	6 "ЋR+6„+щОWХ!НWНnPбКzQ"ЃR!Ђ ^6    ЕF+N+т‡Q!* е!<Qе! 9~#·КвQю КќQOю"К¶Qю'К¶Q +С}|Хе+#~·КНQ№ВАQ6 #г~#ю<КRю>КR!:Q4бГќQб6я#6я*:Qе!<QеН*VR|µКяQеНаTГ  е!RеНT"RГRr   е!TRеНT"VRББЪ,RбСХГќQ9R	Н  Н Can't open > or < file.$ГуQw   ЙСБЕХ*ЃRееС	ееНnPСВtR!ю9Н\PСБ!яяАл"ЃRЕбЙНWЙ*RеНrUБЙ   :ЌR<*ЋRѕШИл
Н Ї2ЌR
НМRГ‘RН ·ИН юК  юКQRюВЛR>
_*ЋR~+ѕР#4N 	s>
»М ЙНQR> !чSНxSШЕ:ђR№ВSН‘R2ЌR_ ~Г
SяН БюВSВS
Н !
 ЙВ(SюКгRюК1So& Й!яяЙБСХЕ*VRХеНчUББЙл> е!ыSНxSСШХл}ю
ВaSЕН Б>
_Н бЙcon:rdr:pun:lst: Ц ЪЉSютЉS_ ~O·А7Г1SЙ                                     яяяяяяя                                                         !"#    БбСХеЕ!gS Хец ѕВ%T#ВTСбi& Й бС~·ВT!µS~юяКDT#В6TГ_UБСХЕл~#Fлчя6 , 6 щяpщяw# 6 2ЌTмSлН™Pе! 9Н®PБЕy=еН«WбК_UХлНJW> юwВћTСХН СН С<К_U!ґSs 	Їw#6вя	w+wтя	~#¶ВЭTХе ЕНYRБлбs#r{ІСК_UлЇЙБСХЕ{ю Ъ U!ыSНxS#Ш ^{·Д !  Й/*
.he                                                           S.P.I.T(ISFCHR)
.pa
*/
#include	"dd.h"

/*======================================================================*/
BOOLEAN         /*							*/
isfchr(c)       /* Check character for illegal value for CP/M file name */
BYTE	c;			/* Character to be tested for legalness	*/
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = CPMOUT CP/M output driver
Revision History:-
12/03/91 Listing brought up to date - ICFO
15/01/87 Extracted from CPMOUT.C
*/

/* Character to be tested for legalness has already been through the	*/
/* 'toupper' function							*/

{

/* list of CP/M filename illegal characters				*/ 
STATIC
BYTE	illegal[] = {
	 '"', 0x27,  '*',  '+', 0x2c,  ':',  ';',  '<',  '>',
	 '=',  '?',  '_',  '.'
	};

LOCAL
WORD	n;	/* working counter					*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* If its not between SPACE & 'Z' it must be illegal			*/

if (c <= ' ' || c > 'Z')  return(FALSE);

/* Given above test, if it is >= 'A' it is a legal alpha character	*/
if (c > '@')  return(TRUE);

/* It is between SPACE & 'A' so check if it is illegal by comparing	*/
/* against illegal entries in the table					*/
n = -1;
while (++n < sizeof(illegal))  if (c == illegal[n])  return(FALSE);

return(TRUE);				/* It is a valid character	*/

}

/*======================================================================*/
 a legal alpha character	*/
if (c > '@')  return(TRUE);

/* It is between SPACE & 'A' so check if it is illegal by comparing	*/
/* against illegal entries in the table					*/
n = -1;
while (++n < sizeof(illegal))  if (c == illegal[n])  return(FALSE);

return(TRUE);				/* It is a valid character	*/

}

/*===================================================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                             AMIE (MANDRV)
.paЉ*/
#include	"portab.h"

EXTERN
BYTE	cpm_drive,	/* CP/M drive letter to be set up		*/
	*switches;	/* Pointer to switch list			*/

/*======================================================================*/
STATUS                 /*						*/
mandrv(target)         /* Find drive to manage by running init. overlay */
WORD	target;					/* SOURCE or DEST	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPMMAN UTILITY PROCESSOR
Revision History
12/04/89 Tidied up - ICFO
*/

{

STATIC
BYTE	*ovname = "CPM.OV1";

LOCAL
STATUS	(*cpmovl)(),	/* Function pointer				*/
	rv;		/* Function return value			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load & run CPM.001							*/
if ((cpmovl = ldprl("CPM.OV1")) == (BYTE *) FAIL)
					       return(flerr("CPM.OV1",4));

/* Run overlay - do not to generate AM!ґS~<К_U6яНdU!ЙS~юrКQU!РSN!»SХН®P}·КPUлх*ІSyюbК@U>w#В9U%се!Ђ =тJU)еН|VББС{=ХН«WН <бА!  7Й!ЏSN#FЕб"ІSЙНРU·КжRю ТиRЇ№+ВўUеХ*ІSе! еН¬VББСХлмS	s{ІСбК1SХеН®P#НіP+л*ІSF!РSС>bѕКМUxюКrUюК1S·КrUh& ЙбБСХЕе{·Ию РНdU!мS~!»SN#F№{А p+pH#ЙНРU·ВVБбСХеЕГDSю ЪVБСбеХЕГGS+е! 9~ю
В?Vе!РS~юbК<V!9V5В:V>бГ?V6б>
*ІS	wгее`i#НіPбЇѕбВmVБСХЕХ%,е! еН|VБББ|µ!яяИш! 9n& :9V·КчUЙЇ22W>ГіV е! 9Н®Pлбе):2W¤х|!ќS†wТ¤V#4!«SсwбЙ>я22W>2…V:ђR·Д®RН3WЕx±КWХеЕХлН С:…VOН Б·ВмV!Ђя	DMбЂ СГБVбС:…VюВWбW	Н !яяГ%WWrite error - Disk full
$С`iН™PеЂ Н бГ†V ! 9~=+еН«WбХV+^+F+NблЙ 	"ЎW> w+ВSWЇw 	w##w 	wая	л#~+ю:В~W~##НЈWЦ@~#·Ию.КЏWНЈWГ~Wл*ЎW++·ИНЈWw#Г•W  жюaшЦ ЙO !ЮS		~_#VІАе!$ еНYRлббr+sbk#|µЙЙ ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                            AMIESTRT(MAIN)
.pa
*/
/*======================================================================*/
char	title[] = "AMIE is being checked",
	vers[] = "V05.20",
	date[] = "05-03-91",
	licence[31] = "",
	ctrl_z = '\32';
/*======================================================================*/

/* NB This is for AMIE V05.20						*/
#define		P_VERS	03.12

#include 	"portab.h"	/* Portability Header			*/
#include	"disc.h"	/* Disc tables				*/
#include	"amst.h"

#define		SPACE	32	/* ASCII Space				*/
#define		DEFDMA	0x80	/* Default DMA address			*/
#define		TOTOS	64	/* Total number of ostypes. New = 64	*/
#define		SIZEBUF	16384	/* Space for 16k copying buffer		*/

#define		SELDSK 27
#define		SETDMA 36
#define		SETTRK 30
#define		SETSEC 33
#define		BIREAD 39
#define		BIWRITE 42

#define		SETUSER	32

BYTE	*buf,			/* Buffer pointer for copying buffer	*/
	*genmes[27],		/* For 'menu'				*/
	amievers[8];		/* AMIE version string			*/

BOOLEAN	md;			/* Existance of memory drive		*/

WORD	ctlq,			/* }					*/
	device,			/* }					*/
	*dframe[3],		/* }					*/
	exov,			/* } To satisfy the LINKer because we	*/
	floppy,			/* } are using the AMIE version of MENU	*/
	genmf,			/* }					*/
	poolq,			/* }					*/
	qbase,			/* }					*/
	qc;			/* }					*/

struct	disctb	*dtbl;
struct	drvtbl	*drvtab;
struct	dpblk	*dpb;
struct	dphdr	*dph;
struct	dtext	*fdtext;

struct	fcbt	fcb,
		mfcb;

STATIC
WORD	bsiz;		/* Block size					*/

EXTERN
WORD	CtlB;		/* Address to patch for CTRL / B (and now	*/
			/* CTRL / C) action				*/

EXTERN
BYTE	*CtlCk;		/* Address of function to check for CTRL / C	*/

/*======================================================================*/
main(argc,argv)                                         /* Main Program */
WORD	argc;
BYTE	*argv[];
/*======================================================================*/
/*USE
Portability	Level 4 (BIOS calls in 'pat_1')
Parent Module	AMIE StartIE.DIR				*/
rv = (*cpmovl)(target,&cpm_drive,NULLPTR,switches,FALSE);

spfree(cpmovl);

return(rv);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее
/*
.he                                                               CPM(OUTDRV)
.paЉ*/
#include	"dd.h"

EXTERN
BYTE	cpm_drive;		/* Holds CP/M drive letter		*/

EXTERN
WORD	cpm_user;		/* CP/M User Number			*/

/*======================================================================*/
STATUS      /*								*/
outdrv(lev) /* Find CP/M drive letter by running initialisation overlay */
struct	lvl	*lev;				/* AMIE Level structure	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMOUT CP/M OUTPUT PROCESSOR
Revision History:-
26/04/89 Tidied up - ICFO
25/03/87 Extracted from cpmout- DAR
*/

{

STATIC
BYTE	*ovname = "CPM.OV1";	/* Overlay name				*/

LOCAL
WORD	(*cpmovl)(),		/* Pointer to function			*/
	rv;			/* Return value				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load overlay								*/
if ((cpmovl = ldprl(ovname)) == (BYTE *) FAIL)  return(flerr(ovname,4));

/* Call overlay	do not generate AMIE.DIR				*/
rv = (*cpmovl)(DEST,&cpm_drive,&cpm_user,lev->switches,FALSE);

spfree(cpmovl);

return(rv);

}

/*======================================================================*/
cpmovl)(),		/* Pointer to function			*/
	rv;			/* Return value				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load overlay								*/
if ((cpmovl = ldprl(ovname)) == (BYTE *) FAIL)  return(flerr(ovname,4));

/*ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееup
Version		As AMIE
AMIE Version	See header
Revision History:
05/03/91	V03.12	Yet another version of 'grope' in 
			SETDATE.C - ICFO
04/03/90	V03.11	Some tidying up of the listing - ICFO
			Call to 'clreos' just after message
			'Indexing formats database' moved to before it
			and arguments supplied - ICFO
			Delay between characters in SHOWTIME reduced
			to 50ms - ICFO
			Now uses 'stoprel' like AMIE.004 instead of
			'exec'uting SHIP which outputs its own message
			and spoils the look of the screen - ICFO
			Method of computing space required to store
			FORMATS.DAT etc and run AMIE rewritten - ICFO
			Checks for space to run AMIE on normal entry as
			well as after indexing database - ICFO
13/12/89	V03.10	Version Number changed for AMIE V05.20
16/10/89	V03.09	Check for amount of space on default drive
			redone - ICFO
			(The 112 * 128 byte records allows for AMIE
			to copy the whole of Drive B: or C: which
			have 1024 entries each of which	will require
			14 bytes (8 + '.' + 3 + <CR><LF>) in AMIE.DIR.
			The other large file which may be required is
			the temporary copy of AMIE.AS at the end of the
			Assignment File Editor.  It is assumed that an
			Assignment File will not increase in size by
			more than 16 * 128 byte records (2K) per run of
			AMIE.  A fixed amount of 16K is reserved for
			AMIE.FRM.  This allows for 1489 * 11 byte
			records.  One record per format.)
			If the number of files in AMIE.FLE is less than
			10 it complains - ICFO
			'md' used as the BOOLEAN it is defined as - ICFO
			'dframe' dimensioned [3] so 'dialogue' can be
			used to put up a 'Please Wait' message while 
			AMIE.005 is plugged with the date
			(Changes AMST.C and RUNAMIE.C) - ICFO
			Interrupts turned off before system shutdown
			(Change in RUNAMIE.C) - ICFO
			If FORMATS.DAT does not exist on Drive A: it
			is copied from floppy
			(Change in AMST / CHKFILES) - ICFO
			Wait message displayed while gropeing for
			type of clock and while setting new time and date
			into AMIE.005
			(Change in SETDATE.C) - ICFO
			Before System Shutdown 'AMIE.CHK' is erased
			(Change in RUNAMIE.C) - ICFO
			Cursor switched on before System Shutdown
			(Change in RUNAMIE.C) - ICFO
15/08/89	V03.08	Yet another new version of 'grope' in
			'setdate' - ICFO
17/05/89	V03.07	Register A cleared before each 'in a' in 'grope'
			in 'setdate' - ICFO
12/05/89	V03.06	Delay introduced in 'showtime' - ICFO
			Correction to 'grope' in 'setdate' - ICFO
16/01/89	V03.05	'grope' code for RTC rewritten.  Change to
			'setdate / grope' - ICFO
28/09/88	V03.04	Top bit cleared when displaying file name during
			checking.  Change to 'chk_files' - ICFO
			'Invalid' message displayed only at end of input
			of invalid field.  Change to 'showtime' - ICFO
30/08/88	V03.03	Test for M: being full should have been for
			'!= bufsize' not '!= buf' - ICFO
14/07/88	V03.02  When M: is full test is for '!= buf' rather
                        than '== 0' - ICFO
26/04/88	V03.01x Now allows for time and date setting and the
                        operator can shutdown the system from the
                        Initial Options - ICFO
18/04/88	V03.00	CTRL / C switches on the cursor - ICFO
                        LIBVER replaced by IOLIBV and TLIBV - ICFO
                        Normal entry checks for 'AMIE.CHK' on M:
                        (if fitted) before booting from track 1 - ICFO
                        'runamie' added and globals to satisfy LINKer
                        because we use AMIE version of 'menu' - ICFO
14/12/87	V02.00  Sortos included
13/12/87	V01.02x Preparations for including SORTOS
18/11/87	V01.01 Space test introduced and better file copying
15/11/87	Altered to start through AMIE.005 with separate checks
15/10/87	Issued to AMIE V04.10
13/08/87	version 4.00 follows from prev 3.5 was AMIE number but
                now refers to amst only
02/04/87	Issue with AMIE V3.4
00/00/87	V01.00x
04/03/87	Work started
                Format of file AMIE.FLE is <CR> <LF> delimited ASCII
		Record 1 - Version No of program
		Record 2 - Number of Files in present suite
		Record 3 -> to number of files + 2 - filenames
*/

{

LOCAL
WORD	i,		/* Counter					*/
	n_blocks,	/* Number of blocks occupied by file		*/
	reqblks;	/* Space required for files on Drive M:		*/

LOCAL
FILE	flechan,	/* channel no for file list			*/
	chan;		/* file channel no				*/

LOCAL
BYTE	amie005[256],	/* Storage for part of "AMIE.005"		*/
	*b,		/* Pointer to bytes when copying CtlB address	*/
	nbrfiles[5],	/* ASCII number of files			*/
	str[16];	/* String space for gen use			*/

STATIC
BOOLEAN fdat_flag = FALSE;	/* True if FORMATS.DAT to be copied	*/

STATIC
WORD	rec2blk();

STATIC
STATUS	chk_space();

UWORD	f_size();

WORD	aexit();		/* Turns on cursor before exiting	*/

VOID	tlibv(),		/* Main Library version number		*/
	iolibv();		/* I/O Library version number		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Set user area to 0							*/
bdееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(RDDATA)
.pa
*/
#include	"dd.h"
#include	"cpm.h"

#define 	RDSIZE	512	/* no of bytes to read into a packet	*/

EXTERN
BYTE	filnam[];		/* name of current file			*/

EXTERN
WORD	user;			/* Current CP/M User Number		*/

EXTERN
FILE	inpfd;			/* File descriptor of input file	*/

/*======================================================================*/
WORD                        /*						*/
rd_data(lev)	            /* read next block of data from source file	*/
struct	lvl	*lev;				/* AMIE Level structure	*/
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = CPMIN CP/M input driver
Revision History:-
26/04/89 Changes to current user number before reading from disc and
         back to user 0 afterwards - ICFO
16/02/87 Final packet data length set after read, bug fix - DAR
*/

{

LOCAL
UWORD	nbytes;		/* Number of bytes read from source file	*/

LOCAL
struct	pkthdr	*pkt;	/* Pointer to a packet header			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Get an empty packet from the pool					*/
/* Read source RDSIZE bytes of file into data area			*/
bdos(SETUSR,user);
nbytes = spread(inpfd,(pkt = qget(lev->in_q))->d_start,RDSIZE);
bdos(SETUSR,0);

/* Adjust the packet control variables 					*/
pkt->d_bytes = nbytes;
pkt->d_freesp -= nbytes;

/* Output above packet, may be zero length				*/
queue(lev->out_q,pkt);

if (nbytes < RDSIZE) {		/* If EOF hit send EOF packet		*/

/* Get an empty packet from the pool					*/
/* Flag it as EOF packet						*/
    (pkt = qget(lev->in_q))->d_bytes = -1;

/* Put it on output queue						*/
    queue(lev->out_q,pkt);	
}

return(SUCCESS);

}

/*======================================================================*/
 variables 					*/
pkt->d_bytes = nbytes;
pkt->d_freesp -= nbytes;

/* Output above packet, may be zero length				*/
queue(ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееos(SETUSER,0);
clrs();
cur_off();

/* Check for M: Drive and set it to the default else set A:		*/
bdos(14,(bdosh(24) & 0x1000) != 0 ? 12 : 0);
bsiz =
     get_bksiz(((md = ((bdosh(24) & 0x1000) != 0) ? TRUE : FALSE) == TRUE)
							     ? 'M' - 'A'
							     : 'A' - 'A');
if (md == FALSE || (md == TRUE && f_exist("AMIE.CHK") != FAIL)) {

/* If no arguments - Run AMIE						*/
    if (argc < 2) {
	if (chk_space() == FAIL)  aexit();
	inivid();
	cur_off();
	wait_a_bit();			/* Timeclaim AMIE - Please Wait	*/

/* BOOT from Track 1 to run AMIE itself					*/
	rd_005(amie005);		/* Read 256 bytes from default	*/
	st_date(amie005,date,SDATE - 0x100,grope()); 	/* Date to date	*/
	st_005(amie005,date,SDATE - 0x100);	/* Update in memory copy*/
	wt_005(amie005);		/* Write back to (poss) M: and A*/
	boot(1);
	clrs();
	say(10,10,"Failed to boot from system track 1");
	clreol();
	unlink("$$$.SUB");
	aexit();
    }
}

/* Set a suitable message in 'genmes[26]' for menu			*/
genmes[26] = "Search";

/* Ensure that CTRL / C switches on the cursor				*/
CtlB = aexit;		/* This is cheating - equating int with pointer	*/
/* Copy address of CtlB to destination of jump if CTRL / C is input	*/
*((b = &CtlCk) + 0x0f) = *(b + 0x14);
*(b + 0x10) = *(b + 0x15);

/* If AMIE.CHK exists on default drive exit because we have just	*/
/* rebooted or come out of AMIE						*/
/* If we have got here via the 'RESET' button when in System Shutdown	*/
/* there will be no $$$.SUB file or AMIE.CHK so we will go on to the	*/
/* check and index phase.						*/
/* If we have rebooted (as per TCDP) there will be a $$$.SUB file which	*/
/* will get executed after 'aexit()'					*/
if ((argc == 2) && (strcmp(argv[1],"START") == MATCH)) {
    if (f_exist("AMIE.CHK") != -1)  aexit();
}

/* If we get here we do a full check					*/
say(0,10,title);
say(0,40,vers);
say(0,55,date);
putstr("\n");
for (i = 79; i > 0; --i)  putvid('=');

say(6,10,"Checking AMIE - Please wait.");

/* Check operating system version and setup drive tables		*/
if (settab() < 0x36) {			/* should be 3.6		*/
    move(10,0);
    clreol();
    say(10,10,"Wrong version of operating system");
    aexit();
}

say(8,10,"Memory drive ");
if (md == TRUE)  putstr("exists.");
else putstr("not fitted.");

/* Allocate an 8k copying buffer most files less than 8k		*/
buf = alloc(SIZEBUF);

/* Look for AMIE.FLE - list of files needed. CR/LF delimited.		*/
/* Look on default drive and if not found try A: specifically		*/

if (md == FALSE)  say(10,10,"Getting list of files to be used.");

if ((flechan = fopen("AMIE.FLE","r")) == 0) {
    if ((flechan = fopen("A:AMIE.FLE","r")) == 0) prompt_copy("AMIE.FLE");
}

/* Get version number from AMIE.FLE					*/
if (fileline(flechan,sizeof(amievers),amievers) == -1) {
    clreos(10,0);
    say(10,10,"Error in Startup file AMIE.FLE");
    say(12,10,"Trouble with version number");
    aexit();
}

/* Check it								*/
if(strncmp(amievers,vers,7) != 0){
    clreos(10,0);
    say(10,10,"AMIE.FLE");
    say(12,10,"Wrong version");
    aexit();
}

/* Find Number of files in AMIE.FLE					*/
if (fileline(flechan,sizeof(nbrfiles),nbrfiles) == -1
						 || atoi(nbrfiles) < 10) {
    clreos(10,0);
    say(10,10,"Number of files error in Startup file AMIE.FLE");
    aexit();
}

/* Check that all of the amie files are present and correct		*/
chkfiles(nbrfiles,flechan);

/* Free copying buffer							*/
free(buf);

/* Check for enough space on M: for FORMATS.DAT and AMIE.FRM + space	*/
/* for other temporary files						*/

/************************************************************************/
/* DO NOT SIMPLIFY THE CALLS TO REC2BLK BELOW.  THEY MUST REMAIN	*/
/* SEPARATE TO ENSURE CORRECT ROUNDING					*/
/************************************************************************/

if (md == TRUE) {
    unlink("M:FORMATS.DAT");
    unlink("M:AMIE.FRM");
    reqblks = rec2blk(f_size("A:FORMATS.DAT"));
    reqblks += rec2blk(f_size("AMIE.AS") + 16);	/* Allow to grow 2k	*/
    reqblks += rec2blk(128);			/* For AMIE.FRM (16k)	*/
    reqblks += rec2blk(128);			/* For AMIE.DIR (16k)	*/
    reqblks += rec2blk(2);			/* For AMIE.SWT	(256)	*/
    reqblks += rec2blk(128);			/* Spare        (16k)	*/
    if (((LONG) space('M' - 'A') << 10L) >=
			((LONG) reqblks * (LONG) bsiz))  fdat_flag = TRUE;
    else say(8,32,"Insufficient space on M: for FORMATS.DAT");
}

/* Generate AMIE.FRM on default drive using 'sortos' and copying	*/
/* FORMATS.DAT to M: if flagged						*/
sortos(fdat_flag);

/* Check that there is enough space on temp file disc to run AMIE	*/
if (chk_space() == FAIL)  aexit();

/* Check existence of AMIE.FRM and check that the size corresponds with	*/
/* FORMATS.DAT if not do a sortos.					*/

/* Copy AMIE.FRM to M: if necessary					*/

/* Check Correct OS on track 1 and ask for system build if not		*/
/* Not in this version							*/

/* Could do system build automatically by means of a file to disc	*/
/* Not on this version							*/

/* Make surееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                                  CPM(REN)
.pa
*/
#include	"dd.h"
#include	"cpm.h"

EXTERN
BYTE	**menu_opt,	/* Messages for CP/M Utilities			*/
	cpm_drive;	/* Drive letter of CP/M drive in use		*/

EXTERN
WORD	cpm_user;	/* Current User number				*/

/*======================================================================*/
STATUS                              /*					*/
ren(target)                         /* Rename files on Destination disc */
WORD	target;		/* 0 for Source, 1 for Destination		*/
			/* Not used by this routine			*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPM UTILITY PROCESSOR
Revision History:
12/03/91 Declaration of 'fn' changed from '[20]' to '[22]' to allow
         room for 'D:USER00\ABCDEFGH.IJK' plus the terminating
         blank - ICFO
         Invalid file names INPUT are allowed but the user is not
         allowed to set an invalid name.  Non-printing characters are
         displayed as inverse video question mark.  All as per
         TCS 220 - ICFO
         'continue' statements removed.  Now obeys TCS 146 - ICFO
         Displays error 52 if file cannot be renamed - ICFO
26/04/89 '*' catered for - ICFO
14/04/89 User numbers added - ICFO
07/09/87 Now uses getdir not setdir DAR
04/09/87 Declaration of menu_opt changed to BYTE ** from BYTE[] DAR
22/2/87  Drive specification now <minflop{+1}> or switch spec -  DAR
         "Type new filename" prompt added
25/01/87 Screen is not now cleared except on exit.  The various
         menus overlay each other.  Also Invalid and Duplicate names
         allow the user to try again.
         This routine breaches TCS 146 by making use of two
         'continue' statements
21/01/87 Call to clear screen changed to 'clrs'
15/01/87 Created from 'erase'
*/

/* This routine tags the files to be renamed and then renames them all	*/

{

LOCAL
FILE	file,		/* Pointer to open file				*/
	file1;		/* Pointer to file opened to check for existance*/

LOCAL
WORD	i,j,k,		/* General counters				*/
	rv,		/* Return value					*/
	tot_files;	/* Count of the number of files on the disc	*/

LOCAL
BYTE	*sel_frame,	/* Pointer to the Menu Frame			*/
	*ptr,
	*txtp[4],	/* Pointers to dialogue messages		*/
	fc[15],		/* Array to hold a file name as input		*/
	fn1[22],	/* Array to hold copy of file name		*/
	fn[22];		/* Array to hold a filename			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Create "AMIE.DIR"							*/
if ((tot_files = getdir(cpm_drive)) == FAIL)  return(FAIL);

/* Create the Menu Frame						*/
if ((sel_frame = alloc(tot_files)) == (BYTE *) FAIL)  return(nferr(1));

/* Set up the Menu Frame with the tags of all files to be erased	*/
if ((rv = sel_file(sel_frame,tot_files)) == FAIL)  CLEANUP;

rv = SUCCESS;

clrs();

/* Open "AMIE.DIR" ready for reading					*/
file = spopen("AMIE.DIR","RC");

/* Set up the Text messages						*/
txtp[0] = menu_opt[9];				/* "Rename file"	*/
txtp[1] = menu_opt[10];				/* "Current name is"	*/
txtp[2] = &fn[2];				/* After the 'D:'	*/
txtp[3] = menu_opt[16];				/* "enter name etc"	*/

/* Set up drive ID letters						*/
fn[0] = fc[0] = cpm_drive & 0xef;
fn[1] = fc[1] = ':';

/* Get the first file name						*/
/* (Read ahead in the best Jackson tradition)				*/
getstr(file,&fn[2],20);

/* Loop round all the files						*/
/* (Note that the control variable is not incremented if an invalid or	*/
/* duplicate file name is given)					*/
i = 0;
while (i < tot_files) {

/* Rename a file provided that the new name is different from the old	*/
/* name and that the operator has responded with other than just	*/
/* 'Return' and the new file does not already exist			*/
    if (sel_frame[i] != FALSE) {
	strcpy(fn1,fn);		/* In case it gets changed for display	*/
	ptr = &fn[1];		/* Non printable shown as inverse ?	*/
	while (*++ptr != NULL)
			 if (*ptr < ' ' || *ptr > '_')  *ptr = '?' | 0x80;
	die that track 1 has been patched to start amie		*/
/* This accesses the wini						*/
pat_1();

/* Write an empty file to say amie has been checked			*/
fclose(fopen("AMIE.CHK","wb"));

clrs();

run_amie();

}

/*======================================================================*/
/*
.pa
.he                                                       AMIESTRT(CHECKVERS)
*/
/*======================================================================*/
WORD
checkvers(name,vers)
BYTE	*name,
	*vers;
/*======================================================================*/
/* Open the file for reading, check the version no against vers, close	*/
/* Say the version is wrong if it is					*/
{
/* Do nothing in this version						*/
return TRUE;
}
/*======================================================================*/
/*
.pa
.he                                                       AMIESTRT(CHK_FILES)
*/
/*======================================================================*/
VOID			/* Check that all files are present and correct	*/
chkfiles(nbrfiles,flechan)
BYTE	*nbrfiles;	/* Number of files to check in ASCII		*/
FILE	flechan;	/* channel no for file list			*/
/*======================================================================*/

{

LOCAL
WORD	i,j;

LOCAL
BYTE	mfname[16],	/* filename starting M:				*/
	fname[13];	/* Name of file to be copied			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Loop round the files							*/
for (i = atoi(nbrfiles); i > 0; i--) {

/* Get the filename							*/
    if (fileline(flechan,13,fname) == -1) /* error */;
    else {
	clreos(10,10);
	j = 0;
	while((fname[j] &= 0x7f) != 0)  putvid(fname[j++]);
	strcpy(mfname,"M:");
	strcat(mfname,fname);
	if (!(md == TRUE && f_exist(mfname) != -1)) {/* not on M:	*/
	    *mfname = 'A';
	    while (f_exist(mfname) == -1) {/* does not exist on A:	*/
		prompt_copy(fname);
	    }
	    if (md == TRUE)  copy(fname,"A:","M:");
	}
    }
} /* end of file for loop */

if (f_exist("A:FORMATS.DAT") == -1)  prompt_copy("FORMATS.DAT");

}

/*======================================================================*/
/*
.pa
.he                                                     AMIESTRT(PROMPT_COPY)
*/
/*======================================================================*/
WORD			/* Get the file from correct floppy		*/
prompt_copy(fname)
BYTE	*fname;
/*======================================================================*/

/* File has not been found or is wrong version so we must get it from a	*/
/* floppy.  As the correct format may not be setup we must set it up	*/
/* 23/02/87 version no changed to hex - DAR				*/
/* 17/11/87 prompts for vers not amievers				*/

{

WORD	drive;		/* ASCII drive letter				*/

/* EXTERN	struct	dtext	*fdtext; previously defined		*/

EXTERN	BYTE	Cmode;

BYTE	from[16],
	drv[3];

Cmode = 0;
drive = minflop();
strcpy(from,"@:");
*from = (char *) drive;
strcpy(drv,from);
strcat(from,fname);
if (strcmp(fdtext[drive - 'A'].dtxt_format,"GEMQDDS")) {
    say(10,10,"Setting GEMQDDS on drive ");  putvid(drive);  clreol();
    exec("A:SET","-fGEMQDDS/ -eAMIE CHECK");
    aexit();
}
clreos(10,0);
while(TRUE) {
    say(12,10,"File missing - ");
    putstr(fname);
    say(14,5,"Put one of the discs marked AMIE ");  putstr(vers);
    putstr(" in ");  putstr(fdtext[drive - 'A'].dtxt_drive);
    putstr(" and press a key to continue.");
    say(22,20,"<ESC> to exit to operating system");  move(13,5);
    if (conin() == ESC) {
	clrs();
	aexit();
    }
    clreos(12,0);
    if (f_exist(from) != -1)  break;
    clreos(10,0);
    say(16,10,"Cannot find file - ");
    putstr(from);
    putstr(" - try again using another disc");
}

copy(fname,drv,"A:");

}

/*======================================================================*/
/*
.pa
.he                                                         AMIESTRT(F_EXIST)
*/
/*======================================================================*/
WORD			/* Returns 0 - 3 if it exists else -1		*/
f_exist(name)
BYTE	*name;
/*======================================================================*/

{
makfcb(name,&fcb);
bdos(26,0x80);
return(bdos(15,&fcb));
/* No need to close the file ( p101 CP/M manual)			*/
}

/*======================================================================*/
/*
.pa
.he                                                          AMIESTRT(F_SIZE)
*/
/*======================================================================*/
UWORD				/* File size in 128byte records		*/
f_size(name)
BYTE	*name;			/* Filename - drive optional		*/
/*======================================================================*/
/* fails if filesize is 8 Mb or 128 bytes less				*/

{
makfcb(name,&fcb);
if (bdos(0x0f,&fcb) == -1) return(0xffff);
bdos(0x23,&fcb);
return(fcb.fcb_fsize);
/* No need to close the file (p101 CP/M manual)				*/
}

/*======================================================================*/
/*alogue(NULL,NULL,4,txtp,12);
	strcpy(fn,fn1);
	cur_on();
	j = getlin(&fc[2],13);
	cur_off();
	if (j != 0)  break;
	j = -1;
	while (++j < strlen(fc))  fc[j] = toupper(fc[j]);
	if ((k = chuser(fn)) == -2) {	/* Caused by NULL in file name	*/
	    flerr(fn,52);			/* Cannot rename	*/
	    if (++i < tot_files)  getstr(file,&fn[2],20);
	}
	else {
	    bdos(SETUSR,k);
	    if (strlen(fc) > 2 && strcmp(fn,fc) != MATCH) {
		if (fnchek(fc) == FAIL) {
		    fc[0] = '|';
		    j = 0;
		    while (fc[++j] != NULL)  fc[j] = fc[j + 1];
		    fc[--j] = '|';
		    fc[++j] = NULL;
		    flerr(fc,15);		/* Invalid name		*/
		    fc[0] = cpm_drive & 0xef;
		    fc[1] = ':';
		    strcpy(fn,fn1);
		}
		else if ((file1 = spopen(fc,"RC")) != OPENFAIL) {
		    file1 = spclose(file1);
		    flerr(&fc[2],27);		/* File exists		*/
		    strcpy(fn,fn1);
		}
		else {
		    if (rename(fn,fc) < 0)  flerr(fn,52);/* Can't rename*/
		    if (++i < tot_files)  getstr(file,&fn[2],20);
		}
	    }
	    else if (++i < tot_files)  getstr(file,&fn[2],20);
	}
    }
    else  if (++i < tot_files)  getstr(file,&fn[2],20);
}

/* Release memory, clear screen and return				*/
spclose(file);

clrs();

bdos(SETUSR,0);

cleanup:

free(sel_frame);

return(rv);

}

/*======================================================================*/
(fn,fc) < 0)  flerr(fn,52);/* Can't rename*/
		    if (++i < tot_files)  getstr(file,&fn[2],20);
		}
	    }
	    else if (++ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(SELPRC)
.pa
*/
#include	"dd.h"

EXTERN
FILE	dirfd;			/* File descriptor for directory file	*/

/*======================================================================*/
STATUS                                 /*				*/
sel_proc(lev)                          /* Select next file for transfer	*/
struct	lvl	*lev;				/* AMIE Level structure	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMINP CP/M input driver
Revision History:-
24/04/89 Tidied up - ICFO
08/09/87 Directory file now closed in 'cpmin.c' - ICFO
*/

{

STATIC
WORD	sel_init = FALSE;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

if (sel_init == FALSE) {	/* No directory file as yet		*/

	if (setdirf(lev) == FAIL)  return(FAIL);
	sel_init = TRUE;
}
	
/* Get 1st/next/last filename for reading				*/
return(getfname(lev));

}

/*================
.pa
.he                                                        AMIESTRT(FILELINE)
*/
/*======================================================================*/
STATUS                              /* Returns FAIL for EOF encountered */
fileline(chan,strsiz,str)           /* File line to string		*/
WORD	chan,					/* File channel		*/
	strsiz;					/* Size of string	*/
BYTE	*str;					/* Pointer to string	*/
/*======================================================================*/

{

/* Gets line from CR/LF delimited file and puts in null term string	*/
/* trailing spaces and tabs removed.					*/
/* Assumes that we start at the beginning of a line and leaves at the	*/
/* at beginning of the next.						*/
/* Assumes that the file is already open in non binary mode. ie no CR's	*/

LOCAL
WORD	i,		/* Counter					*/
	c;		/* Character storage				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

for (i = 0; i < strsiz - 1; ++i) {	/* Leave space for the null	*/
    if ((c = getc(chan)) == EOF) {
	*(str + i) = NULL;
	return(FAIL);
    }
    if (c == (WORD) LF)  break;
    *(str + i) = c;
}
*(str + i) = NULL;		/* Add the null				*/
--i;				/* Move back off the NULL		*/
while (i > 0) {			/* Deal with trailing spaces and tabs	*/
    if (*(str + i) == SPACE || *(str + i) == TAB) *(str + i--) = NULL;
    else  break;
}

/* Skip to end of line							*/
while (c != LF)  if ((c = getc(chan)) == EOF)  return(FAIL);

return(SUCCESS);

}

/*======================================================================*/
/*
.pa
.he                                                            AMIESTRT(COPY)
*/
/*======================================================================*/
WORD				/* Copy file from one drive to another	*/
copy(fname,from,to)
BYTE	*fname,			/* Valid filename with no drive		*/
	*from,			/* Drive string in the form X:		*/
	*to;			/* Drive string in the form X:		*/
/*======================================================================*/

{

/* There is no check of how many bytes copied				*/
/* 18/11/87	Copying via temp file to avoid corrupted files		*/

LOCAL
FILE	fchan,			/* File Channel				*/
	tchan;			/* File Channel				*/

LOCAL
UWORD	bufsize;		/* Size of buffer			*/

LOCAL
BYTE	ffname[16],		/* Filename string constructed		*/
	tfname[16];		/* Filename string	"		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Open file for reading						*/
strcpy(ffname,from);
strcat(ffname,fname);
if (!(fchan = fopen(ffname,"rb"))) {
    say (10,10,"Failed to open file - ");
    putstr(ffname);
    aexit();
}

/* Open file for writing						*/
strcpy(tfname,to);
strcat(tfname,fname);			/* "AMIE.$$$"); */
if (!(tchan = fopen(tfname,"wb"))) {
    say(10,10,"File opening failure - ");
    putstr(tfname);
    aexit();
}

/* Do the copy								*/
say(11,10,"Copying from ");  putstr(ffname);  clreol();
while (TRUE) {
    if ((bufsize = read(fchan,buf,SIZEBUF)) == 0)  break;
    if (write(tchan,buf,bufsize) != bufsize) {
	say(11,10,"Disc or directory full - cannot run AMIE\n\n");
	aexit();
    }
}

/* Close the files and free the buffer					*/
fclose(fchan);
fclose(tchan);

return SUCCESS;

}

/*======================================================================*/
/*
.pa
.he                                                           AMIESTRT(PAT_1)
*/
/*======================================================================*/
VOID                     /*						*/
pat_1()                  /* Patches track 1 for correct running of AMIE */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

bios(SELDSK,0);				/* Select drive A:		*/
bios(SETDMA,DEFDMA);
bios(SETTRK,1);
bios(SETSEC,4);
bios(BIREAD,0);				/* Read in the record		*/
strcpy(0x77 + DEFDMA,"005");		/* Patch it			*/

bios(BIWRITE,0);			/* Write it out			*/
bios(SETSEC,0);				/* Do a read to flush buff	*/
bios(BIREAD,0);
biosh(SELDSK,bdosh(25));		/* Put bios in synch with bdos	*/

}

/*======================================================================*/
/*
.pa
.he                                                              AMST(SORTOS)
*/
/*======================================================================*/
VOID                                          /*			*/
sortos(fdat_flag)                             /* Sort operating systems */
BOOLEAN	fdat_flag;		/* TRUE if to copy FORMATS.DAT to M:	*/
/*======================================================================*/

{

/* The structure of the output file is as follows			*/
/* 	64  2 byte pointers that point to the byte just past the format	*/
/*	names for their operat1ng system type. The last pointer will	*/
/*	just past the end of the file. There is no EOF character.	*/
/*									*/
/*	List of format names ( up to 8 chars null filled to 9 bytes)	*/
/*	starting with those from operating system type 0 and goin======================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(SETDRF)
.pa
*/
#include	"dd.h"
#include	"cpm.h"

EXTERN
WORD	cur_file,		/* Ccurrent file in file list		*/
	cpm_user,		/* Current user number			*/
	tot_files;		/* Total number of files in list	*/

EXTERN
BYTE	*sel_frame;		/* Address of alloced answer frame	*/


EXTERN
BYTE	*spdname;		/* "AMIE.DIR" directory filename	*/

EXTERN
FILE	dirfd;

/*======================================================================*/
STATUS                                /*				*/
setdirf()	                      /* Create file of directory names	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMINP CP/M input driver
Revision History:-
24/04/89 Tidied up and 'cleanup' introduced for user numbers - ICFO
08/09/87 'dirfd' set to zero on OPENFAIL - DAR
*/

{

LOCAL
STATUS	rv;			/* Return value				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

cur_file = 0;	/* Set current file number to start of list		*/

/* Reserve an answer frame for the file selection process		*/
if ((sel_frame = alloc(tot_files)) == (BYTE *) FAIL) {
    bdos(SETUSR,0);
    rv = nferr(1);
    CLEANUP;
}

/* Now go off and select which file names are to be sent		*/
if ((sel_file(sel_frame,tot_files)) == FAIL) {
    rv = FAIL;
    CLEANUP;
}

/* Open up the directory file ready for reading				*/
if ((dirfd = spopen(spdname,"RC")) == OPENFAIL) {
    dirfd = 0;
    rv = flerr(spdname,3);
    CLEANUP;
}

rv = SUCCESS;

cleanup:

return(rv);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееg on	*/
/*	to 63. Where there are no formats for an ostype, adjacent	*/
/*	pointers will be found to be equal. A two byte index into the	*/
/*	data record in FORMATS.DAT is put after each name. Intel style.	*/

/* Beware of bugs in SETUP that set the number of formats greater than	*/
/* true as these can be perpetuated and cause a seek past the end of	*/
/* file and therefore a seek fail. If this happens either correct	*/
/* FORMATS.DAT with DU or try REPACK					*/

/* 13/12/87	V2.11 Speed increased, only works from M:, SETUP bug	*/
/*		overcome, prepared for integration into AMST		*/
/*		For this version it is assumed that the formats are	*/
/*		already sorted alphabetically using the sort program.	*/


LOCAL
WORD	fptr,		/* Pointer to next format name in output file	*/
	offset,		/* Offset *128 bytes to data of FORMATS.DAT	*/
	curfrm,		/* Current format (0 based) but the zeroth is 	*/
			/* not a real format				*/
	nbrfm,		/* Number of entries in FORMATS.DAT inc empty	*/
	i,		/* Character counter				*/
	ostype,		/* Operating system type - range 0 - 63		*/
	reccnt,		/* Record counter				*/
	recnames,	/* Record of format names			*/
	ifptr[64];	/* space for pointers waiting to be written out	*/
			/* also used for BOOLEAN od existance of ostype	*/

LOCAL
UWORD	fsize;		/* Size of FORMATS.DAT in records		*/

LOCAL
BYTE	*names,		/* Pointer into format names array		*/
	*osarry,	/* Pointer to OSTYPE array			*/
	*nampoint,	/* Moving pointer				*/
	*outspace,	/* Area for output file				*/
	*outpoint,	/* Pointer in above space			*/
	*outend;	/* Pointer to end of above space		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */

clreos(10,0);
say(10,10,"Indexing format database");

/* Open FORMATS.DAT on A: in case it was edited				*/
makfcb("A:FORMATS.DAT",&fcb);
if(bdos(0x0f,&fcb) == -1) {
    putstr("\nCannot open A:FORMATS.DAT");
    aexit();
}

/* Get the filesize in 128 byte records					*/
bdos(0x23,&fcb);
fsize = fcb.fcb_fsize;		/* Must store as fcb will change	*/

/* Read FORMATS.DAT header and get format offset			*/
bdos(0x1a,DEFDMA);		/* Set default DMA area			*/
bdos(0x14,&fcb);		/* Read 1st 128 bytes			*/
nampoint = DEFDMA;
offset = *(nampoint++) + 256 * *(nampoint);

/* Calculate the real number of formats from filesize not header	*/
nbrfm = fsize - offset;

/* Allocate enough space for output data				*/
outpoint = outspace = alloc((nbrfm * 11) + 128 - ((nbrfm * 11) % 128));

/* Allocate space for names and ostypes					*/
osarry = alloc(nbrfm);
if ((nampoint = names = alloc(128 * offset)) == (BYTE *) FAIL) {
    putstr("\nNot enough memory\n");
    aexit();
}

/* Copy from defdma into alloc area					*/
cpymem(DEFDMA,names,128);

if (fdat_flag == TRUE) {
    makfcb("M:FORMATS.DAT",&mfcb);
    bdos(0x13,&mfcb);			/* Delete old one		*/
    if (bdos(0x16,&mfcb) == -1) {
	putstr("Cannot create M:FORMATS.DAT");
	aexit();
    }
    mfcb.fcb_extent = mfcb.fcb_currec = 0;

/* Write out first record						*/
    if (fdat_flag == TRUE) 	bdos(0x15,&mfcb);
}

/* Read format names into an array in memory				*/
for (i = offset; --i > 0; ) {
    nampoint += 128;			/* Skip first, move pointer	*/
    bdos(0x1a,nampoint);		/* Set dma			*/
    bdos(0x14,&fcb);
    if (fdat_flag == TRUE)  bdos(0x15,&mfcb);
}

/* Read OSTYPEs into an array in memory					*/
curfrm = 1;
bdos(0x1a,DEFDMA);
bdos(0x14,&fcb);			/* Throw away dummy format	*/
if (fdat_flag == TRUE) 	bdos(0x15,&mfcb);
nampoint = DEFDMA + 33;
while (curfrm < nbrfm) {

/* Move onto format							*/
    bdos(0x14,&fcb);

/* Only bottom 6 bits needed						*/
    *(osarry + curfrm++) = *nampoint & (TOTOS - 1);

/* Fill in osarray to say this ostype is used				*/
    ifptr[*nampoint & (TOTOS -1)] = TRUE;

    if (fdat_flag == TRUE)  bdos(0x15,&mfcb);
}

/* Close the input file and output file if necessary			*/
bdos(0x10,&fcb);
if (fdat_flag == TRUE)  bdos(0x10,&mfcb);

/* Set file index pointer to skip over the 64 pointers			*/
fptr = 2 * 64;

/* Loop round each OSTYPE starting with zero and finishing after no 63	*/
for (ostype = 0; ostype < TOTOS; ostype++ ) {

/*  Check to see if any formats have this ostype			*/
    if (ifptr[ostype] == TRUE) {	

/* Loop till end of formats						*/
	curfrm = 1;
	while (curfrm < nbrfm) {

/* Test OSTYPE and see if format is valid i.e. not null.		*/
	    if ((*(osarry + curfrm) == ostype) && \
				      (*(names + (curfrm * 8)) != NULL)) {

/* Write out format name - eight characters + null			*/
		i = 0; 
		while (i < 8) *outpoint++ = *(names + (curfrm * 8) + i++);
		*outpoint++ = NULL;	   /* Null term the string	*/

/* Now write out the pointer in intel fashion				*/
		*outpoint++ = (offset + curfrm) % 256;
		*outpoint++ = (offset + curfrm) / 256;

/* Increment index pointer for disc file by 11 bytes			*/
		fptr += 11;
	    }
	    ++curfrm;		/* Increment current format counter	*/
	}
    }

/* Write out pointer in array to next format				*/
    ifptr[ostype] = fptr;
}

/* Createееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(SETUSR)
.pa
*/
#include	"dd.h"

EXTERN
BYTE	**menu_opt;			/* Messages			*/

/*======================================================================*/
WORD                                     /*				*/
set_user(target)                         /* Set the current user number */
WORD	target;					/* SOURCE or DEST	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPMMAN UTILITY MANAGER
Revision History:
25/04/89 '*' allowed for - ICFO
14/04/89 Started - ICFO
*/

{

LOCAL
BYTE	user[3];		/* String from the operator		*/

LOCAL
WORD	cpm_user;		/* Return value				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Loop until a suitable new value is input				*/
cpm_user = (WORD) FAIL;
while (cpm_user == FAIL) {

/* Ask the operator for the new user number				*/
    dframe[0] = menu_opt[27 + target];
    dframe[1] = menu_opt[29];
    dialogue(NULL,NULL,2,dframe,2);
    cur_on();
    if (getlin(user,sizeof(user)) != 0 || strlen(user) == 0) {
	cur_of();
	cpm_user = (WORD) FAIL;
	CLEANUP;
    }
    cur_of();

/* Return value of -2 if '*'						*/
    if (user[0] == '*') {
	cpm_user = -2;
	CLEANUP;
    }

/* Test if all characters are digits					*/
    cpm_user = 0;
    while (cpm_user < sizeof(user) && user[cpm_user] != NULL) {
	if (isdigit(user[cpm_user++]) == FALSE) {
	    cpm_user = (WORD) FAIL;
	    break;
	}
    }
    if (cpm_user != (WORD) FAIL)  cpm_user = atoi(user);

/* If the user is invalid output an error message ("Invalid input")	*/
    if (cpm_user == (WORD) FAIL || cpm_user < 0 || cpm_user > 63)
						     cpm_user = nferr(12);
}

cleanup:

/* Display the new value						*/
cpm_user = disp_user(cpm_user);

clrs();

return(cpm_user);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее output file AMIE.FRM on default drive				*/
makfcb("AMIE.FRM",&fcb);
bdos(0x13,&fcb);			/* Delete file			*/
if (bdos(0x16,&fcb) == -1) {		/* Cannot create file		*/
    putstr("\nCannot create output file");
    aexit();
}

/* Set current record and extent to zero for sequential write		*/
fcb.fcb_extent = fcb.fcb_currec = 0;

/* Write out the pointers to the file					*/
bdos(0x1a,ifptr);
bdos(0x15,&fcb);

/* Write out the format data						*/
outpoint = outspace;		/* Set pointer				*/
outend = outspace + (nbrfm * 11) + 128 - ((nbrfm * 11) % 128);
while (outpoint < outend) {
    bdos(0x1a,outpoint);
    bdos(0x15,&fcb);
    outpoint += 128;
}

/* Close the output file and free memory				*/
bdos(0x10,&fcb);
free(outspace);
free(osarry);
free(names);

say(10,10,"Format database indexed");
clreol();

}

/*======================================================================*/
/*
.pa
.he                                                          AMIESTRT(A_EXIT)
*/
/*======================================================================*/
VOID                  /*						*/
aexit()               /* Turn on cursor before exit to operating system */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */

cur_on();
exit();

}

/*======================================================================*/
/*
.pa
.he                                                      AMIESTRT(WAIT_A_BIT)
*/
/*======================================================================*/
VOID                                        /*				*/
wait_a_bit()                                /* Ask the operator to wait */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */

dframe[0] = "Timeclaim AMIE";
dframe[1] = "Please Wait";
dialogue(0,0,2,dframe,0);

}

/*======================================================================*/
/*
.pa
.he                                                       AMIESTRT(CHK_SPACE)
*/
/*======================================================================*/
STATIC STATUS  /*							*/
chk_space()    /* Check enough space on temporary file disc to run AMIE */
/*======================================================================*/

{

/************************************************************************/
/* DO NOT SIMPLIFY THE CALLS TO REC2BLK BELOW.  THEY MUST REMAIN	*/
/* SEPARATE TO ENSURE CORRECT ROUNDING					*/
/************************************************************************/

LOCAL
WORD	reqblks;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

reqblks = rec2blk(f_size("AMIE.AS") + 16);
reqblks += rec2blk(128);			/* For AMIE.DIR (16k)	*/
reqblks += rec2blk(2);				/* For AMIE.SWT (256)	*/
reqblks += rec2blk(128);			/* Spare        (16k)	*/
if (((LONG) space((md == TRUE) ? 'M' - 'A' : 'A' - 'A') << 10L) <
					   (LONG) reqblks * (LONG) bsiz) {
    clreos(10,0);
    say(10,10,"Not enough space on Drive ");
    putvid('A' + ((md == TRUE) ? 12 : 0));
    putstr(": to run AMIE");
    return(FAIL);
}

return(SUCCESS);

}

/*======================================================================*/
/*
.pa
.he                                                         AMIESTRT(REC2BLK)
*/
/*======================================================================*/
STATIC WORD    /*							*/
rec2blk(n_rec) /* Convert file size in records to CPM allocation blocks */
WORD	n_rec;					/* Number of records	*/
/*======================================================================*/

{

/* Assumes that STATIC GLOBAL 'bsiz' has been set up			*/

LOCAL
WORD	n_blk;	/* Number of allocation blocks occupied by the file	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

n_blk = (WORD) (((LONG) n_rec * 128L) / (LONG) bsiz);

if ((WORD) (((LONG) n_rec * 128L) % (LONG) bsiz) != 0)  ++n_blk;

return(n_blk);

}

/*======================================================================*/
n set up			*/

LOCAL
WORD	n_blk;	/* Number of allocation blocks occupied by the file	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

n_blk = (WORD) (((LONG) n_rec * 128L) / (LONG) bsiz);

if ((WORD) (((LONG) n_rec *ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                            S.P.I.T(SIEVE)
.pa
*/
#include	portab.h

/*======================================================================*/
VOID
sieve(sptr,dptr)	/* take source filename & make a valid CP/M	*/
			/* filename from it in a destination string	*/
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = CPMOUT CP/M output driver
Revision History:-
25/6/87		rewritten DAR
*/

BYTE	*sptr,		/* pointer to source filename			*/
	*dptr;		/* pointer to dest filename			*/

{
LOCAL
BOOLEAN	defined;	/* flags filename definition complete		*/

LOCAL
WORD	n;		/* counts filename characters			*/

/* process 1st section of the filename					*/
for(defined = FALSE, n=0; n < 8 ; n++){

/*	if end of source string hit flag name as defined		*/
	if(*sptr == 0){
		defined = TRUE;
		break;
	}

/*	if 1st dot delimiter hit then break				*/
	if(*sptr == '.')
		break;

/*	convert source byte to U/C & test for validity			*/
	*sptr = toupper(*sptr);

/*	if char invalid replace by '-'					*/
	*dptr++ = (isfchr(*sptr) == TRUE) ? *sptr : '-';
	sptr++;
}

/* process the 3 letter extension					*/
if(defined == FALSE){

/*	put dot delimiter in filename					*/
	*dptr++ = '.';

/*	skip past all dots in source					*/
	while(*sptr == '.') sptr++;

/*	get extension name						*/
	for(n = 0; n < 3 ; n++){

		if(*sptr == '\0' || *sptr == '.') break;
		*sptr = toupper(*sptr);
		*dptr++ = (isfchr(*sptr) == TRUE) ? *sptr : '-';
		sptr++;
	}
}

/* terminate the destination string					*/
*dptr = '\0';

return(SUCCESS);
}

/*======================= end of sieve =================================*/
/* Routines called:- isfchr toupper					*/
/*======================================================================*/
 extension name						*/
	for(n = 0; n < 3 ; n++){

		if(*sptr == '\0' || *sptr == '.') break;
		*sptr = toupper(*sptr);
		*ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее




#define		DAY	0
#define		MONTH	3
#define		YEAR	7
#define		HOURS	10
#define		MINS	13
#define		SECS	16
#ifndef		RTC
#define		RTC	2
#endif
#ifndef		SVC
#define		SVC	1
#endif
struct fcbt {
	BYTE	fcb_disc;
	BYTE	fcb_fname[11];
	BYTE	fcb_extent;
	UWORD	fcb_s12;
	BYTE	fcb_reccnt;
	BYTE	fcbab[16];
	BYTE	fcb_currec;
	UWORD	fcb_fsize;
	BYTE	fcb_maxsize;
} ;

xtent;
	UWORD	fcb_s12;
	BYTE	fcb_reccnt;
	BYTE	fcbab[16];
	BYTE	fcb_currec;
	UWORD	fcb_fsize;
	BYTE	fcb_maxsize;
} ;

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…STХ UD•DДXYINDATEЃ“PСSђаd5E$ЕхЁ	UGENMESЃђSRQU‘`$ФHQ1FDEVICEЃ‘”ђSQ`DU„хh1=AAfGENMFЃTУУ`U$4X	EDTBLЃ‘••P 4E(A"FDTEXTЂСђР DФd4(5%:F_EXISЃPQVU et•EфAI=5ARFILELIЃђТС’S deх4•¤XM=IQ=NPAT_1ЃђТPТХ D4х™@ Ч„\‚M$‘D“ЂДe4›Њв Кc5™LЂ°Аj. Ёґ`3ЋF                                                                                                                                                                                                                                                 %їЂ                            Ђ еЂ Vh  Б`і@ h  ! ўАКН  "асМ3і@ UFѓ :’!  ¬Ъ<Б`€C +6Ѓ0EАг gfУ°&UiЂ@:Ш!  V VН  UрB 0лш„  rі@ Љш 
¬06ёЃ0­HЄГ 
Щ¶,	•iЂ„7РMКН»A,6Ї3m 6УЃ2©И„ і@  ‹шюН  Tд›s„„lЫ*К№ЂLЫ8$Н  ґ	›hД„7рКН  "ш еСР(„ rі@ +4  `°X,ь r€hи”B 9Y  ‚БЯА+4  `€@ +4  `іi„ r€A@(†ю‰№Y  ‚БfЂ @(еfЂ mњ–њЃ€i@ Љѕ lађ€  Ђ +шЂ.QUь… –h  С>„…Wр" \ў«ш
Ђ,Ъ°С>„„ @ е›m …b¶mДeY 1 9fЧp1Ќ›aЂЬў^(еfЂ 6ѕіmP*ШЃ€o ›•›v‚X"3вХ•l@Щ/*
.he                                                               CPM(SWCLSE)
.paЉ*/
#include	"portab.h"

EXTERN
BYTE	*switches;	/* Pointer to manager switch list area		*/

EXTERN
WORD	td;		/* Pointer to base address of switches area	*/

/*======================================================================*/
VOID                              /*					*/
sw_close()                        /* Close switch list to driver access */
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMMAN CP/M UTILITIES MANAGER
Revision History:-
12/04/89 Tidied up - ICFO
25/03/87 Extracted from cpman listing - DAR
*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

switches = NULLPTR;	/* No more switches available			*/
	
cls_txt(td);		/* Free base address of switch area		*/

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(SWOPEN)
.paЉ*/
#include	"portab.h"

EXTERN
BYTE	*exov,
	*switches;	/* Pointer to manager switch list		*/

EXTERN
WORD	td;		/* Switch text descriptor			*/

/*======================================================================*/
STATUS                 /*						*/
sw_open(target)        /* Open switch lists ready for access by drivers */
WORD	target;					/* SOURCE or DEST	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMMAN CP/M UTILITIES MANAGER
Revision History:-
12/04/89 Tidied up and optimised
25/03/87 Extracted from cpman listing - DAR
*/

{

LOCAL
BYTE	*sw_arr[8];

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load switches from AMIE.011 & set pointers to them			*/
if ((td = opn_txt("AMIE.SWT",sw_arr,8)) == (BYTE *) FAIL)
					      return(flerr("AMIE.SWT",3));

switches = sw_arr[(target != ¶pJ[b!  ўPК!  Vm&`°X" К! ў, еfЫа6‚!  ўёК!Ј VmР`°X"j(еfЂ 	< "ѕ@«д џЩ¶и	ҐFAt8U|Ђb+д Гѕ bиКН  ,:! ўPК!¦вЋVmв`°X,Р  "К?іoаj®A@(„  rі@ ›K Д  ”B
 9D5PQКН¤АЊ›g„ Ђ”B
 9D5ШQКНЄЂЊUaЂlЫ0К°`‚(еfЮА6Е‚l`Ј•›_A"КН  "*Њ *°АЪжК¶ ‚PК! ў0(еfЦђF‚!·BЋQГrі@ E~ ¶h•yA7QК!ёbЋVmє`°DWа›pЃW”Cn…¬Ъ@Б–т‚
ЇА”B 9D5шКНЁaLF|Z°©€(„ r€@ +4  `°D  ”B
 9D7@QКНµЂЊB 9D  ”C{Е¬Ъ.
Б`°Y¶pHC_Ђў, еЃАVh  Б`°O‹VU|‚ЂQ  еfР`VB
 9D  ”Cn…¬ЪR
Б`°D А”B
 9D4,UКН¬@¬›g…WаК!ЂўьеfФ0¦‚#fЭЂFЈЯа+4  `„A@h  Ні`l«–
! ў КНЄ ¬„ r€A@(†ЊЉ№YµР‚Б`іlађ†я №EWаКН `мЄЈ 9Y  UaЂlЫ 
Кµ Вђ*еfУ06†«
№Y·ј‚!¬"®Vm
`№Y¶xM‚"ѕАЮ*еfР`¦D  №Y¶xM‚л_` ИЉы P +6П	°]b«м _`
  еfЩб6¬U}Ђ"+м ! ¬Ы<&БuЉЇ° dE}Ђ( •›g„Ш.±Uц €Ї° „ rі@ 4  bµB     fЂ VЁЄы 3k`3Є*ѕ ЪюН    *Нѓ@ aЪРa  е€ Qwrіn+‚Б–Цѓ
Ё•›uѓX,Ыњ$#fЮPVUВfЩБ&m°ЯA7(†Р
№Y·@‚Бrі@ 6‹Ѓі@ H„ dЂ                                     @ е›bАЬ¬Ы4
Б^ aUвїПмЪdТ б:X*ј@В±в°иђ8„ іh@;”B 9D7ШКНЁaLF|Z°ЄX;‚A@(„ rіmђ+‚!  WђUy‚7Ш2еfЦР10 ъж?›Ъ'Р“6ТІ¬x8ЄтДWђVѕАБ–mgrіh#‡WЃД7К!ґb®Vh  Б`€o03”C}Ѓњ¬Р ‚БX`[6Э2­ш8†у9Y·h%‚#fЧ0vmЅfЪаvUђ@С•жЮ`g+6н°DgЕ«
ф€o°3•›H,;ћ*°А¶mГeP@Ѓцr€m0«”ChЕ\¬ЪцБ`°e ЃР@†!ЦW+6н°DgЕ«
Ћ„jP«•›H,ђ  BнЋ_"Є<еЂ Сђ  Н  Tx B \ўR*еfЩЂvB \ўЄ<С>„„   еК!Ђ.Vm@`°D P еК!Ђ,ЪbеfЪPvUG‚+чшd" 3@ XЄУ \ўX*еfЩ06шµe[аЃ( е‚ЂQґrіm@3‚БQа‡+6Дѓ°YµCs…\ўЁ*еfЂ 6О	A@(„  rіj ;‚! Ђ‹VU№	ѓ Q( еЮБW+6П0X,\ 9fЦЂ‡+6Д0D а”B 9D7рUКНјCEЂ¬ЫЬБСбg+6„°ETx "ї†B! 6Ѕ„:ЕV 2Ђ.Vm	`€iі•›JВX"°К!
 ў‚,еfЯа†‚!Ђў(КНЁ Њ4  №_б“вХ…YВY·`›g„ А”B  9Y·!‚БЃ@—+6н°DgЕ«*Г°нИH„ r€@ +6ё°X"ЂК! ўЖ,еfФ0–‚!Ђ.Vm3	`€kёі•›jВX,;–!Ђ,ЫФеЃ —(†У
№Yµм-‚Б`ёDTx B _,‘ 9fЫа—(†Ф 9Y  ‚! ў КН©`L„ r€m@•›}X,H„ іnшK”Cj ¬ЫОБ`€Aа(†Ф 9Yґ)‚Бџ¬*\!їЩ"К!µ Vm 
`°EW$’      EOВ„ @ е›BВ…n±U?
fЪVU¶
aЦЂЎU?
€©шS¤…@АЛ6§9Y  EPB„lЫЪКІB rН­ЎN±U?
ЌЂыэ’! ўЄ‚Н  VЂ)‡m‚„   е›`ВќbЄ~rЉЄSDъaХаЎ 9fЪP§XЄџ…FАU?
€©шPЄџ…_зцmiRЂ± 9fЫ°§XЄџ…Y¶"а†Yµд)…A‚Д   е›wќbЄ~fЮ@ ‹ЭюfЮ°¦mАeR ±U?
€©шPЌЦ! ,Ык t”-‡JШw,*ZP*Ё!Aіь2|ZІЄ€X„ іhР[•›\B"*‚#fР@¶UNїЯм–(Ђ ђ                                          5l-К! ,ЪrеfХ †CVВЬў@ rН°ЃnVml`°D5l-К!ІвОVmО`°DUT-›QBЩW@,B
 9D  ”Cf…њ¬Ы@Б`°D5l-КН¶a,mњЦ°·(„ іlЁ[•›bШ,kr€A Л6м…№Y¶d-‚БЦ°·(†Р
№Y¶-‚БUp¶m®eRPБ( е‚ЂQ±rіn [‚БЦ°·+6е°Y¶pHB 9D  ”CrEњ¬Ъ*Б`°D5l-КНЈбЊm¬Ђ@Е«*О
ЄЁ[”UQЂўКН  ,Љ¬…іhc*ґ0ма`Є«…№EUК*«!nVh  Б`°\ўЄІН  Vd0B 9D  ”CuЕњ¬ЪdБ`°Y¶pI‡PѓUT-КНєЂМUWrіmcB  2D!°”B  9Y  ‚! ў КН·!Њ„< r€@ +6г0X"К! ¬Ы¦Б`€Dа(„  rіo c‚!{Ђў.еfЭР¶B* 9D  •›{C,„ еЂ Vm`°D"p”B  9YґP5‚Б†АQd еfХ@&•љ  0X,ђ                                                                                                                                                                                   ”B  9Y¶<%‚Б‚ЂQ( еРaw+6И†0X,ar€m@•›DВ,< еЪЂ+6›…0X"3вХ…H„4|]КН§ЃЊmњ€АQЁ rіhXs‚*№ +ђ! ў КНҐ!М„( r€m@•›O,
  "№Бў«њ#\аС[6ю…9EW85›W‚  6ЏґC"*t*№®QU:fЂ *|*§БЎX›ZC‚(  eК*§БЎX›aќb љ  :Щµа9КНІ ЊР] СU>rіmsEsETи4"Ђ 3lђs•›kГ"+”"№Б®QэюНіL«ј!§BоVm`іlађ…  rЉ®Pk”BЂ 9Y  ‚БЂЂ–mкіk c*®€j@«”Cs ¬ЫьБ`€B`(†ж 9Yµ$9‚Б…ЂQМ rіh {‚#>-XTШ<CS…Ь¬Ы°БfЩБ!  }^АиКм @@Л6ъ‡
Щ·д9•WД!P”Cs ¬ЪBБ`ЛWЕTи4EPEU 4V"ЁЎщэ›t‚љVР<UsѓB(  dEsѓD! ”Usѓ\¬Ъ°Б`€BЂ(†Ф 9Y¶=‚БЂЂ–mFіjP{*Ш‡€B (†ж 9Y¶H=‚БaЦ с "§ЃўРК!@ ¬ЫZБ`€BЂ(†Ф 9Y·=‚БЂЂ–m›іlш{*ч‡€B (†ж 9Y·@=‚БЁ@+њ*§Б®±U<fХ`¦U`… QЁ rіoX{‚*§Ѓў1<єЕW042е\аЦmc ®aщЅў}	
®pk6ђ€	ЂЧ0ьЮ)ФЂРИШ#    е›vCЕlЫєК«ўЁК!№ЂVm`°XwФ<B 9D6 КН«"„ іj8Ђ­›RДV @B 9D70КН­"…  SЂС  "ЁAўЄ„`Щµґ=µhXvё@UPѓDb*„+aЩAUB„j@he›\„lЪм К±В" EOETш5Ц*§Ѓ¬ЫъК±В"«лSАРЛ69EU5›sѓ™Wд@UOE"‘K¬UrѓC,Ыё Н бlЫо К°‚"  EPEU 4"ш?іlШѓjњ€Љ®ђhЊEtѓEnQU<ЉE.±UК№EU 4F"Ёў¶€e›}'Р“‚€Љ®ђhЊEtѓEc` Єй€ДWH4VеS ЧXЄћ†]b ›fCќmиHUtѓDb+¤+rЉ©Рk¬UOC.± Н«"-иHUNB ° dENETр4F"§Ѓ¬;Њ!-ЋT СHF¤†\ўЄpН  vЊ@CV\ўP еfРpцB 9D6 КН°‚„, r€m@•›m„X,сjВ»"Ф.еfУ ц6О	@ иКд FVР B 9D5 5КНёb,„* r€m@•›{X,UР] СU>‚АЫxл] РИE  №ETш4" 3hP“¬BЂ 3kЁ‹­›gC„WP4Uu]b«¤Н  U„HB 9EWH5КНї",„* r€m@•›PД,UТ  ‘ТaТС!@ еЪЂ+6Ё	0X"« еfЭРVЄж№YµМI‚*№A®Vm{`€A@(„ r€l(»•›|X,6 2Y  4  d€lиёЉЖ m`ёЉЗ @ („  r€@@(†Ж 9D  •љ  0X,’  kx«•›A‚!Ђ 2еfЩб6Љж	P +6П	°]b«$\Б! еfЩб6¬Usѓ"+$!@ ¬Ы<&БuЉ®`ђdEs…V VН·bЄD&! t”LB  9Yµ ‚Н°аМVЁD  Ђ ЪоЕjЉ®`“6•‰±Zў«а Н§ВlЫН  V`LB
 9D  •›wГX,( е‚ЂQёrіl“‚БX`[6‹‰І¬ „ aШ11   Ђ.VmЁ`€n»•›t„X"ыэ’!     „ іmёѓ6Ј	±ZЎ    3jH›Є*ѕ ЫL&Н  b+8&! ,ЫF&Н·"lVЁE   Ђ Ыb&ЕjЉЇЂ6е	і@ [6э2ЇЂЄО	€ДVpLUgЩ$i$Љ.!’	`1„Тl2™CxЂДo7ќc‘јЪ 9ћNgC)ґ@t9Lf± Д $	Е2© S2NF3@ ¦T ”ЉЂ P †h2Нf“qњ@A&’HўhЂ l2NfQЬВi:Ђs‘јЬgЊ§#™¤ЮnМВyАКr0ќ&г8Ђжy9ќ¦Р4Кm7њЏ"!ИТv2€ SБ¤жt9‹ЂгyР@f4ќ†S ё G2ќ†“qњ@l4њО‚y@f4›§1РЮ 1DS™”И. I¤’(ёЊL"Ђ@и‚M$‘EДba E9Ќз!¤Ь )ќ'#ЎФа 3M†QљI"‹€ДВ( Ёr7ќLFГ(Ђоi:c)Ижi7›„г©ґДe9 
з#yёО ;0) ? 6 : 2];

return(SUCCESS);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(SZEFIL)
.pa
*/
#include	"dd.h"
#include	"cpm.h"

EXTERN
BYTE	cpm_drive,	/* Drive letter of CP/M drive in use		*/
	**menu_opt;	/* CP/M specific messages			*/

EXTERN
WORD	cpm_user;	/* Current User number				*/

/*======================================================================*/
WORD                                            /*			*/
sizefil(target)                                 /* Size files from disc */
WORD	target;			/* 0 for Source, 1 for Destination	*/
/*======================================================================*/
/*USE
Portability	Level 4 (Direct BDOS calls)
Parent Module	CPM Utilities
Revision History:
26/04/89 '*' catered for - ICFO
14/04/89 User numbers added - ICFO
18/05/88 'kflush' added before each call to 'getkey' - ICFO
17/05/88 Number of files printed (BR414) - ICFO
         Calls to 'spopen' replaced by direct BDOS calls for speed - ICFO
         Sundry tidyings and optimisings - ICFO
04/09/87 Declareation of menu_opt changed to BYTE** not BYTE[]
24/06/87 Created DAR
*/

{

LOCAL
FILE	file;		/* Pointer to open file				*/

LOCAL
BYTE	fn[22];		/* Array to hold a filename			*/

LOCAL
WORD	user,		/* Copy of 'cpm_user'				*/
	i,j,		/* General counters				*/
	n,
	lcount,		/* Counts lines output				*/
	disc,		/* Storage for default disc			*/
	tot_files;	/* Count of the number of files on the disc	*/

STATIC
union	_fcb	fcb;	/* File Control Block				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Create "AMIE.DIR"							*/
if ((tot_files = getdir(cpm_drive)) == FAIL)  return(FAIL);

/* Open "AMIE.DIR" ready for reading					*/
file = spopen("AMIE.DIR","RC");

/* Set up drive ID							*/
fn[0] = cpm_drive & 0xef;
fn[1] = ':';
lcount = lppage() - 8;
clrs();

/* Do the files								*/
for (i = 0; i < tot_files; ++i) {

/* Check for escape key							*/
    if (const() == ESC)  break;

/* Check for end of screen			NG3IјЬ 'M¦#)И@o3Ж“a”ж 2њЋFуђЂТnО†‘РкpЌ&Г(Ђ‚M$‘EДba M‰е"iЁS%@4tA&’Hўв1Hљ  Ћ€Дт‘4‚T)‹€„  ‚M$‘EД ’n9ќLЖcIЊТe73Ѓ„ЖeНВhи@f7њ„byHљA*ЕДB	P w1 	Ј t  Ђr)4ўD"А3)Риi7Дr)4ўD"ДуpЂИr4ќЊў tS"• У1ЉM(‘…1xЂZe “I$QђE!’АcI°К 6љNg3IёО € ©Р@o7Dу0Ђиh2€†“™Њж 6NFі)ђ@A&’Hў  ЂТn qђ@p9Ng1„@k2ћDCxЂЖo7&г©”\ Jd1рЂиoO“ ЂиoОS‘„иi7Д3ЙМиe6ЂfqёЮtЌ&г ЂМi6DС  @-G‘„Оa4›„S™¤ЬgMЖуЎ Кr'3 дb Њ&“a”И :ДуЃ”Ь 3M†Q ґ@ #M†Qјаe7MЖqВi6NFQ ґ@ !›О“IёО 3ЌжС  €i9ДуђЂИi9LgCyИт 3M†Б ґ@c0›ЌЖу Ђдu7$ТI
 P$Ьd2ћ&г8ЂМo9L'AђВt0Њ'3( C0›ЌЖу ЂЮp2›„СћR&ђJ…1q‚T ‰Жу ЂКn7ќLжЃґКm7њЏ  Вn7О‚ИКa:DССћR&ђJ…1q‚T €fqёЮtОFS	РК 7ќN‡©Р@f4› 1јдm0ќC	РВb0њМўIёИe<LЂЎ¤Ъe1›&“hЂ‚M$‘@a”Вs2€
жIР N7ќSqјкg4g	ЊК 7›„C‘¤мe BЎј@r:›„i$Љ ЋО	TU„•HО uALLOCЋї dФ”UdXИ`<ATOIЊµ	D$Dх8ЙpmBDOSHЊђ†Д$”х8ЙmBIOSHЊ‰ЃД$фхHк0BUFЊ’	T2дD•hОp„C.GTЊЋ‰d2дХTЕHЛЁќC.NOTЊ†Ф2еE5HЙЁ•C.UGTЋпd4„T4µhи>CHKFILЊЖѓT4ВдtXК`ќCL.LTЊМ‰d4Е$TфИКРћCLREOSЊ±Д4Е%8ЙpECMODEЊ«Ф4фд”илШ\COPYЊх‡d5”ФTШКCTLBЊЈФ5DД4ём@CTLQЋўЂd5E$ЕхЁОЂCUR_OFЊО‰d5U%ффиииDATEЋЕ dDUd”4Xм`DFRAMEЊв	dD”ДфxнDPBЋТ 4E€н DRVTABЋП DED$ИП‚E.Њт	ґRгНёDEXECЊР	DU„•HмђEXOVЋФ 4d4(НHfFCLOSEЋУ ddEDU…HкVFILELIЋК ddДхПШ]FOPENЊБ‰De$TXоРNF_EXISЋѓdeх4•¤XЙ€ЉG.Ћ¤ dtTдФU8м°GENMFЊћ…ДtUD8МGET_BKЊхTu$хXО8љH.Њо‰Ф„’д$ИОhINIVIDЊ  d”фД”%hЙ°ќL.ASLЊЮ	ФВдD•hП ќL.MODЊк‰ФВдХTИй0LICENCЋЉЃDФ”иНHЋMAKFCBЋГ $ФHо`MFCBЊ„dФ”дdДшК€LMOVEЊї†$винЂePAT_1ЋМ UффЕй FPROMPTЊИ‰еUE5E(МHћPUTVIDЊН€ҐимРQBASEЋО %8ОРRD_005Њ«†E$THОШ6RUN_AMЊ”	%2иЛX›SAYЊ–e4UED(о°nSORTOSЊ“‰Х54XПp^STRCATЊДe5E$4ХПРfSTRCPYЊџе5E$д4ШИST_005Њчe5EфDHи TITLEЊ  UDД”%hПё.UNLINKЋ‹ EdU%8н–WAIT_AЊє†Uu$•DXИXWT_005њ   ћинЂePAT_1ЋМ UффЕй FPROMPTЊИ‰еUE5E(МHћPUTVIDЊН€ҐимРQBASEЋО %8ОРRD_005Њ«†E$THОШ6RUN_Aееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=b:$1.c[g1
c -qSDATE=$2 -q$3 $1
era $1.c
m80 =$1
era $1.mac
xp b:[g1]=$1.rel
era $1.rel
SPUTELL C     ‚              TITSCR  C     	ѓ              BTCDP   ERR                 WRITAC  C     	‡              WRITDB  C     3€‰            LLOYDУ  OV3   sнфЏ        AMST    H     ќ              AMSTBL1 $$$                    еAMIE    H                   еAMIE    MS1   		               BUG     C     •              LLOYDOV2C     0%—            ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее			*/
    if (lcount == 0) {
	putstr("\n\n");
	putstr(genmes[3]);
	kflush();
	if (getkey() == ESC)  break;
	lcount = lppage() - 8;
	clrs();
    }

/* Read next filename							*/
    getstr(file,&fn[2],20);

/* Set the user number and remove "USERnn\" from file name if 'cpm_user'*/
/* specified as '*'							*/
    bdos(SETUSR,user = chuser(fn));

/* Open file								*/
    makfcb(fn,&fcb);
    bdos(26,0x80);		/* Set default DMA			*/
    bdos(15,&fcb);		/* Open the file (no need to close)	*/
    bdos(35,&fcb);		/* Compute file size			*/

/* Output the file size							*/
    putstr("\n");
    if (cpm_user == -2) {
	putstr("USER");
	if (user < 10)  putvid('0');
	putnum(user);
	putvid('\\');
    }
    putstr(&fn[2]);
    for (n = (16 - strlen(&fn[2])); n > 0 ; --n)  putvid('.');
    lputnum(128L * (LONG) ((UWORD) ((fcb.c_fcb[34] & 0xff) * 256)
					       + (fcb.c_fcb[33] & 0xff)));
    --lcount;
}
if (i == tot_files) {
    putstr("\n\n");
    putstr(menu_opt[5]);
    putvid(' ');
    putnum(tot_files);
    putstr("\n");	
    putstr(genmes[5]);		/* Press any key to continue		*/
    kflush();
    getkey();
}

clrs();

spclose(file);

bdos(SETUSR,0);

return(SUCCESS);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(WTDATA)
.pa
*/
#include	"dd.h"

EXTERN
struct	lvl	*lev;	/* level descriptor for this driver		*/

/*======================================================================*/
WORD                         /*						*/
wt_data()                    /* Write packets of data from input stream	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMOUT CP/M output driver
Revision History:-
*/

{

LOCAL
struct	pkthdr	*recd;	/* Pointer to a structured record		*/

LOCAL
struct	pkthdr	*spkt;	/* Pointer to a structured packet		*/

LOCAL
WORD	rv;		/* Return value					*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Get as many packets as are on the input queue & process them		*/
while ((spkt = qget(lev->in_q)) != (BYTE *) FAIL) {

/* Terminate file if it is an EOF packet				*/
    if (spkt->d_bytes == -1) {

/* Put it straight onto the output queue - no data here			*/
	queue(lev->out_q,spkt);

/* Pad out & write remaining data in buffer				*/
	return((end_it_all()));
    }
	
/* Write the record							*/
    rv = wtrec(spkt->d_start,spkt->d_bytes);

/* Put empty packet onto output queue					*/
    queue(lev->out_q,spkt);
}

return(rv);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=b:amstbl1.sub[g1
pip m:=b:amst.h[g1
ren c.old=c.com
pip m:=b:c.com[g1
x amstbl1 amst 0x010B
x amstbl1 runamie 0x010B
x amstbl1 rdwt005
x amstbl1 setdate 0x010B $1
x amstbl1 showtime 0x010B $1
era c.com
ren c.com=c.old
era amst.h
era amstbl1.sub
era amstbld.sub
QOPEN   C     
              QRESEФ  C                   QUEUE   C                   RD2LF   C                   ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                            S.P.I.T(WTREC)
.pa
*/
#include	"dd.h"

/*======================================================================*/
WORD                                        /*				*/
wtrec(ptr,size)                             /* Write a record to buffer */
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = CPMOUT CP/M output driver
Revision History:-
14/5/87		modified to use cpymem func - DAR
*/

BYTE	*ptr;		/* pointer to start of record			*/
WORD	size;		/* no of bytes in record			*/
{
LOCAL
UWORD	trcount;	/* no of bytes to transfer			*/

EXTERN
UWORD	bftaken,	/* no of valid bytes in buffer			*/
	bfleft;		/* space left in buffer				*/

EXTERN
BYTE	*bptr;		/* buffer pointer				*/

/* Routines called							*/
WORD	dump_bu();		/* Dump buffer to disc			*/

EXTERN
struct
lvl *lev;		/* level descriptor held globally		*/


/* while bytes left to send						*/
while(size){

/* 	while bytes left to send & room left in buffer			*/ 

/* no of bytes to send = min of dsize & bfleft				*/
	trcount = (size < bfleft) ? size : bfleft;

/* copy into buffer							*/
	cpymem(ptr,bptr,trcount);

/* update counters							*/
	bptr += trcount;
	ptr += trcount;
	bfleft -= trcount;
	bftaken += trcount;
	size -= trcount;


/* 	If not enough room in the buffer dump the buffer to disc	*/
	if (bfleft == 0)
		if(dump_buff() == FAIL) return(FAIL);
}

return(SUCCESS);
}

/*======================================================================*/
/* Routines called:- dump_bu						*/
/*======================================================================*/
s							*/
	bptr += trcount;
	ptr += trcount;
	bfleft -= trcount;
	bftaken += trcount;
	size -= trcount;


/* 	If not enough room in the buffer dump the buffer to disc	*/
	if (bfleft == 0)
		if(dump_buff() == FAIL) return(FAIL);
}

return(SUCCееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееxsubm
pip
m:=b:amst.rel[g1
m:=b:runamie.rel[g1
m:=b:rdwt005.rel[g1
m:=b:setdate.rel[g1
m:=b:showtime.rel[g1
m:=b:stop.rel[g2]
m:=b:amielib.irl[g3

lib bigstr.rel=amielib.irl(bigstr)
lib dialogue.rel=amielib.irl(dialog)
lib dibox.rel=amielib.irl(dibox)
lib justify.rel=amielib.irl(jstfy)
lib dobox.rel=amielib.irl(dobox)
lib crossbar.rel=amielib.irl(crsbar)
lib menu.rel=amielib.irl(menu)
era amielib.irl
link amie.com=amst[a],runamie,rdwt005,setdate,showtime,bigstr,dialogue,&
dibox,justify,dobox,crossbar,menu,stop,$2lib.irl[s],tlib.irl[s]
dexsub
era amst.rel
era runamie.rel
era rdwt005.rel
era setdate.rel
era showtime.rel
era stop.rel
era bigstr.rel
era dialogue.rel
era dibox.rel
era justify.rel
era dobox.rel
era crossbar.rel
era menu.rel
xp b:amiecom.$2[g1]=amie.com
symsort amie
era amie.srt
era amie.sym
era amstlnk.sub
l=amielib.irl(menu)
era amielib.irl
link amie.com=amst[a],runamie,rdwt005,setdate,showtime,bigstr,dialogue,&
dibox,justify,doееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееГl”ф°°И и     ёz      A:   ь                                        d ћя                                         яя                                                                                                ј                                                !°я9щ*$еНя1БНmЌRН{ЌT|µКСГ9НmЌRГ&Н'ЌRНЯ“"п#"п+n& Уя|µВС*п~·КОНаЊпn& еНЏaБГz*НB“"ГTНz"ГT*B|µВ^Нz"ГTНz"ГT*НB“"ГT!  "pГT*НB“"ГTНz"^!  "rГTНz"у|µКЬ*уГв*НB“"ГT*НB“"ГTН«Њ„ГT*B|µВ*еНЖБ"B*пеНУ;БГОНz"ГTНz"ГTН«ЊtГT*п"гГОНz"	ГT*НB“"ГT*НB“"ГTН'ЌRНЯ“еН2Б!;еН2Бл!P 9щлЙНм“lA xC ЃD ’E ›F §G °K јL ЛM иO фP ьQ R #S ,T 4V =W FX RZ   Г^Г2*++НB“"ў*B|µВп*еНЖБ"B*л! Н'”е*гНЗ“"|*	))еНЖБ":"<*еНЖБ">!И еНЖБ"F*++е*еНЖБ"0"2С"4* Н”"еНЖБ"**| Н”л**"&**л*оя"(*Fd "H!  9"6"8**",*& ".!  "RНХ2НG1"bН'ЌRНЯ“еН"БНyН­! еНg	БНХyНзНРГr*j|µКа!NеН$1БНr*hеНsБ!PеНхqБ*бл!иН'”еНpip m:=c:rcutl$1.c[g13
c rcutl$1
era m:rcutl$1.c
m80 =rcutl$1
era m:rcutl$1.mac
xp c:[g13]=rcutl$1.rel
era rcutl$1.rel
GCOSMБN C     Ѕ               	IBMDEМN1SUB   ѕ               GCOSLОK SUB   ї               GCOSOЦ1 C     А               	IBMDEMANC     SЕФЦ          CPMOV1  C     М               GETATТ  C     Г               GETATТ  C     Д               	GETBOЕ  C     
Е               	GETBPФ  C     Ж               CTOS    MAN   )О Ч            GETDIТ  C     И               ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:rcutlbl1.sub[g13
pip m:=c:recutl.h[g13
x rcutlbl1 prc
x rcutlbl1 ov1
era m:recutl.h
era rcutlbl1.sub
era rcutlbld.sub
RECUTМ  ERR   J              RECUTМ  H     K              RECUTМ  MS1   L              RS232   ERR   M              RS232   H     N              RS232   MS1   O              RS232   MS2   P              RS232ВL1SUB   Q              ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееsБ!hеНхqБ*h|µК! еНМ=БЙ       НХ2!  "n.Н.Ќ|µВN!* еНg–Б! 9е*FНд“еН03БН'Ќ""!!"*~·К”НаЊn& Г„!!"Г”*+"Г‘Нм“q= z.   Г^*6 *n& Гя|µКЧ!е!:е*+НB“КА!vГГ!{е!Ђе!ЁеНБББББ"nНаЊn& |µВлН'Ќ"*6.*"¦!е!:е!‚е!…е!ЁеНБББББ"’НХ2Й    Н'Ќ
еН'Ќ
еН'Ќ
еНБББ"еН'ЌеН5—ББ"НB“К\!‡еНя1Б*еНя1БН%•Н`Ќ+еНаЊn& С}|µВ\*Й    !  "vНаЊпn& Ря"x  Н[“КЎ*x	 НZ“Н&“К»*v
 Н”л*x"vГЂНќЊп*vЙ  Н'ЌеН‹•Б"Д#НB“Кд!™еН2БН%•*ДЙ                               !  "!р"о"к"иН'Ќ"м*оеНаЊмn& С}|µКNНаЊоn& Жя|µВ *о"кГN*к"мН'ЌНЯ“"оНаЊкеНаЊоn& С}ГУ*м"иГшНќЊк*к+n& Жя|µКµ*|µВµН'Ќ"мНаЊкеНаЊмn& С}|µВџ*к6 Н'ЌеНќЊоНд“*иЙН«ЊГшНм“r: {  {  {	 {, {
 {= Л.   Г^ЙC/80 Compiler 3.1 (4/11/84) - (c) 1984 The Software Toolworks
 : Illegal switch.
 }  errors in compilation
 K bytes free
 .MAC .ASM w .c r Can't open file:  Not enough memory.
 *l|µВж!„!еН‡>Б|µКИНp.Га! еНБ|µВа!‰!еН
=БНќ0Н ?Г­Й                                                                  *з|µК`	*зк6 !–!еНхqБ!' еН­qБ!кеНхqБ!' еН­qБ!  "зЙ      *|µКС	Н'Ќ|µКС	**"e	*,е*e	НL“КС	Гћ	*e	 НЯ“"e	Г~	*e	 НЯ“& }жo+++НB“КО	*e	 НЯ“|µВО	*e	еНБГЋ	*@|µИНWy*bеН]1БН-r*ў"c	!  "ўНKx!  "з"a	*@л*a	Нj“К’
Г
НаЊa	Гэ	*>л*a	n& }2йГs
Н)	!–!еНхqБ*й& еНsБГѓ
*й&   Нj“ВX
*й& ~ Нk“Н&“В'
НаЊзке*й& С}Гѓ
Нм“'
\ '
'   Г?
*зВН‡“Ь)	Г
Нr!  "@НG1"b*c	"ўЙ        *ћ++|µВВ
!њ!еН
=БН ?Н®2}2Ё
Г!> }2Ё
НЕ2*J"Є
*Є
n& е*Ё
& НL“К	НаЊЄ
n& |µВЯ
!Ё
еН$1БГ	*Є
6 ГНм“П
< Ц
"   *J"Є
*Ё
& ВяНB“ВX!Є
е*¦е!€!еНБББ"¬
е!”!еН5—ББ"®
НB“Н&“Кt*J"¬
е!”!еН5—ББ"®
НB“Н&“К…!¬!еН
=БГгН«Њћ)’е*®
Нд“*ћ Н”Ё"Є
НаЊЄ
еНаЊ¬
n& С}|µВ¦*ћ)Ые*ћ)Ње*ћ)е!  Нд“Нд“Нд“НХ2Й*n|µКч*nеНБ!  "nЙ          Н Ќю!  " ! |µКЭ!  ".Н'Ќ  Нj“КJ!ј!еНБ>Б|µКD! ГG! Г»!Д!еНБ>Б|µК]!я Г»!Л!еНБ>Б|µКН'Ќ|µКy!ю Г|! Г»Н'Ќ  Нk“К’! Г»!Т!еНБ>Б|µКҐ! Г»!ј!еНБ>Б|µКё! Г»!  "НЈ"Г*ГэН'Ќ ЂН‡“Ъ* лб"юб" б"б"б"лЙ! "ГНм“Н Ъ  ф   ! "Г$Нм“vяяЗ    Н ЌН'ЌеН‡БББ"юН'ЌГi*dл*ю"dГv*ю|µК[! ГЭ*|µКv!  ГЭНм“?  M   ! " НZ(Н ?*l|µВ”Н®2ЭяНB“Н&“К * ГЭГ!Ч!еНБ>Б|µКј!Э!еНБ>Б! Й*H…|µВ !б!еНБ>Б|µКб!Э!еНБ>Б! Й!ж!еНБ>Б|µВц!м!еНБ>БН&“К ! Й!у!еНБ>Б|µК!Э!еНБ>Б! Й!ы!еНБ>Б|µК,! Гr!Э!еНБ>Б|µК?! Гr! "еНБ>Б|µКW!  еНBБГr!"еНБ>Б|µКo! еНBБГr!  Й                    !  "wНЬ0|µК™*wЙН'ЌеНkБ"*"ѓ*|µКЅН'Ќ  Нk“Н&“КЫ*еН'ЌеН'ЌеНi#БББ! Й!  "y*х& |µМч0!я"{Н'Ќ"Ѓ*э& }жo"+++НB“К,*ЃГ!я "ЃГ,Нм“ю    Г*Ѓ|µВe*ГUНGЌ|µКL! "ЃГe! "ЃГeНм“:  C   ГL*ЃГ!*+++|µК†*|µК†!хеНБ! "ѓГє*эН‡“ТЈ!"еН
=БНG1"yеНv1Б"…*+++|µВг!хе!  еН¦ББ|µКФ!  "y!ю "ЃГ†!х"…Н ?Н®2ЕяН&“КэН®2ФяН&“Н&“К	НWyГНѓy*…еНхqБН-r*Ѓ+|µВ;*ў|µК3*…еН/БГ;*|µД-r*Ѓыя|µВR*еНЃБГ«НKx!$"еН‡>Б|µК‡*ЃыяНB“Вy*ЃьяНB“Н&“К‡!&"еН
=Б*"u*эеН'Ќе*{е! еНaББББ*u"ѓНr*Ѓыя|µКб!хе*эеН'Ќ
е*yе*Ѓе*{е*еН»л! 9щлГBН'Ќ ЂН‡“ЪЙ*э& }жo+НB“КН«Њэ! "ѓ"Н–Њ{НќЊ!хеНБ"…НB“В3* Нk“Н&“КD!<"еН
=БГЖ*… е*эНд“*… еН'ЌС}*{"}*… "сНТЊ|µКЏНЛЊсеНЛЊ}НЯ“Нд“Гq! ""ѓ*Ѓыя|µВЖ*…
 6*… еНG1Нд“еНv1Б"…ГгГ*wе*НЗ“"w!хе*эеН'Ќ
е*dл*wе*Ѓе*{е*еН»л! 9щл!$"еН‡>Б|µК!&"еН
=БНХ2*wЙГBНм“kя Џ Јю Ј Э д с   *ѓ|µВR!N"еН
=Б!`"еН‡>Б|µВЌ*wЙ        !  "i}2х""э*s|µКЋ!b"еН
=БГ2! "sНЃ"i! "!я"g*э"eГї*eл! Н­“"eГ¬*e& }жoГ^! "Г2Н?ЌНB“Кд! Г/Н'ЌыяНB“ВэН'ЌьяНB“Н&“К	! Г/Н'Ќ Нj“К! Г/Н'ЌеН!Б"c НЯ“"*л*Н”"!  "s*iЙНЛЊgНЯ“л*Н”"ГsНм“Л Л Ф  I   ГЇЙ          Н Ќw!  "{"}"y"w! |µКїН ?Н®2Ця|µВїНЕ2*w))}цo"wГ–Н®2Шя|µВНЕ2НЃ*э"y! "*е*yН“|µКГъ*))"ГЭН–Њ}Гп!r"еН1БГ!хеНѕ Б"{! |µКзН ?Н®2ГъНЕ2НW! "ГЌНЕ2Н ?! "Н®2Чя|µКo*{|µК`Н®2еНГ1БН&“К·! "{Г“НЕ2Н ?*{|µК‡Н®2…яНB“Н&“В“!  "{*л*}НА“е*yН“"yН–Њ}*{|µВЅГ!  "{*wл*}НА“е*yН“"э. |жАg|µКд!b"еН
=Б*{лб"wб"yб"{б"}лЙНм“)[ 8(   Г·*э))еН'ЌН“"э. |жАg|µК-!b"еН
=БЙ                    !”я9щН Ќ.
!x 9е!  ".С}!x 9еНѕ Б|µКu!x 9еНC!Б".!t"еН‡>Б|µВ•*.|µВ’!v"еН
=БГ"*.|µКЈН1ГЕ*2".*2 "2л*4НЌ“КЕ!Њ"еН
=Б*."2!x 9"0НаЊ2еНаЊ0n& С}|µВТ!  ">"<"8*.еН-Б"@я Нk“К!ў"еН
=БНЈ"6НB“КW!і"еН
=Б!яялб".б"0б"2б"4б"6б"8б":б"<б">б"@!l 9щлЙ*6еНkБ*6е*@Н.“К¬*э"4Г…*4л! Н­“"4Гr*4& }жoГњ!ј"еН
=БГ–Нм“‘  ¬   Гu!хе! еН¦ББ":|µК*: НЯ“е*<НL“Вж*: НЯ“е*эНL“Н&“Вэ*: n& е*6НL“Н&“Д1Г/!хе*эе*6е*<е!э е!яе*еН»л! 9щл":Н'Ќ‚|µКN*8л*Нk“КK*"8Г\*8л*"8"<*|µВl!N"еН
=Б*>Оя|µВѓ!Д"еН
=БГ–НаЊ>)л! 9е*:Нд“!`"еН‡>Б|µВWНZ(!Х"еН‡>Б|µК*. е*8Нд“*.
 е*4":Нд“!  "4*>л*4Нj“К НЩЊ:еНаЊ4)л! 9НЯ“Нд“ГШНЩЊ:6 #6 *:"4л*2Н “К"!Њ"еН
=Б*.еН-БГ'*0еН'ЌгНЗ“л! Н'” Й8                          !оя9щН ЌEН'Ќ$"E"O!t"еН‡>Б"I|µКЏ!яя"EГН®2Г*O++НB“К¦*НB“Н&“К±*. Н&“Кз*еНЃБлб"Eб"Gб"Iб"Kб"Mб"Oб"Qб"S! 9щлЙ!  "O*O"E++НB“К! "Eееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:rcutl$1.rel[g13
link recutl.$1=rcutl$1[op,gutl$1,l8000],amdum,tlib.irl[s]
era rcutl$1.rel
prlpat recutl.$1 $2 $3 $4 $5
prltrm recutl.$1
xp c:[g13]=recutl.$1
symsort recutl
era recutl.sym
era recutl.srt
MSGTAT  C      ш              MSGTFN  C     щ              MSGTVT  C     ъ              MSOUT   C     Eь          FORMAT  C     ]              RCUTLМN1SUB                    MSLNK   SUB   я              MSLPRC  C                    ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееГНм“•, •} •;   ГнН'Ќ*& }жoГт!  ГїН'Ќ&"Q"G|µКQНmЌ&++НЯ“"G|µКQ!  "Q*@"UНPЌ*л! Н­“Нд“НB“КrН?Ќ(НB“Н&“К{*EН&“КЌ! 9еНbБ"[Н&“К"! "u.9Нz’лл*>"Y"W*U"@НТЊ[|µКвНаЊWn& е! еН№xББ*G|µКЯНќЊG|µКвГ±!  е*GеН№xББ*Q|µК*Qе*Wе*YНЗ“Нд“Г*[юН‡“Т!Ч"еН
=БГ*G|µВ2*E|µКxН'Ќ*еН'Ќ*еН'Ќ*е*EеНaББББ"E*Q|µКc*QеНЯ“#Нд“+*G|µКuНќЊG|µКxГ"Г\Н'Ќ(рН‡“ЪѕН'Ќ(ГЄ! "GГ{! "GГ{! "GГ{Нм“Џ     ГЎН'Ќ(еН!Б"K НЯ“"[*K
 НЯ“"M!  "G*M++НЯ“"S|µК*S НЯ“НB“Н&“К!  е*[еН№xББ!  ГїНЩЊMНЯ“"S|µК\*S НЯ“е*S n& е*S е*EеНaББББ"EГ*I|µВj*EГїГ! "G.(96#6 *E|µВ“!  е*GеН№xББГп! "u!а"еН‡>Б"[! 9е! еНcCББ*[|µКЬН Ќ|µВЬН'Ќ& }жo+Н&“КЬ!в"еН
=БН ЌГЫ! 9еНшxБ*G++|µКю!с"еН
=БГпН Ќ"[ Н[“ВН'Ќ( Н[“Н&“К`Н'Ќ(л*[Нk“ВцН'Ќ(ыяНB“КG*[ыяН&“Н&“К`! 9е! 9Нz’Н1ђбН€’! 9Нz’!]Н€’Н'Ќ(ыяНB“В†Н'Ќ(ьяНB“Н&“Кј!]Нz’ле! еН№xББ!]Нz’ЕХ! Ну’Нѓ‘ле! еН№xББГН!]Нz’ле*GеН№xББГп!я"еН
=БГпНм“  Р Ря   ГгГНм“% + {  m   *I|µК!`"еН‡>Б!Х"еН1Б*O  Н[“В6!`"еН‡>БНB“Н&“КB!  ГїН ?Н®2ѓяН&“НС“Гї  !  "U!#еН‡>Б|µВxН—A"U!#еН1Б*|µКђ*U|µВђ!N"еН
=БНаЊ)яе*UНд“Й    Н'Ќ"¤**"ў*,е*ўНL“КН ЌўН8>ББ|µКмН'ЌН&“е*ў
 n& яНB“Н.“Н&“Кц*ўЙ*ў НЯ“"ўГі!  Й    Н'Ќ"*& "
*.е*
НL“КPН Ќ
Н8>ББ|µК@*
Й*
 НЯ“"
Г!  ЙН'ЌеНБ"п|µКѓ*п n& шя|µКЂ!#еН
=БГЁН'Ќе! е.еНG1е! е. ееН»л! 9щл"п*п НЯ“Й        Н'ЌГ! 96#6 ГЧ! 96#6 Н'ЌеН'ЌяНB“еН¦ББ"п*,"і*&"µГ2Н'ЌеНБ"п*."і*("µГ2Нм“Вя Ою Ч Чэ   Гя*п|µКнН'Ќ& }жo+++НB“Кc*п НЯ“& }жo+++НB“Н&“Кж*п НЯ“еН'ЌН.“Кђ*п n& еН'ЌН.“Н&“КЁ*п
 n& еН'ЌН.“Н&“КЫ*п НЯ“|µВП*п еН'Ќ
Нд“ГШН'Ќ|µД1Гг!!#еН
=БГйН1*пЙ*і"п*п "·*µл*·НЋ“К !=#еН
=Б*іЙН{Ќ#|µК5 НЛЊ·еНmЌ++НЯ“Нд“ГэНаЊіеН`Ќ+n& С}еНт1Б|µВ5 *п еН'ЌНд“*п еН'ЌС}*п еН'Ќ
Нд“*п
 еН'ЌС}*п е*·Нд“*&е*µН.“К° *·",Г¶ *·".*пЙ    Н ?Н®2еНГ1Б|µВТ !  ЙН'Ќ"є  +"ј Н®2еНт1Б|µК!*є еНЕ2С}*ј е*є НL“К
!Н«Њє Гб *є 6 ! ЙНPЌряНд“  Нj“К0!!  Г@!*0еН'Ќ Н”СЙ  *0"A!*2е*A!НL“КЂ!Гf!*A! "A!ГI!Н'Ќе*A!еН8>ББ|µК}!*A!ЙГY!!  Й#asm syntax error 
	DB	 nested too deep Can't find file registe extern static auto short int long float double unsigne char struct union too large for register = can't initialize auto improper argument dimension missing , too complicated ) { undefined struct name struct table overflow too many structs bad type nesting struct too large } too long & not an address type mismatch illegal initializer ] not a label type (re)declared after use symbol table overflow                       !оя9щН'Ќ"W#Н'Ќ+++|µВЉ#! 96ю#6 Н?ЌНB“Кљ#! Гµ#!хе!  еН¦ББ|µКІ#!  Гµ#НG1"c#!хе*эеН'Ќе*c#еН'Ќе!  ееН»л! 9щл"Y#Н'Ќя|µВ$*Y# НЯ“еНv1Б"g#Г$!х"g#*|µК$!хеН/Б! "c#НќЊc# ЂН‡“ТE$*c#зе*g#л*c#n& С}Г$*& ".!  "d"f.НGЌ|µВЩ$!8?еН‡>Б|µВС$!  9еНѕ Б|µВ„$Нч0Нќ0!  9е!  е.е*fе! е.
9е! еН»л! 9щлН–ЊfН ?Н®2Чя|µКЖ$!:?еН1БНЬ0|µВС$Гc$!яяеНБ!<?еН‡>Б|µКо$!>?еН
=Б!P?еН‡>Б|µКћ&!  еНБНWy*d"a#!  "dН;r*„|µДvНr*Y#еНrzБН-r*a#е!  ееН»‚БББ"d!  "c#*."a#*& е*a#НL“К•&Гf%*Y#"a#ГI%*& "Y#*Y# НЯ“"_#е*a#НL“К“%ГЉ%*_#"Y#Гp%*Y#
 n& "e#ГЃ&*Y#еНFzБ!  96я!  9еН~Б*e#ыя|µВ’&Н–Њc#!  9е! ее. ее*c#Ну’ЕХ!  ееНxcл! 9щл!  9еН‡sБ*Y#еНgzБГ’&*Y# НЯ“ ЂН‡“Т~&*Y# еН–Њc#Нд“*Y# n& "[#ыяНB“ВH&*[#ьяНB“Н&“Кs&*Y# НЯ“& }жo"]#НB“Вp&*]#+++НB“Н&“Н&“К~&Н–Њc#Г’&Нм“Ј% Ј% &   Г]%Нe("_#Гє&Н;r*„|µДv!зеНхqБН-rНь&"_#*_#+++|µКН&!  еНВ,Б!  "d*& ".!  "U#"¤*|µКц&!  еНg	Б! 9щЙН®2НB“е*lН“|µА!R?еНБ>Б|µК-'! еНВ,БНZ(! "zГV(!P?еН‡>Б|µК@'Нe(ГV(!Y?еНБ>Б|µКS'Н¦(ГP(!\?еНБ>Б|µКk'!  еН•*БГP(!b?еНБ>Б|µКѓ'! еН•*БГP(!f?еНБ>Б|µК›'! еН•*БГP(!i?еНБ>Б|µК¶'! еН*.БНZ(ГP(!o?еНБ>Б|µКЙ'Н)ГP(!v?еНБ>Б|µКЬ'Н
*ГP(!{?еНБ>Б|µКп'Нw*ГP(!ѓ?еНБ>Б|µК
(!  еН*.БНZ(ГP(!<?еН‡>Б|µВP(!‹?еН‡>Б|µК*(Нp.ГP(!ђ?еНБ>Б|µК=(Н‡,ГP(Н1,|µВP(!  еН\AБНZ(! "z*zЙ!<?еН1БЙ  Н«Њj! "c(!•?еН‡>Б|µВ™(*l|µКђ(!•?еН$1БГ™(Нь&"c(Гp(НќЊj*c(Й    Н Ќў(НG1"ў(!—?еН1Б*ў(е!  е!8?еН^БББНь&!™?еНБ>Б|µВн(*ў(еНM1Бб"ў(б"¤(ЙНG1"¤(еНББ*ў(еНM1БНь&*¤(еНM1БГд(      !ля9щН Ќ)*~")!  "~*<")! 96 #6 ! 9##еНG1Нд“! 9еН-2Б!—?еН1Б! 9е! еНШAББ! 9еН‡sБ! 9еНо„Б|µКќ)Н ЌГђ)Н|…Гќ)Н……Гќ)Нм“„) Љ)   !8?еН1БНG1")еНББНь&! 9##НЯ“еНББ*)еНM1Б*)е*<е*~еНњЂБББ! 9##НЯ“еНM1Б*)"<*)"~Нy2б")б")б")! 9щЙ*~#|µВ*!ћ?еН
=БЙ*< е*	)л*:СНЌ“К=*!­?еН
=БЙНЛЊ<еНG1Нд“еНM1БНЛЊ<еН—AНд“*•AьН‡“Тn*!ј?еН
=Б!У?еН1БЙ!У?еН1БНG1"~еНM1БЙ          !ля9щН Ќ‹*НG1"‹*"Џ*НG1"Ќ*НGЌ!|µВЖ*НG1"‹*еНM1БГҐ+Н'Ќ!|µК +НG1"‘*!—?еН1Б!<?еН‡>Б|µВх*!  еН\AБНZ(*‘*еНM1БГ+*‹*еНM1Б!—?еН1БН'Ќ!НB“В%+!<?еН‡>БНB“Н&“КN+*Ќ*е!  е.%Н'Ќ%|µКD+!<?ГG+!8?еН^БББН'Ќ!|µКҐ+Н ?Н®2Чя|µВr+*‘*"‹*"Џ*Гќ+НG1"“*еНББ*‹*еНM1Б!  еН\AБ*‘*еНББ*“*еНM1Б!8?еН1Б! 9е*Џ*Нд“! 9##е*Ќ*Нд“! 9еН-2БНь&НGЌ!|µКЭ+*‹*еНББГ
,!\?еН1Б*Џ*еНM1Б!—?еН1Б*‹*е! е!8?еН^БББНZ(*Ќ*еНM1БНy2б"‹*б"Ќ*б"Џ*б"‘*б"“*! 9щЙ  ЕЕЕЕ*/,еН ?*J"/,! 9еНѕ Б|µК{,НЕ2Жя|µВ{,! 9еНTБеНM1БНь&! лб"/,ББББлЙ*/,"J!  Гp,ЕЕЕЕ!  9еНѕ Б|µКЄ,!  9еНTБеНББГІ,!Х?еН
=БНZ(ББББЙ        !уя9щ!  "А,"ј,.Н'Ќ|µК/-НЬ0|µВ&-!  9е! еНШAББ!  9еН‡sБН Ќе*ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:rcutlln1.sub[g13
x rcutlln1 prc $1 $2 64 $3
x rcutlln1 ov1 $1 $2 64 $3
era rcutlln1.sub
era rcutllnk.sub
RCUTLРRCC    BCDEF      NAMCPY  C     7              UHTOVD  C     H              LABEL   C     "‡Е            RECUTМ  ERR   J              RECUTМ  H     K              RECUTМ  MS1   L              RS232   ERR   M              RS232   H     N              RS232   MS1   O              RS232   MS2   P              RS232ВL1SUB   Q              ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееW#еНG€ББ*W#ьяНB“е*W#ыяНB“Н“"А,Г/-! 96 #6 *d"ѕ,НB“КF-НLл! 9щлЙ*¤|µКl-Н'ЌНB“В[-*U#Н&“Кl-*¤еНББГ>-НG1"¤еНM1БН'Ќ"U#*& "є,*.л*є,Нџ“Кя-ГЁ-*є, НЯ“"є,Г€-*є,
 n& Гп-Н'Ќ|µКб-*А,|µКП-!  "ј,ГШ-Н…}! "ј,! 96 #6 Ні~*є,еНgzБГь-Нм“µ- µ-   Г-!  е.Н'Ќе*А,еН»‚БББ*ј,|µД…}НL*ѕ,"dГ>-  НЊ2"(.НB“АН'Ќ)л*(.НЯ“|µВ[.*(.ья"(.л*6Н “АГ4.Н'Ќ)л*(.НЯ“еНББЙ  *ў"n.!  "ўН
y!‹?еНхqБНr!  "v! |µКБ.Нc3!Я?еН‡>Б|µВБ.*l|µВБ.Н®7*FеНхqБНrГђ.НХ2! "vН
y!Я?еНхqБНr*n."ўЙ      !уя9щН ЌЯ.Н'Ќ"Я.!  "б.Н ?*Я.n& Г!/*Я.е!  еН‡sББ*Я.еН~БГ5/Нм“/я / /   Г	/*Jе!8?еН>ББ|µВЩ/НЬ0|µВЩ/! 9е! еНcCББеН‡sБ! 9еНо„Б|µКw/Н ЌНB“Н&“КІ/*Я.n& я|µВ§/Ні~*Я.6яН†~Н–Њб.*Я.еН~БГЇ/Н†~Н–Њб.ГД/*Я.n& я|µМї~Н~Н–Њб.!:?еН‡>Б|µКЩ/Г5/!8?еН1Б*Я.n& Г\0НЏГp0*Я. НЯ“еНv1Б"г.Г0*Я. НЯ“"г.*„|µКC0!з?еНЛ~БН%Ѓ*г.еНхqБ!:?еНхqБ!зеНхqБНrГN0*г.еНБНrГp0!н?еН
=БГp0Нм“к/ю р/ 0   ГQ0*dл*б.е! е*Я.еНо„БеН»‚БББ"dб"Я.б"б.! 9щЙНб2еНт1Б|µКЅ0Н®2еНт1Б|µКШ0НЕ2ГЄ0Н®2еНт1Б|µВШ0Н®2|µКШ0НЕ2ГЅ0Н ?ЙН ?*Jе!<?еН>ББеН®2НB“Н“Й!@еН
=БНќ0Й!@еН
=БЙН'ЌеН‡>Б|µВ#1Н'ЌеН$1БЙ!  еН
=БН'ЌеН2Б!*@еН2БЙ!<@еН
=БЙН«Њ^ЙН;rН'ЌеН]1БН-rЙН'ЌеНv1БеНхqБЙ          !l1"t1#"t1+6.Н`ЌН'Ќ|µКє1НаЊt1еН'Ќл! Н'”лa С}НPЌл! Н'”Нд“Г‡1*t16 !l1Й! 9~! ю{ТЮ1юaРю_Ию[ТЮ1юAР+Й! 9~! ю0Ър1ю:Ш+Й! 9НЗ1}=Ва1Й!
 еНg–БН'ЌеН2БЙН'Ќ~·К*2Н`Ќ+n& еНg–БГ2Й  *6P ьяе*8Н.“КK2!T@еН
=БЙ!  "+2*+2юН‡“Ъx2НЛЊ8еНаЊ+2)лН'ЌНЯ“Нд“ГQ2ЙНЊ2|µК‹2*8ья"8Й*6е*8Н.“КҐ2!k@еН
=Б!  Й*8ьяЙЙ*Jn& Й*JЇѕКБ2#ngЙ!  Й*J~·КБ2#"Jo& Й*F6 *F"JЙН®2|µВ3*lл*S#|µКъ2!  ЙНc3Н®7Гб2НЕ2ЙН®2|µВ3*S#|µК3!  ЙНc3*l|µК*3!  ЙНЕ2Й  Н'Ќ".3НаЊ.3еН¶•С}цяН&“В73НќЊ.36 Н'ЌЙ          ЕЕЕЕ*_3е*ћ)НЯ“"[3! |µК‰3*l|µК’3б"_3ББББЙ*ћ)’НЯ“"Y3*ћ)ЊеНЯ“#Нд“НХ2:\3·ъЅ4*Y3еН¤Б"[3|·ъЅ4:‚·КЉ4*[3ўя|µВл3*Y3еН¤Б"[3Г‡4*[3¤я|µВe4*Y3еН¤Б"[3ГE4!` "[3Гe4!| "[3Гe4!{ "[3Гe4!} "[3Гe4!~ "[3Гe4!^ "[3Гe4НаЊJ6\Гe4Нм“4' 4! 4(  4) )4- 24_   Г;4*[3їН‡“Т‡4*[3ҐН‡“Ъ‡4*[3  "[3*[3}ю
КЅ4*F:J•_:KњW*PТЇ4!|@еН
=БГЅ4*J:[3w#"JГє3*J6 *Fе*JН.“К5*[3 ЂН‡“Ъy3*Y3еНБ!  "[3*ћ|µВ5!  "[3"’#"lГ5НќЊћ)ЫНЯ“"‚*ћ)НЯ“"[3*F"J!Љ@еН–>Бе!’@еН–>Б)С"_3|µКї5! 9еНѕ Б|µКj5! 9еН–<Б|µКj5! е*_3НЗ“"_3Н«Њ\ыя|µВ€5!™@еН
=БНќЊ\Гy3*\+)RНЯ“юН‡“Т­5*\)R6#6 Гy3*\)Rе*_3Нд“Гy3!°@еН–>Б|µКE6! "S#Н®7! "_3*J "JН®2|µКo6! 9еНѕ Б|µВ6Нч0Гo6! 9е!  еН¦ББ"a3|µК$6*a3 НЯ“НB“Н&“К36! "_3Гo6Н®2Фя|µВo6НЕ2Ге5!ё@еН–>Б|µКx6! "S#Н®7*J "JН—AНB“#"_3!  "S#Гj5*\|µКл6!ј@еН–>Б|µКВ6*\)RНЯ“эН‡“Ъї6*\)Rе*\)RНЯ“ ХНЗ“Нд“Гy3!В@еН–>Б|µКЧ6НќЊ\Гy3*\)RНЯ“юН‡“Ъy3*F"J*tе*vН“|µК7Н
y*FеНхqБНr*ћ)е*[3Нд“Г‰3      *Nе*LН.“К•7*N)еН‹•Б" 7#НB“КQ7!Й@еН
=БН%•*H""7* 7"$7НТЊN|µК{7НаЊ$7еНаЊ"7n& С}Г]7* 7"H*L)"N! е*NНЗ“"PНаЊLл*HеН'ЌС}Й      ЕЕЕЕ!й@еН–>Б|µКц7!  9еНѕ Б|µВУ7Нч0Гр7!  9еН–<Б"Ё7|µКр7*Ё7++л*B6 Нc3ГІ7!  "L*F"JН®2|µК=:Н®2Г:*v|µК9!  еН&7БН®2аяНB“В78Н®2чяНB“Н&“К8НЕ2Г 8*v|µК9Н®2"Є7еН&7БНЕ2Н®2е*Є7НL“К¦8Н®2|µВy8!р@еН$1БГ¦8Н®2¤я|µВ›8Нµ2|µВ“8Нc3ГY8НЕ2еН&7БНЕ2еН&7БГY8НЕ2*Є7еН&7БГ8Нµ2Ця|µВ9Н3Н3Н®2ЦяН&“ВЭ8Нµ2СяН&“Н&“Кя8Н®2|µВс8Нc3Гф8Н3*l|µВя8ГЖ8Н3Н3Г8Нµ2|µВ9Нc3Г8Н®2Ря|µВ[9НЕ2еН&7БН®2еНЏaБЁя|µВC9НЕ2еН&7БН®2еНт1Б|µК:НЕ2еН&7БГC9Н®2еНГ1Б|µК:!  "Ё7Н®2еНт1Б|µК„9*Ё7 Нj“Н&“Кў9ГЌ9НаЊЁ7л!  9еНЕ2С}Гn9!  9л*Ё76 !  9"¬7еН–<Б"Ё7|µКМ9*Bл*Ё7"¬7НаЊ¬7n& "Є7|µКз9*Є7еН&7БГМ9Н®2еНт1Б|µК:НЕ2"Є7*vл*Ё7|µВ:*Є7еН&7БГз9НЕ2еН&7БГ8Нм“8  8	 C8" C8' ґ8/ 9\   Г9!  еН&7Б*F"Ё7*H"F"J*Ё7"H* 7|µК…:*NеН‹•Б"H#НB“К:!Й@еН
=БН%•!  " 7*Fn& Эя|µВЬ:!ч@еН–>Б|µК§:Н°
Гб:! AеН–>Б|µКє:Н];Гб:!AеН–>Б|µКЬ:*ћ)Ые! Нд“"‚Гб:ББББЙНc3ГІ7                    Н'ЌеН7;Б*ч:)з:еНЯ“е*щ:Н“Нд“ЙН'ЌеН7;Б*ч:)з:НЯ“е*щ:Н“ЙН'Ќл! Н­“"ч:Н'Ќ& }жoл! лНА“"щ:Й  ЕЕЕЕ!  9еНѕ Б|µВz;Нч0НХ2ББББЙН Ќ еНы:Б!  9"[;НаЊ[;n& еНR<Б|µВЉ;Н®2аяНB“еН®2чяНB“Н“|µКї;НЕ2Гњ;НЕ2еНR<Б|µВї;Гu;    *С;е*П;е! "П;.Н'Ќn& еНт1Б|µК <Н'Ќn& еНы:БН'Ќn& "С;ГяНB“К%<*П;|µК%<!  "С;"П;*С;еНR<БН`Ќ+~·В <*П;|µКG<!  еНR<Бб"П;б"С;Й  *Bл*DеН ЌС}*+л*DНj“Кx<НаЊDГ‹<*P<|µВ‹<!A"P<еН
=БН ЌЙ      Н'Ќ"”<n& еН;Б|µВ®<!  Й*B"ђ<л*D"’<*’<л*ђ<Нџ“К=*”<е*ђ<еН8>ББ|µКр<НаЊђ<~·ВЫ<*ђ<е*BНЗ“Й*ђ<Їѕ#Вф<ѕ#Вщ<"ђ<Гј<!  Й  *FеН2Б!
 еНg–Б*F"п*Jл*пНџ“КP=НаЊпn& чяНB“КE=!	 ГH=!  еНg–БГ =! AеН2Б*ћ Н”ЁеН2Б!+AеН2Б*n"=!  "n*ћ)ЊНЯ“еНsБ*="n!2AеН2БН'Ќ|µКѕ=Н'ЌеН2Б!5AеН2Б!
 еНg–БН«Њh!  еНМ=БЙ*€•|µВ>*|µК>Н'Ќ|µВх=* ###" л*НZ“Н&“К>!>AеН2БН¶•ця|µВ>! " Й  Нl>">НB“К(>!  Й*>еН'ЌНЗ“Й    Нl>"4>НB“КJ>!  Гk>*4>n& еНт1Б|µК`>!  Гk>*4>еН'ЌНЗ“ЙБбСге·К>ѕ#Кq>!  лбгЕеЕлЙН ?Н'ЌеН–>БЙ  *JеН'ЌеН>ББ"”>|µК»>*Jл*”>"J! Й!  Й  Н ?*JеН'ЌеН8>ББ"ї>|µКь>*Jл*ї>"JН®2еНт1Б|µКш>Нб2Ге>! Й!  ЙН®2}·В?*S#|µАНc3Н®7:l·К ?Н®2}ю К0?юК0?ю	К0?·рН«ЊJГ ?) , ; extra ; (ignored) { return if while for do break switch case default continu #asm goto } ( else misplaced case too many cases illegal constant value : bad label #endasm CALL_ illegal function call illegal symbol name previously defined  missing. ******
 not a declared variable too many active whiles no active whiles line too long #ifndef #ifdef ifdefs nested too deep #ifneed #if #else #endif Not enough memory for long line #undef " or ' #include ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                          RECUTL(RCUTLOV1)
.pa
*/
#include	"dd.h"
#include	"recutl.h"

BOOLEAN	dflt;		/* Is default value to be taken			*/

BYTE	gstring[61],	/* Byte array used for number entry		*/
	*swnames[8],	/* Switch names					*/
	*swvals[8],	/* Switch values				*/
	*rumes[20];	/* General messages				*/

WORD	text,		/* Text descriptor				*/
	swtot;		/* Total number of switches			*/

/*======================================================================*/
STATUS                     /*						*/
utlov1(lev,rd)             /* Create record descriptor from switch info */
struct	lvl	*lev;				/* Level descriptor	*/
struct	_rd	*rd;				/* Record descriptor 	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	RECUTL.OV1
Version		04.02
AMIE version	05.20
Revision history:
19/03/91 V04.02 issued - ICFO
         'Please Wait' message added after switches analysed.  Otherwise
         replying with just 'cr' to the /SH dialogue gave no appreciable
         response - ICFO
18/02/91 V04.01 issued - ICFO
         If /DF switch missing TS was requested after SS and ES.  This
         was caused by a faulty loop (n++ instead of ++n)
         (Change in RCUTLOV1 / STRINGS) - ICFO
17/12/90 V04.00 issued - ICFO
         Switch /SH added - ICFO
         Listing tidied up a lot - ICFO
08/07/88 V03.00 issued - ICFO
22/05/88 Names changed to V5 standard - ICFO
16/01/88 Response size increased to take 999,999,999 also used
         as max size and Max records in bytes message removed.  PN
06/08/87 Version numbered
04/05/87 Created DAR
*/

{

LOCAL
WORD	rv;			/* Return value				*/

STATIC
BYTE	*mfile = "RECUTL.MS1";	/* Local messages file			*/

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

lev->levchk = -1;
lev->bfsize = 0;
lev->expf = 3;

/* Fail if we have no switches						*/
if (lev->switches == 0)  return(ruerr(1));

/* Set up switches ready for inquiry					*/
swtot = setswt(8,lev->switches,swnames,swvals);

/* Load the message text						*/
if ((text = opn_txt(mfile,rumes,13)) == FAIL)  return(flerr(mfile,3));

/* Set up the record descriptor						*/
rv = setrec(rd);

/* Put up a 'Please Wait' message					*/
chat(19,20,NULL,NULL);

/* Free the local messages						*/
cls_txt(text);

/* Return to caller							*/
return(rv);

}

/*======================================================================*/
/*
.he                                                 RECUTL(RCUTLOV1 / SETREC)
.pa
*/
/*======================================================================*/
STATUS                        /*					*/
setrec(rd)                    /* Set up record descriptor from switches */
struct	_rd	*rd;	/* Pointer to record descriptor structure	*/
/*======================================================================*/

{

LOCAL
WORD	n;		/* Used in number length calculations		*/

LOCAL
LONG	rv;		/* Longs used in length arithmetic		*/

LONG	hrtdets();	/* Returns long int as maxrec can be > FFFF	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Is default switch present						*/
dflt = fndswt(swtot,swnames,"DF") != FAIL;

/* Get header size / record size / trailer size / max record number	*/
/* using similar function						*/
n = -1;
while (++n < 4) {
    if ((rv = hrtdets(n)) == (LONG) FAIL)  return(FAIL);
    switch (n) {

	case 0:
	    rd->sh_size = rv;
	    break;

	case 1:
	    rd->r_size = rv;
	    break;

	case 2:
	    rd->st_size = rv;
	    break;

	case 3:
	    rd->maxrec = rv;
	    break;
    }
}

/* Set up temp file containing start & trailer strings			*/
if (strings(rd) == FAIL)  return(FAIL);

/* Set up /SH switch							*/
if (set_sh(rd) == FAIL)  return(FAIL);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                REC#define #UPPER macro table full ^
******    Line  :    ****** Hit <RETURN> to continue.     !уя9щ!  9еН'ЌеНШAББН'Ќ|µВЂAН Ќ Н&“Н&“КЏA!  9еН‡sБ! 9щЙ  !уя9щ!  9е! еНcCББН Ќ |µВКAН Ќ"•A! 9Нz’лл! 9щлЙ!fеН
=Б!  ГВAН'ЌеН'ЌеНcCББ!)fеН‡>Б|µВШAН'ЌЙ!уя9щ!  9е! еНcCББеН‡sБ! 9щЙ+f  Н ?НБB"B|µК5BН'ЌеНрBБГ¤B!CfеН‡>Б|µВFB!  ЙН'ЌеНрBБ"B|µК¤BН®2Г“BНµ2ГBГ¤B*B еН®2С}*BеН
=БГ¤BНм“cB  cB	 cB    ГfBНм“]B- ]B* ]B&   НТЊB|µКґBНЕ2Г¤B!  "XA#Й     !ѕBеНрBБ"јB|µКкB*Jл*јBn& Гя|µВкB*јB#Й!  Й  Н'Ќ"оBН®2Г%CН®2еНµ2НL“ВRCНаЊоBеН®2С}НаЊоBеН®2С}ГRCНм“эB> эB< C+ C- C* C/ C% C^ C| C&   *оB6 *оBеН'ЌНЗ“Й;ЕН'ЌеН{FБ!  9еНBБ|µК‘CН'Ќе! 9еН'Ќ	еН­CБББН'Ќ3БЙН'Ќе! еНcCББЙ2    !уя9щН Ќ§CН'Ќ"§CеН'eБ*§CеН eБ|µВЩC*§CеН–sБ*§Cn& я|µВхC*§Cе! еНљ}ББН'Ќ~·К#D! 9е*§CеН.WББН'Ќе!Cе!
 9еНАPБББГ1D! 9е! еНcCББН'ЌНB“КBDН ЌНB“Н&“КіD*§Cn& ГўD*§CеН–sБ*§CеНм}Б! 9е*§CеНGEББ*§Cе! 9еН“{ББ*§Cе! 9еН.WББ*§Cлб"§Cб"©Cб"«C! 9щлЙНм“QD YD YDя   ! 9еН‡sБ*§CеНм}Б! 9е*§CеНаDББ*§CеН9{Б*§CГЋDН'ЌеНо„БеН'ЌеНо„Б)СГ/EН'ЌеН'ЌеН5‡ББГ@EН'ЌеН'ЌеН‡ББГ@EН'ЌеН'ЌеН ‡ББГ@EНм“щD E E   Й.A    *AEеН'Ќ"AE#n& "CEН.Ќn& "EEН6ЌНЯ“|µКЋE*CEыя|µВѓE!EfеН
=Б*AE#6б"AEЙН'ЌеНо„Б|µКF*EEГтE*CEыя|µВЗE*AE е*AE Нz’НfђбН€’ГяE*CEыя|µКпE*AE е*AE Нz’Н1ђбН€’ГяEНм“ўE КE   Г'F*CEыя|µВ'F*AE е*AE Нz’НfђбН€’*AE#е*EEС}Г‰EН'Ќn& НB“КXFН'Ќ Нz’ЕХ    Нђ’Н&“Й                               Н Ќ\FН'Ќ"\Fе!  еН]HББ!XfеН‡>Б|µК1H!  "XA*\FеН‡sБ*\FеНG1"`Fе! еНЫБББ*\FеН{FБ*\FеН5FБ"fF*\FеН‡sБ*\F#n& "bF*\F##НЯ“"dF!ZfеН1БНG1"^FеНББ*`FеНM1Б*\FеН{FБ*\FеН5FБ"lF*\FеН‡sБ*bF}2oF*\F#n& "jF*\F##НЯ“"hFН&“К…G*hFе*dFНL“ВaG*bFе*jFНL“Н&“К‚G*fF|µКG*hF"dF*jF}2oFГ‚GН\qГH*dF|µК™G*lFНB“Д\qГH*jFе*bFН.“ВH*jFл*oF& Нj“КјG*jF}2oF*oF& ьН‡“ТH*dF"pF*jFе*oF& Н.“КHНG1"hFеНББ*^FеНM1Б*hF"^F*\F#е*bFС}*\Fе!nFеНаDББ*\F#е*oF& С}*\F##е*dFНд“*^FеНM1Б*\Fлб"\Fб"^Fб"`Fб"bFб"dFб"fFлЙ\f_f]fbf`f    !уя9щН ЌYHН'ЌыН‡“ТЋHН'ЌеН¤IБлб"YHб"[H! 9щлЙН'ЌеН.ЌеН]HББН'Ќ)OHНЯ“"[H! |µК“IН ?Н®2е*[Hn& НL“В“IНµ2е*[Hn& Н.“КгH*[H#n& |µК“I!  "XAНБB|µВьH*[HеН‡>БНB“Н&“В“IН'ЌюН‡“Ъ2IН'ЌеН‡sБН'ЌеНG1"YHеН'ЌеНЫБББГ@IН'Ќе!  еНљ}ББ! 9еН.ЌеН]HББН'ЌюН‡“ЪsI! 9еН‡sБ*YHеНM1БНђ„ГђIН'ЌеНм}Б*[HеН'Ќе! 9еНhБББГ¬HН'ЌГ~H          !уя9щ*њIе*љIеН'Ќ"љIеНWLБН ?Н®2ГЬI*љIлб"љIб"њI! 9щлЙГмIНм“ЩI= ЩI!   ГЖI! |µКЙI!df"њIеН‡>Б|µВJ!gf"њIеН‡>БН&“КLL*љIе!  еНљ}ББ! 9еНWLБ*љIеНо„Б"ћI! 9еНо„Б)" IН ЌНB“КXJ*ћIл* IНB“Н&“КкJ*љIеНм}Б*љI##НЯ“|µКѓJ*љI##6 #6 *љI#6!jfе*љIе! 9еНhБББ*љIеН‡sБН ?*XA#НB“КµJН®2е*ZAН.“Н&“КПJ*њIn& ГяН&“#"XAГзJ*њIn& Гя|µВдJНf„ГзJНђ„Г4L! 9еН‡sБ*љIеНм}Б*љIn& яН&“"ўI|µК!K! 9еН~Б*љIеН‡sБ*ћIл* I|µВLKНЎ~*њIn& Гя|µВFKНџ„ГIKН®„Г4L*ћIл* IГХK*ўI|µКpK! 9е*љIеН§…ББГ~K! 9е*љIеН‡ББГжK*ўI|µКљK*љIе! 9еН‡ББГЁK*љIе! 9еН§…ББГжK*ўI|µКДK*љIе! 9еН5‡ББГТK! 9е*љIеН5‡ББГжKНм“WK ЃK «K   *d "d*љI#n& ыяНB“ВLН ЌыяНB“Н&“"ћI*њIn& Гя|µВ,L*ћIеН@…БГ4L*ћIеН^…Б*љI6я*љI#6*љI##6 #6 ГRL*љIГЙIГмI е*ULеН'Ќ"ULеНZPБН ?Н®2Г‡LНµ2еН®2НL“В—L*ULлб"ULлЙНм“pL< pL>   Г}L! |µКЂL*ULе!lfе!  еН4MБББ|µВ—L*ULе!ofе! еН4MБББ|µВ—L*ULе!rfе! еН4MБББ|µВ—L*ULе!tfе! еН4MБББ|µВ—L*ULГЂLГ—L        е*    vf|f‚f€fЋf”fљf f¦f«f°fµfєfАfЖfМf  !уя9щ*MеН'Ќ"MН'ЌеН‡>Б|µКPН'Ќ"
M*Mn& я|µВuM*Mе!  еНљ}ББ! 9еНZPБ*M"MеНм}Б! 9"Mn& яНB“КЄM*Mn& яН&“Н&“Д;P*MеНо„Б"M*MеНо„Б"M*Mл*M|µКkN*Mn& я|µКтM*MеН‡sБ*MеН~Б*MеН‡sБ*M|µВ!N*Mе*MеН§…ББ*M#е*M#n& С}Г,NН ЌMНаDББ*M#n& ьяНB“КCN!  ГFN! "M*
Mл*M)MНЯ“еНЛ~Б*d "dГЧO*Mn& я|µК O*MеНБdБ|µД;P*MеНБdБ|µКhO*MеН‡sБН ?*XA#НB“КіNН®2е*ZAН.“Н&“КВN*Mn& НB“Н&“К]O*M Нz’лНС“"M*MеНPБе*MеНPБН“шяНB“"M|µКO*M|оЂg"M*
MГ:OНќЊM|µВ(O! е*
MНЗ“еНЅwБГЭO*
M& }жo###"XAГJOНм“O O   Г(O*MеН6xБ*MеНnЂБГЧO*MеННwБГ«O*MеН eБ|µД;P*MеН‡sБ*MеН eБ|µКOН…}*MеН‡sБГ«O*MеН~Б*MеН‡sБН§~*MеНPБе*MеНPБН“"M*
Mл*M)MНЯ“еНЛ~Б! "†*M#6*M6я*M##6 #6 ! лб"M! 9щлЙ!  ГхOН6ЌНЯ“& }жoГ*PН.Ќn& +++|µВ7P! ЙНм“P  &P   ! Й*M"M*M"M*M"M*
M}оo"
MЙ  Н'ЌеН^QБН ?Н®2Г®PНБB|µВ«P!Тf"XPеН‡>Б|µВЏP!Хf"XPеН‡>БН&“К«P*XPе!^QеН'ЌеНАPБББГtPГ»PНм“lP> lP<   Н'ЌЙ!уя9щН'Ќn& яНB“ВвPН'ЌеН1QБНB“Н&“КцPН'Ќе!  еНљ}ББН'Ќе! 9ге!QгйБН'ЌеНм}БН'ЌеН'Ќе! 9еНhБББН'Ќл! 9щлЙН'Ќn& Г?Q! ЙНм“;Q+ ;Q* ;Q| ;Q& ;Q^   !  Й  Н'ЌеНЖQБН ?Н®2ГІQНБB|µВЇQ!Шf"\QеН‡>Б|µВ“Q!jf"\QеН‡>БН&“КЇQ*\Qе!ЖQеН'ЌеНАPБББГxQГїQНм“pQ+ pQ-   Н'ЌЙ  Н'ЌеНKRБН ?Н®2Г+RНБB|µВ(R!Ъf"ДQеН‡>Б|µВыQ!Ьf"ДQеН‡>БН&“ВR!Юf"ДQеН‡>БН&“К(R*ДQе!KRеН'ЌеНАPБББГаQГ<RНм“ШQ* ШQ/ ШQ%   Н'ЌЙ        !уя9щН ЌARН'Ќ"AR!аfеНБ>Б|µК'S!зfеН‡>Б|µВ‚R*ARеНKRБГБRНЈ"CR|µК¬R*CRеНkБ!  "ER*"CR!йfеН1БГкR*ARе!  еНШAББ!йfеН1Б*ARn& "ER*AR##е*AR##НЯ“))##Нд“*ARеН3ZБ"CR*ARе!  е.е. ее*CRНу’ЕХ!  ееНxcл! 9щл*ERя|µВ$S*ARеН‡sБГЛVНжV"GR|µКCS*ARеНKRБ!  "CRГ2VН®2ГчUНЕ2"CR*ARеНKRБ*ARn& |µВьS*CRГлS*AR#n& ыя|µВ”S*AR е*AR Нz’НМЌбН€’Г­S*AR е*AR Нz’Н\’бН€’ГЛV*AR е*AR Нz’НЬ’Ну’бН€’ГЛV*AR е*AR Нz’Нm’бН€’ГЛVНм“hS- °S! ПS~   *ARеН‡sБ*ARеНо„Б|µКѓT*AR#n& ьяНB“"IR*CRГoT*IR|µК6TНЖ„Г9TНП„ГЛV*IR|µКJTНШ„ГMTНб„*AR#6ГЛV*IR|µКdTНЅ„ГlT!лfеН
=БГЛVНм“(T- <T! VT~   Г¬T*CRГ›TН]„ГЛVНf„ГЛVНu„ГЛVНм“‰T- ЏT! •T~   НЕ2*ARеНKRБ*AR ~·КЛT*ARеН‡sБ*ARеНџeБГЛVНЕ2*ARеНKRБ*AR##НЯ“Н&“ВьT*AR#n&  Нj“Н&“КUTL(RCUTLOV1 / HRTDETS)
.pa
*/
/*======================================================================*/
LONG                                                /*			*/
hrtdets(type)                                       /* Get switch value */
WORD	type;				/* Type of input required	*/
/*======================================================================*/

{

/* Type = 0 - header size required					*/
/*        1 - record size required					*/
/*        2 - trailer size required					*/
/*        3 - maximum record size required				*/

/* Declare switch IDs that we are looking for				*/
STATIC
BYTE	*swtyp[]={
	"HS",		/* Header size to ignore on input		*/
	"RS",		/* Record size taken from input stream		*/
	"TS",		/* Trailer size to ignore from input stream	*/
	"MR"		/* Maximum number of records to put to output	*/
};

/* Define user messages to output					*/
STATIC
WORD	omsg[] = {
	1,		/* Enter input header size			*/
	4,		/* Enter input record size			*/
	5,		/* Enter input trailer size			*/
	10		/* Enter maximum number of records		*/
};

/* Define user error messages 						*/
STATIC
WORD	emsg[] = {
	2,		/* Invalid input header size			*/
	3,		/* Invalid input record size			*/
	4,		/* Invalid input trailer size			*/
	7		/* Invalid maximum record number		*/
};

/* Default values for the size variables				*/
STATIC
LONG	def_val[] = {
	0,		/* No header bytes				*/
	80,		/* 80 character records				*/
	0,		/* No trailer bytes				*/
	999999999};	/* Very high value for maximum record number	*/

/* Define upper limits of the size variables				*/
STATIC
LONG	u_limit[] = {
	999999999,	/* Input header size = LOTS			*/
	999999999,	/* Input record size = LOTS			*/
	999999999,	/* Input trailer size = LOTS			*/
	999999999};	/* Maximum record number = LOTS			*/

LOCAL
BOOLEAN	defined;	/* Is an item defined or not			*/

LOCAL
WORD	index;		/* Index into switch array			*/

LOCAL
LONG	rv;		/* Return value					*/

LONG	gtkbnm();	/* Converts ASCII to long			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

defined = FALSE;	/* Prime end of process flag			*/

/* Look for required switch ID						*/
if ((index = fndswt(swtot,swnames,swtyp[type])) != FAIL) {

/* Switch is present but has it a value?				*/
    if (*(swvals[index]) != 0) {

/* YES so translate it							*/
	rv = gtkbnm(swvals[index]);
	if (rv >=0 && rv <= u_limit[type])  defined = TRUE;
	else  ruerr(emsg[type]);
    }
}

/* If switch not defined is there a valid default			*/
else {
    if (dflt == TRUE) {

/* Read from default table above					*/
	rv = def_val[type];
	defined = TRUE;
    }
}

/* While value undefined or invalid ask operator for size		*/
while (defined == FALSE) {

/* Enter size manually							*/
    ru_chat(0,omsg[type],(type == 3) ? 0 : 2,3,9);

/* Enter a number							*/
    if (lgetlin(gstring,10) != 0)  return((LONG) FAIL);

/* Take default on RET only						*/
    if (gstring[0] == 0)  rv = def_val[type];

/* Translate number that might contain a 'K' char in it			*/
    else  rv = gtkbnm(gstring);

/* Check given value is in range					*/
    if (rv >=0 && rv <= u_limit[type])  defined = TRUE;
    else  ruerr(emsg[type]);
}

return(rv);

}

/*======================================================================*/
/*
.he                                                RECUTL(RCUTLOV1 / STRINGS)
.pa
*/
/*======================================================================*/
STATUS             /*							*/
strings(rd)        /* Process header & trailer strings from switch list */
struct	_rd	*rd;		/* Record descriptor in recutl main	*/
/*======================================================================*/

{

LOCAL
FILE	tfd;			/* File descriptor for RECUTL.TMP	*/

STATIC
BYTE	*tfile = "RECUTL.TMP";	/* Temp filename			*/

LOCAL
WORD	rv,	/* Return value						*/
	n;	/* Counter used to process header (0) & trailer (1)	*/

UWORD	def_str();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Open up the scratch file & put strings into it			*/
if ((tfd = spopen(tfile,"WC")) == OPENFAIL)  return(flerr(tfile,3));

/* Define header & trailer string using def_str() function		*/
n = -1;
while (++n < 2) {		/* 0 = header 1 = trailer		*/

/* 'def_str' returns the length of the head or trail string processed	*/
/* having written the fully expanded string to disk			*/
    if ((rv = def_str(n,tfd)) == FAIL)  break;

/* Terminate the string							*/
    spputc(0,tfd);

/* Store the string lengths in the record descriptor structure		*/
    if (n == 0)  rd->dh_size = rv;
    else	 rd->dt_size = rv;
}

/* Close the scratch file						*/
spclose(tfd);

/* Return SUCCESS or FAIL depending on value of rv			*/
return((rv == FAIL) ? FAIL : SUCCESS);

}

/*======================================================================*/
/*
.he                                                RECUTL(RCUTLOV1 / DEF_STR)
.pa
*/
/*===============================================
U*ARеН'eБ*ARеН–sБ*AR##е*AR##НЯ“))##Нд“*AR 6 ГЛVНЕ2НЈ"CR|µКзU*CRеНkБ!йfеН1Б*юН‡“ТeU!gеН
=Б*э"ER& }жo+НB“К}UН«ЊER*ARеНKRБ*ARеН‡sБ*AR##НЯ“& }жoН&“К§U! Г®U*AR#n& е*ER& }жoН&“КДU! ГЗU*CRеНG€ББ*AR#е*CRС}*AR##е*ERНд“ГЛV*ARе! еНfWББГ!VНм“IS- IS! IS~ ¬T* ЦT& 3U(   *ARе!  еНfWББНжV"GR|µКЛV! "CR*ARеН'eБ*ARеН eБНB“КUV*ARn& яН&“Н&“КkV*ARеН–sБ*ARеН~Б! 9е*ARеН.WББ*ARn& я|µВЌV*AR6я*GRе*ARе! еНј[БББ! 9еН9{Б*CR|µКВV*GRе*ARе!яяеНј[БББ*AR 6 *ARлб"ARб"CRб"ERб"GR! 9щлЙН ?Н®2ГWНµ2Хя|µВWНЕ2НЕ2!ШfЙНµ2Уя|µВ(WНЕ2НЕ2!jfЙНм“пV+ W-   !  Й  *,Wе! ",WНТЊ,W|µКYWГEWН`Ќ+еН`Ќ+n& С}Г8Wб",WЙх      !уя9щН Ќ^WН'Ќ"^WеН'ЌеН\ББ! |µКX*^W##НЯ“"`W& }жo"bW!зfеН‡>Б|µКоW*bW+++|µКВW!gеН
=БГКW*^WеНе.Б*^W6я*^W 6 *^W##е*`Wл! Н­“Нд“ГѓW*bW+++|µВ6X*^W##е*`W))}цoНд“*^W
 еНЯ“##Нд“*^Wлб"^Wб"`Wб"bWб"dW! 9щлЙН®2ГZНЕ2*bWГPX!,gеН
=БГ`XНм“MX MX   ГEX*^Wе!  еНљ}ББ! 9е! еНШAББ*^WеНм}Б!Шfе*^Wе! 9еНhБББ*^W ~·КЄX*^WеН‡sБ*^WеНџeБ!<gеН1БГѓWНЕ2*^W#n&  Н[“КЦX*bWНB“Н&“КжX*^W n& Н&“КхX! 9еНѕ БН&“КY! 9е!э еН¦ББ"dWН&“КEY*^Wn& я|µК›Y*^W еНz’ЕХ*dW НЯ“Ну’НO’бН€’ГНY!>gеН
=БНќ0ГѓW!WgеН‡>Б|µКZ*bW++|µВEY! 9еНѕ БНB“ВЌY! 9е!э еН¦ББ"dWНB“Н&“ВEY*^WеН‡sБ*^W#6*^W##6 #6 *^W 6 !Шfе*^Wе*dW НЯ“еНј[БББ*^W#е*dW n& С}*^W##е*dW НЯ“Нд“*^W
 е*dW Нд“*^W 6ГѓW*^WГXГѓWНм“<X[ ЅX. SY-   ГZ      Н Ќ-ZН'Ќ
 НЯ“"-ZН6ЌНЯ“"/Z& }жoГS[! "1ZГ)[Н–Њ-Z! "1Z! |µК,[*/Zл! Н­“"/Z& }жoГ;[*1Zл*1Z"1ZГ)[*-Z|µВ­Z!ZgеН
=БГїZНЛЊ-ZНЯ“л*1ZН”"1ZГnZН.Ќn& "/ZрН‡“ТсZ*/ZеН!Б НЯ“л*1ZН”"1ZГ)[*/ZГ[*1Z"1ZГ)[*1Z))"1ZГ)[*1Z)"1ZГ)[Нм“чZ  [  [   Г[*1Zлб"-Zб"/Zб"1ZлЙНм“ЊZ ЊZ љZ ВZ    ГnZНм“cZ hZ   ГZZН'Ќn& Гu[! Й! ЙНм“m[ю q[я   Н'ЌеНБdБ|µКё[Н'ЌНB“К [! Г·[Н'ЌеН1QБ|µКґ[!  Г·[! Й! Й!уя9щ!  9е!  е.е. ее.Н'ЌНу’ЕХ!  ееНxcл! 9щлН'ЌеН'Ќе! 9еНhБББ! 9щЙБ*            ЕЕЕЕ*\еН'Ќ"\! 9е*(НЗ“"
\л*бН “КA\*
\"бН'Ќ|µВR\!зfеН‡>БН&“Кv\!  "XA*\е! еНШAББ!йfеН1БГю]! 9еНѕ Б|µК®]! 9еНБ"\НB“КЄ\! 9е!  еН¦ББ"\НB“Н&“КЯ\! 9е! е+е. е#е+ееН»л! 9щл"\Н ?Н®2Шя|µД>1!  "\"
\"\*\ НЯ“"\*\
 n& "\Г7]*\"\ГP]*\ НЯ“"
\ГP]! "\*\ НЯ“"\ГP]Нм“] ] !] !] ']   *\& }жoГe]! "\Гr]Нм“\]  \]   *\е*\е*\ n& е*\е*\е*
\Ну’ЕХ*\ е*\еНxcл! 9щлГю]*\еНt^БНB“КЗ]*\еНbБНB“Н&“Кю]!mgеН
=Б*\е!  е.е. ее    ЕХ!  ееНxcл! 9щлНќ0*\лб"\ББББлЙ!уя9щН'Ќn& "ZA!яя"XA!  9е! еНШAББН'ЌеН1БНќЊXA ЂН‡“ЪL^! "XA!  9еН'ЌеН'Ќе*XAН“еНЫБББ!  "XA! 9щЙН'ЌеН™^Б|µВ‹^Н'ЌеНГaБН&“Й          !Юя9щ!  "‘^9Нѓ’    ! 9"Џ^Н®2"•^ТяНB“КН^*H…НB“Н&“КЊ_НаЊЏ^е*•^С}НЕ2Н$a"•^еНЏaБ»я|µВC_НаЊЏ^е*•^С}НЕ2Н®2"•^ХяНB“е*•^УяНB“Н“е*•^еНа1БН“|µКC_НаЊЏ^е*•^С}НЕ2Н$a*Џ^6 !  9е! 9еН«ђббН€’Н'Ќ$е!  е.е. ее.
9Нz’ЕХ!  ееНxcл! 9щл! л!" 9щлЙН®2еНа1Б|µКaН®2Ря|µВИ_! "‘^НЕ2Н®2еНЏaБЁя|µВИ_! "‘^НЕ2Н®2еНQaБ|µКs`Н®2еНћaБ"•^	 Нk“Ку_*‘^ьяН&“Н&“Вs`НаЊЏ^еНЕ2С}*‘^|µК'`!  9еНz’ЕХ*‘^Ну’НИ‘бН€’ГY`!  9е! 9Нz’ЕХ   НИ‘ЕХ! 9Нz’НO’ЕХ   НИ‘бН€’!  9еНz’ЕХ*•^Ну’НO’бН€’ГИ_*H…|µВе`Н®2"•^еНЏaБГС`! "“^НЕ2Гл`*‘^Н&“Ну’ЕХ   НO’ЕХ! 9Нz’НГ’Нѓ‘НЧ’КИ`! ГЛ`! "“^Гл`Нм“У^. ц^E Ќ`L   Г™`! "“^Н'Ќ$е!  е*“^е!  ее.
9Нz’ЕХ!  ееНxcл! 9щл! Г„_!  Г„_Г„_ Н®2}2#aеНа1Б|µКIaНаЊЏ^е*#a& С}НЕ2Г$a*#a& Й  Н ЌеНа1Б|µКca! ЙН ЌеНЏaБ"OaA Н[“КЃa*OaF НZ“Н&“К‹a! Й!  ЙСбеХ}юaШю{РЦ oЙН ЌеНа1Б|µКµaН ЌРяЙН ЌеНЏaБЙяЙ!ЂgеН‡>Б|µВФa!  ЙН'Ќе!  е.е. ееНdНу’ЕХ!  ееНxcл! 9щл!ЂgеН1Б! Й            !њя9щ!‚gеН‡>Б|µВ0b!  л!d 9щлЙ!  9"	bН®2Юя|µКZbН®2|µКZbНаЊ	bеНdС}Г7bНЕ2НаЊ	b6 *	bе! 9НЗ“"b*|µКоb*>"b*>л*@л*bНџ“Коb!  9"bНаЊb"b*	bл*bНџ“КИbНаЊbn& еНаЊbn& НL“ВлbГЎb*>л*@л*bНЌ“Клb*bе*>НЗ“+"bГHcГЂb*@"b!  9"b*	bл*bНџ“КHc*+л*@Н[“К/c*b|µВ&c!„gеН
=Б! "bГHcНаЊ@л*>еНаЊbn& С}ГыbН'Ќfе! е.ее*bе*bНе’ЕХ!  ееНxcл! 9щл*bГ(bНТ*vcеН'Ќ"vcеН'ЌС}*vc#еН'ЌС}*vc##еН'ЌНд“*vc еН'ЌНд“*vc е!
 9Нz’бН€’*vc
 еН'ЌНд“*vc еН'ЌС}Н'ЌГэc! "ЉГ
d! "€Г
dНм“лc фc   б"vcЙ     НЕ2}2d¤яН&“К+d*d& ЙНЕ2}2d!›g"d*d~·КcdНаЊdn& е*d& Н.“К[d*dn& ЙНаЊdГ8d*d& еНа1Б|µКёd*d& Ря}2d! "dНќЊdН&“еН®2еНа1БН“|µКёd*d& )))еНЕ2РяН“}2dГ…d*d& }ГЪ“Н'Ќn& ГзdН6ЌНЯ“& }жo+Н&“Кгd!  Й! ЙНм“Лd Лd Лd гd    !  ЙН'Ќn& Гe! ЙНм“
e  
e 
e 
e   !  ЙН'Ќ ~·К8e! ЙН6ЌНЯ“& }жoГ[eН.Ќn& рН‡“ТleГЏeНм“He  Xe Xe   Н'Ќn& Гze! ЙНм“ve ve ve ve   !¦gеН
=Б!  Й"+  *›eеН'Ќ"›e##НЯ“& }жoГьe!ЗgеН
=Б*›e
 НЯ“"ќe*›e
 еН–ЊќeНд“*›e##еНЯ“л! Н­“Нд“*›e 6ГfНм“Аe Эe   Гёe*›eлб"›eлЙmust be a constant , Warning - =X op assumed = illegal assignment ? : || && ^ == != - <= >= < > cl.le cl.ge cl.lt cl.gt cf.le cf.ge cf.lt cf.gt c.le c.ge c.lt c.gt c.ule c.uge c.ult c.ugt << >> + * / % sizeof ( ) operands and/or operator incompatible too complex not a function can't subscript ] illegal struct reference -> can't compute size invalid expression ' " string space exhausted n
t	brf Illegal expression - need lvalue not a pointer eqбѓgqкѓjqуѓlqьѓnq„pqT„sq<„vq!„yq*„|q3„  еНtI                    Н Ќh
Н'Ќ"h*яgеН'Ќ"яg"h*h"h*hn& я|µВOh*hеН‡sБ*hn& я|µВfh*hеН‡sБН'Ќn& "h*h##НЯ“& }жo"	h*h##НЯ“& }жo"h*	hН&“"hе*hН&“С"hГЛk*hУя|µВ,qГЬk*hГНhГЭh*h|µВЭhГ,qНм“їh+ Вh-   ГКh*h|µВчh*h"h*h"h*h"h*hеНо„Б|=======================*/
UWORD                    /*						*/
def_str(type,tfd)        /* Write header or trailer string to disk file */
WORD	type;		/* 0 = header string  1 = trailer string	*/
FILE	tfd;		/* Scratch file fd, RECUTL.TMP			*/
/*======================================================================*/

{

LOCAL
BOOLEAN	defined;	/* Is string defined Y/N			*/

LOCAL
UWORD	index,		/* Index into switch array			*/
	rv;		/* Return value is length of the string		*/

/* Possible switch IDS - SS = Header string  ES = trailer string	*/
STATIC
BYTE	*swtyp[] = { "SS", "ES" };

/* Possible message & error codes					*/
STATIC
WORD	omsg[] = { 6, 7 },
	emsg[] = { 5, 6 };

UWORD	strans();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

defined = FALSE;	/* String not yet defined			*/

/* Is the required string ID in switch list				*/
if ((index = fndswt(swtot,swnames,swtyp[type])) != FAIL) {

/* We have a switch but do we have a value				*/
    if (*(swvals[index]) != 0) {
	if ((rv = strans(swvals[index],tfd)) != (UWORD) FAIL)
							   defined = TRUE;
	else {
	    seterr("RECUTL");
	    flerr(swvals[index],emsg[type]);
	}
    }
}
else {

/* No switch ID but can we take a default value				*/
    if (dflt == TRUE) {
	rv = 0;		/* Default is a zero length string		*/
	defined = TRUE;
    }
}

/* If string still undefined then ask the operator for it		*/
while (defined == FALSE) {

/* Enter string by hand							*/
    ru_chat(0,omsg[type],8,9,60);

/* Enter a number exit if 0 not returned				*/
    if (lgetlin(gstring,61) != 0) {
	rv = FAIL;
	break;
    }

/* Take default (null string) on RET only				*/
    if (gstring[0] == 0) {
	rv = 0;
	defined = TRUE;
    }
    else {
	if ((rv = strans(gstring,tfd)) != (UWORD) FAIL)  defined = TRUE;
	else {
	    seterr("RECUTL");
	    flerr(swvals[index],emsg[type]);
	}
    }
}

/* Return size of the string if in limits				*/
return((rv >= 0 && rv <= 0x7fff) ? rv : (UWORD) ruerr(emsg[type]));

}

/*======================================================================*/
/*
.he                                                 RECUTL(RCUTLOV1 / STRANS)
.pa
*/
/*======================================================================*/
UWORD                        /*						*/
strans(sptr,tfd)             /* Translate & write switch string to file */
BYTE	*sptr;		/* Pointer to text switch text			*/
FILE	tfd;		/* Write expanded switch string to this file	*/
/*======================================================================*/

{

LOCAL
UWORD	c,	/* Takes characters form the string			*/
	rv;	/* Return value is length of the string			*/

UWORD	tr_hexst();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Get first character of the string					*/
c = toupper(*sptr++);

/* If an ASCII string is defined then write it to the file & return	*/
/* terminating zero must also be written				*/
if (c == 'A') {
    rv = 0;
    while (*sptr) {
	spputc(*sptr++,tfd);
	++rv;
    }
    return(rv);
}

/* Translate a hex based string	(but only if declared correctly)	*/
if (c != 'H')  return(FAIL);

/* 'tr_hexst' returns length of string written				*/
if ((rv = tr_hexst(sptr,tfd)) == FAIL)  return(FAIL);

return(rv);			/* Return length of the written string	*/

}

/*======================================================================*/
/*
.he                                               RECUTL(RCUTLOV1 / TR_HEXST)
.pa
*/
/*======================================================================*/
UWORD                      /* Translate hex string definition to string */
tr_hexst(sptr,tfd)                       /* placing result in text file */
BYTE	*sptr;			/* Pointer to switch list		*/
FILE	tfd;			/* Temporary scratch file		*/
/*======================================================================*/

{

LOCAL
UWORD	stlen,		/* String length				*/
	i,		/* Character counter				*/
	rep,		/* Repitition factor				*/
	c,		/* Character manipulator			*/
	hval,		/* Value of hex digit				*/
	hbyte;		/* Running total of hex value string		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

stlen = 0;	/* Set string length to 0				*/

clrs();

/* Read the source string up to NULL char				*/
while (*sptr) {

/* Get 1st char of hex string						*/
    if ((hbyte = tohex(*sptr++)) == FAIL)  return(FAIL);

/* Get next char - is it hex						*/
    if ((hval = tohex(*sptr)) != FAIL) {
	hbyte = hbyte * 16 + hval;
	++sptr;
    }

/* Get the repitition factor if any					*/
    c = toupper(*sptr);
    rep = 0;
    if (c == 'R') {
	while (isdigit(*++sptr)) {
	    rep = 10 * rep + (*sptr - '0');
	}
    }

/* If repitition is zero set it to 1					*/
    else  rep = 1;

/* Bump string length by size of this element				*/
    stlen += rep;

/* If on writing pass send out the string to the file			*/
    while (rep-- != 0)  spputc(hbyte,tfd);

/* If not at end of string increment pµВ,q*hеН3ZБ"h+НB“ВЬk*hn& я|µВ5iНї~*h6я*h6юГQi*hn& я|µВQi*hе!  еНљ}ББ!jqе*hе*hеНј[БББ*hеНм}Б*h#е*h#n& С}*h##е*h##НЯ“Нд“ГЬk*hеНо„Бе*hеНо„БС"h|µКИk*hеНо„Б|µКщj*hn& я|µВpj*hеН‡sБ*hеНо„Б|µВиiН ЌhН‡ББГ1j*h#n& ыя|µВ&j*hn& я|µВj*hе*hеН§…ББ*h#е*h#n& С}Г1jН ЌhН5‡ББ*h#е*h#n& С}*hn& я|µКmj*hеН~Б*hеН‡sБН'ЌеН1QБ|µМЋ…ГIk*hn& Гйj*hеН‡sБ*hеН~Б*hеН‡sБ*hеНо„Б|µВ¬jН ЌhН‡ББГжj*h#n& ыя|µВЫj*hе*hеН§…ББ*h#е*h#n& С}ГжjН ЌhН5‡ББГIkНм“yjя ‰jю   Гyj*hеНо„Б|µКИk*hn& я|µК%k*hеН‡sБ*hеН~Б*hе*hеН§…ББ*h#е*h#n& С}*hеН‡sБ*h#n& ыяНB“Вhk*h#n& ыяНB“Н&“КЁk*hГ€kН.Ќn& е*hНL“ВЁkГ,qНм“tk< tk> …k% …k& …k| …k^   ГЁkН'Ќе*hеН{†ББ*яg#е*h#n& С}ГЗpГЬkНм“Єh №h Ћi    *hn& |µВ»n*h Нz’л"h*h Нz’л"h|µВ;l*hГ"lН.Ќn& е*hНL“В;lГmmНм“l< l> l+ l- l|   *hn& Г}m*	h+|µВ’m*hГ.m*hл*h"hГ[m*hе*hНЗ“"hГ[m*hл*hН”"hГ[m*hл*hН'”"hГ[m*hл*hН'”л"hГ[m*hе*hН“"hГ[m*hе*hН“"hГ[m*hе*hН“"hГ[mН.Ќn& ДяНB“Крl*hл*hНА“Гъl*hл*hНj“"hГ[mН.Ќn& ВяНB“Кm*hл*hН­“Г(m*hл*hНk“"hГ[mНм“Sl+ al- ql* Ѓl/ ‘l% ўl| Іl& Вl^ Тl<  m>   *h е*hНу’бН€’*яgе*hеН.WББГ/qНм“Dl Dl Dl Ml    *hеН‡sБ*hГ–n*hНС“"h*h ЂН‡“ЪЗm!‡„"h*hНС“"hГУm!~„"h*h"h*hГn*hе!вmгй*hе!лmгй*hе!фmгйГЗp*hеН6xБНбѓГЗpНм“Щm вm лm   Гчm*h+|µКЗpГ»nН.Ќn& Дя|µВ»n! л*hНА“"h*hГ]nНШѓНШѓНШѓНШѓНШѓНШѓГЗpНм“Hn@ Kn  Nn Qn Tn Wn Zn   Г»n*hе*hеНHЃББ|µВЗpГ»nНм“ m- ©m+ n/ %n< Bn* Ѓn& Ѓn| Ѓn^   Н'ЌеН1QБ|µКТn*hn& НB“Н&“Кнn*h"h*h"h*h"hГЬk!Хg"сНЛЊсНЯ“"h|µК,qГoН–ЊсГуnНаЊhn& е*hН.“К)qН.Ќn& НB“В@oНаЊhn& еН.Ќn& Н.“Н&“К)q*hn& —я"h*hе*hеН'Ќ еНc[БББе*hе*hеН'Ќ"еНc[БББСНk“К“o*h"h*h"h*h"h*hn& Гp*hn& я|µВБo*hеННwБ*h|µВ:pН~Г)p*hеН‡sБ*h|µКpН'ЌеН1QБ|µКзo*hеНБdБН&“Кшo*hеННwБГpН…}*hеН‡sБГ:p*hеН~Б*hеН‡sБГ)pНм“Йoя pю   Гњo*h|µК7pН§~Г:pНЎ~*h|µВxp*h#n& +++НB“В_p*h#n& +++НB“Н&“Кxp*h#е*h#е! С}С}*яgе*hНL“К‘pН'ЌеН1QБНB“Н&“КЁp*h|µКҐpН…}ГЁpНї~*сНЯ“"hе*h#n& +++НB“ге!ЖpгйБ*яg6я*hГq*hУя|µВq*hеН3ZБ"hе*hеН3ZБНL“В,q*яg#6*яg##6 #6 !lqе*яgе*hеНј[БББГ&qНм“Тp   Г/qГoН\qб"яgб"hб"hб"hб"hб"	hб"hб"hб"hб"hб"hЙ!qеН
=БЙ+ -i * / % << >> |i ^i &i operands and/or operator incompatible         бБЕе:ў·КЗqyю.ВАq@ю_ВЗq?Еy·Ксq*n}ґКоqеН)™С+|ґтсqНз!
‰еН
=БГсqНg–бЙ  Н'Ќ"уqНаЊуqn& еН­qБ|µВьqЙ!
 еН­qБ!  "§q"†"ЂЙ!	 еН­qБЙ! "Ђ.:еН­qБЙ*Ђ|µКKr!  еНМrБ*§qл*Ђ|µДrЙН'ЌеНfrБНrЙН$rН'ЌеНхqБЙН'ЌеНМrБНrЙ    ‰!‰(‰0‰5‰9‰>‰E‰K‰P‰U‰d‰i‰p‰v‰}‰„‰‘‰—‰ќ‰Ј‰©‰°‰·‰Ѕ‰‰В‰Я‰р‰‰ш‰ЉЉ$Љ(Љи‰Н$rН'Ќ  Н[“КжrН'Ќ$ Нj“Н&“КsН'Ќ)„rНЯ“"Ђr"‚rГ	s!BЉеН
=Б*‚rеНхqБЙ  Н'Ќ"s ЂНB“К.s!ZЉеНхqБЙ*s ЂН‡“ЪKs!- еН­qБ*sНС“"s*sеНTsБЙН'ЌцН‡“ТqsН'Ќл!
 Н'”еНTsБН'Ќл!
 Н'”л0 еН­qБЙН'Ќе!  еНtББЙН'Ќе! еНtББЙ  Н'Ќn& яНB“КГsН.Ќn& +НB“Н&“КЧsН'Ќ n& НB“Н&“КйsН.Ќе! С}Й! "Ґs#Н'Ќе!  еНtББ!  "ҐsЙ*A      ЕЕ*tе*tеН'Ќ"tе*©qНL“ДВ}Н'Ќ
"	t*t##НЯ“"t& }жoГњt*t#n&  Н[“КZtН'Ќ
НB“Н&“ВЮvГ©t*t##е*t}жьo}цoНд“*t
 еНЯ“##Нд“Н'Ќ
|µВЮv!
 96#6 Г©tНм“Ct  ct   *tеНЇ|БНB“В»tН'Ќ
Н&“К•u*tn& Гyu*t ~·В:uГw*tеНо„Б|µКu!`ЉеНfrБ*tеНµzБНrН?Ќ
|µКw!gЉеНЛ~БГwН'Ќ
|µКu!`ЉГu!nЉеНfrБ*tеНµzБНrГw*tеН*wБН'Ќ
|µВvu*tеНо„Б|µК[u!gЉеНЛ~БГvu*|µКnu! еНsrБГvu!tЉеНЛ~БГwНм“Кtя ­u  Щt Щt 2u   ГЮv*tn& Гйv*t ~·ВљvГw*tеНо„Б|µВНu*t Нz’леНЅwБГw! 9е*t Нz’ЕХяя  Нk‘бН€’! 9Нz’леН6xБ!wЉеНfrБ! 9е*t Нz’ЕХ! Ну’Нѓ‘бН€’! 9Нz’леНsБНrГw*е*ҐsН“|µКFv!~ЉГIv!nЉеНfrБ*tеНµzБНr*Ґs|µВЏv*|µК‡v*|µК|v! еНsrБГ„v!ѓЉеНЛ~БГЏv!# еНsrБГw*tеН*wБ*Ґs|µК­v! еНsrБГЫv*|µВАv! еНsrБГЫv*|µКУv! еНsrБГYv!kЉеНЛ~БГw!‰ЉеН
=БГwНм“ћuя ­u  1v 1v ’v   ГЮv*t6я*t е*	tС}*tлб"tб"tББлЙUБ*(wеН'Ќ"(w Нz’ЕХяя  Ню‘Кdw*(w еНz’ЕХ! Ну’Нѓ‘бН€’*(w НЯ“е*(w Нz’лСе*dНЗ“еНЅwБ! еНsrБб"(wЙН'Ќ|µКјwН'ЌяН‡“Тіw!+ еН­qБН'ЌеНsБЙНЋ}Н'ЌеНsБНrЙ!•ЉеНfrБН'Ќn& |µКнwН'ЌеНµzБГ2xН'Ќ Нz’ЕХяя  Ню‘К!xН'Ќ еНz’ЕХ! Ну’Нѓ‘бН€’Н'Ќ Нz’леНsБНrЙ!•ЉеНfrБН'ЌеНsБНrЙ!  "§q"ҐqЙ  *ҐqеН'ЌНL“Кvx*Ґq|µДrН'Ќ"ҐqН?Ќ)UxНЯ“е*§qН“|µК™x!, еН­qБГіx*§q|µДr*Ґq+|µВ°xНЃГіxН%ЃН«Њ§qЙН'ЌяН‡“ТчxН?ЌНB“КЦx! ГЩx! еНYxБН'ЌеНsБ! 96 #6 Н€ЌГ№xЙ! еНYxБН'ЌеНµzБЙН;r*§q|µДKx!; еН­qБЙН
y*$еНхqБНr*r|µКTy*|µВTy!њЉеН°yБ*„|µКTy!ҐЉеН°yБЙяя*|µВey*UyНB“Н&“А!  "Uy*|µК‚y!«ЉеНхqБНrЙ*|µВ’y*Uy+НB“Н&“А! "Uy*|µКЇy!±ЉеНхqБНrЙ!·ЉеНfrБ*геНхqБН'ЌеНхqБ!ѕЉеНхqБНrЙ*|µКрy!kЉеНБ!ГЉеНYrБГEz*r|µКEz*€|µКz!ЗЉеН°yБ*Љ|µКz!РЉеН°yБ*€л*Љ|µК-z!ШЉеН°yБ!бЉеНхqБ!  еНsrБ!жЉеНYrБЙ!nЉеНfrБН'Ќ НЯ“еНv1БеНхqБНrЙ!рЉеНfrБГNzН'Ќ
 n& Г¤zН'Ќ НЯ“еНv1БеНхqБГ°zН'ЌеНхqБГ°zНм“Ђz   ГzЙ    Н'Ќ"іz НЯ“"±z*іzn& Гкz*±zеНv1БеНхqБГцz*±zеНхqБГцzНм“Пz   ГЯz*іz Нz’ЕХяя  Ню‘К({*іz еНz’ЕХ! Ну’Нѓ‘бН€’*іz Нz’леН•wБЙН'Ќn& Гf{Н'ЌеНП|БГz{Н'ЌеН;}БГz{!‰ЉеН
=БГz{Нм“C{ C{ O{ю   Г[{Н'Ќ6яН'Ќ 6 Н'ЌЙP]  ЕЕН ЌЏ{Н'Ќ"Џ{! 9еН'Ќ Нz’бН€’*Џ{еНо„Б|µК0|*Џ{n& +++|µВЯ{НЋ}*Џ{еНµzБНr!цЉеНЛ~БН%Ѓ! 9Нz’ЕХяя  Нk‘леНsБ!, еН­qБ! 9Нz’ЕХ! Ну’Нѓ‘леНsБНrб"Џ{б"‘{ББЙН'Ќ
 Нz’л"‘{*Џ{n& +++|µВf|НЋ}*‘{еНsБНr*Џ{еН9{БГ%|!ыЉеНfrБ*‘{& еНsБНr*Џ{еНЇ|Б|µВ¬|! еНsrБ!ыЉеНfrБ*‘{л! Н­“& еНsБНrГ%|Н.Ќn& +НB“КЗ|Н6ЌНЯ“НB“Н&“ЙA!  Н ЌЛ|Н'Ќ"Л|еНо„Б|µК}НЋ}*Л|еНµzБНr!‹еНЛ~Бб"Л|ointer past delimiter		*/
    if (*sptr)  ++sptr;
}

return(stlen);			/* Return length of this string		*/

}

/*======================================================================*/
/*
.he                                                  RECUTL(RCUTLOV1 / TOHEX)
.pa
*/
/*======================================================================*/
WORD                           /*					*/
tohex(c)                       /* Convert ASCII character to hex number */
WORD	c;					/* ASCII Character	*/
/*======================================================================*/

{

STATIC
BYTE	hdig[] = "0123456789ABCDEF";

STATIC
WORD	n;			/* Array counter			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

c = toupper(c);

/* Find match in character array					*/
n = -1;
while (++n < 16)  if (c == hdig[n])  break;

/* Return HEX value of character					*/
return((n == 16) ? (WORD) FAIL : n);

}

/*======================================================================*/
/*
.he                                                RECUTL(RCUTLOV1 / RU_CHAT)
.pa
*/
/*======================================================================*/
VOID                                   /*				*/
ru_chat(title,mes1,mes2,mes3,anslen)   /* Record utility dialog routine */
WORD	title,				/* Message title		*/
	mes1,				/* 3 message pointers		*/
	mes2,				/*				*/
	mes3;				/*				*/
WORD	anslen;				/* Length of answer required	*/
/*======================================================================*/

{

LOCAL
WORD	line;		/* Line counter					*/

LOCAL
BYTE	*cframe[4];	/* Dialogue output strings			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

cframe[line = 0] = rumes[title];
if (mes1 != 0)  cframe[++line] = rumes[mes1];
if (mes2 != 0)  cframe[++line] = rumes[mes2];
if (mes3 != 0)  cframe[++line] = rumes[mes3];

dialog(0,0,++line,cframe,anslen);

}

/*======================================================================*/
/*
.he                                                 RECUTL(RCUTLOV1 / GTKBNM)
.pa
*/
/*======================================================================*/
LONG             /*							*/
gtkbnm(s)        /* Special version of atol (string may have 'K' in it) */
BYTE	*s;			/* Source string to be translated	*/
/*======================================================================*/

{

LOCAL
BYTE	*ptr;		/* Used to access array members			*/

LOCAL
BOOLEAN	kcalc;		/* Is a Kb calculation necessary		*/

LOCAL
LONG	rv;		/* Return value					*/

LONG	atol();		/* ASCII to integer translator			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

kcalc = FALSE;			/* Kb calculation not reqd		*/
ptr = s;			/* Point to start of string		*/

/* Check entry for byte or Kb calculation				*/
while((*ptr = toupper(*ptr)) != NULL) {
    if (*ptr == 'K') {
	kcalc = TRUE;		/* Kb translation reqd			*/
	*ptr = 0;		/* Terminate string at the 'K'		*/
    }
    ptr++;
}

rv = atol(s);			/* Translate the number			*/

/* Multiply up to Kb total if necessary					*/
return((kcalc == TRUE) ? rv * 1024L : rv);	/* Return number	*/

}

/*======================================================================*/
/*
.he                                                   RECUTL(RCUTLOV1 / ATOL)
.pa
*/
/*======================================================================*/
LONG                                       /*				*/
atol(s)                                    /* Convert string to integer */
BYTE	*s;	                           	/* String to convert	*/
/*======================================================================*/

{

LOCAL
LONG	n;

LOCAL
WORD	sign;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

sign = 1;
n = 0;
switch	(*s)	 {
	case	'-'	:	sign = -1;
	case	'+'	:	++s;
}

while (*s >= '0' && *s <= '9')  n = 10 * n + *s++ - '0';

return((LONG)sign * n);

}

/*======================================================================*/
/*
.he                                                RECUTL(RCUTLOV1 / LGETLIN)
.pa
*/
/*======================================================================*/
STATUS                     /*						*/
lgetlin(s,chrs)            /* Special version of getlin for UHT drivers */
BYTE	*s;			/* Source string to be translated	*/
UWORD	chrs;			/* Size of buffer			*/
/*======================================================================*/

{

LOCAL
WORD	rv;			/* Return value				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

cur_on();
rv = getlin(s,chrs);
cur_off();

return(rv);			/* Return number			*/

}

/*======================================================================*/
/*
.he                                                  RECUTL(RCUTLOV1 / RUERR)
.pa
*/
/*======================================================================*/
STATUS                                           /*			*/
rueб"Н|Й*Л|еНЇ|Б|µК%}! еНsrБ!	‹еНfrБГ-}!рЉеНfrБ*Л|еНµzБНrГь|Н'ЌеНо„Б|µКU}Ні~!‹еНЛ~БЙН'ЌеНЇ|Б|µКy}Н§~! еНsrБ! еНsrБГ„}НЎ~!‹еНЛ~БЙ! еНsrБЙНВ}!`ЉеНfrБЙН'Ќn& я|µК®}!  ЙНВ}Н'Ќ"«qН'Ќ"©qЙ  *©q|µКл}*©q"А}!  "©q*А}е*«qеНtББ*А}еН~БЙН'Ќе*©qН.“К ~!  "©qЙН¤Њd! еНsrБЙН¤Њd! еНsrБЙРя*~еН'Ќ"~еНо„Б|µКA~*~ n& НB“Н&“КM~Н†~ГP~Н~*~n& я|µВt~*©q|µК|~*©qе*~НL“К|~!BЉеН
=Б*~6юб"~Й*dья"d! еНsrБ! еНsrБЙН–ЊdЙНЎ~! еНsrБЙНЎ~! еНsrБЙНВ}! еНsrБЙН'ЌеНБ*ў|µКл~НrН'ЌеНБГ*|µК!‹еНхqБНrГНrЙНВ}!‹еНfrБН'ЌеНхqБЙ!‹еНfrБН'ЌеНхqБНrЙ*|µКK!!‹еНхqБН'ЌеНхqБНrЙ*„|µКm!+‹еНЛ~БН%Ѓ!зеНхqБНrГu!0‹еНYrБЙ!4‹еНfrБ!зеНхqБ!;‹еНхqБЙНЋ}*|µВҐ!J‹еНхqБГ­!N‹еНхqБНrНї~!	 еНsrБН–ЊdЙ! еНМrБН'ЌеН]1БНrЙ !Н'ЌеН§sБ*†|µВQЂН6ЌНЯ“НB“КЂН'Ќ n& НB“Н&“КIЂН.Ќn& Г8Ђ!R‹еНЛ~БГQЂ!Y‹еНЛ~БГQЂ! еНsrБГQЂНм“Ђ "Ђ -Ђ   !
 еНsrБН'ЌЦn& еНМrБН'ЌеН]1БНrЙН'Ќ|µВ}ЂНбѓГ›Ђ*|µК“Ђ!" еНsrБНбѓГ›Ђ!_‹еНЛ~БЙ!e‹еНЛ~БН'ЌеН'ЌНL“КаЂН%ЃНmЌ++НЯ“еН]1Б!, еН­qБНmЌ++НЯ“еНsБНrГ¤ЂН%Ѓ!  еНsБНrН'Ќ|µК ЃН'ЌеНББЙ!m‹еНfrБЙ!q‹еНfrБЙ!x‹еНfrБН'ЌеНsБЙ!|‹еНfrБЙя   Ђ‹  я …‹   Љ‹        Н'Ќл! Н­“& "@ЃН'Ќ& "BЃН'ЌГѓЃ!.Ѓ"DЃГ“Ѓ!4Ѓ"DЃГ“Ѓ!:Ѓ"DЃГ“ЃНм“hЃ& qЃ|   ГzЃ! "FЃ*DЃ##НЯ“е*@ЃН.“К»Ѓ!H е*@ЃеН“‚ББГСЃ*DЃНЯ“е*@ЃНL“КСЃ!  "FЃ*DЃ##НЯ“е*BЃН.“КуЃ!L е*BЃеН“‚ББГ(‚*DЃНЯ“е*BЃНL“К(‚*FЃ|µК$‚!L е*DЃ НЯ“е*BЃеНM‚БББ*FЃЙ*FЃ|µВI‚!H е*DЃ НЯ“е*@ЃеНM‚БББ! Й!Џ‹еНfrБН ЌеН­qБНrН'ЌеНfrБН'ЌеНsБНr!–‹еНfrБН ЌеН­qБ!Ь‰еНхqБНrЙ!›‹еНfrБН ЌеН­qБ!, еН­qБН'ЌеНsБНrЙ  Н'Ќе*dНЗ“"№‚|µВУ‚Н'ЌЙ*№‚ ЂН‡“Т2ѓ*№‚хН‡“Ъ2ѓ*№‚& }жo|µКѓ! еНsrБНТЊ№‚*№‚|µК-ѓН'Ќ|µКѓ! Г ѓ! еНsrБН¤Њ№‚ГѓН'ЌЙ*№‚ ЂН‡“Ъ‘ѓ*№‚
ЂН‡“Т‘ѓ*№‚& }жo|µКeѓ! еНsrБНаЊ№‚*№‚|µКЊѓН'Ќ|µК|ѓ! Гѓ! еНsrБН–Њ№‚ГeѓН'ЌЙН'Ќ|µКЎѓН'ЌНB“Н&“Д…}НЋ}*№‚еНsБНr! еНsrБН'Ќ|µКНѓН'ЌНB“Н&“Д…}Н'ЌЙ! еНsrБЙ! еНsrБЙ! ‹еНЛ~БЙ!Ј‹еНЛ~БЙН'Ќ|µК„!Є‹Г„!°‹еНЛ~БЙН'ЌеНьѓБН…}Й!¶‹еНЛ~БЙ!№‹еНЛ~БЙ!ј‹еНЛ~БЙН'Ќ|µКK„!ї‹ГN„!Е‹еНЛ~БЙ!Л‹еНЛ~БЙ!С‹еНЛ~БЙ!Ч‹еНЛ~Б! "†Й!Э‹еНЛ~БЙ! еНsrБЙ! еНsrБЙ!г‹еНЛ~Б! "†Й!з‹еНЛ~Б! "†Й!к‹еНЛ~Б! "†Й!н‹еНЛ~БЙ!у‹еНЛ~БЙ!щ‹еНЛ~БЙ!я‹еНЛ~БЙ!ЊеНЛ~БЙ    Н Ќк„Н.Ќn& "к„Н6ЌНЯ“& }жo"м„++|µВ#…!  лб"к„б"м„лЙ*к„ьяНB“В:…*к„ыяНB“Н&“Г…Н'Ќ|µКO…!ЊГR…!ЊеНЛ~Б! "†ЙН'Ќ|µКm…!ЊГp…!ЊеНЛ~Б! "†Й! еНsrБЙ!"ЊеНЛ~БЙ!(ЊеНЛ~БЙ?ciulf @..@     Н ЌЈ…Н.Ќn& "Ј…Н.Ќn& "Ґ…е*Ј…Н.“КФ…б"Ј…б"Ґ…Й*Ј…—…n& еНЏaБ}2ћ…*Ґ…—…n& еНЏaБ}2Ў…!ћ…еНЛ~Б*Ј… Нj“К†*Ґ… Н[“Н&“К"†Н¤Њd*Ј… Н[“К7†*Ґ… Нj“Н&“КB†Н–ЊdГЛ…            /Њ1Њ5Њ7Њ;Њ=ЊAЊІ‹CЊEЊIЊН‹KЊЗ‹MЊ‰OЊQЊUЊWЊ  !K†"E†#"E†+еН.Ќn& —…n& еНЏaБС}НаЊE†6.!Q†"I†НЛЊI†НЯ“"G†|µКш†*G†n& еН'Ќn& Н.“Кр†*I†НЯ“"G†НаЊE†еНаЊG†n& С}|µВЧ†Гш†Н–ЊI†ГЄ†!K†еНЛ~Б*d "dЙН'ЌеН'Ќе! еНT‡БББЙН'ЌеН'Ќе! еНT‡БББЙН'ЌеН'Ќе! еНT‡БББЙXx.Xx     Н'ЌеН(€Б"P‡Н'ЌеН(€Б"R‡Н'Ќ+++НB“Кѓ‡*R‡е*P‡Н.“Н&“А*P‡—…n& }2K‡*R‡—…n& }2N‡НGЌНB“К№‡*K‡& ”яНB“Н&“Кй‡*N‡& ќяНB“е*N‡& —яНB“Н“|µКй‡! еНsrБЙН'Ќ Нj“Кь‡!H Гя‡!B }2J‡Н'Ќ& }жo|µК€!B Г€!H }2M‡!J‡еНЛ~БЙН6ЌНЯ“& }жoН&“К?€! ЙН.Ќn& ЙН'ЌеН'ЌН.“АН'ЌьН‡“Ъё€Н'ЌьН‡“РН'ЌГ«€Н'Ќ+++НB“К†€![ЊГ‰€!aЊеНЛ~БЙН'Ќ+++НB“Кў€!gЊГҐ€!mЊеНЛ~БЙНм“s€ Џ€   Н'ЌГь€Н'ЌьН‡“ЪЧ€! еНsrБГЯ€!sЊеНЛ~БЙН'Ќ Нj“Ку€!"ЊГц€!yЊеНЛ~БЙНм“ї€ а€   ЙOutput file error DS	0 DAD	SP MOV	A,L JNZ	 JZ	 XCHG PUSH	H POP	D XTHL PCHL MOV	A,H
	ORA	L DW	0 INX	SP POP	B DCX	SP PUSH	B DAD	SP
	SPHL DAD	H DAD	D INX	H DCX	H STAX	D PUSH	D POP	H JMP	 MOV	L,A
	RLC
	SBB	A
	MOV	H,A MOV	L,M
	MVI	H,0 MOV	A,M MOV	A,M
	INX	H
	MOV	H,M
	MOV	L,A ORA	A JNC	 JC	 MOV	A,H
	XRI	128
	MOV	H,A internal compiler error 32768 LXI	H, llong. LHLD	 h. LXI	B, LDA	 c.sxt usage error LXI	D, CLIBRARY CPROF 	CSEG 	DSEG XTEXT  .ASM END FLOATLIB LONGLIB LGFLTLIB $END END	$INIT SHLD	 st4. MVI	M, slong. STA	 q. ## CALL	 EXTRN	 
	PUBLIC	 RET_ RET DB	0,' ',0,0,0,0,0,0
 *+5 $+5 long.0 flt.0 c.tst .switch DB	 .LONG	 DS	 DW	 ANI	 ORI	 XRI	 MOV	A, MOV	 MVI	 s. c.mult c.udv c.div o. x. a. c.usr c.asr c.asl c.neg c.not c.com e.0 e. n. L.com L.neg F.neg L.not F.not cf.eq eq.4 cf.ne neq.4 Bf.Hi swap4. + add - sub * mul / % mod < > | ^ xor & and Hu.Bl Hi.Bl Hu.Bf Hi.Bf Bl.Bf Bf.Bl б"’Њб~#еХ_ ! 9СГ    ! Г®ЊЙ!яяГ®ЊЙ!юяГ®ЊЙ! "”ЊбХ^#V#гел:”Њ†_w#:•ЊЋwgkСЙЙ! ГгЊЙ!яяГгЊЙ!юяГгЊЙ! "”ЊбХ^#V#гел^:”Њѓw#V:•ЊЉwлСЙЙб^#V#~#лO 		+F+NЕ=ВЌлйЙНЊГЩ“ЙНЊn& ЙНЊГЯ“ЙНЊНЯ“#ЙНЊНЯ“##ЙНЊНЯ“+ЙНЊНЯ“++ЙНЊге! 9НЯ“ГЯ“ЙНЊеНЯ“#Нд“ЙЙНЊеНЯ“##Нд“ЙЙНЊеНЯ“+Нд“ЙЙНЊеНЯ“++Нд“ЙЙ               ЇГ«Ќ>Н№ЏбСБе!ДЏе!ИЌ·КГЌ=##Г№Ќ~#foйФЌСЌyоЂOЙНЎЏx·И:™Ќ·К№ЏђТоЌ/<лН©ЏлН№ЏБСюРхНМЏgсН“Ћґ!–ЌтЋНsЋТWЋ#4.Н©ЋГWЋЇђG~›_#~љW#~™OЬЋhcЇGy·ВDЋJTeoxЦюаВ%ЋЇ2™ЌЙ)zWyЏOт<Ћx\E·КWЋ!™Ќ†wТ7ЋИx!™Ќ·ьiЋF#~жЂ©OГ№ЏАААЂ4Й~ѓ_#~ЉW#~‰OЙ!љЌ~/wЇoђG}›_}љW}™OЙ ЦЪўЋCZQ Г•ЋЖ	oЇ-ИyOzW{_xGГҐЋбЙН©Џ „  Н№ЏБСНyЏ.яН@Џ44+~2ЎЌ+~2ўЌ+~2ЈЌAлЇOW_2¤ЌеЕ}е!ЈЌ–бo|е!ўЌћбgxе!ЎЌћбG:¤ЌЮ ?ТЏ2¤Ќсс7ТБбy<=ъXЋ{_zWyO)xG:¤Ќ2¤ЌyІіВйЋе!™Ќ5бВйЋx·КdЏ}!™Ќ®ЂGЁxтcЏЖЂwК·ЋНМЏw+ЙНyЏ/б·бГ7ЋНДЏx·ИЖGНФЌ!™Ќ4Й:™Ќ·И:Ќю/џА<ЙyГ“Џ€  !™ЌOp #6ЂГЋ!Ќ~оЂwЙл*–Ќге*ЌгелЙНz’л"–Ќ`i"ЌлЙ!–ЌГz’#Й!Ќ~7w?##wy7O®Й iQYНФЌ!™Ќ~GOW_·ИеНДЏНМЏ®gьђ>ђН“Ћ|ЬiЋ ЬЋбЙzЈ<АЙ!™Ќ~ю:–ЌР~НнЏ6{хyНЋсЙx·т;ђН\’>яхЕ Н€ЏБН©ЏYP Н€Џ:™Ќ·КYђЖ2™ЌБСНФЌс·ьЎЏГДЏx·ВoђOW_Й!  yоЂъzђO$xю ТЎђюЪ‰ђЦG,еН№ЏНбЏ б-ВњђAJS %АГ\’яяяГњђЙ! 9^#Vл~НєђГДЏю-хКЖђю+КЖђ+Н7ЋGW_/OНJ‘Ъ‘ю.КчђюeКгђюEВыђНJ‘НZ‘НJ‘Ъ>‘ВыђЇ“_КОђе{ђфrr(code)                                      /* Output RECUTL error */
WORD	code;						/* Error code	*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

seterr("RECUTL");
return(nferr(code));

}

/*======================================================================*/
/*
.he                                                 RECUTL(RCUTLOV1 / SET_SH)
.pa
*/
/*======================================================================*/
STATUS                                             /*			*/
set_sh(rd)                                         /* Set up /SH switch */
struct	_rd	*rd;				/* Record descriptor 	*/
/*======================================================================*/

{

LOCAL
WORD	c;

LOCAL
STATUS	rv;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

rv = SUCCESS;

rd->sh_allowed = -1;

/* Is definition in the switches					*/
if (fndswt(swtot,swnames,"SH") != FAIL)  rd->sh_allowed = TRUE;

/* ... no so is it a default definition					*/
else if (dflt == TRUE)  rd->sh_allowed = FALSE;

/* ... no so get it from the operator					*/
if (rd->sh_allowed == -1) {
    ru_chat(0,11,12,0,1);

/* Default is no							*/
    cur_on();
    if ((c = getkey()) == ESC)  rv = FAIL;
    else rd->sh_allowed = (BOOLEAN) ((c = toupper(c)) == 'Y');
    putvid(c);
    cur_off();
}

return(rv);

}

/*======================================================================*/
t == TRUE)  rd->sh_allowed = FALSE;

/* ... no so get it from the operator					*/
if (rd->sh_allowed == -1) {
    ru_chat(0,11,12,0,1);

/* Default is no							*/
    cur_on();
    if ((c = getkey()) == ESC)  rv = FAIL;
    else rd->sh_allowed = (BOOLEAN) ((c = toupper(c)) == 'Y');
    putvid(c);
    cur_off();
}

return(rv);

}

/*================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее‘т
‘хН№Ћс<ВюђСсМЎЏлЙИхНhЏс=ЙХWx‰GЕеХНhЏсЦ0Н3‘бБСГОђН©ЏНЋЏБСГФЌ{ѓ†Ц0_Гйђ#~ю:Рю КJ‘ю0?<=ЙюЁИю-Ию+Ию§И+ЙЙ! 9~Ј_#~ўW#~ЎO#~ Gб33гЙЇ°±ІВ±‘іК­‘{ю Т±‘! 9Ї~·тЎ‘7~w+ВЎ‘В”‘бСБй! 9~·> тЅ‘=w+Вї‘Г­‘Ї°±ІВп‘іК­‘{ю Тп‘! 9Ї~w#Ва‘ВЩ‘Г­‘! 9ЇГЅ‘Й! НЖ’! еН+’бхНЧ’В’сГ’с! Т’-СББХ-Й! НЖ’! Г’! 9~“_#~љW#~™O#~hgGх|­тI’с?ЙсЙЙН\’бглбг}‰O|€GЙ> “_> љW> ™O> GЙ{/_z/Wy/Ox/GЙ^#V#N#F#ЙгНz’гs#r#q#pЙбЕГ›’бЕ Хе! 9л! 9ѕ#В·’ВЁ’ЇГ№’>бСССг& ©oЙ! 9~s_#~rW#~qO#~pGЙx±ІіЙ! НЧ’А-Йл  Й}Ны’]WOGЙ|Ны’лOGЙ·>яш<ЙлЙлГЪ“ЙБСЕ}іo|ІgЙБСЕ}«o|ЄgЙБСЕ}Јo|ўgЙ|µИ!  ,ЙБСЕ|є}!  В@“»В@“,ЙЇЙ|µК,“!  ЇЙБСЕ|є}! А»А-ЙлzјВl“{ЅВw“!  ,Йлz¬ъ}“zјВw“{Ѕ! Ш-Й|§! ъ{“µЙ|оЂgЙл|єВ•“}»! Тќ“-ЙµЙлzјВ§“{Ѕ! Ш-Йл|ш|g}oГ®“лЇГ°“лш)ГБ“БСЕ{•ozњgЙ+|/g}/oЙ~oџgЙ~#foЙлбгs#rлЙлбN#F#x±К”~#»~#Во“єВо“`iйDM!  z·>В”S\)л)лТ”	=В”ЙЇхГ2”z¬х¬льС“л|·фС“MD!  x<ВF”zЃ>ЪK”jS\>)л)лТS”#е	бТ[”	=ВK”лсрлНС“лГС“Й   * +%"З–%"Е–%"Г–Ья	"—	"—	"—yя	6 "А•+6„+щk”Х!яљНџ“бК¬”"і•!Ђ ^6    ЕF+N+т№”!* е!n”е! 9~#·К•ю КП”Oю"Ки”ю'Ки” +С}|Хе+#~·Кя”№Вт”6 #г~#ю<К4•ю>КF•!l”4бГП”б6я#6я*l”е!n”еН*€•|µК1•еНГ  е!B•еН5—"D•ГQ•r   е!†•еН5—"€•ББЪ^•бСХГП”k•	Н  Н Can't open > or < file.$Г%•w   ЙСБЕХ*і•ееС	ееНџ“СВ¦•!ю9НЌ“СБ!яяАл"і•ЕбЙяљЙ*D•еН¤БЙ   :ї•<*А•ѕШИл
Н Ї2ї•
Ню•ГГ•Н ·ИН юК  юКѓ•юВэ•>
_*А•~+ѕР#4N 	s>
»М ЙНѓ•> !)—НЄ–ШЕ:В•№В7–НГ•2ї•_ ~Г<–яН БюВQ–ВM–
Н !
 ЙВZ–юК–юКc–o& Й!яяЙБСХЕ*€•ХеН)™ББЙл> е!-—НЄ–СШХл}ю
В“–ЕН Б>
_Н бЙcon:rdr:pun:lst: Ц Ъј–ютј–_ ~O·А7Гc–Й                                     яяяяяяя                                                         !"#    БбСХеЕ!™– Хец ѕВW—#ВD—Сбi& Й бС~·В@—!з–~юяКv—#Вh—Г‘БСХЕл~#Fлчя6 , 6 щяpщяw# 6 2ї——лНК“е! 9НЯ“БЕy=еНЭљбК‘ХлН|љ> юwВР—СХН СН С<К‘!ж–s 	Їw#6вя	w+wтя	~#¶ВХе ЕН‹•Блбr+s{ІСК‘лЇЙБСХЕ{ю Ъ2!-—НЄ–#Ш ^{·Д !  Й!ж–~<К‘6яН–!ы–~юrКѓ!—N!н–ХНЯ“}·К‚лх*д–yюbКr>w#Вk%се!Ђ =т|)еН®™ББС{=ХНЭљН <бА!  7Й!Б–N#FЕб"д–ЙН™·К–ю Т–Ї№+ВФеХ*д–е! еНЮ™ББСХл—	s{ІСбКc–ХеНЯ“#Нд“+л*д–F!—С>bѕКюxюК¤юКc–·К¤h& ЙбБСХЕе{·Ию РН–!—~!н–N#F№{А p+pH#ЙН™·В9™БбСХеЕГv–ю ЪG™БСбеХЕГy–+е! 9~ю
Вq™е!—~юbКn™!k™5Вl™>бГq™6б>
*д–	wгее`i#Нд“бЇѕбВџ™БСХЕХ%,е! еН®™БББ|µ!яяИш! 9n& :k™·К)™ЙЇ2dљ>Ге™ е! 9НЯ“лбе):dљ¤х|!П–†wТЦ™#4!Э–сwбЙ>я2dљ>2·™:В•·Да•НeљЕx±КQљХеЕХлН С:·™OН Б·Вљ!Ђя	DMбЂ СГу™бС:·™юВQљб7љ	Н !яяГWљWrite error - Disk full
$С`iНК“еЂ Н бГё™ ! 9~=+еНЭљбХV+^+F+NблЙ 	"Уљ> w+В…љЇw 	w##w 	wая	л#~+ю:В°љ~##НХљЦ@~#·Ию.КБљНХљГ°љл*Уљ++·ИНХљw#ГЗљ  жюaшЦ ЙO !—		~_#VІАе!$ еН‹•лббr+sbk#|µЙЙееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                    AMST(RDWT005 / RD_005)
.pa
*/
#include	"portab.h"
#include	"amst.h"

#define		OPEN	15
#define		CLOSE	16
#define		SREAD	20
#define		SWRITE	21
#define		LOGVEC	24
#define		SETDMA	26

STATIC
struct	fcbt	fcb;		/* File Control Block for "AMIE.005"	*/

/*======================================================================*/
STATUS             /*							*/
rd_005(amie005)    /* Read 256 bytes from "AMIE.005" from default drive */
BYTE	*amie005;				/* Storage of AMIE.005	*/
/*======================================================================*/
/*USE
Portability	Level 4 (BDOS calls)
Parent Module	AMST
Revision History:
25/04/88 Started - ICFO
*/

{

LOCAL
WORD	i;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Set the file name into the FCB					*/
makfcb("AMIE.005",&fcb);

/* Open the file							*/
if (bdos(OPEN,&fcb) == FAIL) {
    say(10,10,"Cannot open file - AMIE.005");
    say(1…”ђХUаDDdЕHMQI%:SWNAMEЃ”ХХђSаU%TФU8QaRSWTOTЃ•UХЊ`U%TU%(MQIHRTDETЃ”Х’S‘аe4UEх4€Q-	96RU_CHAЃ“СU`dDTeх5HMQI9NTR_HEXЃUТV DDфЙ@ Х°0                                                                                                                                                              Р0B Y   D Ќџв1іьB Y¶P " FАШ ! ,ЫH 	 #`Њl Ѓ –mґ † –mД >-XWl B 9Yµ-‚Й‚ Q 9fЬ° €` fЮ@(†џЂ9D5<КН  ,Eb@V4К!«аQ4 еfЂ EaАlР •JЂEV4К!Ђ¬Р ‚Бd€@@Л6хЂ9Yµ€‚"±`К!
 ў К!  ¬Р ‚Б`°EVКН  "« Й       Ub@ў~ еУрЗ+4  `°X"6h  "  ыьEW EUpF"«Ђ!бэљ  6©ђЄ® №Y¶ђ	В!«А,Р ЉХїЯмР љ  2­€…юяdЉЄаЌ@@Л6—Ђ№D5xљ  8Y¶t‡KА„   е›o B Ђ eК!«А,Ы†бfЬp/ЂЂ–mСЃ —(†Ї іnа…›x XtјB Y·Ё" \ўјНѕ .mщaТр&/fЂ Ь  №Ђ е /р   0м„ іh•›[A"6meTђ!эюЙЂЂ–m7rіjа[FНЁ LЄА!їЩ" “Pѓ*(eH©aЂ   Ђ     А     P        яd¦‡oцJhvяd¦‡oцJhvяd¦‡`          Eg …V$К!§аQ 9fФа!HFІY¶Ь	КН­а,EgЂ„lЪмКЄ b«<)Фр Л6ЯЃ3@ mНeTа1Uћ„jx e›vАњ¬ЫѕбЪ &mЪ &mbµD  6ТЂі@ U+ЂЂ–mпЉB602Н  lVЁ†Р3hр6…Ѓіo*ќ€@ њaФа1 9fСP1HFєYґьКНЁaljp»ЃЉЁ  ­›UА™UЬB YµR)ЧА Л6“€m 6э@ њ–»ЃЛ]АЕVp	›UЂЩUxB  9D @ е›X Е!ШfШђ7(„ іl€¬V+fЧ°6UЄЂ ;Z! ўК!Ђ¬Ъ&Б`°X, r€A@+6ђ…°X'Е«*лЃ€_пцmdЋЁ4  >-XWмB Y¶dR)ЧА Л6ґЃ€m 6·Ѓ°иH †Ѓ 9Y·|%В!ґ LЫм!ґ LЫаЕj€@ mФfТђ6U8ЂЂ–mзЉB602НЎ ЊVЁ†Р3iX#6Њ3i`*Ј‚@ њaХ°A 9fТ AHFєYµ0КНЁalwЪ &m3dЂ 80    UњК!«!ЋVh  Б`€«( Ќ›gАЩVHUYБўКН¤ ,$Bя€«X Єµ‚ДU¬"ю?іl`jЂ‚Љ«X#”UYA¬Ъ^
Б`€«H Ќ›_БW‡@AD  ”UYA¬Р ‚БV°CвХ…{   е›U!  eК*­ ЊР ‡Ѓ   е›w!  eК*­ ЊЫОГі ‚ЄКеfЂ UiіmР#*Њ‚€_пцЂ ђ      *аe_  а (  Ђ *:
*± Q? r€A Л6ш‚
B4Њ2НЁ@®VmГ`°X"*>
#fУђFUМQрQHF§ЂYµ(›wЂ™µ`•rAET|R©а–mfr€@ЂЛ6Ѕ№Y·T‚БRW(…юяfЂ «@
! ЂTt‡rAD5€1КН  "Є>
)Фр Л6Б№D ` е›lAE!V
fЫђW+6Ж‚0X2ЬђVвP [6‡ІЇ(„  RQ "Ј ІЮ Yo(ЄЋ‚іn€+*Нѓ@ („ іn(¤#IБC,Ыи
е‚ Q$ еЏ Vm	`°X,†Ѓ 9D#Р•›HBШ,вХ•KЃ„/чшЉђ‚°мШ0кЃ 3nШсjВ© В  EHAD  ЉЋ‚°мА0†Ѓ 9D @ е›\¬ЫЄБ`€©+”Bяіlђ+*·ѓ@ aЩЂabrіm(+UGБE!ћ fХg(„ іl 0¤#JБC,ЫеfЬPV[0Гј@ўЄB
    *Ш
©(EюfЂ ЪШ
К·ЂВЄB
Гє В  rНІ ВђЌ+іn3•›PВШ,ђ    Ѓ —+6дѓЩ·рVН­ ®Vh  Б]aUСЇЯб“вХ…MБД   Љйѓ@ЂЛ6нѓ–мЄf! .Vmіnш0­›xБњў  rНў оVmЛ`°EWLF"є`М;ю*є`М‘UС®б“вХ•QБД/чы$B Yґ„К! ,ЪеfЧ vEtБ„lЫМ
К­@выэ’*є`Мђ             Ђ *ЬН   @ е›UПЛvU“Ѓ —+6Д€ЩґTVНЈ оVmЄ`€«А8Ќ›XAЩVИBяІD @ е›eAЩ¶tКНµAvіm€3*уЉ«А8¤R)єЕUШ2"Ї в  rеfЫpq6Мѓ€@ЂЛ6ріmР;•›yБ"*и!  UИU]В*зшdшµaT`Ѓ 9rіoX8Ќ›yЩ·ёКН  'Е«*Ў„
«ђ8D fЂ Q 9fС †mґб–€dE\ЃШt(!‡S  Љ№Љ«p;¬U\ЃГ"*Ь*®@в±rџ¬Єр*Ї оQ 9fУ ‡+6’ѓ°X,:®! ,ЪЪ~[І¬Ђ@„ №Yµф FНўЃ;*­Ам‘ЂДd3FГqАд‚B!‘¤`   ! .Q 9fШ ‡+6щ°Y¶8 Bя€­@@ЄФДV  "р?іm#jщ
­@@FЛ„YґФ!К! ,ЫhН  Wј!‡|‚w Uj/шe›jAЩT$Bя°и@HЄФ2@            "Ў!"ђЌ	№D А е›y!ѕ fТ@–mј‚ –m,	>-YUp$UBBDb*)Р°ђЛ”B
 YґШ$R«а–mO	fТр‘ 9fХp“вХ•aВET$$F"Ў!"ђЌ	№D Ђ е›XBE!ѕ fЧ –mZ	Ѓ –m‚	>-YVИ$UBBDb*)Р°ђЛ”B Y¶0$R«а–mҐ	fШP‘  еЂ QU		€ЁHK”CBВ\ўP rНµЎ.Vh  Б`°X,H         „  ]ђ‘ 9fЬ°‘Ч	]p—(Єл„іnаC•›n-иI›qЃЩT°(UuВY·Ь$"µ†O‹V!
Ђ@+І*єб#` Єл„€ДW\$VГЅб" rНЅA.Vmi
p€nШK6ѓ‚
®ИH­›~‚Up(CvВYµ€ЉХЂ Ђ љ  0лP†н„іj`S$       "¬бBЖН       B YґД)›BВvl(Bя€«8P„ №Yµш(FН¶,;PНЈ`V(Z ±ЃB°  -Ё
ЂЂ–m’
fШ €А Н  W,(B Y¶ґ)›l‚#ђ4  fР ¦U‚ЂVh  !¬aLЪАНЄбLVЁ„ №Y· (FНІБB¶mГ
fЂ Р ЉХЊ Ъ*Н  5Њ)›Ov (UYВ™·ь)ЉХЦ0¦mЬ
fЭр¦H  Н   @ е›zBњў  rНҐ!nVh  Б`€Ёш[4  Qр¶H†±9YµР‚! ,ЪbеfЂ H    @ ZЂЂ–mP… ‘іьF6Љ¬H”COАўТеfФаV‚#fЬА¦UћЂЂ–mg… ‘°F6 0нАXЄЂ 
Щµ)•nД   е›dВ!@ dl ЌЂЫЂ± 9fЪР°€P fЫР±сjВ¦‚ К!Ђў`К!  ўКНўa,‚БfТ ¶h  "«a+ь2НґalЄ!їДUh-‡IC   е›qВ!@ eК*«nVmы	`€ЄАXENяіo°[6ц…
ЄА[•љ  0Yґф,UV‚Щ%")ЄT&‰Ґ1€ €F 
`‘L T)Ђ	Ґ HЉC*•	‚вЎ4  +ђА2 ЉS €¤2©P )’ ™А¬\¦®’Ё‡i
€*‰й‘њђЁ†\Ћ‹¶
€eЙ€±’ Њ†\љЄ© ЁeЙЙк‘“ j†\¦°©ПЁeКЉj‘љаj†\ЄЋ‹ўЁeК©€±” †ђ‚©6Ёi…Ии±x†¤§UИiЉkк‹’аМ†Є¤ѕћЌйИjЄKййСТр\€ЉЊѕ¦©  €€ЙЉ‘Ђ €Њ¤‚љ‹П	И‰()‰исћp„Љ]†hҐЖљЂЉў\i”ЁЙ€ЄJQ—рјЊњ€¦®©с
HеСЂ ЋЉњљЉ§  Ёи©ЙЁСћАјЋЉЁ–Љі5ИиЄ‰‰)СР Ћ¦Ё¤’ќЯ	Ик‰hIЙ±ђђДђ]ф
©eИI‘‘єђ’\„™¤Й
J€€Є‘ќ`Ё’\\™Й*h‰(й1џpЄ\‚€‰©…ЙЄ©‘ђ є\¦Є…!Й€иЄ‰‰1‘ђјћњЋ]aIЕС•@єњЊЉ¤ҐЙк	Лк‹’ М ЄЁ¬’‰#J%СФ0є¤ЄЉ¤Ґ_ ЄJ©ЁЄqС0њ¤Єѕ†ђѓHКhЄ€ЄJQЦ ¦ЉЁ¤Љ‡ч КhЄЉjк‘ХАј¦ЉЁѕ¦‘Кi‰йИеСђ`\¦ †ћ§vКj	к©С—Њ¦  ЄЁ‡s
Љj†…СЭPl¦Ё¤‚њ§mКjЉI)ИсУр¦®њ‚љ‹‰ Єjк‰к‘Фр¦®¬‚§‡ Љ€«
‘Ђ 
Ё’„­ЄЄ‰й«‘PМЁћЄ  ‹zКЉKй«ШрЄЁћ¬c8  ћњЋ]aIЕС•@єњЊЉ¤ҐЙк	Лк‹’ М ЄЁ¬€ЉЊѕ¦©  €€ЙЉ‘Ђ €Њ¤‚љ‹П	И‰()‰исћp„Љ]†hҐЖљЂЉў\i”ЁЙ€ЄJQ—рјЊњ€¦®©с
HеСЂ ЋЉњљЉ§  Ёи©ЙЁСћАјЋЉЁ–Љі5ИиЄ‰‰)СР Ћ¦Ё¤’ќЯ	Ик‰ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее2,10,"Press any key to continue");
    getkey();
    clrs();
    return(FAIL);
}

/* Read the first 256 bytes from the file				*/
fcb.fcb_currec = 0;
for (i = 0; i < 256; i += 128) {
    bdos(SETDMA,amie005 + i);
    if (bdos(SREAD,&fcb) != 0) {
	say(10,10,"Read failure on file - AMIE.005");
	say(12,10,"Press any key to continue");
	getkey();
	clrs();
	return(FAIL);
    }
}

return(SUCCESS);

}

/*======================================================================*/

/*
.he                                                    AMST(RDWT005 / WT_005)
.pa
*/
/*======================================================================*/
STATUS                               /*					*/
wt_005(amie005)                      /* Write 256 bytes from "AMIE.005" */
BYTE	*amie005;				/* Storage of AMIE.005	*/
/*======================================================================*/

{

LOCAL
WORD	i;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Write 256 bytes to the default drive and close the file		*/
fcb.fcb_currec = 0;

for (i = 0; i < 2; ++i) {
    bdos(SETDMA,amie005 + i * 128);
    if (bdos(SWRITE,&fcb) != 0) {
	say(10,10,"Write failure on file - AMIE.005");
	say(12,10,"Press any key to continue");
	getkey();
	clrs();
	return(FAIL);
    }
}

if (bdos(CLOSE,&fcb) == FAIL) {
    say(10,10,"Cannot close file - AMIE.005");
    say(12,10,"Press any key to continue");
    getkey();
    clrs();
    return(FAIL);
}

if ((bdosh(LOGVEC) & 4096) != 0) {/* M: exists so update A: as well	*/

/* Open the file							*/
    makfcb("A:AMIE.005",&fcb);
    if (bdos(OPEN,&fcb) == FAIL) {
	say(10,10,"Cannot open file - A:AMIE.005");
	say(12,10,"Press any key to continue");
	getkey();
	clrs();
	return(FAIL);
    }

/* Write the first 256 bytes of the file				*/
    fcb.fcb_currec = 0;
    for (i = 0; i < 2; ++i) {
	bdos(SETDMA,amie005 + i * 128);
	if (bdos(SWRITE,&fcb) != 0) {
	    say(10,10,"Write failure on file - A:AMIE.005");
	    say(12,10,"Press any key to continue");
	    getkey();
	    clrs();
	    return(FAIL);
	}
    }
    if (bdos(CLOSE,&fcb) == FAIL) {
	say(10,10,"Cannot close file - A:AMIE.005");
	say(12,10,"Press any key to continue");
	getkey();
	clrs();
	return(FAIL);
    }
}

return(SUCCESS);

}

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…”‘Х e$EуX]Q|ААЦP 5ъ                                           C|Ђњў  еfЂ „ r€h •љ  0X"6h  К® PК! ўцеfЂ B 9D  ”CEАЬ¬ЪЁ Б`°Y  4  їЯм‘  }R   "¤ЂЄH  Щ  jыЂ0мр Є’ P  ИЉ’ 0м „4 r€@ЂЛ4  uЉ©  eКН§Ђ„( r€h •›l ,вХ•}   ”B
 9D4ДКН¬АB 9D  ”CEАЬ¬Ы¦ Б`°Yµ°›[А/чы%‡d@  $  Ђ С•  Ђ +ц *ї`сэ›b@V‡HАEWм F"ї`:! ў«ц @   ¬B Y¶њ 2еfЫРB 9D4 КН§`,	сjКЇа"PК! ўўеfЮP‚! ўPК!ўаnVm^`°X,ЫЦ НЅАыэ’ГЈ "ЂК!  VmH`°DlЪ„ КёЂ"PК! ўдеfЧ ‚! ўPК!ўаnVmЈ`°X,ЪмНЇ "ыэ’! ¬Р ‚. Б;4  e^а!Џr€h •›KА,< еР +6ЕЂ°X"6m‘eRp!( е‚ЂQљrіmЁ‚Бѓ Q( еСp7+6ѓ0X,m»fЫаэюЙЂ С•  Ђ +ц *ї`сэ›D@[V°	‡S@…Wм F"ї`:h! ў«ц @ ґёЦ! ,Ъlrіop‚!
Ђў  еfЦP&шµeZђ!( е‚ЂQёrіhА‚Бѓ Q( еСp7+6Д0X,mfТ!эюЙaФ0!@ еР +6№0X"6mфe^а!( е‚ЂQЫrіlР‚Бѓ Q( еСp7+6жЃ0X,m fЪ0!эюЙ–ч@ IљI"‹†Ё †a7ЌзAјаe7Ж“a”@-I¤’(ё`0Ђ
#)Мж 0›Џ"Y”т :Д3yёиi7L ‘”ВdЊ&“aФдeНВ1¤ШeDi$Љ. №ИТt2€ЖI°кr2€жбТl2€ў	4’EPВn7О‚°Юs2€Ж“a”@-I¤’(ё`0Ђ#ў	4’EPВn7О‚yАКnЌ&Г(ЂZ  Ћ€$ТI\0@s‘¤иeЊ&“aФдeНВ1¤ШeDСљI"‹†Ё †a7ЌзAЊШo9™DcI°К €#ў	4’EPfФ
!"'©Жr@j"zљDe`!—&Є¦*FnАЄrrz¤dм
Ў—*)ЄFz ўb’њgLў—F  9tg”#ўЄ%ў¬ЖX ’Atg„& ҐЈ!ЎGIЂ2’"щЃЃ¬g|	© ¬З@2єўщЃЃ¬а  ћЖ“a”@-I¤’(ё`0Ђ#ў	4’EPВn7О‚yАКnЌ&Г(ЂZ  Ћ€$ТI\0@s‘¤иeЊ&“aФдeНВ1¤ШeDСљI"‹†"‹†Ё †a7ЌзAјаe7Ж“a”@-I¤’(ё`0Ђ
#)Мж 0›Џ"Y”т :Д3yёиi7L ‘”ВdЊ&“aФдeНВ1¤ШeDi$Љ. №ИТt2€ЖI°кr2€жбТl2€ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                                    RECUTL
.pa
*/
#include	"dd.h"		/* Declares AMIE globals & structures	*/
#include	"recutl.h"	/* Record utility header		*/

struct	_rd	rd;	/* Record descriptor structure			*/

UWORD	ipktchs = 0,	/* Bytes left in inputpacket			*/
	otbytes,	/* Output trailer bytes				*/
	itbytes,	/* Input trailer bytes				*/
	opktspce = 0;	/* Space left in output packet			*/

LONG	currec,		/* Current record no				*/
	ihbytes,	/* Input header counter				*/
	ohbytes,	/* Output header counter			*/
	dbytes;		/* Record body counter				*/

BYTE	*irptr,		/* Input record pointer				*/
	*ohptr,		/* Output header pointer			*/
	*otptr,		/* Output trailer pointer			*/
	*orptr,		/* Output record pointer			*/
	*aptr = 0;	/* Global pointer to area holding strings	*/

/* Pointers to packets - set to FAIL to flag that they are not in use	*/
struct	pkthdr	*opkt = FAIL,		/* Pointer to output packet	*/
		*ipkt = FAIL;		/* Pointer to input packet	*/

BYTE	*dhead,		/* Destination header string			*/
	*dtail;		/* Destination trailer string			*/

BOOLEAN	op_used;	/* Only one packet to be taken from pool per	*/
			/* DATA call this flags whether an output pkt	*/
			/* has been taken or no				*/

BOOLEAN	rec_done;	/* Flags that record has been sent		*/

QUEUE	inq,		/* Input queue					*/
	dumpq,		/* Put used packets here			*/
	outq;		/* Output queue					*/

/*======================================================================*/
STATUS                                       /*				*/
utlprc(comd,lev)                             /* Start of record utility	*/
WORD	comd;				/* Command to be actioned	*/
struct	lvl	*lev;			/* Level descriptor		*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	RECUTL fixed length record utility
Version		04.02
AMIE version	05.20
Revision History:-
19/03/91 V04.02 issued - ICFO
         If the last record is zero length (as is the case if tееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                             AMST(RUNAMIE)
.pa
*/
#include	"amie.h"
#include	"amst.h"

EXTERN
BOOLEAN	md;		/* TRUE if Drive M fitted			*/

/*======================================================================*/
VOID                                            /*			*/
run_amie()                                      /* Display initial menu */
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	AMST
Revision History:
18/04/88 Started - ICFO
*/

{

LOCAL
BYTE	amie005[256],			/* 1st 256 bytes of AMIE.005	*/
	date[20],			/* Date as 'dd mth yy hh:mm:ss'	*/
	*txtp[4];			/* Messages			*/

LOCAL
struct	menframe	mf;		/* Menu frame			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Set up the screen attributes						*/
inivid();
cur_off();

/* Set up the menu frame						*/
txtp[0] = "AMIE";
txtp[1] = "Set Time and Date";
txtp[2] = "Run CP/M";
txtp[3] = "System Shutdown";
mf.title = "Initial Options";
mf.options = txtp;
mf.maxopt = 4;
mf.maxrvals = 1;
mf.inc = 2;
while (TRUE) {
    switch (menu(&mf,TRUE,0)) {

	case 0:				/* Execute AMIE			*/
	    clrs();
	    wait_a_bit();
	    rd_005(amie005);		/* Read 256 bytes from default	*/
	    st_date(amie005,date,SDATE - 0x100,grope()); /* Date to date*/
	    st_005(amie005,date,SDATE - 0x100);	/* Update in memory copy*/
	    wt_005(amie005);		/* Write back to (poss) M: and A*/
	    boot(1);
	    clrs();
	    say(10,10,"Failed to boot from track 1");
	    clreol();
	    say(12,10,"Press any key to continue - ESC aborts");
	    clreol();
	    if (getkey() == ESC) {
		unlink("$$$.SUB");
		aexit();
	    }
	    clrs();
	    break;

	case 1:				/* Set Time and Date		*/
	    set_date();
	    break;

	case 2:				/* Run CP/M			*/
	case FAIL:
	    unlink("$$$.SUB");
	    clrs();
	    aexit();

	case 3:				/* System shutdown		*/
	    clrs();
	    wait_a_bit();
	    unlink("AMIE.CHK");
	    clrs();
	    dframe[0] = "Timeclaim A.M.I.E";
	    dframe[1] = "System has shut down";
	    dframe[2] = "Now turn power off or press Reset button";
	    dialogue(0,0,3,dframe,0);
	    cur_on();
#asm
	.z80
	di		; Turn off interrupts (needed for WYSE 50 / 60)
	.8080
#endasm
	    stoprel();	/* Park winni & put into HALT state - NO RETURN	*/
    }
}

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееhe
         number of bytes in the file is a multiple of the record length)
         it is put onto the dump queue.  Otherwise any following
         processor which counts records (eg ICL2900) will get one
         too many - ICFO
18/02/91 V04.01 issued - ICFO
17/12/90 V04.00 issued - ICFO
         Message concerning short block changed from error to
         warning - ICFO
         Message output only if short blocks are NOT allowed - ICFO
08/07/88 V03.00 issued - ICFO
22/05/88 Names converted to V5 standard - ICFO
16/01/88 Warning supressed if EOF while stripping trailer  PN
         (Change in DO_DATA)
06/08/87 version numbered
17/07/87 rewritten DAR
04/05/87 Created DAR
*/

{

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

if (comd == DATA)  return(do_data());	/* Stripped out for speed	*/

/* Action the command passed from the copy controller			*/
switch (comd) {

    case CONNECT:	/* Establish transfer connection & init driver	*/
			/* NB expansion factor calc by init overlay	*/
	if (ruinit(lev) == FAIL)  return(FAIL);
	if (opn_gstring() == FAIL)  return(FAIL);

	return(SUCCESS);

    case RESTART:	/* Restart the data transfer from beginning	*/
    case RELEASE:	/* Transfer termination sequences		*/
    case DISCONN:
    case ABORT:
    case ABORT_DATA:	/* Abort data transfer				*/
	rec_done = TRUE;
	cls_ipkt();	/* Dump the packets				*/
	cls_opkt(0);
	cls_gstring();
	break;


    case READ_ATTR:	/* Read VFS attributes & pass across to output	*/
	outq = lev->out_q;
	dumpq = lev->discard;
	inq = lev->in_q;
	return(ru_attr());

    case BEGIN_DATA:
	rec_done = FALSE;
	currec = 1L;
	recdets();	/* Prime record controllers			*/
	opn_opkt();
	break;
}

return(SUCCESS);

}

/*======================================================================*/
/*
.pa
.he                                                         RECUTL(DEBUGGERS)
*/
#ifdef DBUG
/*======================================================================*/
bug()	/* Debug all useful values					*/
/*======================================================================*/

{

clrs();
putstr("\nsource header = ");
lputnum(rd.sh_size);
putstr("\nsource trailer = ");
lputnum(rd.st_size);
putstr("\ndest header = ");
lputnum(rd.dh_size);
putstr("\ndest trailer = ");
putnum(rd.dt_size);
putstr("\nmaxrec = ");
lputnum(rd.maxrec);
putstr("\nrecord size = ");
lputnum(rd.r_size);
putstr("\noutput header = |");
xputstr(dhead,rd.dh_size);
putstr("|\noutput trailer = ");
xputstr(dtail,rd.dt_size);	
putstr("|");
putstr("\nihbytes = ");
lputnum(ihbytes);
putstr("\nohbytes = ");
lputnum(ohbytes);
putstr("\ndbytes = ");
lputnum(dbytes);
putstr("\notbytes = ");
putnum(otbytes);
putstr("\nitbytes = ");
putnum(itbytes);
lputstr("\ninput packet is ");
if(ipkt == FAIL) lputstr("none");
else {
    pp(ipkt);
    lputstr("\ninput packet has = ");
    lsputnum(ipktchs);
}

lputstr("\noutput packet is ");
if(opkt == FAIL) lputstr("none");
else {
    pp(opkt);
    lputstr("\noutput packet has = ");
    lsputnum(opkt->d_bytes);
    lputstr(" taken -  free = ");
    lsputnum(opkt->d_freesp);
}

}

pp(p)
struct memdesc *p;
{
p = (BYTE *)p - sizeof(struct memdesc);
bdos(5,p->mtype);
}

xputstr(ptr,size)
BYTE	*ptr;
WORD	size;
{
while(size--)  xprint(*ptr++);
}

xprint(c)
char c;
{
if(c <= ' '){
    putvid('<');
    puthex(c);
    putvid('>');
}
else putvid(c);
}

#endif
/*======================================================================*/
/*
.he                                                           RECUTL(DO_DATA)
.pa
*/
/*======================================================================*/
STATUS                                    /*				*/
do_data()                                 /* Execute main data sequence */
/*======================================================================*/

{

LOCAL
WORD	c;	/* Character transferred or EOF if -2 or fail if -1	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Clear the output packet flag, allows 1 pkt to be got from pool	*/
op_used = FALSE;

/* If no output packet in place get one					*/
if (opkt == FAIL) {

/* Increment current record count					*/
    ++currec;

/* If we have processed last record stop the transfer			*/
    if (currec > rd.maxrec) {
	c = -2;				/* EOF value			*/
	ipkt->d_bytes = -1;		/* Set input packet to EOF pkt	*/
	CLEANUP;
    }
    else opn_opkt();			/* Open next output packet	*/
}

/* Strip any header bytes from input					*/
while (ihbytes) {
    if ((c = getipc()) < 0)  CLEANUP;
    --ihbytes;
}

/* Write any header bytes to output					*/
while (ohbytes) {

/* As 'putopc' must put a character decrement value here		*/
    --ohbytes;
    if ((c = putopkt(*ohptr++)) == FAIL)  CLEANUP;
}

/* Get any data bytes & send them					*/
while (dbytes) {

/* Read input byte							*/
    if ((c = getipc()) < 0)  CLEANUP;

/* As 'putopc' must putееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…”•SђSR`e%TефЩ@ ХИZ                                                3@ h  !±АB*(!І`B*,!ґ B*0!µАB*4!·АB*8!ўЂ"*<! TЂB © „ RЂ |ZІ¬h†Ћ №D ”B  9Y  ‚БaЧ&h  Н  4 КН  "  еР („ rі@ +4  `°X,  r€h ”B 9Y  ‚БР +4  `€@ +4  `іl „ r€A@(†з9Y  ‚БfЂ `К! ўФеfЭ ‚Нј ,Р  "е†O‹VС7+4  `і@ mЛaШ &h  Г±@RС !rіh@›CА™ґ0	›HА™¶CF@Ь¬Ъ>БfТђ!"  h"’ SР!II *„  r€@ („ r€jH”B  9Y  ‚Б`°Y  Нљ  0мP4  °`   Ђ(РFЂџпъP   :МЙ “I$PLКt&У(ЂВn2†Ў” R:›„2Ђјљ )ћNgC)ґ@S4N†CyЬЬ $›Ќ'CI„Ш 'њ†“yёж #M&Г)ђ@t7€FуyР@f9НўЎИВc5€ ЃИКs9€&гИЂЦe<€†сЊЮn:MЗS(ЂZ "”Иb	€Юr:АA ђ\S*ђЂi$Љ.!’	`Ў¤Ъe1›&“hЂ‚.&‹‰"в( ¦y9ќ¦С ВsНS ЂИo;›ЂгyЬ@t:њЌВЃјоe9жc0ЂЮrFS™М@R2њМ§A€кt:НАЛђ.SWITCЊ“TU„•HО8BOOTЊъЂд4Е$TфИЙёCLRSЊ  D5DЕЙpCUR_OFЊґd5U%ффиА DEVICEЊ¬dDe$ФXЛ DIALOGЊ  DU„хhА FLOPPYЊ  $rиА GENMESЊ  TtTдФhПАGETKEYЊП Фu$хXЙXINIVIDЊ  $ФHЛШMENUЊ  UффЕА QBASEЊ  %8МpRD_005Ћ• е%TефШПxSAYЊЉЃe4UEфDЛ`STOPREЊЪЂе5EуXНST_DATЊ™ЃeTдД”дёЙ`WAIT_AЊЯЂеuEуYА  ћЊ  D5DЕЙpCUR_OFЊґd5U%ффиА DEVICEЊ¬dDe$ФXЛ DIALOGЊ  DU„хhА FLOPPYЊ  $rиА GENMESЊ  TtTдФhПАGETKEYЊП ФS*ђЂi$Љ.!’	`Ў¤Ъe1›&“hЂ‚.&‹‰"в( ¦y9ќ¦С ВsНS ЂИo;›ЂгyЬ@t:њЌВЃјоe9жc0ЂЮrFS™М@R2њМ§A€кt:НАЛђ.SWITCЊ“TU„•HО8BOOTЊъЂд4Е$TфИЙёCLRSЊ  D5DЕЙpCUR_OFЊґd5U%ффиА DEVICEЊ¬dDe$ФXЛ DIALOGЊ  DU„хhА FLOPPYЊ  $rиА GENMESЊ  TtTдФhПАGETKEYЊП Фu$хXЙXINIVIDЊ  $ФHЛШMENUЊ  UффЕА QBASEЊ  %8МpRD_005Ћ• е%TефШПxSAYЊЉЃe4UEфDЛ`STOPREЊЪЂе5EуXНST_DATЊ™ЃeTдД”дёЙ`WAееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее a character decrement value here		*/
    --dbytes;

/* Write output byte							*/
    if ((c = putopkt(c)) == FAIL)  CLEANUP;
}

/* Write any trailer bytes to output					*/
while (otbytes) {

/* As 'putopc' must put a character decrement value here		*/
    --otbytes;
    if ((c = putopkt(*otptr++)) == FAIL)  CLEANUP;
}

/* Strip any trailer bytes from input					*/
while (itbytes) {
    if ((c = getipc()) < 0)  CLEANUP;
    --itbytes;
}

/* This record is complete start on next				*/
rec_done = TRUE;
cls_opkt(0);
rec_done = FALSE;

/* Set values for next record						*/
recdets();

cleanup:

if (c == -2) {			/* EOF hit				*/
    rec_done = TRUE;		/* Flag end of record hit		*/
    cls_opkt(c);		/* Close output packet			*/
    opkt = ipkt;		/* Put EOF packet on output		*/
    cls_opkt(0);
    ipkt = FAIL;		/* Close input packet			*/
    rec_done = FALSE;		/* Set record flag for next transfer	*/

/* If we have written a short block issue warning			*/
/* If we arrived here trying to strip a trailer supress warning 	*/
    if (dbytes < rd.r_size && dbytes > 0 && rd.sh_allowed == FALSE) {
	seterr("RECUTL");
	err_handle(WARNING,NULLPTR,0);
    }
}

return(SUCCESS);

}	

/*=====================================================================*/
/*
.he                                                           RECUTL(RECDETS)
.pa
*/
/*======================================================================*/
VOID                             /*					*/
recdets()                        /* Initialise record control variables */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* set working counters & pointers from initial switch values		*/
ohbytes = rd.dh_size;
otbytes = rd.dt_size;
ihbytes = rd.sh_size;
itbytes = rd.st_size;
ohptr = dhead;
otptr = dtail;
dbytes = rd.r_size;

}

/*======================================================================*/
/*
.he                                                          RECUTL(OPN_IPKT)
.pa
*/
/*======================================================================*/
STATUS                                    /*				*/
opn_ipkt()                                /* Open packet on input queue */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Get packet - if none return fail					*/
if ((ipkt = qget(inq)) == FAIL)  return(FAIL);

/* If packet is EOF packet return EOF value				*/
if (ipkt->d_bytes == -1)  return(-2);

/* Point input pointer to start of packet data area			*/
irptr = ipkt->d_start;

/* Set number of input packet characters available			*/
ipktchs = ipkt->d_bytes;

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                          RECUTL(CLS_IPKT)
.pa
*/
/*======================================================================*/
VOID                                              /*			*/
cls_ipkt()                                        /* Close input packet */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* If packet not closed put it on the dumping queue			*/
if (ipkt != FAIL)  queue(dumpq,ipkt);

/* Set number of chars available to 0					*/
ipktchs = 0;

/* Flag packet as closed						*/
ipkt = FAIL;

}

/*======================================================================*/
/*
.pa
.he                                                            RECUTL(GETIPC)
*/
/*======================================================================*/
WORD                                      /*				*/
getipc()                                  /* Get char from input stream */
/*======================================================================*/

{

LOCAL
WORD	rv;		/* Return value					*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

while (ipktchs == 0) {		/* No data present so get some more	*/
    cls_ipkt();			/* Close current input packet		*/

/* Open next input packet						*/
    if ((rv = opn_ipkt()) < 0)  return(rv);
}

--ipktchs;			/* Decrease byte count in packet	*/
	
return(*irptr++ & 0xff);	/* Return next character non sign ext	*/

}

/*======================================================================*/
/*
.he                                                          RECUTL(OPN_OPKT)
.pa
*/
/*======================================================================*/
STATUS                                            /*			*/
opn_opkt()                                        /* Open output packet */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Only one packet /*
.he                                                             AMST(SETDATE)
.pa
*/
#include	"dd.h"
#include	"amst.h"

STATIC
BYTE	mth[] = "JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC";

/*======================================================================*/
STATUS                                    /*				*/
set_date()                                /* Set the date into AMIE.005 */
/*======================================================================*/
/*USE
Portability	Level 4 (Depends on Gemini Hardware)
Parent Module	AMST
Revision History:
05/03/91 Yet another new version of 'grope'.  This one is the same as
         that in AMINIT.C - ICFO
15/08/89 Yet another new version of 'grope' (not tried on GM880) - ICFO
17/05/89 IN in 'grope' preceded by 'xor a' to ensure (a) = 0
         or else the IN instruction seems to load (a) with 21h.
         At least this is so on the Hitachi HD64180 chip in the
         GM880 - ICFO
12/05/89 'wt$15' corrupts (bc) so (bc) pushed onto stack before
         call - ICFO
16/01/89 'grope' function for RTC rewritten - ICFO
22/09/88 Same delay function as in the BIOS used because it allows for
         different processor speeds - ICFO
19/04/88 Started
*/

{

LOCAL
BYTE	amie005[256];			/* Storage of AMIE.005		*/

LOCAL
STATUS	rv;				/* Return value from 'wt_005'	*/

STATIC
STATUS	get_time();			/* Plug new time into AMIE.005	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

clrs();

/* Read in AMIE.005 (from M: if fitted)					*/
if (rd_005(amie005) == FAIL)  return(FAIL);

/* Get new time								*/
if (get_time(amie005) == FAIL)  return(FAIL);

/* Write AMIE.005 back out to disc (M: if fitted and A:)		*/
clrs();
wait_a_bit();
rv = wt_005(amie005);

clrs();
return((rv == FAIL) ? FAIL : SUCCESS);

}

/*======================================================================*/
/*
.he                                                  AMST(SETDATE / GET_TIME)
.pa
*/
/*======================================================================*/ 
STATIC STATUS                        /*					*/
get_time(amie005)                    /* Plug the new time into AMIE.005 */
BYTE	*amie005;			/* Buffer holding AMIE.005	*/
/*======================================================================*/

{

LOCAL
WORD	type_clock;

STATIC
WORD	cur_pos;

LOCAL
BYTE	date[20],
	*name_clock[] = {
		"No clock present",
		"Super Video Controller present",
		"Real Time Clock present"
	};

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Ask the opertor to hang about a bit					*/
wait_a_bit();

/* Find out which kind of clock is present				*/
type_clock = grope();	/* Gropeing takes a little while (as always??)	*/
clrs();
say(10,10,name_clock[type_clock]);
clreol();

/* Set the initial time into 'date'					*/
st_date(amie005,date,SDATE - 0x100,type_clock);

/* Ensure that 'date' is a null terminated string			*/
date[19] = NULL;

/* Get the new time							*/
if (show_time(amie005,type_clock,date) == FAIL)  return(FAIL);

/* Copy new time into AMIE.005						*/
st_005(amie005,date,SDATE - 0x100);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                     AMST(SETDATE / GROPE)
.pa
*/
/*======================================================================*/
WORD                        /*						*/
grope()                     /* Find out which clock (if any) is present */
/*======================================================================*/

{

/* Returns 0 if no clock						*/
/*         1 for SVC							*/
/*         2 for RTC							*/

/************************************************************************/
/*									*/
/* Thе  testinз foт thе absencе oж thе Reaм Timе Clocл iо SVГ  machineу */Ќ
/* haу  giveо  nп  enд  oж trouble®   Thе  currenф  systeн  useу  Clocл */Ќ
/* Interrupф   anд  Statuу  Registeт  15®    Thiу  iу  aф  addresу   2Ж */Ќ
/* (hexadecimal© oо thе I/П Bus®   Iж б Reaм Timе Clocл iу presenф thiу */Ќ
/* wilм returо thе Interrupф Status®  Sincе Nп Interruptу havе beeо seф */Ќ
/* thiу wilм havе thе valuе zero®   Iж nп Reaм Timе Clocл iу presenф iф */Ќ
/* returnу (oо б Z8° baseд system© thе valuе oж thе porф (iе 2F)®   Thе */Ќ
/* valuе returneд oо aо HD6418° baseд systeн witи nп Reaм Timе Clocл iу */Ќ
/* noф knowо aф present¬  but¬  baseд oо pasф experiencе witи thе GM88° */Ќ
/* board¬ iф coulд bе different.					*/
/*									*/
/************************************************************************/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

#asm
	.z80
	extrn	mdelay

	clock	equ	20h

;   First test for RTC
	in	a,(clock + 15)		; Interrupt frequency register
	and	0fh			; Mask out bottom nibble
	ld	hl,2
	ret	z			; Return if zero

;   Test for SVC or IVC
	ld	a,1bh			; Escape
	call	put$vid
	ld	a,'v'			; Return version number
	call	put$vid
	call	get$vid
	ld	hl,0
	ret	c	allowed from pool per data call			*/
if (op_used)  return(FAIL);

opkt = qget(0);			/* Get empty packet from poolq		*/
orptr = opkt->d_start;		/* Point to data area			*/
opktspc = opkt->d_freesp;	/* Calculate space in packet		*/
op_used = TRUE;			/* Flag packet used			*/

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                          RECUTL(CLS_OPKT)
.pa
*/
/*======================================================================*/
VOID                                             /*			*/
cls_opkt(c)                                      /* Close output packet */
WORD	c;				/* Marker - -2 = last record	*/
/*======================================================================*/

{

/* Possible span status table						*/
STATIC
WORD	span_tab[] = { 1, 2, 0, 3 };

/* Set spanning to one of these based on value of 'decision'		*/
STATIC
WORD	span_reset[] = { TRUE, TRUE, FALSE, FALSE };

STATIC
BOOLEAN	spanning = FALSE;	/* Spanning record flag			*/

/* Used to calculate the type of span					*/
STATIC
WORD	decision;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

if (opkt != FAIL) {

/* Make decision an index into span_tab					*/
/* Possible values:							*/
/*									*/
/*	record		spanning	type to		spanning	*/
/*	finished	flag start	set		flag at end	*/
/*									*/
/*	FALSE		FALSE		1 (start seg)	TRUE		*/
/*									*/
/*	FALSE		TRUE		2 (cont seg)	TRUE		*/
/*									*/
/*	TRUE		FALSE		0 (no span)	FALSE		*/
/*									*/
/*	TRUE		TRUE		3 (end seg)	FALSE		*/


    decision = rec_done ? 2 : 0;			/* set bit 1	*/
    decision = spanning ? decision | 1 : decision;	/* & bit 0	*/

/* Set record type to correct spanning status				*/
    opkt->d_rtype = span_tab[decision];

/* Adjust spanning flag based on decision				*/
    spanning = span_reset[decision];

/* Put the output record on the output Queue				*/
/* If the last record is zero length put it on the dump queue		*/
    queue((c == -2 && opkt->d_bytes == 0) ? dumpq : outq,opkt);

/* Flag opkt as closed							*/
    opkt = FAIL;
}

/* No return value							*/

}

/*======================================================================*/
/*
.he                                                           RECUTL(PUTOPKT)
.pa
*/
/*======================================================================*/
STATUS                              /*					*/
putopkt(c)                          /* Write character to output stream */
BYTE	c;					/* Character to send	*/
/*======================================================================*/

{

/* This function must always write the character given 			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

*orptr++ = c;

++opkt->d_bytes;

if (--opkt->d_freesp == 0) {	/* No data present so get some more	*/

    cls_opkt(0);		/* Close current output packet		*/

/* Open next output packet						*/
    if (opn_opkt() == FAIL)  return(FAIL);
}

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                            RECUTL(RUINIT)
.pa
*/
/*======================================================================*/
STATUS                                /*				*/
ruinit(lev)                           /* Run record description overlay */
struct	lvl	*lev;
/*======================================================================*/

{

LOCAL
WORD	(*ov_go)(),	/* Pointer to a function			*/
	rv;		/* Return value from function			*/

BYTE	*ldprl();

/* Name of general record descriptor overlay				*/
STATIC
BYTE	*ru_name = "RECUTL.OV1";

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load the overlay file						*/

if ((ov_go = ldprl(ru_name)) == (BYTE *) FAIL)  return(flerr(ru_name,4));

/* Execute the overlay and return its own return value			*/
rv = (*ov_go)(lev,&rd);

free(ov_go);	/* Free overlay area					*/

return(rv);

}

/*======================================================================*/
/*
.pa
.he                                                       RECUTL(OPN_GSTRING)
*/
/*======================================================================*/
STATUS             /*							*/
opn_gstring()      /* Open the start & term strings stored in temp file */
/*======================================================================*/

{

LOCAL
BYTE	*ptr;		/* Working string pointer			*/

LOCAL
UWORD	totsze;		/* Size counter for string work			*/

LOCAL
FILE	tfd;		/* Temporary file descriptor			*/

STATIC
BYTE	*rtnam = "RECUTL.TMP";	/* Temporary file name			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Calculate size of strings in file from preset length values		*/
totsze = rd.dh_size + rd.dt_size;

/* Return if no strings to be got					*/
if (totsze == 0)  CLEANUP;

/* Allow for zer		; No - therefore no clock

;   Differentiate between SVC and IVC
	cp	40h			; SVC?  [(hl) still zero]
	ret	c			; No - IVC therefore no clock
	inc	hl
	ret

;   Local copy of 'putvid'
put$vid:
	push	af			; Save the character
pv0:	in	a,(0b2h)		; Check 'ready' flag
	rrca				; Move flag to carry
	jr	c,pv0			; Wait if buffer is full
	pop	af			; Get the character back
	out	(0b1h),a		; Send it out
	ret				; Done

;   Local copy of 'getvid'
get$vid:
	in	a,(0b2h)		; Read the flag register
	rlca				; Move flag to carry
	jr	nc,gv0			; Get character if there
	call	wt$15			; 0.15 seconds delay
	in	a,(0b2h)		; Read the flag register
	rlca				; Move flag to carry
	ret	c			; Not SVC or IVC
gv0:	in	a,(0b1h)		; ... else read the character
	ret				; ... and return with it.

;   Wait for 0.15 seconds
wt$15:
	ld	hl,150			; Delay 
	push	hl
	call	mdelay
	pop	bc
	ret

clok1:	defs	2
clok2:	defs	2

rdclok:					; Taken from GM816 Manual
	ld	d,h			; Start of storage
	ld	e,l
rdc$1:	ld	c,clock			; 1 before first register
	ld	b,2			; Number of registers to read
	ld	h,d
	ld	l,e
rdc$2:	inc	c			; Register to read
	ini				; Read into (hl) and inc. hl etc
	jr	nz,rdc$2		; For next register
	ld	b,2			; Number of registers to read
	ld	h,d			; Start of storage
	ld	l,e
rdc$3:	ld	a,(hl)			; Pick up characters as read
	and	0fh			; Mask out bottom nibble
	cp	0fh			; Test for update indicator
	jr	z,rdclok		; Update indicator found
	ld	(hl),a			; Put value away
	inc	hl			; Point to next value
	djnz	rdc$3			; Back for next value
	ret

chkclok:
	ld	hl,clok1 + 1		; Compute 1st time as 0.1 seconds
	call	times10
	ld	d,a			; Save it for later
	ld	hl,clok2 + 1		; Compute 2nd time as 0.1 seconds
	call	times10
	cp	d			; If 2nd < 1st add 100 ms to 2nd
	jr	nc,chk$1
	add	a,100
chk$1:	sub	d			; Compute delta time
	cp	1
	jr	z,chk$2			; Jump if 0.1 seconds
	cp	2
	jr	z,chk$2			; Jump if 0.2 seconds
	xor	a
	inc	a
	ret				; Return non zero
chk$2:	xor	a
	ret				; Return zero

times10:
	ld	a,(hl)
	sla	a
	ld	e,a
	sla	a
	sla	a
	add	a,e
	dec	hl
	add	a,(hl)
	ret
	
	.8080
#endasm

}

/*======================================================================*/
/*
.he                                                   AMST(SETDATE / ST_DATE)
.pa
*/
/*======================================================================*/
VOID                                      /*				*/
st_date(amie005,adate,date_offs,type)     /* Copy the date into 'adate' */
BYTE	*amie005,	/* Storage for AMIE.005				*/
	*adate;		/* Date as 'dd mth yy hh mm ss'			*/
WORD	date_offs,	/* Offset in to amie005 where date is stored	*/
	type;		/* 2 = RTC, 1 = SVC 0 = No Clock		*/
/*======================================================================*/

{

LOCAL
BYTE	time[13];

LOCAL
WORD	i;

LOCAL
struct	date	*sdate;

VOID	rd_noclock(),
	rd_svc(),
	rd_rtc();

STATIC
WORD	(*rd_clock[])() = {
		rd_noclock,
		rd_svc,
		rd_rtc
	};

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Point 'sdate' to the date field inside AMIE.005			*/
sdate = (struct date *) (amie005 + date_offs);

(*rd_clock[type])(time,sdate);		/* Read the clock		*/

time[10] = sdate->year[1];		/* Units of year		*/
time[11] = sdate->year[0];		/* Tens  of year		*/

/* At this point 'time' is set up no matter which clock is present	*/
/* Now set up 'adate' by a common set of instructions			*/
for (i = 0; i < 19; ++i)  *(adate + i) = ' ';	/* Initialise		*/
*(adate + DAY + 0) = time[7];
*(adate + DAY + 1) = time[6];
i = (time[9] - '0') * 10 + (time[8] - '0') - 1;
strncpy(adate + MONTH,&mth[3 * i],3);
*(adate + MONTH + 3) = ' ';
*(adate + YEAR + 0) = time[11];
*(adate + YEAR + 1) = time[10];
*(adate + HOURS + 0) = time[5];
*(adate + HOURS + 1) = time[4];
*(adate + MINS + 0) = time[3];
*(adate + MINS + 1) = time[2];
*(adate + SECS + 0) = time[1];
*(adate + SECS + 1) = time[0];
*(adate + HOURS + 2) = ':';
*(adate + MINS + 2) = ':';
return;

}

/*======================================================================*/
/*
.he                                                    AMST(SETDATE / RD_RTC)
.pa
*/
/*======================================================================*/
VOID                                        /*				*/
rd_rtc(time,sdate)                          /* Read the Real Time Clock */
BYTE	*time;				/* Buffer to read time into	*/
struct	date	*sdate;			/* Not used in this procedure	*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

#asm
	.z80

nmrreg	equ	11			; Number of registers to read
clock	equ	20h			; Clock chip base address


;   Read in the clock registers
rd1:	pop	de			; Return address
	pop	bc			; Not used in this procedure
	pop	hl			; Storage address
	push	hl
	push	bc
	push	de
	ld	(rd4),hl		; Save for later
	ld	c,clock + 1		; First register
	ld	b,nmrreg		; Number to read
rd2:	inc	c			; Point to next port
	ini				; Put o terminators						*/
totsze += 2;

/* Allocate space for the strings					*/
if ((ptr = aptr = spalloc(totsze)) == (BYTE *) FAIL)  return(nferr(0));

/* Open up the temporary file						*/
tfd = spopen(rtnam,"RC");

/* Header is at start of area, trailer at end of header			*/
dhead = aptr;
dtail = aptr + rd.dh_size + 1;

/* Read strings in							*/
while(totsze--)	 *ptr++ = spgetc(tfd);

/* Close file								*/
spclose(tfd);

cleanup:

/* Erase temporary file							*/
unlink(rtnam);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                       RECUTL(CLS_GSTRING)
.pa
*/
/*======================================================================*/
VOID                                        /*				*/
cls_gstring()                               /* Close global string area */
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

aptr = spfree(aptr);	/* un alloc area				*/

}

/*======================================================================*/
/*
.he                                                           RECUTL(RU_ATTR)
.pa
*/
/*======================================================================*/
STATUS                                    /*				*/
ru_attr()                                 /* Get source file attributes */
/*======================================================================*/

{

LOCAL
struct	pkthdr	*vfdpkt;	/* Pointer to packet containing a VFD	*/

LOCAL
struct	tvfd	*vfd;		/* Pointer to virtual file descriptor	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Get VFD packet							*/
vfdpkt = qget(inq);

/* Point to start of data area						*/
vfd = vfdpkt->d_start;

vfd->v_struct = 1;	/* Data is record based				*/
vfd->v_rstyp = 0;	/* Fixed record size				*/

/* Set new record size							*/
vfd->v_recsize = (LONG) (rd.dh_size + rd.dt_size + rd.r_size);

/* Put VFD on the output Queue						*/
queue(outq,vfdpkt);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                             RECUTL(RUERR)
.pa
*/
/*======================================================================*/
STATUS                                           /*			*/
ruerr(code)                                      /* Output recutl error */
WORD	code;						/* Error code	*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

seterr("RECUTL");
return(nferr(code));

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…”ђХU %$H%A-Q"OTBYTEЃ’U–U`dхµE5UIIIHBYTEЃ“Т–U`dD%•DU8%IAQJOHPTRЃSХ Tх%E(AQJOPKTЃTХ TD„THQ%2OP_USEЃ”‘PЧСа4”еU5AFOUTQЃ•UђаdDхфDHIU%9%ROPN_GSЃђУЧТT d4Е5фх1M}NRU_ATTЃ”‘PСU dхефхQ%APUTOPKЃ“Ф—ТT U%TU%)@ Ч8                                                              юяїА               Ѓ –h  yїГ'Е«
Ї 3i@$B Yµ<‡@   е›XА¬Ъ‚
Бі@ U їЯм–m”іk°*ЖЂ_пцH„  dЛd@%І Щ	l€ „ T m¶Ђ Vm_`іih3‘ €@@Л6¶ЂAЂ Л6ЦЂЄ@ „ іm  D  іmр ЉЈ @@Л6вЂA@ Л6зЂЄ 6ћѓ2D   ЉЎ @    !ЈАР ›LАЩґH‡HЂXt€љ  VЂ  ИЂ D  І   ‘ Ђ,€ <j  ѕ     ’  @ @ SЂ6В 2«Р†Џ 3@ +TB 3@ h  !ЈАЫЮ !ЈАЪxЕj€h`6©Ђі@ Uwїџв*L*§@gшЊlяaЪА&zfС IkРµиCHЂµlљ  2­ђ6о€©0D  fЂ «0ГµЂBD НЇА,VЁ„ fФ@h  !¤@ЪљГЇ@2Ы & fЩАmЃe_P& fЫ`+TB 3m 6УЂ€i06ЦЂЉ©Ђ ЊEL lР КНѕ Њ&іi*щ °н`Щ Л}@D4Ё›pЂY¶д•PЂ™·pEIЂB  6И ІЁЦiP6ьЂ±Zў›rЂY·4CJЂ·LUIЂ\¬ЫвБR`6х І©шЦ0пЁµUF ‹VUqQЂXЉЊ 
©ђ ЊELЂlЫјеfЯFЉ“ €ЩґЬ	•[Ђv°	‡PЂҐ® BЄ4 |ZІ¬Ё6о€©0D  fР°&U‹aЪА!U €ЁРёЃ@ B Ђ Vm_`€@ B fУ01U&€П‹V/Ђ@*„ *¤А.Vm_`Љ©Р Љњ @ +6Ї‚0D/чшЉќ @ B Т mbµD4 ›xЂ™  *ЃЃ€iP6х1Zў ›GА™µxљ  2ЁxЄЉ 3k06‚І©x†Ч9Y  Bя№D  ”B  9Y  ‚Б–—Ѓ€@ HЄ€ 3@ & fТЂ!U QЂ  fЯ`!" fУР1 fФђ6h  "Ј@Єx "¦ Є| "¦@ НЄ bT Н©аl‘UD rі@ Љќ Щґ4•c Д/чы$UNЂ·X F|Z°¬а…ьяdЉ©Р D іlЂЉ— 
©Р6Т€Ё° „  dЉ©Р Ќ›D ЩW4UQЂўЄt еfЂ „  Q`эю"§@ђ [ё*ўАЕ«
юЃіm°6»€®РD  fШ0&Uъ] 6KоЉЁ° ¬EEЂTё F"ҐА¶mZ "ЄЂ |ZІЁр …юяd€@ +6ЅЃ°DTа UN  ` e›k@ДTР UN b6m1QА "Ё  ’  Ђ      @         Єp #fЫ°6UрT вХ•]Б  Ѕ@ ]U°CвХ•cБUtъц ›ШvHUWAUtUN  @ eК*« ‚ђЌKіiа#4  UРAHF©‚Y¶EVБ   е›mb6mѓe]AU8 fЫаFmГfЦ@FUЭT`аTЂ(Єњ 9Y·$‚БїЯв*p ЙS@Љљ 
Ьў  rНЎ ЌиHUN ¬Ы#fЪђAU8 €Ь¬Ъ
+fРРSвХ…MБD  •›WБ,Ъ$#fЬрFU7їЯм™iё(„  dЂ   µSрW+4  `€©Ш+”Bяі@ UdSрW(„ rі@ ’*§`®Q 9fС`W”C@ nQ{qєX,=S°W+4  `Љ©и+$      Ђ*ў ±U €¬p(ЄЗџ¬+T
Г¤ В«
#€¬p(ЄЗ№Y  EMЂV0К!їЩµD•tБD  •љ  0Y"«$
еЬ°g+4  `°DV@UMЂTр UMЂbЄ  value into (hl)
	jr	nz,rd2			; Do the rest

;   Scan the values for any update indicators
	ld	b,nmrreg		; Number to scan
	ld	hl,(rd4)		; Start of storage
rd3:	ld	a,(hl)			; Get value
	and	0fh			; Mask top nibble
	cp	0fh			; Update indicator?
	jr	z,rd1			; Yes! - try again
	add	a,30h			; Convert to ASCII
	ld	(hl),a			; Resave it
	inc	hl			; Point to next one ...
	djnz	rd3			; ... and repeat

	jp	rd5			; Skip over workspace

rd4:	dw	1

rd5:	ds	0			; Here beginneth the 'C'

	.8080
#endasm

*(time +  8) = *(time +  9);		/* To obliterate 'day of week'	*/
*(time +  9) = *(time + 10);

}

/*======================================================================*/
/*
.he                                                    AMST(SETDATE / RD_SVC)
.pa
*/
/*======================================================================*/
VOID                                              /*			*/
rd_svc(time,sdate)                                /* Read the SVC Clock */
BYTE	*time;				/* Buffer to read time into	*/
struct	date	*sdate;			/* Date from AMIE.005		*/
/*======================================================================*/

{

LOCAL
WORD	i;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

putstr("\33t?");		/* Request clock [<ESC><t><?>]	*/
for (i = 5; i >= 0; --i)  *(time + i) = getvid();	/* NOT 'getkey'	*/
*(time + 6) = sdate->day[1];		/* Units of day			*/
*(time + 7) = sdate->day[0];		/* Tens  of day			*/
*(time + 8) = sdate->month[1];		/* Units of month		*/
*(time + 9) = sdate->month[0];		/* Tens  of month		*/


return;

}

/*======================================================================*/
/*
.he                                                AMST(SETDATE / RD_NOCLOCK)
.pa
*/
/*======================================================================*/
VOID                            /*					*/
rd_noclock(time,sdate)          /* Read the date and time from AMIE.005 */
BYTE	*time;				/* Buffer to read time into	*/
struct	date	*sdate;			/* Date from AMIE.005		*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

time[0] = sdate->secs[1];		/* Units of seconds		*/
time[1] = sdate->secs[0];		/* Tens  of seconds		*/
time[2] = sdate->mins[1];		/* Units of minutes		*/
time[3] = sdate->mins[0];		/* Tens  of minutes		*/
time[4] = sdate->hrs[1];		/* Units of hours		*/
time[5] = sdate->hrs[0];		/* Tens  of hours		*/
time[6] = sdate->day[1];		/* Units of day			*/
time[7] = sdate->day[0];		/* Tens  of day			*/
time[8] = sdate->month[1];		/* Units of month		*/
time[9] = sdate->month[0];		/* Tens  of month		*/
 
return;

}

/*======================================================================*/
/*
.he                                                    AMST(SETDATE / ST_005)
.pa
*/
/*======================================================================*/
VOID                                     /*				*/
st_005(amie005,adate,date_offs)          /* Copy the date into AMIE.005 */
BYTE	*amie005,	/* Storage for AMIE.005				*/
	*adate;		/* Date as 'dd mth yy hh mm'			*/
WORD	date_offs;	/* Offset in to amie005 where date is stored	*/
/*======================================================================*/

{

LOCAL
struct	date	*sdate;

LOCAL
WORD	i;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Point 'sdate' to the date field inside AMIE.005			*/
sdate = (struct date *) (amie005 + date_offs);

/* Set up the various fields in AMIE.005 ready to be written out	*/
sdate->year[0] = *(adate + YEAR + 0);
sdate->year[1] = *(adate + YEAR + 1);

for (i = 0; i < 12; ++i)  if (strncmp(adate + MONTH,&mth[3 * i],3) ==
							    MATCH)  break;
if (++i < 10) {
    sdate->month[0] = '0';
    sdate->month[1] = i + '0';
}
else {
    sdate->month[0] = '1';
    sdate->month[1] = (i - 10) + '0';
}

sdate->day[0] = *(adate + DAY + 0);
sdate->day[1] = *(adate + DAY + 1);

sdate->hrs[0] = *(adate + HOURS + 0);
sdate->hrs[1] = *(adate + HOURS + 1);

sdate->mins[0] = *(adate + MINS + 0);
sdate->mins[1] = *(adate + MINS + 1);

sdate->secs[0] = sdate->secs[1] = '0';

return;

}

/*======================================================================*/

.pa
*/
#include	"portab.h"
#include	"amhead.h"

#define		STACKSIZE	200
#define		ALLOCATED	1
#define		FREE		0
#define		END_OF_CHAIN	-1

struct	header	{
	struct	header	*nxt_block;	/* Pointer to next alloc. block	*/
					/* Set to END_OF_CHAIN if last	*/
	UWORD	size,		/* Size of the area + header in bytes	*/
		alflag;		/* ALLOCATED, FREE or Tagged		*/
} ;

EXTERN
struct	header	base;

/*======================================================================*/
STATUS                                       /*				*/
init()                                       /* Initialisation function */
/*========================€©р ЄЗЉДV8F|ZІЁИ0ЄЖ€ДV0VеY W+4  `ґOЎ&хY W+4  `Љ¬ђ+•љ  0D  $UMЂ¬Р ‚"¦Ађ    T@+6‘‚0DTдUNA‚ ` e›[ADTмUNБ‚(ђ dlS°`ЉX  Tм"— \ўЄ  лQ  Л•љ  h@6¶Ѓіj8…›\АЕU К*§ ОVmж`°D  $CkЃњ¬Ъ4БЂЂ–mPrіnx+’R"ђКҐB` ¤E!•J„Бq<¬1 €¤2©P.*J ‘ю ЕКjй*€qУ`‚ ЁҐXЁI…Й
±џ8†\Ћ©.ЁeЙЙк‘ђ:†\Ћ©нЁi…ЙЉ‘ТРl†¦ѕЋ§¶ИiЉkй*ХрL†¦ѕћЎ ИjЄJHЁqТ €„ІЁЉ§  И€КH)Ё±УА
€ђЉ‚‰(И‰ли€*‘Уа
€Ё‚’™F ЁЉ©Є
1њPTЉ]ТhҐЖ’ <Љ¤¤ѕђѓ_ЁЙ€ЄJQPXЊ¤Љ‹яHеСЂ ЋЉњљЉ§  Ёи©ЙЁСЭА<ЋЉЁ’ ‡¦IСџа*ђ’\„™7©
ҐИI‘Т ’ђ„ІЁ‹D i)К1У ’ –© Й*	j€iТа
’¤ ЁҐ Й*€K*€± j\‚€‰"©…КjЁQ”`Z€ ¤™Й‰‰йИеСџАћњЋ\aЄ©ИИЄJQТ`ћђ„ІЁ‹0 ©й

ЉQУЂћ –© Йк	jЉjЩ@\ћ њѕЋ§vЙк	Лй*С Lћ њѕћЎ@ ЙккЄh±У@
ћ¤ ЁҐ Йк€K*€±У 
ћЁ ЁҐH ‰кЄЉ1ЯL ЄЁћ —J%С” hўЋЉ©‘Є*ЁЄЁ±Р ¤‰3КHЁh€Є‘Ф ¤Љ†ѕ€џ™ЄJЁЄJQФ\¤Є’њ’©=КJ«и*Љ‘™аl¦ЉЁЉ¤Ґ†Кi‰йИеС›p\¦ ‚џКji‰кq“ l¦ Њ¤Љ‹КjиЄ€qќА\¦ ћ Љќ  Є‰‰(JС—ђhЄ\\™&К©Й‰)ЙqФ ЄЁ ¤‡8  ћњѕЋ§vЙк	Лй*С Lћ њѕћЎ@ ЙккЄh±У@
ћ¤ ЁҐ Йк€K*€±У 
ћЁ ЁҐH ‰кЄЉ1ЯL ЄЁћ —J%С” hўЋЉ©‘Є*ЁЄЁ±Р ¤‰3КHЁh€Є‘Ф ¤Љ†ѕ€џ™ЄееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееSource data exausted, short record sent to output
Fixed length record utility switch list unspecified
Invalid record header size
Invalid record size
Invalid record trailer size
Invalid output start string
Invalid output termination string
Invalid max record count
RS232   H     N              RS232   MS1   O              RS232   MS2   P              RS232ВL1SUB   Q              ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее==============================================*/
/*USE
Portability	Level 1
Parent module	AMIE initialiser overlay AMINIT.C
Module Version	02.07
AMIE version	05.14
Revision History:-
12/11/90 V02.07 Test to skip over day of week when reading the Real
         Time Clock corrected.  It is when (b) == 8 not 9.  This fixes
         the problem reported by Barclays on 29/10/90 - ICFO
03/12/89 Space for AMIE.MS1 increased to 2048 bytes.  1024 was too
         small - ICFO
30/11/89 'sbrk', $memry' and a version of 'allocini' moved to here so
         they will be overwritten after use - ICFO
10/08/89 V02.05 'grope' code for RTC rewritten (AGAIN!!) - ICFO
16/01/89 V02.04 'grope' code for RTC rewritten - ICFO
17/12/88 V02.03 rd_rtc "Number to scan" reduced by 1 - PN
22/09/88 V02.02
         Delay function changed to be same as the one from the BIOS
         which allows for differing processor speeds - ICFO
12/07/88 Pretty picture changed because 'sethw' has moved to 'sysman'
         and 'format' - ICFO
25/05/88 Local copy of 'delay' introduced - ICFO
         (BEWARE WITH NEW PROCESSOR BOARD)
04/05/88 Made part of main program to be overwritten - ICFO
27/01/88 Commented to latest standards - ICFO
01/06/87 Prepared for V4 release - DAR
23/03/87 Split into component modules - DAR
*/

{

/************************************************************************/
/*									*/
/* This  function  is quite tricky and it cheats.   After  some  normal */
/* initialisation  of  the hardware,  screen etc it gropes to see  what */
/* kind  of  clock is present and passes the address  of  the  relevant */
/* function  into a function which assumes an array of bytes.   As  the */
/* function was compiled the first byte was set to be the length of the */
/* function so these many bytes are copied into the byte array which is */
/* forced  to be at the beginning of this ('init')  function.   Finally */
/* $MEMRY  is altered to be the address of the next byte following  the */
/* particular  clock  function.   Finally the AMIE.MS1 general  message */
/* file  is  read into memory at $MEMRY.   This means  that  the  array */
/* called  'func_clock'  must be big enough to hold the clock  function */
/* and  sufficient of the AMIE.MS1 file so that it does  not  overwrite */
/* the code which is reading it in.					*/
/*									*/
/* After this function completes the memory is as follows		*/
/*									*/
/*               0 +-------------------+				*/
/*                 |     CP/M Base     |				*/
/*             100 +-------------------+				*/
/*                 |                   |				*/
/*                 |     AMIE Base     |  Same size for all systems	*/
/*                 |                   |				*/
/*                 +-------------------+  <-- $MEMRY set here by linker	*/
/*                 |  Clock Read Func. |  Groped for			*/
/*          $MEMRY +-------------------+  <-- Set by this function	*/
/*                 |      AMIE.MS1     |				*/
/*                 +---------------ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                           AMIE (RECUTL.H)
.pa
*/
/*======================================================================*/
/*                          RECUTL.H					*/
/*======================================================================*/

/*17/12/90 'sb_allowed' added - ICFO					*/

/* Record modification descriptor					*/
struct	_rd	{
	LONG	sh_size,	/* Size of source record header		*/
		st_size,	/* Size of source record trailer	*/
		r_size,		/* Size of input record			*/
		maxrec;		/* Maximum number of records allowed	*/
	UWORD	dh_size,	/* Size of destination header		*/
		dt_size;	/* Size of destination trailer		*/
	BOOLEAN	sh_allowed;	/* TRUE if short records are allowed	*/
} ;

/*======================================================================*/
ruct	_rd	{
	LONG	sh_size,	/* Size of source record header		*/
		st_size,	/* Size of source record trailer	*/
		r_size,		/* Siееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…”СUU e4UEфDI=AST_DATЃ”ХМ`e$Eфдф8I}MYRD_RTC”  M_B	DqЉB&ђJDЃHљA,’Љ¤вQTA*‘КdRЃ<†T'КДB)-%     †’Ђ9Y  FН  TфBяІD4”КНІА,6љ ІЄЂ…юяdіi@4  ТP+4  `€©(6ЁЂЉ©(Ќ›QАYUРBя°лё„  dЂ                          SЉ„XBµP›G „Uа›XЂD  ”B
 9EUаRІ !–h  еfЂ љ  @@Л6ЩЂ№D5рК!ЂўЄреfЬ&‚БЂ С•ЏЂЂ–mДrЉ«А”C_ \¬Р ‚Б`€Щµ¤•@Ђ„/чы$B Y·К!ЇЂ.Q, еfЪрf‚!  2СА&ШЅМЂЂЃрm›NЂ‡Зfm:fФ@!  Ш6KХ¶ІЋoљЕ’ЫYЖ vmSm¬Ђн†ЪЕ’!K ¬Р ‚Й–ЇKX Љ…РpЂ1БЋХЃцЌgз0=ь:в0ѓХ’!« LЫ:WХр&mќ] Lc"IьЯА!@^<d«Щ'жXњѕЛІДи1Z’Й                   Y[В	^Б Ђ е›AАќb  rНёАA‘№ЂЂ–mО„mШe›v@њўTгrЉ­ИЌК!ѕ`N7K‚*· B6h  }[@!U№fЯ #иКЪЃ@ ·[p ‹ґюН  Tи‡J@ЕVЬF"¶аL: ! ,ЫВл[p ИШ@ГЈаb0 rНҐАnQХ±fЂ иHB YґьFе[ &mFhџBC«fН« aѓь2   ”ulЂ™µ„"Р†Z!‘XЉЫЃ@АЛ6Ё€Дb7(ЄЫЃ@`mkР  Л”B 9Y  ‚БЃЂ–mѓ€Дb1Њl ЃЂ–m¦ЃА—(кЪЃ3kђDъЃЂ–mµЃА‘”um ™· ў}	@АЛ6е„A@ Л”ukА™·Xў}	@АЛ6р„A@ ИЌК:µАLЫЦС>„„ ` е›}@В Р eК:µ LЪС>„„ ` е›BБ Р dFеZА&mhџBB0 rН¤ ЃЂ 2еZ°&m,hџBB0 rН¦АЃЂ 2#rЋ­P6 ‚4OЎ! 9fФ°@€( €ЖГЎ 9fЦ@€4 €ЖГ¦LµмўБp№X­Qў@А°cµD }ЃЃb«D~sЯАсC‰Њ0;€В6¤ Ђ%ґЂ‚  rН® Ѓ@ 2еЃЂ–m©‚@–mhџBB  rН¶ ЃH 2еЃЂ–mЖ‚Ђ–mјhџBLђ  C^B¬Р ‚!ЂW|UwБ 6‹ЃґЁр+„Љ®ш ¬EwБwјB Y·HЦ*»аЃ—+4  hџBL;ь! ,Ъ
 .Q 9fТ0P€ іnИ#DъЃ –m/ЃА—(„ іj(D іiё+DъЃ –mM‚ —(„ іjр(ЊF#fХ@V‰ф$! ,ЪФ
Ђ.Q 9fЧ QЌ›\Z'Р“$B Y¶К! ,Ы,
 "6m‹hџBB  rНіАў7(„ іmЂ(D іm0+DъЃ –m№€Ьў  rН№@Ў@ 2#fЬ V‰ф$! ,ЫЁ
#€Ьў  rНјАЎ@ 2Н»Ђ­иHB Y·Д" \ў  rН @Б0 2#fЯЂV‰ф$! ,ЪЂ.Q 9fТ `€ fС`f‰ф$! ,ЪX .Q 9fУР`€ іi3DъЃ –mIЃА—(„ іjШ0D іj€3DъЃ –mg‚ —(„ іkА0ЊF#fЦаf‰ф$! ,ЫЂ.Q 9fЩ@aЌ›bЃљ'Р“$     ` е›hќb rН¶ЂБ‘«Z°g(„ іmа0D іm(3DъZ°a”B Y·," DlЫ¤С>„„   ЉЦѓ
­h0EиfЯ`FХ;aРРqU­€­h3ъ@ЂЛ6рѓДb7(ЄЦѓ@`mђР  Л”B 9Y  ‚Б>-XTа‡NБШtUkA„b+Z{Щ·мµYЃЕV¬F#V¬F#№EVґ"0 Z'Р“БЉ­X0ЊF6Љ­X0ЊF#rЉ­h0Eмя„F  ЛDъZ°`€ r€@АЛ6‰іoH3DъZ°`€ №D ` е›cБДlЫ$С>„…V¬" \ў0 rНґ бP 2Нµ ниHUjБ‚ ` dFеЃЂ–m»‚Ђ‘6бґOЎ!U«‚ —(„ іnЁ8D іnи;DъZ°`€  №D ` е›{БВ Р dFНѕАниHUjБ‚   eК*µ`БP 2#r€F ‰ф$С>„™$гxЂЖl7НbЃИКs2›ЋЂ™Фаe9
Ж“!”Ю !›НЗC‘јШl2њ„‘”жe7 #)„Ш *M¦QШo1љД‘”жe7 і ьИeЙЄ©Љ‘џђ†\њћ©WЁeКk
‘”`z†\Ё¦©ЅИiЉH©й‘љ †¤§  И€КH)Ё±‘„Ћ]  Ии©ЙЁЄqЂ 
ЋЉњљЌИиЄЉЙ(‘СА*Ћ¤ћ ‹	IС•Ђ,љ€Љ‚іжК
ЄЉjЉQ’р¤€ѕ``k‘КH‹йЙиqЧ°L¤€ѕ¤Ё‡бКH‹кjИq›p¦‚і'КhЄ‹и€1џ ¦ђћ®ѕ©+КjЉIИi±™А<¦Ё¤њ†ЎЇКj‹ж±Ь,¦Ёѕ€‚©—Ки)*‹и1•°®Ёѕ``k8  ћ ьИeЙЄ©Љ‘џђ†\њћ©WЁeКk
‘”`z†\Ё¦©ЅИiЉееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееInsufficient memory for program operation
Operation aborted - Insufficient memory
This file essential for program operation
Unable to open this file
Overlay loading error (not found / no memory)
Disc read error
Disc write error
Open failure on source device
Open failure on dest device
Read failure on source device
Write failure on dest device
Seek error
Invalid entry
Device is output only
Device is input only
Incorrect format
Format not found
Transfer abort error
I/O error from this device driver
Transfer buffer error
No files on disk
Processor loaded in wrong position
Driver mismatch at this stage
Invalid switch list
Cannot load overlay
Buffer allocation error
Read error on dest device
File exists - operation terminated
Destination disk full
Dest disk -  block allocation error
Input drive same as output
Transfer packet error
Uncorrectable transfer error
File too complex
Destination device not a disc
Cannot identify 1st floppy disc
Illegal format name
Invalid assignment fiFixed length record utility
HS: Enter input header size to ignore (default 0)
as bytes (numbers only) or Kb (eg 1k)
<RET> only enters default
RS: Enter size for transfer to output record (default 80)
TS: Enter input trailer size to ignore (default 0)
SS: Enter output start string, for none press RETURN only
ES: Enter output end string, for none press RETURN only
in text format eg. ATEXT STRING
or hex format eg. H0D,A,0R100
MR: Enter max no of records to output (default all)
SH: Are short records to be allowed
'Y' for Yes, other for No
y enters default
RS: Enter size for transfer to output record (default 80)
TS: Enter input trailer size to ignore (default 0)
SS: Enter output start string, for none press RETURN only
ES: Enter output end string, for none press RETURN only
in text format eg. ATEXT STRING
or hex format eg. H0D,A,0R100
MR: Enter max no of records to output (default all)
SH: Are short records ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее 9                                                                                                                             Copyright Timeclaim Ltd 1989 05.2004.02@ DEVELOP ЬФ                                                                            Г’Ђ                                                                                                                                             7Њ! 9Нл" 6я#6я! 9Нл" 6 #6 ! 9Нл" 6#6 ! 9Нл" Нл"|µВЮЂ! еНF‹БЙ! е! 9Нл" Нл"е!BЂе!RЂеНЄББББ"ЊЂ*ђЂе!bЂе! еН*БББ"ЉЂ#НN"К-Ѓ*ђЂе! еН‡ББЙ! 9Нл"еНeЃБ"ЋЂ! е! е!  е!  еН!ББББ*ЉЂеН~Б*ЋЂЙ      *ЊЂе!BЂе!BЊеН+БББ#Н2""Ђ!яя"_Ѓ*_Ѓ#"_ЃьН“"Ъ5‚*_ЃеН§‚б!aЃНє0ЕХ!яяН%1НВ0КґЃ!яяЙ*_ЃГ‚! 9Нл"е!aЃН¬0бНє0Г2‚! 9Нл" е!aЃН¬0бНє0Г2‚! 9Нл" е!aЃН¬0бНє0Г2‚! 9Нл" е!aЃН¬0бНє0Г2‚Г2‚Нш"єЃ  ПЃ иЃ ‚   Г„Ѓ! 9Нл"еНp„Б#НN"КL‚!яяЙ! 9Нл"еН_‹Б#НN"Кc‚!яяЙ!  ЙEЊHЊKЊNЊ   
         P       яЙљ;яЙљ;яЙљ;яЙљ;яЙљ;        !  "џ‚*ЊЂе!BЂе! 9Нл")g‚Нл"еН+БББ"Ў‚#Н2"КTѓ*Ў‚)RЂНл"Не"Н2"КQѓ*Ў‚)RЂНл"еНв‰б!Ј‚Нє0!le
Invalid device description
No formats for this Op Sys
Invalid FC: switch
Driver ID not in Op Sys list
System workspace exausted
No drive accepts this format
Input drive same as output drive
Utilities not available for this processor
Text file loading error
Both input & output to tape not allowed
Destination directory full
Illegal filename
No files match specified name
Requested drive does not accept this format
Cannot rename this file
if (get_time(amie005) == FAIL)  return(FAIL);

/* Write AMIE.005 back out to disc (M: if fitted and A:)		*/
clrs();
wait_a_bit();
rv = wt_005(amie005);

clrs();
return((rv == FAIL) ? FAIL : SUCCESS);

}

/*======================================================================*/
/*
.he                                                  AMST(SETDATE / GET_TIME)
.pa
*/
/*======================================================================*/ 
STATIC STATUS                        /*					*/
get_time(amie005)                    /* Plug the new time into AMIE.005 */
BYTE	*amie005;			/* Buffer holding AMIE.005	*/
/*======================================================================*/

{

LOCAL
WORD	type_clock;

STATIC
WORD	cur_pos;

LOCAL
BYTE	date[20],
	*name_clock[] = {
		"No clock present",
		"Super Video Controller present",
		"Real Time Clock present"
	};

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Ask the opertor to hang about a bit					*/
wait_a_bit();

/* Find out which kind of clock is present				*/
type_clock = grope();	/* Gropeing takes a little while (as always??)	*/
clrs();
say(10,10,name_clock[type_clock]);
clreol();

/* Set the initial time into 'date'					*/
st_date(amie005,date,SDATE - 0x100,type_clock);

/* Ensure that 'date' is a null terminated string			*/
date[19] = NULL;

/* Get the new time							*/
if (show_time(amie005,type_clock,date) == FAIL)  return(FAIL);

/* Copy new time into AMIE.005						*/
st_005(amie005,date,SDATE - 0x100);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                     AMST(SETDATE / GROPE)
.pa
*/
/*======================================================================*/
WORD                        /*						*/
grope()                     /* Find out which clock (if any) is present */
/*======================================================================*/

{

/* Returns 0 if no clock						*/
/*         1 for SVC							*/
/*         2 for RTC							*/

/************************************************************************/
/*									*/
/* The  business  of detecting the type of clock has been fraught  with */
/* difficulties.   The latest idea is to read the Real Time Clock twice */
/* with  a  delay  of  150  milliseconds  between  readings.    If  the */
/* difference   in   time  is 0.1 or 0.2 seconds then the   Real   Time */ 
/* Clock   is present and already running.    If the difference is some */
/* other  value  then   the Real Time Clock is  started  and  the  test */
/* repeated.    If the difference  is still something other than 0.1 or */
/* 0.2  seconds  then  the   Real Time  Clock  is not  present  so  the */
/* program  goes on to test  for  the presence  of  an  Internal  Video */ 
/* Controller    and   to   differentiate  between   the  Super   Video */
/* Controller  (SVC)  which  has  a  clock  and   the  Internal   Video */
/* Controller (IVC) which does not have a clock.                        */
/*          							        */
/* Note  that  it is just conceivable that the difference  in  readings */
/* could  be  1 unit even if the Real Time Clock is absent but this  is */
/* most  unlikely.   However to minimise even this remote possibility a */
/* further  test is made of the Interrupt / Status register which  will */
/* definitely  be  zero  if the Real Time Clock  is  present  and  will */
/* probably be non zero otherwise.					*/
/*       								*/
/* Note  also  that  to  start the clock it is  necessary  to  set  the */
/* registers  to a sensible value and it also appears necessary to wait */
/* a little while before reading the clock.				*/
/*									*/
/************************************************************************/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

#asm
	.z80
	extrn	mdelay

	clock	equ	20h

;   First test for RTC
	ld	b,5			; Loop
g1$:	push	bc			; To free 'b' for use
	ld	hl,clok1		; Read the clock
	call	rdclok
	call	wt$15			; Wait 150 ms
	ld	hl,clok2		; Read the clock again
	call	rdclok
	call	chkclok			; Returns zero if delta ...
	pop	bc			; time is 100 or 200 ms
	jr	nz,g2$			; Jump if not
	in	a,(clock + 15)		; Check Interrupt / Status ...
	and	0fh			; ... register is zero
	ld	hl,2			; In case it is RTC
	ret	z			; Gotcha
g2$:	push	bc
	call	wt$15			; Wait 150 ms
	pop	bc
	dec	b			; Try once more
	ld	a,b
	cp	4
	jr	z,g1$
	lЈ‚Н¬0ЕХ!  Н%1НЄЌК.ѓ! 9Нл"))Џ‚Н¬0ЕХ!Ј‚Н¬0НЄЌН2"К=ѓ! "џ‚ГQѓ! 9Нл")w‚Нл"еНF‹БГzѓ*Ђ+НN"Кzѓ! 9Нл"))‚Н¬0!Ј‚Нє0! "џ‚*џ‚НN"Кa„!  е! 9Нл")o‚Нл"е! 9Нл"+++НN"К­ѓ!  Г°ѓ! е! е!	 еН‰БББББ!Ђе!
 еН$‹ББ|µКЪѓ!яяН%1Й:ЂНж"|µВюѓ! 9Нл"))‚Н¬0!Ј‚Нє0Г„!ЂеНв‰б!Ј‚Нє0!Ј‚Н¬0ЕХ!  Н%1НЄЌК;„! 9Нл"))Џ‚Н¬0ЕХ!Ј‚Н¬0НЄЌН2"КJ„! "џ‚Г^„! 9Нл")w‚Нл"еНF‹БГzѓ!Ј‚Н¬0Й  QЊ    *j„е!\ЊеН‘ББ"h„#НN"К•„*j„е! еН‡ББЙ!яя"n„*n„#"n„юН“"Ъ…*n„е*h„еН2…ББ"l„#НN"КЕ„Г…!  е*h„еНRББ*n„|µВп„! 9Нл" е*l„Нр"Г…! 9Нл" е*l„Нр"Г›„*h„еНЅБ*l„#НN"К…!яяГ…!  Й      _ЊbЊ    !  " …*ЊЂе!BЂе! 9Нл")&…Нл"еН+БББ""…#Н2"КП…*"…)RЂНл"Не"Н2"КМ…*"…)RЂНл"е! 9Нл"еНШ†ББ"$…е!яяНX"КЈ…! " …ГМ…!eЊеН|Б*"…)RЂНл"е! 9Нл").…Нл"еН‡ББГе…*Ђ+НN"Ке…!  "$…! " …* …НN"Кћ†!  е! 9Нл")*…Нл"е! е!	 е!< еН‰БББББ!Ђе!= еН$‹ББ|µК1†!яя"$…Гћ†:ЂНж"|µВK†!  "$…! " …Г›†!Ђе! 9Нл"еНШ†ББ"$…е!яяНX"Кr†! " …Г›†!eЊеН|Б*"…)RЂНл"е! 9Нл").…Нл"еН‡ББГе…*$…  Нљ"Кі†*$…яН™"Н2"Кї†*$…ГУ†! 9Нл").…Нл"еНF‹БЙ    ! 9еНл"#Нр"+Не"еНР#Б"Ф†*Ф†їя|µВ:‡!  "Ц†! 9Нл"~·К6‡! 9еНл"#Нр"+Не"е! 9Нл"еНRББ*Ц†#"Ц†Г‡*Ц†Й*Ф†ёя|µКJ‡!яяЙ! 9Нл"е! 9Нл"еН}‡ББ"Ц†#НN"Кm‡!яяЙ*Ц†Й            !  "q‡Нѕ'! 9Нл"~·К–€! 9еНл"#Нр"+Не"еН­€Б"{‡#НN"Кµ‡!яяЙ! 9Нл"Не"еН­€Б"y‡#Н2"Кй‡*{‡))))л*y‡"{‡! 9еНл"#Нр"! 9Нл"Не"еНР#Б"w‡!  "u‡*w‡®я|µВI€! 9еНл"#Нр"Не"еНmЌБ|µКF€*u‡
 Н#е! 9Нл"Не"РяС"u‡Г€ГO€! "u‡*q‡л*u‡"q‡*u‡+"u‡#|µК{€*{‡е! 9Нл"еНRББГZ€! 9Нл"~·К“€! 9еНл"#Нр"Г†‡*q‡Й0123456789ABCDEF   ! 9е! 9Нл"еНР#БНр"!яя"«€*«€#"«€рН“"Ъх€*«€љ€Не"е! 9Нл"Н:"Кт€Гх€ГЗ€*«€ряНN"К‰!яяГ‰*«€Й          !  "‰)‰е! 9Нл")bЂНл"Нр"! 9Нл"|µК_‰*‰#"‰)‰е!
 9Нл")bЂНл"Нр"! 9Нл"|µКЉ‰*‰#"‰)‰е! 9Нл")bЂНл"Нр"! 9Нл"|µКµ‰*‰#"‰)‰е! 9Нл")bЂНл"Нр"!  е!  е*‰#"‰е!‰е!
 9Нл"еНWБББББЙ        !  "Ь‰! 9Нл""Ъ‰*Ъ‰е*Ъ‰Не"еНР#БС}Н2"К/Љ*Ъ‰Не"µя|µВ$Љ! "Ь‰*Ъ‰6 *Ъ‰#"Ъ‰+Гт‰! 9Нл"еНlЉб!Ю‰Нє0*Ь‰+НN"К_Љ!Ю‰Н¬0ЕХ   Н
/ГeЉ!Ю‰Н¬0Й      ! "jЉ!fЉНµ0    ! 9Нл"Не"ГћЉ!яя"jЉ! 9еНл"#Нр"Г«ЉНш"‰Љ- ЏЉ+   ! 9Нл"Не"0 Нg"КОЉ! 9Нл"Не"9 Нf"Н2"К‹!
 еНбЌ!fЉН¬0Н
/ЕХ! 9еНл"#Нр"+Не"Н1НЃ0ЕХ!0 Н%1Н~0!fЉНє0Г«Љ*jЉН%1ЕХ!fЉН¬0Н
/Й  Н(! 9Нл"е! 9Нл"еНuЊББ""‹Н&(*"‹Й!eЊеН|Б! 9Нл"еНpБЙ    !  "]‹! 9Нл" 6я#6я*ЊЂе!BЂе!lЊеН+БББ#Н2"КЎ‹! 9Нл" 6#6 Г»‹*Ђ+НN"К»‹! 9Нл" 6 #6 ! 9Нл" Нл"#|µВ3Њ!  е! е! е!  е! еН‰БББББН(Н±("[‹еяНN"КЊ!яя"]‹Г(Њ! 9Нл" е*[‹еНР#Б"[‹§яНN"Нр"*[‹еН)БН&(*]‹ЙRECUTL.MS1 DF HS RS TS MR RECUTL.TMP WC SS ES RECUTL SH       ! 9еНл"+Нр"! 9Нл""sЊ!  "oЊ*sЊеНо("qЊС}*qЊ  Нv"ВіЊ*qЊ Нg"Н2"К=Ќ*qЊГ!Ќ*oЊ+"oЊ#|µВПЊГЃЊ*sЊ+"sЊ!iЌеН„'БГ:Ќ! 9Нл"6 *oЊ+"oЊ#|µКЌ!iЌеН„'БГкЊ*qЊея|µВЌ! ЙГЃЊ*sЊ6 !  ЙГ:ЌНш"їЊ їЊ бЊ кЊ Ќ   ГeЌ! 9Нл"л*oЊНv"КeЌ*sЊ#"sЊ+Не"еН)Б*oЊ#"oЊГ‘ЊЙ  ! 9~!  ю0Шю:Р,Й! Нш0! еН°ЌбхН	1В–ЌсГћЌс! ТћЌ-СББХ-Й! Нш0! Г†Ќ! 9~“_#~љW#~™O#~hgGх|­тОЌс?ЙсЙЙге!1ГжЌге!1ГжЌге!%1ЕХе! 9Н¬0бХъЌХе`iЙ! 9Нє0бСБЙе!51ГЋе!31ГЋе!31ЕХе!
 9Н¬0бН7ЋDM! 9^#V#Нє0СБбсЙйЙ                  @          $@@     " @   Ђ HDD  Є       	 	 ‘@ H @ЂH  @    Ѓ€‚ 	  ‚@ђ"@ $@$D H@ ‚ @"   Ѓ"   ! A$@ @@‚	   ЂЂЃђA$ B ‚HЂ ЂЂH ’ @@   @   $€  @Ѓ    @ @Ђ "Ђ€    ђ Ђ  $‚DH‚@   Ђ    DH I A    "   $D   €Ђ     HЂ H ‚B" D$ @ H  ‚ "    $     A     BЂ      ђ                     ђ ЂH ’DDЂЂ‚@H	 „DD€ ‰    @D      ЂЂ          Є       	 	 ‘@ H @ЂH  @    Ѓ€‚ 	  ‚@ђ"@ $@$D H@ ‚ @"   Ѓ"   ! A$@ @@‚	   ЂЂЃђееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееd	a,0			; Set the clock registers
	out	(clock),a
	out	(clock + 15),a
	out	(clock + 4),a
	out	(clock + 5),a
	out	(clock + 6),a
	out	(clock + 7),a
	inc	a
	out	(clock + 8),a
	out	(clock + 9),a
	out	(clock + 10),a
	out	(clock + 11),a
	out	(clock + 12),a
	out	(clock + 13),a
	out	(clock + 14),a		; Start the clock ...
	push	bc
	call	wt$15
	pop	bc
	djnz	g1$			; ... and try once more

;   Test for SVC or IVC
	ld	a,1bh			; Escape
	call	put$vid
	ld	a,'v'			; Return version number
	call	put$vid
	call	get$vid
	ld	hl,0
	ret	c			; No - therefore no clock

;   Differentiate between SVC and IVC
	cp	40h			; SVC?  [(hl) still zero]
	ret	c			; No - IVC therefore no clock
	inc	hl
	ret

;   Local copy of 'putvid'
put$vid:
	push	af			; Save the character
pv0:	in	a,(0b2h)		; Check 'ready' flag
	rrca				; Move flag to carry
	jr	c,pv0			; Wait if buffer is full
	pop	af			; Get the character back
	out	(0b1h),a		; Send it out
	ret				; Done

;   Local copy of 'getvid'
get$vid:
	in	a,(0b2h)		; Read the flag register
	rlca				; Move flag to carry
	jr	nc,gv0			; Get character if there
	call	wt$15			; 0.15 seconds delay
	in	a,(0b2h)		; Read the flag register
	rlca				; Move flag to carry
	ret	c			; Not SVC or IVC
gv0:	in	a,(0b1h)		; ... else read the character
	ret				; ... and return with it.

;   Wait for 0.15 seconds
wt$15:
	ld	hl,150			; Delay 
	push	hl
	call	mdelay
	pop	bc
	ret

clok1:	defs	2
clok2:	defs	2

rdclok:					; Taken from GM816 Manual
	ld	d,h			; Start of storage
	ld	e,l
rdc$1:	ld	c,clock			; 1 before first register
	ld	b,2			; Number of registers to read
	ld	h,d
	ld	l,e
rdc$2:	inc	c			; Register to read
	ini				; Read into (hl) and inc. hl etc
	jr	nz,rdc$2		; For next register
	ld	b,2			; Number of registers to read
	ld	h,d			; Start of storage
	ld	l,e
rdc$3:	ld	a,(hl)			; Pick up characters as read
	and	0fh			; Mask out bottom nibble
	cp	0fh			; Test for update indicator
	jr	z,rdclok		; Update indicator found
	ld	(hl),a			; Put value away
	inc	hl			; Point to next value
	djnz	rdc$3			; Back for next value
	ret

chkclok:
	ld	hl,clok1 + 1		; Compute 1st time as 0.1 seconds
	call	times10
	ld	d,a			; Save it for later
	ld	hl,clok2 + 1		; Compute 2nd time as 0.1 seconds
	call	times10
	cp	d			; If 2nd < 1st add 100 ms to 2nd
	jr	nc,chk$1
	add	a,100
chk$1:	sub	d			; Compute delta time
	cp	1
	jr	z,chk$2			; Jump if 0.1 seconds
	cp	2
	jr	z,chk$2			; Jump if 0.2 seconds
	xor	a
	inc	a
	ret				; Return non zero
chk$2:	xor	a
	ret				; Return zero

times10:
	ld	a,(hl)
	sla	a
	ld	e,a
	sla	a
	sla	a
	add	a,e
	dec	hl
	add	a,(hl)
	ret
	
	.8080
#endasm

}

/*======================================================================*/
/*
.he                                                   AMST(SETDATE / ST_DATE)
.pa
*/
/*======================================================================*/
VOID                                      /*				*/
st_date(amie005,adate,date_offs,type)     /* Copy the date into 'adate' */
BYTE	*amie005,	/* Storage for AMIE.005				*/
	*adate;		/* Date as 'dd mth yy hh mm ss'			*/
WORD	date_offs,	/* Offset in to amie005 where date is stored	*/
	type;		/* 2 = RTC, 1 = SVC 0 = No Clock		*/
/*======================================================================*/

{

LOCAL
BYTE	time[13];

LOCAL
WORD	i;

LOCAL
struct	date	*sdate;

VOID	rd_noclock(),
	rd_svc(),
	rd_rtc();

STATIC
WORD	(*rd_clock[])() = {
		rd_noclock,
		rd_svc,
		rd_rtc
	};

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Point 'sdate' to the date field inside AMIE.005			*/
sdate = (struct date *) (amie005 + date_offs);

(*rd_clock[type])(time,sdate);		/* Read the clock		*/

time[10] = sdate->year[1];		/* Units of year		*/
time[11] = sdate->year[0];		/* Tens  of year		*/

/* At this point 'time' is set up no matter which clock is present	*/
/* Now set up 'adate' by a common set of instructions			*/
for (i = 0; i < 19; ++i)  *(adate + i) = ' ';	/* Initialise		*/
*(adate + DAY + 0) = time[7];
*(adate + DAY + 1) = time[6];
i = (time[9] - '0') * 10 + (time[8] - '0') - 1;
strncpy(adate + MONTH,&mth[3 * i],3);
*(adate + MONTH + 3) = ' ';
*(adate + YEAR + 0) = time[11];
*(adate + YEAR + 1) = time[10];
*(adate + HOURS + 0) = time[5];
*(adate + HOURS + 1) = time[4];
*(adate + MINS + 0) = time[3];
*(adate + MINS + 1) = time[2];
*(adate + SECS + 0) = time[1];
*(adate + SECS + 1) = time[0];
*(adate + HOURS + 2) = ':';
*(adate + MINS + 2) = ':';
return;

}

/*======================================================================*/
/*
.he                                                    AMST(SETDATE / RD_RTC)
.pa
*/
/*======================================================================*/
VOID                                        /*				*/
rd_rtc(time,sdate)                          /* Read the Real Time Clock */
BYTE	*time;				/* Buffer to read time into	*/
struct	date	*sdate;			/* Not used in this procedure	*/
/*===================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее Ќ                                                                                                                             Copyright Timeclaim Ltd 1989 05.2004.02@ DEVELOP ЬФ                                                                            ГMЂ                                                        яяяя              ! 9Нл"уя|µВaЂН+ЃЙ! 9Нл"Г Ѓ! 9Нл"еНD…Б#НN"К‚Ђ!яяЙН—…#НN"КђЂ!яяЙ!  Й! "EЂН№ѓ!  еНb„БН0†Г%Ѓ! 9Нл" Нл""KЂ! 9Нл" Нл""IЂ! 9Нл"
 Нл""GЂН@†Й!  "EЂ   !!ЂНє0Н6ѓН„Г%ЃГ%ЃНш"kЂ  ”Ђ ”Ђ ”Ђ ”Ђ ”Ђ «Ђ	 вЂ   !  Й  !  "CЂ*;Ђ#НN"К}Ѓ!!ЂН¬0ЕХ! Н%1НЃ0!!ЂНє0!!ЂН¬0ЕХ!ЂН¬0НЧ†КzЃ!юя")Ѓ*=Ђ6я#6яГЇ‚Г}ЃН„!%ЂН¬0Н	1КµЃНЯѓ")Ѓ  Нv"К›ЃГЇ‚!%ЂН¬0ЕХ! Н%1Н~0!%ЂНє0Г}Ѓ!)ЂН¬0Н	1КшЃ!)ЂН¬0ЕХ! Н%1Н~0!)ЂНє0*3Ђ#"3Ђ+Не"еНф„Б")Ѓ#НN"КхЃГЇ‚ГµЃ!-ЂН¬0Н	1КE‚НЯѓ")Ѓ  Нv"К‚ГЇ‚!-ЂН¬0ЕХ! Н%1Н~0!-ЂНє0*)ЃеНф„Б")Ѓ#НN"КB‚ГЇ‚ГшЃ*Ђ|µКt‚*Ђ+"Ђ*5Ђ#"5Ђ+Не"еНф„Б")Ѓ#НN"Кq‚ГЇ‚ГE‚*Ђ|µК‚НЯѓ")Ѓ  Нv"КЋ‚ГЇ‚*Ђ+"ЂГt‚! "EЂ!  еНb„Б!  "EЂН6ѓ*)Ѓ##|µВ2ѓ! "EЂ*)ЃеНb„Б*=Ђ";Ђ!  еНb„Б!яя"=Ђ!  "EЂ!-ЂН¬0ЕХ!ЂН¬0НС†Кѓ!-ЂН¬0ЕХ!  Н%1НЧ†Н2"Кѓ*ЂНN"Н2"К2ѓ!±†еН|Б!яяе!  е!  еНзБББ!  Й*ЂН1!)ЂНє0*Ђ"Ђ!ЂН¬0!%ЂНє0!ЂН¬0Н31"Ђ*?Ђ"3Ђ*AЂ"5Ђ!ЂН¬0!-ЂНє0Й*GЂеН“Б"=Ђ#НN"КЏѓ!яяЙ*=ЂНл"#|µВџѓ!юяЙ*=Ђ Нл""1Ђ*=ЂНл""Ђ!  Й*=Ђ#Н2"КРѓ*IЂе*=ЂеНББ!  "Ђ!яя"=ЂЙ  *Ђ|µВ „Н№ѓНyѓ"Эѓ  Нv"Кэѓ*ЭѓЙГЯѓ*Ђ+"Ђ*1Ђ#"1Ђ+Не"& Й*CЂ|µК!„!яяЙ!  еН“Б";Ђ*;Ђ Нл""7Ђ*;Ђ##Нл""Ђ! "CЂ!  Й               *;Ђ#Н2"Ку„*EЂ|µКz„! Г}„!  "`„*^„|µК’„*`„}цoГ•„*`„"`„*;Ђ е*`„)N„Нл"Нр"*`„)V„Нл""^„! 9Нл"##НN"КФ„*;ЂНл"НN"Н2"Ка„*IЂГг„*KЂе*;ЂеНББ!яя";ЂЙ*7Ђ#"7Ђ+е! 9Не"С}*;ЂеНл"#Нр"*;Ђ##еНл"+Нр"|µВ:…!  еНb„БН„#НN"К:…!яяЙ!  Й    ё†*B…еНzБ">…е!яяН:"Кg…*B…е! еН‡ББЙ*>…е! 9Нл"ге!Ђге!~…гйББ"@…*>…еНу*Б*@…Й      Г†*Ђл*Ђ"‘…*‘…|µВ­…Г$†*‘…##"‘…*‘…еНо)Б"9Ђ"Џ…е!яяН:"КЦ…!  еНpБЙ*•…е!О†еН‘ББ"“…*9Ђ"?Ђ*9Ђл*Ђ#"AЂ*‘…+"‘…#|µК†*Џ…#"Џ…+е*“…еНДБС}Гш…*“…еНЅБ*•…еНЄ,Б!  Й*9ЂеНу*Б"9ЂЙ    *GЂеН“Б"<†*<† Нл"">†*>†‰ 6*>†– 6 *>†— е*Ђл*ЂеН-‡!ЂН¬0НЃ0бНє0*KЂе*<†еНББ!  Й!±†еН|Б! 9Нл"еНpБЙRECUTL RECUTL.OV1 RECUTL.TMP RC ! Нш0! еН‡бхН	1Вк†сГт†с! Тт†-СББХ-Й! Нш0! ГЪ†! 9~“_#~љW#~™O#~hgGх|­т"‡с?ЙсЙЙге!1Г:‡ге!1Г:‡ге!%1ЕХе! 9Н¬0бХN‡Хе`iЙ! 9Нє0бСБЙе!51Гk‡е!31Гk‡е!31ЕХе!
 9Н¬0бН‹‡DM! 9^#V#Нє0СБбсЙйЙ           	   H    Ѓ ‚I€€€Ђ ђ$ $I ’$ 	 ђ " I @$Ђ AI	 "’@$‰@‚DH ђI     ‚	 ‚$’ @ @$@BI ‘"D  ђ@  A! I " € $ I" "  @ "  ђ @$DHI	  €’!"	Ђ    $ „Ђ@       @Ђ      Ђ   Ђ  ЂН¬0НЃ0бНє0*KЂе*<†еНББ!  Й!±†еН|Б! 9Нл"еНpБЙRECUTL RECUTL.OV1 RECUTL.TMP RC ! Нш0! еН‡бхН	1Вк†сГт†с! Тт†-СББХ-Й! Нш0!ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее===================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

#asm
	.z80

nmrreg	equ	11			; Number of registers to read
clock	equ	20h			; Clock chip base address


;   Read in the clock registers
rd1:	pop	de			; Return address
	pop	bc			; Not used in this procedure
	pop	hl			; Storage address
	push	hl
	push	bc
	push	de
	ld	(rd4),hl		; Save for later
	ld	c,clock + 1		; First register
	ld	b,nmrreg		; Number to read
rd2:	inc	c			; Point to next port
	ini				; Put value into (hl)
	jr	nz,rd2			; Do the rest

;   Scan the values for any update indicators
	ld	b,nmrreg		; Number to scan
	ld	hl,(rd4)		; Start of storage
rd3:	ld	a,(hl)			; Get value
	and	0fh			; Mask top nibble
	cp	0fh			; Update indicator?
	jr	z,rd1			; Yes! - try again
	add	a,30h			; Convert to ASCII
	ld	(hl),a			; Resave it
	inc	hl			; Point to next one ...
	djnz	rd3			; ... and repeat

	jp	rd5			; Skip over workspace

rd4:	dw	1

rd5:	ds	0			; Here beginneth the 'C'

	.8080
#endasm

*(time +  8) = *(time +  9);		/* To obliterate 'day of week'	*/
*(time +  9) = *(time + 10);

}

/*======================================================================*/
/*
.he                                                    AMST(SETDATE / RD_SVC)
.pa
*/
/*======================================================================*/
VOID                                              /*			*/
rd_svc(time,sdate)                                /* Read the SVC Clock */
BYTE	*time;				/* Buffer to read time into	*/
struct	date	*sdate;			/* Date from AMIE.005		*/
/*======================================================================*/

{

LOCAL
WORD	i;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

putstr("\33t?");		/* Request clock [<ESC><t><?>]	*/
for (i = 5; i >= 0; --i)  *(time + i) = getvid();	/* NOT 'getkey'	*/
*(time + 6) = sdate->day[1];		/* Units of day			*/
*(time + 7) = sdate->day[0];		/* Tens  of day			*/
*(time + 8) = sdate->month[1];		/* Units of month		*/
*(time + 9) = sdate->month[0];		/* Tens  of month		*/


return;

}

/*======================================================================*/
/*
.he                                                AMST(SETDATE / RD_NOCLOCK)
.pa
*/
/*======================================================================*/
VOID                            /*					*/
rd_noclock(time,sdate)          /* Read the date and time from AMIE.005 */
BYTE	*time;				/* Buffer to read time into	*/
struct	date	*sdate;			/* Date from AMIE.005		*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

time[0] = sdate->secs[1];		/* Units of seconds		*/
time[1] = sdate->secs[0];		/* Tens  of seconds		*/
time[2] = sdate->mins[1];		/* Units of minutes		*/
time[3] = sdate->mins[0];		/* Tens  of minutes		*/
time[4] = sdate->hrs[1];		/* Units of hours		*/
time[5] = sdate->hrs[0];		/* Tens  of hours		*/
time[6] = sdate->day[1];		/* Units of day			*/
time[7] = sdate->day[0];		/* Tens  of day			*/
time[8] = sdate->month[1];		/* Units of month		*/
time[9] = sdate->month[0];		/* Tens  of month		*/
 
return;

}

/*======================================================================*/
/*
.he                                                    AMST(SETDATE / ST_005)
.pa
*/
/*======================================================================*/
VOID                                     /*				*/
st_005(amie005,adate,date_offs)          /* Copy the date into AMIE.005 */
BYTE	*amie005,	/* Storage for AMIE.005				*/
	*adate;		/* Date as 'dd mth yy hh mm'			*/
WORD	date_offs;	/* Offset in to amie005 where date is stored	*/
/*======================================================================*/

{

LOCAL
struct	date	*sdate;

LOCAL
WORD	i;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Point 'sdate' to the date field inside AMIE.005			*/
sdate = (struct date *) (amie005 + date_offs);

/* Set up the various fields in AMIE.005 ready to be written out	*/
sdate->year[0] = *(adate + YEAR + 0);
sdate->year[1] = *(adate + YEAR + 1);

for (i = 0; i < 12; ++i)  if (strncmp(adate + MONTH,&mth[3 * i],3) ==
							    MATCH)  break;
if (++i < 10) {
    sdate->month[0] = '0';
    sdate->month[1] = i + '0';
}
else {
    sdate->month[0] = '1';
    sdate->month[1] = (i - 10) + '0';
}

sdate->day[0] = *(adate + DAY + 0);
sdate->day[1] = *(adate + DAY + 1);

sdate->hrs[0] = *(adate + HOURS + 0);
sdate->hrs[1] = *(adate + HOURS + 1);

sdate->mins[0] = *(adate + MINS + 0);
sdate->mins[1] = *(adate + MINS + 1);

sdate->secs[0] = sdate->secs[1] = '0';

return;

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                            AMST(SHOWTIME)
.pa
*/
#include	"portab.h"
#include	"amst.h"

#define		M_DELAY	50	/* Maximum delay is 255 milliseconds	*/

STATIC
BYTE	mth[] = "JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC",
	c_date[] = "                   ";		/* 19 spaces	*/

/*======================================================================*/
STATUS                                   /*				*/
show_time(amie005,type,date)             /* Show current / get new time */
BYTE	*amie005;			/* Store of AMIE.005		*/
WORD	type;				/* Type of clock		*/
BYTE	*date;				/* Buffer containing date	*/
/*======================================================================*/
/*USE
Portability	Level 4 (Depends on Gemini Hardware)
Parent Module	AMST
Revision History:
05/03/90 M_DELAY reduced to 50 from 255 - ICFO
12/05/89 Delay M_DELAY introduced in loop waiting for a character - ICFO
28/09/88 Functions 'c_left' and 'c_right' introduced instead of
         accessing the terminal specific characters directly - ICFO
         'Invalid' message shown only on completion of invalid
         field - ICFO
20/04/88 Started
*/


{

LOCAL
BOOLEAN	bsp,				/* Left cursor input		*/
	inv_date;			/* Date being input is invalid	*/

LOCAL
WORD	cur_pos,			/* Entry 'cur_pos'		*/
	c;				/* Character from keyboard	*/

STATIC
STATUS	ck_date(),
	ck_space(),
	ck_time();

LOCAL
struct	_syntab	{
	STATUS	(*semantic)();		/* Address of semantic routine	*/
	WORD	sy_next;		/* Relative next		*/
	WORD	sy_sep;			/* 0 if not or 1 if separator	*/
} syn_tab[] = {
	{ ck_date,    1,  0, },		/*  0 Digit 1 of Day		*/
	{ ck_date,    2,  0, },		/*  1 Digit 2 of Day		*/
	{ ck_space,   1, -1, },		/*  2 Separator			*/
	{ ck_date,    1,  0, },		/*  3 Alpha 1 of Month		*/
	{ ck_date,    1,  0, },		/*  4 Alpha 2 of Month		*/
	{ ck_date,    2,  0, },		/*  5 Alpha 3 of Month		*/
	{ ck_space,   1, -1, },		/*  6 Separator			*/
	{ ck_date ,   1,  0, },		/*  7 Digit 1 of Year		*/
	{ ck_date ,   2,  0, },		/*  8 Digit 2 of Year		*/
	{ ck_space,   1, -1, },		/*  9 Separator			*/
	{ ck_date,    1,  0, },		/* 10 Digit 1 of Hours		*/
	{ ck_date,    2,  0, },		/* 11 Digit 2 of Hours		*/
	{ ck_space,   1, -1, },		/* 12 Separator			*/
	{ ck_date,    1,  0, },		/* 13 Digit 1 of Minutes	*/
	{ ck_date,  -14,  0, },		/* 14 Digit 2 of Minutes	*/
	{ ck_space, -15, -1  }		/* 15 Separator			*/
};

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

c = 0;
cur_pos = 0;
inv_date = FALSE;
strncpy(c_date,date,strlen(date) - 4);

while (TRUE) {

/* Clear the keyboard buffer						*/
    while (const() != NULL) ;

/* Get a character while displaying the time				*/
    while (TRUE) {
	disp_time(amie005,cur_pos,type,date);
	mdelay(M_DELAY);		/* Delay for WYSE 60 (Sixty)	*/
	if ((c = toupper(const())) != NULL)  break;
    }
    bsp = FALSE;

/* If character is ESC return FAIL so that AMIE.005 will not be updated	*/
    if (c == ESC) {
	clrs();
	return(FAIL);
    }

/* If 'CR' is input and date not invalid - update clock and return	*/
    if (c == CR) {
	if (inv_date == FALSE) {
	    clrs();
	    upd_clock(type,date);
	    return(SUCCESS);
	}
	else {
	    ck_space(' ',c_date,cur_pos,inv_date);
	    continue;			/* Ignore character		*/
	}
    }

/* Space is used to move cursor right one place				*/
    else if (c == c_right())  c = *(c_date + cur_pos);

/* Sort out backspace							*/
    else if (c == c_left()) {
	bsp = TRUE;
	if (cur_pos > 0)  --cur_pos;
	else                cur_pos = 14;
	while (syn_tab[cur_pos].sy_sep != 0) {
	    if (cur_pos > 0)  --cur_pos;
	    else              cur_pos = 14;
	}
	c = *(c_date + cur_pos);
    }

/* Ignore everything which is not alphanumeric				*/
    if (isdigit(c) == FALSE && isalpha(c) == FALSE)  continue;

/* Check with semantic routine						*/
    inv_date = ((*syn_tab[cur_pos].semantic)(c,c_date,cur_pos,inv_date)
						  != FAIL) ? FALSE : TRUE;
    if (inv_date == FALSE)  clreos(16,10);

    if (bsp != TRUE) cur_pos += syn_tab[cur_pos].sy_next;

}

}

/*======================================================================*/
/*
.he                                                  AMST(SHOWCLOK / CK_DATE)
.pa
*/
/*======================================================================*/
STATIC STATUS                                   /*			*/
ck_date(c,date,cur_pos,inv_date)                /* Check for valid date */
WORD	c;				/* Character from the operator	*/
BYTE	*date;				/* Buffer containing date	*/
WORD	cur_pos,			/* Entry 'cur_pos'		*/
	inv_date;			/* Date being input is invalid	*/
/*======================================================================*/

{

LOCAL
WORD	days,
	leap,
	year,
	i;

STATIC
WORD	t_digit[] = { 0, 1, 7, 8, 10, 11, 13, 14 },
	t_alpha[] = { 3, 4, 5 },
	ndays[][12] = {
		{ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 },
		{ 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }
	};	

/* - - - - - - - - - - - - - - - - - - - - - - - - -ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее - - - - - - - - - -*/

/* Put the character into the array					*/
*(date + cur_pos) = c;

/* Check that day and year and hours and minutes are digits and month	*/
/* is alpha								*/
for (i = 0; i < sizeof(t_digit) / sizeof(WORD); ++i)
		     if (isdigit(date[t_digit[i]]) == FALSE)  return(FAIL);
for (i = 0; i < sizeof(t_alpha) / sizeof(WORD); ++i)
		     if (isalpha(date[t_alpha[i]]) == FALSE)  return(FAIL);

/* Check that hours < 24 and minutes < 60				*/
if ((*(date + HOURS + 0) - '0') * 10 + (*(date + HOURS + 1) - '0') > 23)
							     return(FAIL);
if (*(date + MINS + 0) > '5')  return(FAIL);

/* Test if there is a recognisable month present			*/
for (i = 0; i < 12; ++i)
	if (strncmp(date + MONTH,&mth[3 * i],3) == MATCH)  break;
if (i == 12)  return(FAIL);

days = (*(date + DAY + 0) - '0') * 10 + (*(date + DAY + 1) - '0');
year = (*(date + YEAR + 0) - '0') * 10 + (*(date + YEAR + 1) - '0');
leap = (year % 4 == 0) ? 1 : 0;

/* Test if the number of days in that month is valid			*/
return((days > ndays[leap][i] || days == 0) ? FAIL : SUCCESS);

}

/*======================================================================*/
/*
.he                                                 AMST(SHOWCLOK / CK_SPACE)
.pa
*/
/*======================================================================*/
STATIC STATUS                                        /*			*/
ck_space(c,date,cur_pos,inv_date)                    /* Check for space */
WORD	c;				/* Character from the operator	*/
BYTE	*date;				/* Buffer containing date	*/
WORD	cur_pos,			/* Entry 'cur_pos'		*/
	inv_date;			/* Date being input is invalid	*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

if (inv_date == TRUE) {
    hil_on();
    say(16,10,"Invalid Date or Time");
    hil_off();
}

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                AMST(SHOWCLOK / UPD_CLOCK)
.pa
*/
/*======================================================================*/
VOID                                                /*			*/
upd_clock(type,date)                                /* Update the clock */
WORD	type;			/* 2 = RTC, 1 = SVC 0 = No Clock	*/
BYTE	*date;			/* Buffer containing date		*/
/*======================================================================*/

{

VOID	st_noclock(),
	st_svc(),
	st_rtc();

STATIC
WORD	(*st_clock[])() = {
		st_noclock,		/*  No Clock			*/
		st_svc,			/* SVC Clock			*/
		st_rtc			/* RTC Clock			*/
	};

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Update copy of the date						*/
strcpy(date,c_date);

(*st_clock[type])(date);	/* Set the clock to the new time	*/

return;

}

/*======================================================================*/
/*
.he                                                   AMST(SHOWCLOK / ST_RTC)
.pa
*/
/*======================================================================*/
VOID                                      /*				*/
st_rtc(date)                              /* Update the Real Time Clock */
BYTE	*date;			/* Buffer containing date		*/
/*======================================================================*/

{

LOCAL
WORD	i,
	hl;

STATIC		/*       1 d  10 d    1 h   10 h    1 m   10 m		*/
WORD	from_date[] = {    0,    1,    10,    11,    13,    14 },
	port[] =      { 0x29, 0x28,  0x27,  0x26,  0x25,  0x24 };

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Find the month							*/
for (i = 0; i < 12; ++i)
		 if (strncmp(date + MONTH,&mth[3 * i],3) == MATCH)  break;

/* Stop the clock, set non_test mode and no interrupts			*/
#asm
	.z80
	xor	a
	out	(2eh),a		; Stop clock
	out	(20h),a		; Non-test mode
	out	(2fh),a		; No interrupts
	.8080
#endasm

/* Update the month							*/
if (++i > 9) {
    hl = 1;
    i -= 10;
}
else hl = 0;

hl;
#asm
	.z80
	ld	a,l
	out	(2ch),a
	.8080
#endasm

i;
#asm
	.z80
	ld	a,l
	out	(2bh),a
	.8080
#endasm

for (i = 0; i < sizeof(from_date) / sizeof(WORD); ++i) {
    hl = *(date + from_date[i]) - '0';
    #asm
	.z80
	push	hl
	.8080
    #endasm
    hl = port[i];
    #asm
	.z80			; Entry with Port in (hl)
	ld	a,l
	ld	(i1),a
	pop	hl		; Retrieve value
	ld	a,l
	db	0d3h
i1:	db	00
	.8080
    #endasm
}

/* Start the clock						*/
#asm
	.z80
	ld	a,1
	out	(2eh),a		; Start the clock
	.8080
#endasm

return;

}

/*======================================================================*/
/*
.he                                                   AMST(SHOWCLOK / ST_SVC)
.pa
*/
/*======================================================================*/
VOID                                            /*			*/
st_svc(date)                                    /* Update the SVC Clock */
BYTE	*date;			/* Buffer containing date		*/
/*=======================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее===============================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

*(date + SECS + 0) = *(date + SECS + 1) = '0';
putstr("\033\164");			/* <ESC>"t"			*/
putvid(*(date + HOURS + 0));
putvid(*(date + HOURS + 1));
putvid(*(date + MINS + 0));
putvid(*(date + MINS + 1));
putvid(*(date + SECS + 0));
putvid(*(date + SECS + 1));

return;

}

/*======================================================================*/
/*
.he                                               AMST(SHOWCLOK / ST_NOCLOCK)
.pa
*/
/*======================================================================*/
VOID                                              /*			*/
st_noclock(date)                                  /* No clock to update */
BYTE	*date;			/* Buffer containing date		*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

return;

}

/*======================================================================*/
/*
.he                                                AMST(SHOWCLOK / DISP_TIME)
.pa
*/
/*======================================================================*/
VOID                                                /*			*/
disp_time(amie005,cur_pos,type,date)                /* Display the time */
BYTE	*amie005;			/* Store of AMIE.005		*/
WORD	cur_pos,		/* Cursor position			*/
	type;			/* 2 = RTC, 1 = SVC 0 = No Clock	*/
BYTE	*date;			/* Buffer containing date		*/
/*======================================================================*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Read the clock							*/
st_date(amie005,date,SDATE - 0x100,type);

say(12,10,"Current date and time are: ");

putstr(date);

say(14,10,"    Set new date and time: ");

putstr(c_date);

/* The constant 37 below depends on the length of the string "Current	*/
/* date and time are: ".  If the message is changed then the constant	*/
/* must be changed also.						*/

move(14,37 + cur_pos);

hil_on();
putvid(c_date[cur_pos]);
hil_off();

return;

}

/*======================================================================*/


say(12,10,"Current date and time are: ");

putstr(date);

say(14,10,"    Set new date and time: ");

putstr(c_date);

/* The constant 37 below depends on the length of the string "Current	*/
/* date and time are: ".  If the message is changed ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…”ТХХ`e4„хuхH%MA}RUPD_CLЃ”ХУ“Раe5Eх5d8MQ}IQP 5%IДb)љA)J"iІJ*“‰ERaЄG)‘JтPњO+¤0 Ђ@  Ђ@  Ђ@           QР0   Ј `   JA@ ыюЋЃЂ@   Ђ  
:   ¤ їии   QР0   Ґ  эяG@А   ЋЃЂЂ  ) Ђпъ:   tдя  )H+Еюя€@ ? Ђ *z !  Tм CI@ў  rН  ў0 rН·ЂVh  Бїб—+4  `°X" шµe\а&h  |ZІЇHп Kz@ сjК¦`"0 rНёЂQU= r€A Л6ы 9D Ђ е›@Ђ\¬ЪXБ`°X"ђКН  ,Ыѕ еfЂ ? fЂ Є`Г¦`,;Т !  Tд UOА.WшdшµaTАh  !їЩ"Є~ yїГ'Е«
ОЂЉ©Ш4  eX mFЃ –m
r€@ЂЛ6ґЂ№Yµd‚БЂ –љ€ Q% rЉ©и”UNА¬ЪR
Б`°X,;¬ ГҐАLР К*§аР •nЂETф #I@,Р  EOАtё	љ  9ETь›i@YTёB ©И ЄћЂ_зцh  Тј`"Єz +SРйѓЂ*z-йSР € Н  5 2 ,Ъв|ZІ©ЄћЂ_зцmФiQЂ!U= €©иЏAА= aЮђU= ТP Л6Щ €©шґё
Z\*§аVh  БfХАUGSр+4  `іiё6” ІЄЂл 
©и D fЯ ЌA іoШ”UOАnQ% q№ETфЖеS°”C^Ђњn–‚Біj@*ЕЃ@ ЋЂ@*v *§`ЪЉКґаBЂК! ¬Р ‚БSђ[6А2®XЄћЂ@АmWФ ИЊFН«АN±U= €©ил 2@              @ X    `   
 ЂЂ ш < ЂА ш >  а р > Ђ  ш < ЂА ш >  а р > ЃЂ–mБu€@ЂЛ6‘†\ўP rНҐ@mиHB  ®ЁЄкЃ_цm	mX 6W]P!ЉкЃ0йрЄкЃ
B7\2Н¦`n± 9fЦ 0Л6”Ѓ9YґМ	‚НІ LЄъ!їЩ,:љ!  WTUu@‚/Уы6ўЃ¶®@ПЃЉ®ЁЊEu@vUu@…!ОfЦЂ7X„ іm@e›[ Ь¬Ъ‚БfЧ@6UЕїЯм–•ЃЂ–m°‚Ђ–mґґбђ€( Н· NQ  9fЬР0€( іn E яґC!ёљ  2Ё …юяd€@АЛ6у„A  Л6ч„F mъeQаAэюЙЂ +Є*є AЎэ›c@ЫU¬‡OAWTF"є L:H! ,Ъ#€Ьў«ЄЂ·x#@ .Q еfЂ шµaVЂFkaУ0AUХЅб“вХ…^Б/чы$B Yµ›CБ-шd"
 3jx#”B Y¶ FН°`Ѓѓь2С€®x„ іlЁ D іlИ E я„A@mЌr€A Л6Ф‚@а ИЌ›l-шeў]0!UУu€@Ђh  лfЫА6UмЂ@;Ю!  WDUt@‚!Ђ6ЭoheК*є B–€e›pЃb«ћНў Њ*2
*№аLЫВНµЂLЄJ
!їШt B  2D   е›AБElЪ.
К©а¬Р  B 9D  ”CmЃЬ¬Р ‚Б`і@   ЙҐ`ц,У€@@Л6—№D4”КН  , 9fХаQHF©‚†YµјК! ,Ъо
гr€l@+ЌТБdЂ       Ђ ° 4  
@Ђ њ & 	@@ „  X QUЉЅмЪVЪѕ`¬;Љ
*±@ў1ЉaЪАQ 9fЧрQЊFеX P€ Нї Ѓ  r€@`+6­‚0X,вХ…|XwМ‡nБeѕ`Єц№¦ i‹ЕV(F"±@Ў±э›lБZTtB ¬`(ЄЕ„^ПрИЉЕ°й0„  XАQUЊ>ґЕ‚«
}iЉД   ЉЕЉ¬P(EфfРPfХ†aФаaUЉ€¬P+љѓ
¬P(¤#cЃC,Ы”
лЂЂ–mWіnP E я€¬`+”UbЃE!4
fХрaЊ>Њ¬3„ъУ 0к 4¶|i‹™" rН®АБЂ 2еЃ –mђ„ ‘”B0 4OЎ&‰ф$!№`оVh  БЂЂ–mњ‚Ђ–mcrі@ „ іmР0D €Щ·КНё М 9fЬР`€4 fЭPg+6мѓ0D   е›xA‚ Р dFНЅ ОVmм`€@@Л6ъB  Л6ю9Yґ ‚! ,Ъ "6mrіh;’Й‚ –mr€@ЂЛ6ѓ№D °”B
 YґдКН  ,B 9D  ”CsЃЬ¬ЪЋ
Б`°D   е›QAЬ¬ЫdБѓЂQ( еЮ w+6®°X,% rіkP;B 9D Ђ е›YЃВ"P eКН  ,m8ЃЂ–mђТP Л6‘ѓ№Yґњ‚Н© ¬’Iёмa6L‚!„иeОBЎ¤Ъe ОЂФдr2›Ћ‚!„иeMЖAРТm2€'#(и@ ™”и 7Nв!„иeMЖAРТm2Ћ„ Ои%C.DIVЊ‡Д2дЕHОё.C.MULTЊ™Ф2ддхHЙа5C.TSTЊСЃd4Е$Tх8ЛCLRSЊЋЂФ4фе5HНШC_LEFTЊП д5х$”t€й`>DISP_TЊб ¤RиИР+E.0ЊХѓ¤rиН :H.ЊЩѓд„”ЕффhМи>HIL_ONЊЬд•4Е€ЛЂISDIGIЊЊЂдФDTДМА<MOVEЊВеUE5E(Нx>PUTVIDЊЅµ4нSHOW_TЊіе5E$5О@STRLENЊс‚е5E$д4ШО€STRNCPЊ¤ѓе5EфDHйX>ST_NOCЋУе5Eх%D8мX6ST_SVCЊђЂеDхUXкИ.UPD_CLњ   ћCLRSЊЋЂФ4фе5HНШC_LEFTЊП д5х$”t€й`>DISP_TЊб ¤RиИР+E.0ЊХѓ¤rиН :H.ЊЩѓд„”ЕффhМи>HI,m8ЃЂ–mђТP Л6‘ѓ№Yґњ‚Н© ¬’Iёмa6L‚!„иeОBЎ¤Ъe ОЂФдr2›Ћ‚!„иeMЖAРТm2€'#(и@ ™”и 7Nв!„иeMЖAРТm2Ћ„ Ои%C.DIVЊ‡Д2дЕHОё.C.MULTЊ™Ф2ддхHЙа5C.TSTЊСЃd4Е$Tх8ЛCLRSЊЋЂФ4фе5HНШC_LEFTЊП д5х$”t€й`>DISP_TЊб ¤RиИР+E.0ЊХѓ¤rиН :H.ЊЩѓд„”ЕффhМи>HIееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(BFINIT)
.paЉ*/
#include	"dd.h"

EXTERN
struct	lvl	*lev;

/* Buffer control block							*/
EXTERN
UWORD	bftaken,	/* Number of valid bytes in output buffer	*/
	bfleft;		/* Space left in buffer				*/

EXTERN
BYTE	*bptr;		/* Current buffer pointer			*/

/*======================================================================*/
VOID                                  /*				*/
bfinit()                              /* Initialise the buffer pointers */
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMOUT CP/M output driver
Revision History:
21/04/89 Tidied up - ICFO
*/

{

/* The CP/M output buffer is controlled by a number of variables, it is	*/
/* the job of this function to initialise them prior to use		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

bftaken = 0;		/* No bytes in buffer yet			*/
bfleft = lev->bfsize;	/* Space in buffer is whatever AMIE has given us*/
bptr = lev->buff;	/* Buffer pointer to start of buffer		*/

}

/*======================================================================*/
r is controlled by a number of variables, it is	*/
/* the job of this function to initialise them prior to use		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

bftaken = 0;		/* No bytes in buffer yet			*/
bfleft = lev-ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CHSEFN)
.paЉ*/
#include	"portab.h"
#include	"disc.h"

EXTERN
BYTE	*menu_opt[],		/* Pointers to text messages in 'text'	*/
	cpm_drive;		/* Holds drive letter for this driver	*/

EXTERN
WORD	cpm_user,		/* Holds Current User number		*/
	floppy[];		/* Holds source dest drive nos		*/

EXTERN
struct	dtext	*fdtext;

/*======================================================================*/
STATUS                                      /*				*/
choose_fn(ovno,comd,target)                 /* Execute utility function */
WORD	ovno,					/* Overlay number	*/
	comd,					/* Command		*/
	target;					/* SOURCE or DEST	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPMMAN UTILITY OVERLAY
Revision History
12/04/89 Tidied up - ICFO
*/

{

STATIC
WORD	curov = -1;		/* Current overlay in memory		*/
				/* -1 = none				*/
				/* 0  = CPM.OV2	general utiliееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееties	*/
				/* 1  = AMIE.012 formatter		*/

STATIC
BYTE	*ovname[2] = {		/* Holds overlay name			*/
		"CPM.OV2",
		"AMIE.012"
	};

LOCAL
STATUS	(*ovaddr)();		/* Overlay execution address		*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* If shutdown request do so						*/
if (ovno == -1) {
    if (curov != -1)  spfree(ovaddr);
    curov = -1;
    return(SUCCESS);
}

/* Ask the operator to wait						*/
chat(19,20,NULL,NULL);

/* If required overlay not in memory					*/
if (ovno != curov) {

/* If formatter overlay loaded close it down				*/
    if (curov == 1)  (*ovaddr)(fdtext[floppy[DEST]].dtxt_format,4,0);

/* Free current overlay if it exists					*/
    if (curov != -1)  spfree(ovaddr);

/* Load overlay								*/
    if ((ovaddr = ldprl(ovname[ovno])) == (BYTE *) FAIL)
					    return(flerr(ovname[ovno],4));

/* If formatter overlay open it up for use				*/
    if (ovno == 1) {
	if ((*ovaddr)(fdtext[floppy[DEST]].dtxt_format,0,0) == FAIL)
							     return(FAIL);
    }

/* Set current overlay no						*/
    curov = ovno;
}

/* Execute the required function in the overlay				*/
/* 0 = General utility functions					*/
/* 1 = Formatter							*/
if (ovno == 0) return((*ovaddr)(comd,menu_opt,cpm_drive,cpm_user,target));
else	       return((*ovaddr)(fdtext[floppy[DEST]].dtxt_format,comd,0));

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CHUSER)
.paЉ*/
#include	"portab.h"

EXTERN
WORD	cpm_user;	/* CP/M User Number				*/

/*======================================================================*/
WORD                        /*						*/
chuser(fn)                  /* Set up the new file name and user number */
BYTE	*fn;	/* File name (including "USERnn\" where relevant)	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	All CP/M Processors
Revision History:
26/04/89 Started - ICFO
*/

{

/* Iж  thе useт haу seф thе useт numbeт aу '*§ iф wilм havе beeо storeд */Ќ
/* aу  -І anд thе filе namе aу retrieveд froн AMIE.DIТ wilм bе  iо  thе */Ќ
/* form:-								*/
/*									*/
/*        X:USERnn\ABCDEFGH.IJK						*/
/*									*/
/* Thiу  functioо  wilм extracф thе 'nn§ anд returо it®   Iф wilм  theо */Ќ
/* movе thе filе namе uр tп jusф afteт thе drivе specifieт sп thaф  thе */Ќ
/* file name will be:-							*/
/*									*/
/*        X:ABCDEFGH.IJK						*/
/*									*/
/* and can therefore be presented directly to the BDOS.			*/

LOCAL
WORD	user,		/* CP/M User Number				*/
	i,j;		/* Loop counters				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Remove User Number from file name and set user number if necessary	*/
user = cpm_user;
i = strlen(fn) - 1;
while (i >= 2 && *(fn + i) != '\\')  --i;

if (*(fn + i) == '\\') {
    *(fn + i) = NULL;
    user = atoi(fn + i - 2);
}
j = 2;
while (*(fn + ++i) != 0)  *(fn + j++) = *(fn + i);
*(fn + j) = NULL;

return(user);

}Љ
/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                                CPM(CPM.H)
.pa
*/
/*======================================================================*/
/*                           CPM.H 					*/
/*======================================================================*/

/* 13/01/87 Created from 'tape.h'.  Only the File Control Block and 	*/
/*          some 'defines' used						*/

#define		MAXOPT	4	/* Maximum number of options on the menu*/

#define		N_MESS	30	/* Number of messages in CPM.MS1	*/

#define		SETDISC	14	/* BDOS Set the default disc		*/
#define		SEARCHF	17	/* BDOS	Search First function		*/
#define		SEARCHN	18	/* BDOS Search Next function		*/
#define		GETDISC	25	/* BDOS Get current disc drive function	*/
#define		SETDMA	26	/* BDOS Set DMA address function	*/
#define		SETUSR	32	/* BDOS Set / Get User Number		*/

#define		ENTPLN	4	/* Number of entries per line		*/

union	_fcb {		/* Structure of a CP/M File Control Block	*/
struct	s_fcb {
	BYTE	fcb_disc;	/* Logical disc (0 = Default)		*/
	BYTE	fcb_fname[11];	/* File name, type (with attributes)	*/
	BYTE	fcb_extent;	/* Current extent			*/
	UWORD	fcb_s12;	/* Reserved for CP/M			*/
	BYTE	fcb_reccnt;	/* Record count used in current extent	*/
	union	{		/* Allocation blocks can be either ...	*/
		BYTE	fcbab_short[16];	/* ... one or two bytes	*/
		UWORD	fcbab_long[8];
	} _fcbab;
	BYTE	fcb_currec;	/* Current record within the extent	*/
	BYTE	fcb_ranrec[3];	/* Record for random read / write	*/
} ;
BYTE	c_fcb[36];
} ;

/*======================================================================*/
/
	UWORD	fcb_s12;	/* Reserved for CP/M			*/
	BYTE	fcb_reccnt;	/* Record count used in current extent	*/
	union	{		/* Allocation blocks can be either ...	*/
		BYTE	fcbab_short[16];	/* ... one or two bytes	*/
		UWORD	fcbab_long[8];
	} _fcbab;
	BYTE	fcb_currec;	/* Current record within the extent	*/
	BYTE	fcb_ranrec[3];	/* Record for random read / write	*/
} ;
BYTE	c_fcb[36]ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее У                                                                                                                             Copyright Timeclaim Ltd 1989 05.2004.01  DEVELOP _У                                                                            Г,Ђ                                РЃ       ! 9Нл"уя|µВIЂ! 9Нл"еНt‚БЙ! 9Нл"ГЈЃ! 9Нл" 6#6 ! 9Нл" 6#6 ! 9Нл"еНl„Б"Ђ#НN"КЌЂ!яяЙГМЃ*Ђ|µК Ђ*ЂеНЅБ*Ђ|µК°Ђ*ЂеНЅБ!  "Ђ"Ђ*%ЂеНу*Б"%Ђ*#ЂеНЄ,БГМЃ!  }2Ђ! 9Нл"еН5ѓБЙ! 9Нл"еНаЃБ!  е!ЂеНЮ„Б"ЂеНь.ББ!Ђе!ЩЃеН‘ББ"Ђ#НN"К<Ѓ!  "Ђ!  е!  еНь.ББ!Ђе! еН‡ББЙ! 9Нл" 6 #6 !  е!  еНь.ББ!  Й*ЂеНЅБ"Ђ!  е!  еНь.ББГМЃ! 9Нл" 6#6 *Ђе    ЕХ!  еНЙ…ББББЙГМЃНш"SЂ  ђЂ ђЂ ђЂ ПЂ гЂ	 ]Ѓ ]Ѓ xЃ   !  ЙAMIE.DIR RB     ! 9Нл"
 Нл"еН“Б"ЬЃ6«#6 *ЬЃ##еНл"UяНр"*ЬЃ Нл""ЮЃе!« е!  еН.БББ*ЮЃе!ЂеНBЉББ*ЮЃЊ е*ЮЃђ е*ЂеНяббНє0бНє0! 9Нл" Нл"е*ЬЃеНББ!  Й    !  е*ЂеНь.ББ*Ђе! 9Нл"
 Нл"еН“Б"r‚ Нл"е! еНZБББ"p‚!  е!  еНь.ББ*r‚е*p‚Нр"*r‚##еНл"е*p‚НУ"Нр"! 9Нл" Нл"е*r‚еНББ*p‚ юЪ/ѓ! 9Нл"
 Нл"еН“Б"r‚6я#6я! 9Нл" Нл"е*r‚еНББ!  Й  *3ѓНN"К[ѓ! 9Нл"еНjѓБ#НN"КUѓ!яяЙ! "3ѓ! 9Нл"еНэѓБЙ  !  "Ђ*ЂеНо)Б"%Ђе!яяН:"К ѓ!  е!  еНь.ББ! еНpБ"hѓГуѓ*%Ђе*ЂеН8€ББ#НN"КЅѓ!яя"hѓГуѓ*#Ђе!шѓеН‘ББ"Ђ#НN"Кнѓ!  "Ђ*#Ђе! еН‡ББ"hѓГуѓ!  "hѓ*hѓЙЙRC   :'ЂНж"}2Ђ!: }2Ђ*Ђл*ЂНg"К/„! 9Нл" 6#6 !яяЙ*Ђе!Ђе! еНгБББ#НN"КL„!яяЙ*Ђ#"Ђ+л*%ЂНе"НN"В„!  ЙР„    *f„еНzБ"h„е!яяН:"КЏ„*f„е! еН‡ББЙ*h„е!  ге!'Ђге!	Ђге!
 9Нл" Нл"ге! ге!ј„гйБББББ"j„*h„еНу*Б*j„ЙCPM.OV1       *	Ђ"Ш„! 9Нл"еНw.Б+"Ъ„*Ъ„ Нg"К…! 9Нл"л*Ъ„Не"¤яН2"Н2"К&…*Ъ„+"Ъ„Гф„! 9Нл"л*Ъ„Не"¤яНN"Кc…! 9Нл"л*Ъ„6 ! 9Нл"л*Ъ„++еН­‰Б"Ш„! "Ь„*Ъ„#"Ъ„л! 9Нл"Не"Н2"К©…*Ь„#"Ь„+л! 9Нл"е! 9Нл"л*Ъ„Не"С}Гi…! 9Нл"л*Ь„6 *Ш„Й              ! 9Нл"))KНл"НN"Кг…!яяЙ! 9Нл"))K##Нл""ї…"Б…*Б…* Не"©я|µВ†!яяЙ! 9Нл"ГZ†!Е…Нµ0    Гn†! 9Нл"еНЎ‡б!Е…Нє0Гn†! 9Нл"еНяб!Е…Нє0Гn†!яяЙГn†Нш"†  )† >†   ГS†! 9еН¬0ЕХ!Е…Н¬0НЃ0бНє0! 9Н¬0ЕХЂ   Нv/Н31"»…! 9Н¬0ЕХ!Ђ Н%1Нq/Н31"Ѕ…*ї…* #Не"ЅяНN"КЧ†*ї…$ Нл"ГЪ†!Ђ "Г…! е*Г…еНь.ББ*ї…! е*»…Нр"!! е*ї…еНь.ББ|µК‡!яяЙ*ї…* #Не"ЅяНN"К4‡*ї…* Не"®яНN"Н2"К‡! е*ї…еНь.ББ|µКP‡!яяЙ*ї…( е!Ђ е*Ѕ…НУ"Нр"*ї…& е*ї…$ Нл"л*Ѕ…Нр"*ї…/ е*»…еНs‹Ђ   Н
/бНє0!  Й  ! 9Нл"))KНл"НN"Кѕ‡!яяН%1Й! 9Нл"))K##Нл""џ‡*џ‡* #Не"Ѕя|µВ€*џ‡/ Н¬0ЕХ*џ‡& Нл"е*џ‡$ Нл"НУ"Ђ ХНУ"Н%1Н~0ЙГ'€*џ‡/ Н¬0ЙЙ        њ‰      ! 9Нл""4€*4€|µВb€*НN"К^€! еНpБГa€!яяЙ*4€)еНо)Б".€е!яяН:"КЃ€! еНpБЙ*0€е*.€е*4€еН*БББ"6€#НN"Кі€*.€еНу*Б*0€е!. еН‡ББЙ*.€е*4€еНZЉББ*0€е!Ґ‰еН‘ББ"2€!  "*€*4€л**€Н«"К	‰Гр€**€#"*€ГЦ€*2€е**€)л*.€Нл"еНvББГж€*2€еНЅБ*|µК;‰! 9Нл"е*4€"aе! еН.БББ!  "(€Гx‰*"W*.€"Y*4€"[! 9Нл""]!я"_! "c!Wе!  е!  еНsБББ"(€*.€еНу*Б*6€еН~Б*(€#НN"К‰*(€Г›‰*aЙAMIE.DIR WCD     ! "«‰!  "©‰! 9Нл"Не"ГЫ‰!яя"«‰! 9еНл"#Нр"Ги‰Нш"Ж‰- М‰+   ! 9Нл"Не"0 Нg"КЉ! 9Нл"Не"9 Нf"Н2"К7Љ*©‰
 Н#е! 9еНл"#Нр"+Не"СРя"©‰Ги‰*«‰л*©‰Н#ЙБбСХеЕ+#~·ВIЉЙ        ! 9Нл"л! Н3#"RЉ*RЉяН“"Тj‹ГЉЉ*RЉл! Н3#"RЉГkЉ*RЉ"TЉ! 9Нл"л*TЉНv"Кg‹Г®Љ*TЉ#"TЉГђЉ*TЉе*RЉНУ""VЉ*VЉ ЂН“"Тd‹ГЪЉ*VЉе*RЉНУ""VЉГ»Љ*VЉ)л! 9Нл"Нл"е*VЉл*RЉ)л! 9Нл"Нл"еНZ.ББяН“"Тa‹*VЉ)л! 9Нл"Нл""XЉ*VЉ)л! 9Нл"е*VЉл*RЉ)л! 9Нл"Нл"Нр"*VЉл*RЉ)л! 9Нл"е*XЉНр"ГКЉГ¤ЉГzЉЙге!1ГЂ‹ге!1ГЂ‹ге!%1ЕХе! 9Н¬0бХ”‹Хе`iЙ! 9Нє0бСБЙе!51Г±‹е!31Г±‹е!31ЕХе!
 9Н¬0бНС‹DM! 9^#V#Нє0СБбсЙйЙ            @Ѓ! ! ђ ЂD  Ђ Ђ          !        DB           @    @  Ђ ЂЂ     	" IH H$€   D ! A ђ @!   @  ђ    $ Ђ @ ‘  HЂ  Ђ@     $   Ђ  B"       	  H @Ђ $  @Ђ   @D       $ @ Ђ    @ H@  	 D"€$‰" ђ Ђ  @       I    Ђ !     ђ   D  Ђ  $HI  ’$€$H‚H @  @ H "  " @         ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее                                                                                                                                  GET_ATю ARD_DATю -SEL_PRю VSETDIRю 	:GETFNAю _INPDRVю ZGET_VFю BWT_DATю HWTRECю #DUMP_Bю \BFINITю kEND_ITю !GET_VDю  ZSIEVEю %"OUTDRVю 'CHOOSEю ,#SET_USю 1	DISP_Uю 2tDSK_DIю ?PERASEю HRENю TBGETDIRю c
FNCHEKю fMANDRVю gZSW_CLOю h+SW_OPEю jSIZEFIю r6GETDVю |lDVALIDю ~DV_FROюGET_VAюISFCHRюCHUSERю	 ю…‘СUU dtUEфI@ ЦP        ељ  A@ Л6„Ђ9Y  E@ К±Ш *  1•›D %Wшeљ  
Ё  D іi0 ЉЃ 9D*°”B  9Y  ‚БP (†H   9Y  ‚* @` 2еP  Љ@ rЉЂ +4  pёY  …›\Ђ   е›MА А e›_@ўЄ  еfЂ „  dЖ  2"2’
j,eґ#$¦"©¤ЖT 22Jbr
l` #—F  2:*rj*њ` Јў§&ЈGA 2:*ўъ
¤f$FZ@*Jr‚2$dґ(—FE "Љ:*¤f0ЁЄўЄўЖQЂ2љ*ўj*leШ)¦'§#—FU 2љў’‚Ма  …”‘U`e$EфDI@ Ч     " ”T  9Y  ‚*  ў  rН     e›FЂ¬Р ‚" @0 2Н¤ Q еfЂ E@ " ”B  9Yґ4‚БP (ЄЂ 3@ U €Ь¬Ъ` еP h  НЄ  rН«А` 2Н­аQU rі@ U@  рeµoА   е›]Ђ   e›d@¬ЪJ БP іьF6€@@Л6М AЂ Л6Ц 9ETКНЇА„  dЖR@""zњ` "#) ¦ўЖ  22Jbr
l` #—F  2:*rj*њ` Јў§&ЈFlАAtdH¤§(#"FZ ‰tfp(ЈўЄFnА*ЉЄ*Є,t)"/ў ЄFY@™tdа)Ё)" ўFB@"Єљ*”а  …”СSђаe4TЕх)@ ФФ   P h  КҐ  rН  ¬Р ‚#fР`U" їЯм‘ "   rНў Vh  БdЖF@*rrz¤` "#) ¦ўЖ  *"J’2$` #—F  2:*rj*њ` Јў§&ЈFL@2:*ў2rdґ$G@Ђ2љ*bъ‚”dP)ўЄ"$©N   …”СU‘ e4UDD•)@ ЦL   Ђ    T  9Y  D  9D/чы4  eSЂЂ еЂ Vh  Б`€@ +4  `€Ё ЕЂ
Ё€”UB@¬Р ‚Бі@ UU їЯв*  Г±`  К!І Vh  Б`€Ђ 6ЈЂ2¬( „  V0UV r€@`+4  `°DT ‡bА   ЉЂ 
Ё %’R!Ђ#! 11=2L‘Фг,а№9=R0 ђФWХTг АUI}&0 ‘”ђSQc. %I20 ‘KЈ/`1IJ0  ‘ЛЈ  95N0 QСS“QЈ%а9IJ2‚”СSС’c' M1}J:”СUTЈ.`MA962ј”ФФSЈ' Q=Q}&p  …‘СU““`dtUDdд@ Х¬     Р  ъ2  # фe$ Ў@  Ц*    *љ @@Л4  … ‘°F6 _пцHЁ  r€dЂ@DК!
 ¬Р ‚Б`€Щ  *ЁЂ_пцLµD UF b*¤ +uЉЂ  Л4  fФЂ Ђ ИШC.LEЊ± T2ддхHИ0C.SXTЊЃЂd5ХфE(К°CUR_FIЊ  dDe$ФXЙЁDIRFDЊњЂdd”ДдШКшG.Њ  dtTдФU8А GENMFЋЃ dtUDdдКGETSTRЊ’Ђ$‚иКШSEL_FRЊЉ eDхEфd™А  …’S”• d”еE%i@ ХИµ      ЄЂ 9Y  E@Ђўыэљ  2©H ЄЂ 9D @•љ  0X,‘U r€@ ”B  8Ьў Же‚Ђ–h   ,Ъ‚ гr€@ ”CUЂn–‚Б`€Ё  ЄЃ 9Y  UA $2Ѓ4\O+@“0† љѕ€Ґ8 Иj	«кЄqЂ €Њ¤‚љ‹ HҐС’@
ЊЉ¤Ґc €КHЁ±Ђ Ћ]  Ии©ЙЁЄqЂ 
ЋЉњљЌH IСР`’њ €¤­ ©€Љ
I“Ђ  …‘СU‘‘ dtUEхdi@ Ф@ T  A@ Л4  rі@ &0 ‘”ђSQc  	є0 ‘СS“QTг  95: ‘СUХ‘Ј! 	 є2 УUЈ!ЂERp  …•ХU`euEфDI@ Хм       	h0 Ё  ‚Ђ–h  еfЂ  r€_пцh  К®аЄ НЎА3вХ…QЂT " YґК* @Vh  Б`і@ HЄЃ @А Л6› 9ET›SЂ¬Р ‚БP@U/ ѓ –mU rЉЁ•›OЂ, P@L` "#) ¦ўЖPА2*r"ъJ¤` #—F  2:*rj*њ` Јў§&ЈFZ Ate„¦"«FG@qtdH(ЈўЄF\ *ЉЄ*Є,ed«Є)"ЎЗAЂ2єўъ"
¤а  …UХ‘PаUuE$T9@ Цњ   –Ѓ @@Л4  >-YVЊ B YґЦ*    *”Ђ@@Л6‰Ђ0й` Є‹ЂЁ  „ іi ”T  9ET КН  ,Єњ :ЕT  2"ЁА  rеfУ@XЄЂ Y   Є• 9ET љ  « Ё  uЉЁ  dE[Ђ   еКНЄАQU  fЦЂm^ V°вХ…h    Ќљ  2­  …юяdЛh t B  2c1`	1R2мђ‘•RСc)А	AQJ3.PЛ““Х##@№U1R2ЂђФSQSc  I53&‘STРЈ  	є0 ‘СS“QTг  952ь ’Ј  1Z3 ”KЈ0 	Lє:UХ‘Pз   …‘T•Q dETХф)@ ЧH       P  л  Р  E@Ђ  *з 
Ё E  fЂ * *   ` eљ  Ё  €  P XЄЃ DT  B  9E@ •љ  0X"  К*¦`QU rі@ ‚еP h  КЇа К!  ¬Ъ’ Б`€CЂ+4  `ІD" ”B  9YµИ‚БPpX…  fРаXЉ‚ ¬h ЄЂ 9EUHК* ЂVh  Б`°EV€Ц* Ђ‘° R` €  fТР(ЄНЂ3@   !  1Ђ„€ћ§М ИHЙ€ЁК‘њ`„ЊЁ‚–‹ё €J
ЉQ’ †\љЄ©” ЁeКЁЉСљ † ІљЉ›  И€КH)Ё±Р`€Єљ ѕ… hҐЖЂ Њ’њ‚›  HеСЂ ЋЉњљЉ§  Ёи©ЙЁСњ ђ]» i€ЄС–@њ]{ ©ИИЄJQ”а
ћЄЁЊ‰Й JeС• ¦ ®¤’©E ЉЄhЄSЂ  …ђ‘’S’U d$d”д•I@ Ф„ B  Ђ P   ,Р  D  
Ё8 D іhp €  dЗ@ 22JrJ¤dD!#&"Ј*FA 22ў
Z,dx!(*)F  2"2’
j,` #—F  2:*rj*њ` Јў§&ЈFFАAtdP¦"«N   …QS‘U dTдEф•I@ Хљ  Щ  *‡ _пцHЁ  >-YU  UCАb*. + б–Х2   1& ЌѓL:, Н  6m eT эюЙ–  @ Ldl!#* ҐўЖJЂ"‚ў”dЬЎ—''ЄF  2"2’
j,dМ"*¦Ё/ЎG@ 2*r"ъJ¤` #—F  2:*rj*њ` Јў§&ЈN   …‘СU‘ dtUEхdI@ Х                        P   #d Њl ЂЂ–h   ,ЪN "  H 2Н  @  †Ѓ 9ET К!
 ¬Р ‚Б`€h•›z@"   C@Ђў    еfЂ Ё  >-YVф U@ ўєеfЂ Є¬ ^Зцh  ЪІ Є  еЦ '+4  `°EUфК*  QU  rі@ D2еfЂ ЄЂ 9D5ђ	КНІ б 
Ё  Ш *  QU  rіmўr€dЂ@|К!Ђ¬Ъ” Б`°D  $        "ј` rНҐАVmЛ `ЉДW” Uy@  4  eR 9fЯ@XЄтЂYґа "¤†Y  6ЏЂІ©€ЄтЂ
ДW”‡А   е›D ]b«К fСЂЉ‘юfЂ «ж! ,Ъlл^P ИШ ! ,Ъћл^P ИEфя№D5t	К! ¬Р ‚Б`іj(*ЛЂ€@@Л6®ЂєЕW” 2+іiр•љ  0ElЪрН¤@,«l! ,Ыл^P И­›c \¬Ы БіlЁ6М І®ђ„ іm¬Uy@"±[•љ  0DWЊ UxА  4  a^pUг ЏАР ›mАYWМB  Ї·МB  Ї8 ЄтЂДW”Ц! ,Ы‚fЪ°mиeSђ!Uз €Ї8 ­Ц! ,Ъr€@ЂЛ6ђ:ЕW” 2НЎ@MиI‡~@D   е›J@ќb«О  U  " @3lJ¬Ѓ
Є@ЉсЂ
Ї$ЄS"”Ђ pМ€*‰й1ќђ†\Ћ©€eЙ€±ћP†\©ґЁeЙЙк‘”а*†\Ё¦©TИj	«кЄqЂ €Њ¤‚љ‹hҐЖќ Њ’њ‚›1HеСЂ ЋЉњљЉ§  Ёи©ЙЁСС`ЋЉЁѕ¬‰>IСљр’¦€’Ћ“© ‰*‰и1‘pЉ­; ЙкHи)Й1–0
¦’Љ¬‹¶ КjЉHh*‘—Ђ¦Ё¤† іш КjЉI€©С— ¦Ё¤њ†›Ъ КjЉIИj™`Є¦ЉҐ8  …TТQU‘`U4”UdY@ Ц°       ЉЂ @  P  ‹аюН  Vд‡JЂT F" @¶ Ѓ –h  Н  ‹VB Ђ@*  Г·   rНҐаЪd i?Г'Е«
¬ 0нИ „ іj8”B Yµt›RЂ¬Р ‚С>„„   еКН¬ 6h  +r€@АЛ6ј 3k@•љ  0ElР •hА ` е›a@¶ ‡iЂ"РDъЃ —+6НЂЩµр VГЈаЄ  НІ «>! .VmЇ іm ¬l.Ѓ –mИ fЩа ‹Iю>-XWР B \¬Ы¬ #fЬА[иЂ@  P  ‹фюНўа«>ГўЂ"Є #P [э @ЂЛ6х 3nИ6ЮЂ0©Ё„ іhИ6Ћ „ZOрЛ6ЏЂі@ U>aЩр 9fТђ(„ іj6– №Yµ°‚С>„„   еКН©`ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее"6mо №D ` е›WЂYµ8КН±Ђ[6™ЂІ¬H„ іkX6· °м`„Z hџBB  rеfШ6± ЉШt$[>! ,Ы*6 @ LeЬЎ—''ЄF@@jrўљ¤dШў—Fa R9tfђ$F\ЂrJљ2B”fd(—GA *љJ*І,eH*'ЄЁ("О   …“ХU• dхUDE%i@ ХИµ      ЄЂ 9Y  E@Ђўыэљ  2©H ЄЂ 9D @•љ  0X,‘U r€@ ”B  8Ьў Же‚Ђ–h   ,Ъ‚ гr€@ ”CUЂn–‚Б`€Ё  ЄЃ 9Y  UA $2Ѓ4\O+@“0† љѕ€Ґ8 Иj	«кЄqЂ €Њ¤‚љ‹ HҐС’@
ЊЉ¤Ґ  HеСЂ ЋЉњљЉ§  Ёи©ЙЁС”Ђђ] ©€Љ
I‘Р`ћЄЁ€¤­c КjКHЁіЂ  …ђТСQ“ d4„фх4Y@ Цhюя± 6D  ЃЂ–h  #>-XTА U@ gЕ«*“ 
Ё0•љ  0D/чшЉЂ @ H„& r€BЂ(„  r€@ +4  `°X,U  r€A Л6†Ђ3@ UP YсjВ°аЄ еI Ђ   €H Н  b   2гr€@Ђ”B  8Ьў гt°X,U  џ¬«0 * АVm# `€@АЛ6Ё 
B4 2Ні Vh  БP`(…юяfЂ «¦ ! ,ЫJ )Р  Л6Я 9D @•љ  0X,‘ 9fЬ`YсjВў "Є еI Ђ+0 D$ fЦАXЄё \nQ  гr€@ ”C@А\n–‚#fЂ Є"!їЩ2С 9fЭЂ  ЃЂ–m>-XUtUAЂў0 rН¤ .7(„  q№G@ 4  q№E@ ЌК! ,Ъ`гr€j ЌТБ`°X,KД ЉЁ0”U$ ј ђ›zАb«Ю q№D Ђ е›RА\nQ  гr€l ЌТБ`°Y,’@љ.'•†@	4’E# e !—&Є¦*FB jrrz¤dфЎ—)¬*FP@"B
¤t !¤'§©ўЖNЂr‚jъ"”e!Ё&ЇЄ©Жm )te°#"*"¬*FsЂ*2b*’”e€#&'Ё(,Ж  9teШ$Fj@*b"‚’ddФ&ў§*Ї§ЖTАqtfT)Ё#)"ўО   …”СUTФ e4UEхU9@ ХD     ыьE@АT FН  TьB Y   D6 Љ]b   2НЈ@   UHА#  e›IАR@ 
T !  ў К! ўn еЂЂVh  Б`°X,h  !  Q еfЂ 4  aW`  rі@ 6€ 3k0*Д 3@ эю" `:~НЇ Є  Н  -gшdшµaZ0щю" `:~!  T U@А 04  e\ U Р  Л4  fЧpmА e^аU €Ё ¬#@ ,Ыz еfЂ mt e^°эю" `;Ь Гµ ыэК* `Р •AЂD4 КН  "* !їЬўЄ Н  TpU@А  6Ш 3n
•ЂЉЁ D~ fЂ Ъ:К§Ђ"`КН  "* ГЎ`УрU rі@ ЉЃЂ3@ U dЖ@ b
ўzLdh!—#ЄFJ@brb¤gtЎ—''ЄFcА*rљВ¤e,!¦))Жb@2Є’ъz4eX!Є©/§§FQЂ2"2’
j,e8"$ ¦'ЈЖQ r"Jљ‚ъ¬d8"—FK Z)q„gT#—F  2:*rj*њ` Јў§&ЈFX@2:*ўbJtdР$Fv@2Jљ"J:Ldґ&ў§*Ї§Ж}ЂqtdШ§#"©)GA@2љ*ўъЄњeА)Є)&"§N   …‘ФTФ dD•5хY@ ХИ Bя№D @ ељ  3@ U^ fЂ  К! ¬Р ‚БЂЂ–m	 €П‹V: Ц +4  `°к †µЂ9YґР‚! ,ЪL еЂЂVh  Б`і@  9fФpHЁ  dђI„БT¦E) 
Ґ2)H@  FWА2‚jъЄњt "$©Ё/ЄЖ  9tel$FU 2BJbъz4dH$$¦/§§FG@"jzІ,d0'FSА2‚Єў’Rtdь(*Є)Є)N   „СT dE4µфD™@ Х@                                          P  #і@ U7 ЂА:t ! T8 t  3@ +4  `€Ё  Љ„ Щґ°•WЂ/чшЉЃ 0нH„ і@ [6Ё 2«А Є„ 9Y¶ь‚#fЦph  К°аыьE@Ђv¤CMўzеfЂ ЉЂ 
Ё@ EюfЂ +0Н     Eря€Ё` Є† @ h  Кё Є   ¶Ь›^@TиB  Ё0 Є‡ :ЕTљ  2Ї8 Є„ @ mГ fЬ`U0P (†‰ 9D!@•љ  0X, rіi UAЂb* лPаmе eQа@aТFrі@ Є„ 
ДT ‡t@T0 V"ЎЂ;` Нґа±[”B  9Y  ‚*Ў Е«
ЅЂЉЂ  €( fЦ0+6‘Ђ°ETКН  "ЊеfХРЄH   9Yµґ‚Г°`"© 0qrіkЁљ  3@  ‹•ю>-XVT‡f Xv\ U@ ¬Р ‚НґЂ  E@Ђ4РКН  "Є Й              е›V@E.Vh  Б[P(…юяfЂ «О! Ђ¬Р ‚"·`,:!¦ЂЋQUµr€@АЛ6в №Y  ‚Б[p6» 2ЁР†љ9D"а•љ  0X"+vГЎЂbЄN #џ¬*®!  VдB Y·РЦ*· ,ЫІ КЄаB«r#[ђXҐЦ*¶ !—+6—Ѓ@а Л4  aТ )jёЄЪЂ№D @ е›RАњ¬Р ‚БУ@G(†¤9Y¶@‚Б[Р6Ѓ2¬ђ†љ9D 0•›D ,»aРА1U€П‹VПЂ +r! ,ЪАл[ђm6e\р!U№€­И¬Rл[PЛ•›iА‚/—шe›TЂv€
[ћ!  VдB Y·	Ц*· ,Ы\К Ђb«zе[ђЉЬЂЉЕ.±UµіnР•љ  0X,;Є*· .Vmќ`Љ­ё•љ  0EVФКН  " ’      EHЂД   е›~@™   E¤яџ¬Єь*¤@b1"ЂЂ—+6—Ѓ€Щ·(VН¦@nVh  БЂЂ–mJfХ 3вХ…^АД   е›WЂЖВб 9fЦР1Ш ГҐ@b«&#іkР*ЗЃ€Aа’‚ *@*¤@b1"єЕTЂ›DАYVИB  9YµX‚ГІ b rН®Аb6mafШ@6UОФ°G+6А °XtМB \¬Ыn#fФа1[6ЭЃ№Y¶°‚!  T€B Y·P›w П‹VUR 1Љ‘€@@Л•›{ЂДlЫ°+fЯ7+6р°Xw¤Z.*¤@b1"„_§цmћ mS0AЂ еfСF‹‚KLБ$i$Љ."J@‘    ( W!Ђ ЂЙЁ)‰‰иqћ(†\Ћ©ў€eЙЉ‘›а:†\њћ©A ЁeКk
‘’0J†\Ё¦©Ў€iЉJq‘<†¦ѕЁ±> Иj	«иЉQ—р<† љѕЄ§  И€КH)Ё±Т`€¦–ѕ€“ФHҐСћЂЉ\a€ЁЙ€ЄJQџР*Њ ЄЁ§€КHЁ±ђРDЋ]|Ии©ЙЁЄqЂ 
ЋЉњљЌE ИиЄ€‰*QpЋЉЁ–Љіъ ИиЄЉjЉQђPDђ]„ЙhЙЉЄi“°  ‚Ћ‹RЙЁ©К«йс”Pљћ¬‹Ю©ИИЄJQџЂћ њѕЁ±eК
Є‰К©±њЂ< ЄЁ¦ЁҐ-К
ЄЉЙ(‘ђђDў]dЉiкJ‘ђђ<¦ †ћ§qКj	к©СљаЄњ’њ—8  …QTђTС`TU$4Y@ Ц`                                          P  #і@ U7 …А:t ! Tx t  3@ +4  `€©  Ќ›K UX BяІETђКН  "* еїЯмР •]  •љ  0Y"Є еR@+4  `°DlЪљ КІЂЄ еfЂ эюЙ    2Н  @  ЄКЂCА Л6О ¤Ђ@| B  9D  ”B 9D6°К!  ¬Р ‚Б`°X,Р љ  9Y  "§†O‹VUк P +6ЖЂ0D/чы%љ  B`(„( r€@ („  rі@ ‚БШ0'(†Ж9Y  ‚"  Є| НЁ `хМп7џFT B: FT B  ЁР Љђ 
© ¬UFЂ  *™0кxЄЌ ДTh VГ¦Ђ,Р  "е†O‹V^aУ !U  >-XV@›zАV€ "$ Y¶¤КН  "еfЧP4  R U  ЅЯб‘  P (†ѓ 9D!@•љ  0X,U uЉЁР dь·eRр! rі@ ЉЋ h0•›_@X"Є8 #QА[¬UGЂ  *пЂ€D +4  `°о„@ r€h •љ  0\¬Р ‚БР@+4  `іl*€Ѓ
«PDD іk€•›oАX,:@*  A  2Н аNVm`€lx•›G@"Є@ +R DЩ'+6’Ѓ0ETH"& Yґd	КН¦аL”rіj0U$
   ¬ЪњБfЬ°mО fЦpU rіoU@ ¬Р ‚! ў КНЅ ,„  dђI¤’(ё€I) 
D0 ( 
 С 2¶PSРг/`Q	=N2xЛ‘Х#9а1№1R3фPЛ““Х## 5№MaR3ьТU#= 9!UMJ2АУ”г* 5=9MR2*ђФWСЈ$аA5}UN3v‘”ђSQc8`%1=2М ‘KЈ¤АIM2О”‘Qc  	є2¤‘СS“QTг  952Љ‘СUTЈ+ YQ-f3:‘СUХЈ(@I є2ґ’С“TТ#0 91AA2v“QS•WУг. 9IJ2¬”UХЈ; 9AUQY%2ъ”СSС’c-аYMA1=N2”ФФSЈ6Ђ9MQI1:3¤•ХTc>А9U91%9.p  „Ф‘S 5$Tй@ Фђ                                                                                                 љ  9Y  EC lР •[Ђ/чы$UC ¬Р ‚"ЎАQэюН  V0 B 9Y  ’*ЎАQU rі@ EBЂlЪК КґА:!  T(љ  hА#”CHA¬Р ‚БP P  	 ,Р  EDЂW  " Y· EE 5 EEЂW4 "  Y·P EF UX›V@Ал™Юo>ЊЁРфeOА# фeFАЈ*Ђ *  QA r€BЂ+4  `°X"  EA T0Ц* ЂР •} ЕT8Ц* Ђ–h  Н  W8CJ@ў~ еfЂ †  ЁЂ Є€ ДT@›N@O‹VUЊQ m\€ ЪVВЇА"Є  Н¬а!шљ  3iа*ДЂЉЁЂ Щ~ГЄЂ" К!  ў К!ў@Qееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее0 еfЂ ‚БУр(†”Ђ9Yµ(‚БfЂ 8 еѓ@Vh  Б`€Ё04  P`вХ•uЂXwРBя€Ё0 Єѓ ДTК!Ј@Vh  Бhіkа*€
Ё0 FЌ \ўЄ Ј@–mvrі@ DъaЭА? rі@ Љ„ ДlЫ< КЄАB~ еЌ Vh  Б`ЉЁ  ЊEA bЄ НЅА,Є¦*  QA r€BЂ+6Њ °X,Л€ QU rі@ CFЂ¬ЫТБЂЂЪxК°ЂB~ еС +4  `°Yµь›`Ђ™V CFЂ¬Р ‚#fСа&U џ С• Ђ * * А1 С  Л6ЃЃ¬«¤* А4 rЉЁ0 Њ#FЂ,ЫdС>„vUAЂb* Ј@‘±рUAЂb* Ј@‘° CFЂўxКНҐЂLкцЂ3oЂ  }s;НзС• ЋЂС• Ур(†”Ђ9Y¶Д‚БaЪP1 r€i#•›n , іl(*ЇЃЉЁ•љ  0DT CG ўШКНѕ L†џЂ9D4¤КНЈ lТЃ€iш”CFЂ¬Р ‚БЂР µ`ЂД4ьК! ¬Ъ–Б`ЉЁ  ЊEA bЄ Н­аL«J*  QA r€BЂ+6§0X,m(¶”‡rАЕT F" Ђ±U fШа6UЛP († Ђ9D!@•›h Ш,·,[–Гѕ bЄ #P@XЄ† 3m *шЃЉЁ ”CP@ў КНёАl[вГ¤`"Є  еfУА66ЦЂD („  rіjш‚*ЎАVh  БP IљI"‹€„’ђ ¤C F\А*
bbzd !"'©Ж[@br:¤gh!—&*Fe Єrrz¤gф
Ў—)¬*F\ кrўљ¤dT!¤*©ў©F@вb’њgи!Ё&Їў)F  2‚jъЄњg$!Є©/§ЈFmЂrЄ’ъzt` "#) ¦ўЖh@r"J
bz<eш"—FLЂЪ)q„eшЈ&"©)FcАІ2rB*\dD#)"ўЖrЂ’9t` #ў§&ў©Ж  *:*rj4et#ўЄ"$©Fp@r:*ўbJtg°#ўЄ)Є)FyАAtgЂ&ў§*Ї§Жb *r2*’”uT©"§FZ т’*r
j,fT)ў¦/Ј$Ж~@тљ‚bzњd¤)Ё'Ё"§F_@Іљў’j„e`)Є)!Ё,ЖZ Іљў’b*td*'ЄЁ("О   …‘СUT dtUDD•)@ Х„                                      Є  шь~?ЏЗгсшь~                       U" r€jИ+•љ  0X"*@ #fЂ ЄФ *¤@QА еfЂ $B 9D( •љ  0X"€ EFЂ   ЉЏ C („  rіk‚"Ј pК! ,Р  L >№ќжрЉэюrіl`‚*  b3вХ…pЂ#рфeI w< B  9EVјКНµ@„ іlа  }s;Нб›ь2НЄа«Ю ! TX‡X@D   е›u Ал™ЮoЇЯбђ€< Н  b   2Ђ,Р  "  і@ U!ЂЂ:H! ЂTX B Y·Р L >№ќжрЉэюѓАЪлPЂИЊFНҐЂ.±
  лfЂ ±U fУАX„ fЂ *,-aQ (†’ 9Y·,‚БQ@4  eS°&mњfЮU%їЯв*8 ! ,ЪЊ& \Б{6№ЂІ­ЄгЂДlЫ*Нґ ,«В!  Vh  Б€Ёа ЄЋ @ h  Кє "Є8   –mЊ©б–mЈfЬрUбQАXЉЋ 0н ·„B 9ET`КН­@,Єђ 9ETp F"ЈЂ  rі@ B 9D @ е›r DАл™ЮoЇЯб—+6х °X"Є< #Qаh е  Vm`°D!  ЉЌ 0л„ rЉЁА•›KЂ,h еR +4  `°D" ”B  9Yµ	‚БR +4  `€©  ЄЏ ¬+ *¤@Vh  БїЯоQ  е… Vh  Б`°Y"Є< Й         Q@H¤R)„P  ИЉКA  ИЌ›C „Ал™ ofЭ ТY@ €0 fЫ!0Ц*ўАР ›nЂWњUe ™·L †Яб–m|fЭ0&UсїЯм‘  Y`! "і B  EfЂ…VP"	 \ў«0+YЂ&€e›w „Алюoёб–mеeS 1UЂ ЫvНЅ LЄrГ `b«0    JР€@ љY`!ЉЛ
Ьў«(Ђ.±UіhЁ }sНниHUf …b+0  µ Ґh ЕVXF"ІАB·(ЄКA  Л¬Uf ѓ,ЪВ& \Зу{DъaЦА9m ЄН¬«d*ІАB1–Ќ…В@ Ef …VPFеYЂ!XЉМ4C,Ы$& \ЗуxEАяіi*сЉ¬АD  fТа6m1e^°6ёYЂ € Н®аm*Њ*ІАB1–№EVPFлYЂ Л6гЃ‰ЂЧ1ьЮС>„…V`V"і A›|ЂЪUUeЂ„b+,+rЉ¬ ЌЦ*і A–m
 ®cщЅў}	0иЁ$µUfАO‹VU°Y`!ЉЛ
ЖЕБU–€¬°­К*ІЂLЪpл‚ЂР Ц -иHUeЂ„b+,+rЉ¬ 6І‚:Д  6¶F  ЛDъY`'(†®№Y  ‚!«Ђ®Vm­`єЕVX2"ІАB«,#Y`!XШ !їДV`C@ ¬ЫJБY !U€¬А”UfЂ…b+4СfЂ Є
*і A  rЉ¬АFЂ Y¶К*і@A  fЯF€eў}	
¬РFЂ \ў«0  –mьrЉ¬РFЂ YґLљ  4OЎ!UР  Л”Uf ‚4  2НЈА®QUљР  Л6›іi+DъaЬ°A  Й “I$Qq’R И`‘¦U FWЂў"zњe8Ў— ©¦FW jr
љ”f(Ў—"$«Ft ўr:,gЂ!—&"Жw"rb¤eT!—&Є¦*Fu кrrz¤dЂЎ—*)ЄFEЂjrЄ:¤e!Ё&ЇЄ©Ж  2"2’
j,e ў(!FxАЪ)q„f("©)/¤ ЖY@*2b*’”gьЈ(*Є)ЖPAR9t` #ў§&ў©Ж  *:*rj4u#ўЄ"$©FD RAte)—FYАІљ‚bzњe8)Ё'Ё"§FT@Іљ‚‚Єўfp)Є)!Ё,ЖqA2љў’b*teи*§&$§%О   …‘“ђТRаddд4„T№@ Чt         „ P U €Ё¬B Y   eљ  FTљ  2©ё кѓ 3@  ‹IюfТPm5 eUPХ fТа+4  `і@ UR їЯм– P  ‹ФюН  U” BяІGT›P@‹Vt Ђ ‘U P@U €Ё ¬B Yґh 2НЈАС• fУЂUВ P`mi rіj(›R@VФ uAЂ¶l "Т†Y¶Њ›dЂVь BяІXuи U@Ђ @ eЦ* ЂР •v@  о _пцLg8!—#ўЖlА*rrz¤f°Ў—)¬*FW *rўљ¤` "#) ¦ўЖmЂ)q„t#'!¤"ҐЖbА9t` #ў§&ў©Ж  *:*rj4f$FgА2Jљ2B”а  …“PS‘• dФдE%i@ Х¬±Ђ     †±Ђ9Y  E@Ђўыэљ  2©H †±Ђ9D @•љ  0X,‘U r€@ЂЛ4  q№D  ЌК!  nQP  гr€@ ”CSАn–‚Б`€Ё  ЄЃ 9Y  UA $2Ѓ4\O+@“p† љѕ€Ґ HҐС’@
ЊЉ¤Ґ  HеС“ ђ] ©€Љ
I‘Р`љ‚њ€¤­\ КjКHЁ±”¦®’Ё†‘8  …”ХРУС`e5uф4Дщ@ Ф< B  Ђ P  еfЂ Ld,!¦)ЇЄ,F  9td)«¤Є!¤G@ 2љєъb|d*"N   …”ХУФS e5uфхY@ Х¬                   CXЂў  е‚ Vh  Б`°D@ ”Bяі@ U= Ц („ rі@ ’! ,Р љ  2ЄЂ „ aХ0 )Р  Л6Ў Ђ   Й “I$QqL®T FJЂ)teў—F  "*ВzґdаЈ&"©)F  9ted$FG@2z‚rъўДep)«¤Є!¤GD 2љєъz‚,dЊ*"N   …”Ц‘Q’S e4•¤Td™@ Ц                                                                                     Р КН  "*H #fЂ ЄЖ !їЩ"деЧ°'+4  `°DT  uRАµ8 L >№ќжуиКЃ G@иКЃЂ3@  ‹бюR h  !  Th UI bЄ4 Н  T0	‡mАTh F"Ј@;: Н  .Wшdшµa\`R вХ…@5ш	КН  "© 0   еfЭ04  fЂ +ь2|Z°ЇЂ†3lX Eря€© 6КЂ
Ё ”CA ў КН  ,„@ r€h•љ  0DT`КН  , r€i0•љ  0X"РК!@ ¬Ъ@Б`€Aа(†“ 9Yґи‚Б€АQ& rіj8‚!ЇаNVmЫ `ЉЂ ЊшµaY`ЃrіjиUF /cы4  mX`А еfЂ U rі@ „ё rіlCA ¬ЪЮБР@+4  `„B «4  QаU їПмЪтТєЂ,;’*ЈА± aЫ ё еfЩ0ЯЂ€j@4     4  r€j86м ‰ЂЛ4  bµB(    fЂ V«4  `°ETЂ V"¤ ;Z *¤ЂQU fЂ Є¬!ЇАNVm›`ЉЂ  €( fЂ Vm`€D +6з °ETђКН±`,rіihU$
 єаVmE`іnш6с 3oШ ЄЂ 9Y  B  9D  •›U X,  Й “I$Qq’R €` P( U)‘J@ЛPBDOSЊТЂD2дuHП C.MULTЊ­ T2ддхHЛёC.SXTЊЫЂФ2еE5HИАCHUSERЊ«ЃD4Е%8НАCONSTЊє d5ХфE(ЛCPM_USЊ  dDe$ФXИ E.ЊуЂ¤rиКHGENMESЊ  TtTдФhКђGETDIRЊЄdtUDґUИPGETSTRЊ”Ѓ$‚иПpHU.BLЊЁЃdґdЕU4€ПИL.MULЊшЂdЕtXПрLPUTNUЊ–ЂдФґd4(ЙMENU_OЊћЃeUDеTШКhPUTSTRЊљЃeUEd”HНX
S.ЋҐ e4•¤TdКрSPCLOSЊ¶ e5хTиНSTRLENњ   …QСU TtUDEi@ Х„              XB  9D ` ељ  3@ U$ їЯм‘P еЃЂ–m r€@ („  rі@ ‚БP U r€i€”CVАЬ¬Р ‚Б`€Ё0 Ќљ  2«ш „ іih”B YµЊ R  ,ЪЦ  Ђ-иI‡TАY   Єѓ 
B4Ф 2Н®`* *Ў`Р  шµa]pP  |ZІееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее®0 „ іlX”B
 Y¶ КН  ,6¬Ђ2® …юяd°о  Є†Ђ9D!p•љ  0X,–SP°(Є…Ђ3l •љ  0Z'РђЄ…Ђ3nш•љ  0O‹VU‚ –m° rЉЁX6цЂ4OЎ&SPР P°m°_б“вХ•K ET, F"Ў`:&*Ў`Q( 9fЯаmhџBBЄ е…АVmП `°ET, l?їЯм™jµLB  9D Ђ е›M@Yґl•^ЂD Ђ е›W \¬Ъp}{ниHB  2D   ЉЂ 
Ё”CQАўјеfФр‚" А6h  К§АbЄ )Шp Л6ґЂіkhE¬яџ¬+x!?ДT‡NАЕT Rґ !–mҐfЪЂвХ•y@ET Rё !–mЕrі@ Љ‚ 0йШ…юяP@U іmР*’€A@Л6м „C` И¤"  Y·иD  
¤‡@E$ Ў B К!  ўК!ЎаNQ еfЂ ‚БfЂ Р  CB ўКН  ,вХ•UА™   „  P@эю"  :HНЁАB еfЂ вХ…\ „   Љ‚ 0й к„ 3@  ‹Yю>-XV Bю€Ё ’€@  P@ € Н  VњUA 4  2Н№ ,Ы.Нґ L«¦* Ђ1 „h@ e›hЂњ¬Р ‚Нѕ ,« !їДT‡tАv8Bя№ETљ  2ЇX†„ 9Y·p‚" ЂыэК* ЂЪѕВ  bЄ   ¶T	›j T@UA #р4  fР 6U!ѓ Vh  БP@л„АQP еЂ Q  еfЂ ѓ-;aФ@1  " Ђ0 rН АNQU fЂ Є  Й"‡Cр¬ *“ЂћP(‚Ёћ“я€eИк‘ђа8†\©ВЁeЙЙк‘—@*†\¦°©5€i*‘ђА,† љ¦Ћ§XИjЄKйиС’а,†Є¤ѕћќИ€КH)Ё±’`,€’‚ћЏс ИЉИ)‰(‘›@€¬ѕЊ¤џуHҐС‘6Љ\aFЁЙ€ЄJQ–рЊћ  іЌИЙИЉjк‘› $Ћ]  Ии©ЙЁЄqЂ 
ЋЉњљЌ ЁиЄ€ЉС“А,ЋЉЁ’ќЂ ИиЄ‹кИ1”ђ4ђ]ѕЙ*h‰(й1“,–ЊЄ¦‘ЫIЕС‘°:њЊЉ¤ҐPJ%С“ђ¦ЉЁ¦®©_КjЉI€©СP¦®њ‚љ‹ФКjкИ)Љqћ0ЁћЄ  ‹њ КИ)€ЉJУЂ  …‘ђSQ dEdД”I@ Х   Ђ *  *  ђ€  fЂ Е«*ћЂ
Ё  ЊE@ bђЌ іh€”B Y  4  eS  ЙaРЂ  ЙЊ  dDe$ФXиDVALIDЊЂ$RиЙpG.Њ  dtTдФU8А GENMFЊ“ $‚иЙVALDRVњ   …‘‘”“Ф dEeфe$щ@ ФЬ           Ѓ –h  |ZІЁа ЄH0   0иш ЄH,EА@  …иrі@ ЉЃ Ё ”Bяі@ UC Ђ@Vh  Бd€@  Ђ@* * Ађ€  fРрвХ•}ЂT  F"Ў ±HFђ \ўЄ Н  T RЄЂ–mX ¬Яб–h  К±А© а aЩTђhДЂЁ  ЄЃ 9ET F" Ђ¶h  С>„Џ‹VU¶ P ЉЃ 
ШvP U@Ђb* +T F" @·(Єѓ 
B5а 2НЇЂиHU@Ђb* +…T F" @±° UAЂb* +aФрU №D  •љ  0X"* *  Vh  БPЂ6БЂ2Ёи…юяd€@@Л6й 9ET  R№А–m"hџBB “ЁeЙЙк‘р† љ¦Ћ§i И€КH)Ё±Р €¬ѕЊ¤џ5 HҐСљЋ] Ии©ЙЁ©СЂ ЋЉњљЉ§  Ёи©ЙЁС’ађ]? ©ИИЄJQ—ў]' Кj)‰‰сђА¦ Њ¤Љ‹*КИ)€ЉJУЂ  …‘ХђS dtUEхd@ Хь        ЉЂ @    ±U fЂ ЄЊ ГҐ`Є #P [€ 
Ё  ЊE@ bђ€  rЉЁ D‚ і@   fЂ Е«*° 
Ё  ЊE@ bђЌ5 Ќ‰ў1° U@ !°  c` ЄЂ ¬Єц !  uш BяІc# №R0 ‘”ђSQc" 1=AAf0  ‘ЛЈ  95N0 QСS“QЈ ЂQ}Y2Ћ’TЧУQЈ( 	Dє2К•ђS•§   …’TСђТ d•4d4…)@ Ц D'
ЕѓЎШр|=—ЕА  „ і@  €Ђ Н  T° B YґP "Z 3@ h  К¦А ’! ,ЪH _џЩ  JҐ @ H…юяPРU €Ёh EжfФХ PР Ќ  іiШ”B Yµ љ  2«а „  d°кЂ „ dЖFЂ"r:,dЁ!—&*FVА*rўљ¤` "#) ¦ўЖ\А)tdґў—F\ 9t` #ў§&ў©Ж  *:*rj4t<$©Ј!¤)N   …ђТTСT d4…U4U)@ ЧЊ       P  "   rН  ¬Р ‚+P U ЂЂР •OЂ   е›D@bЄ fЂ #ь2Н  ґр•SЂT V" @:8 ! ,ЪZ лP  Л6љЂTЏрЛ4  eX° 9fХ0XЄЃ FА 9fЦАXЄЃ Eb·+4  `€Ё  „ P@U €Ё¬B Yµи 2Н«`Ъ~ Кє Є #P@[¬B Y¶x 2еЃ –mё uЉЁ e›hЂ'Р“ИЂ@@Л6аЂ:ЕT 26 
Ё &3
UТc$`№12ДPЛ““Х# А!UMJ2ђФWХTг4 ёВ3’ ‘ЛЈ:А	 є2*”Х“S§   ћU €Ёh EжfФХ PР Ќ  іiШ”B Yµ љ  2«а „  d°кЂ „ dЖFЂ"r:,dЁ!—&*FVА*rўљ¤` "#) ¦ўЖ\А)tdґў—F\ 9t` #ў§&ў©Ж  *:*rj4t<$©Ј!¤)N   …ђТTСT d4…U4U)@ ЧЊ       P  "   rН  ¬Р ‚+P U ЂЂР •OЂ   е›D@bЄ fЂ #ь2Н  ґр•SЂT V" @:8 ! ,ЪZ лP  Л6љЂTЏрЛ4  eX° 9fХ0XЄЃ FА 9fЦАXЄЃ Eb·+4  `€Ё  „ P@U €Ё¬B Yµи 2Н«`Ъ~ Кє Є #P@[¬B Y¶x 2еЃ –mёееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее                                                                                                                              Copyright Timeclaim Ltd 1989 05.2004.01  DEVELOP _У                                                                            ГЋЂ                                                                                	                                   !вѓе!Ђе! еН*БББ"JЂ#НN"КёЂ!вѓе! еН‡ББЙ! 9Нл"еН‰†Б"PЂ#НN"КСЂГ±ѓ! 9Нл"еН†Б"PЂ#НN"КкЂГ±ѓНj†!  "DЂеНЌ…Б! 9Нл""LЂ+НN"К)Ѓ:AЂНж"& }жпoїяе*µНX"К)Ѓ! "LЂ!  "FЂ*FЂ#Н2"К™ѓ*LЂ)RЂНл""HЂ!  "NЂ*HЂл*NЂНv"КЌЃ*NЂ)1е*LЂ Н#XЂе*NЂ#"NЂ+)СНл")ЂНл"Нр"ГMЃ*HЂе!1е! еНд†БББ"FЂ! е!  еНь.ББ"NЂ! е!  еНь.ББ! е*NЂеНь.ББНѕ'*HЂ+е*FЂН:"КгЃ!яя"FЂ*FЂ#Н2"К–ѓ*FЂГnѓ!  е!  е! 9Нл"еНыѓБББГ–ѓ!  е! е! 9Нл"еНыѓБББГ–ѓ!  е! е! 9Нл"еНыѓБББГ–ѓ!  е! е! 9Нл"еНыѓБББ"DЂГ–ѓ!  е! е! 9Нл"еНыѓБББГ–ѓ!  е! е! 9Нл"еНыѓБББГ–ѓ! е! е! 9Нл"еНыѓБББ#НN"К¬‚Г–ѓ! е! е! 9Нл"еНыѓБББ#НN"КМ‚Г–ѓ! е! е! 9Нл"еНыѓБББ#НN"Км‚Г–ѓ! е! е! 9Нл"еНыѓБББ#НN"КѓГ–ѓ! е! е! 9Нл"еНыѓБББ#НN"К,ѓГ–ѓГ–ѓ! е! е! 9Нл"еНыѓБББ#НN"КOѓГ–ѓ! е! е! 9Нл"еНыѓБББГ–ѓГ–ѓГ–ѓНш"уЃ  ‚ %‚ >‚ Z‚ s‚ Њ‚ /ѓ   ГhѓГ/Ѓ!яяе!  е!  еНыѓБББ!  "PЂ*JЂеН~Б! е!$ еНb(ББ!кѓеН„'Б!  е!  еНь.ББНѕ'*PЂЙCPM.MS1          яя|…„…  ! 9Нл"#|µВ#„*уѓ#|µК„*щѓеНу*Б!яя"уѓ!  Й! е! е!  е!  еН!ББББ*уѓе! 9Нл"НX"К…*уѓ+|µВz„*щѓе*µ Н#л*S-ге! ге!  ге!w„гйБББ*уѓ#|µК‹„*щѓеНу*Б! 9Нл")хѓНл"еНzБ"щѓе!яяН:"КЖ„! 9Нл")хѓНл"е! еН‡ББЙ! 9Нл"+|µВ…*щѓе*µ Н#л*S-ге!  ге!  ге!ц„гйБББ#НN"К…!яяЙ! 9Нл""уѓ! 9Нл"|µВP…*щѓе! 9Нл"ге!Ђге:AЂНж"ге*DЂге! 9Нл"ге!G…гйБББББЙГ{…*щѓе*µ Н#л*S-ге! 9Нл"ге!  ге!w…гйБББЙЙCPM.OV2 AMIE.012 !яяе! 9Нл"НX"Кл…Н(! е!$ еНb(ББ! 9Нл"##|µВЗ…!п…еН„'БГа…!ш…еН„'Б! 9Нл"е! еН(‡ББН(! 9Нл"Й*DЂЙALL USER USER   b†    !b†еНzБ"†е!яяН:"К(†!b†е! еН‡ББЙ*†е! 9Нл"ге!AЂге!  ге*?Ђге!  ге!N†гйБББББ"†*†еНу*Б*†ЙCPM.OV1 !  "?Ђ*BЂеН~БЙ                !Ы†е!y†е! еН*БББ"BЂе!яяН:"К¶†!Ы†е! еН‡ББЙ! 9Нл"Н2"КЙ†! ГМ†! )y†Нл""?Ђ!  ЙAMIE.SWT ! 9Нл")ЅНл""W! 9Нл""Y! 9Нл""[! "c"_!Wе! е!  еНsБББЙ  ! "&‡! 9еНл"+Нр"#юН“"ТS‡*&‡
 Н#"&‡Г.‡! 9Нл"|µВl‡*&‡л!
 Н3#"&‡! 9Нл"л*&‡Нw"К•‡!  еН)Б*&‡л!
 Н3#"&‡Гl‡! 9Нл"еНў‡БЙ! 9Нл" ЂН“"ЪМ‡!- еН)Б! 9е! 9Нл"НЭ"Нр"! 9Нл"цН“"Тп‡! 9Нл"л!
 Н3#еНў‡Б! 9Нл"л!
 Н3#л0 еН)БЙ                  €  H  "ЂH" @ђ   ‚@‘	H  	 @ @  B$	      ‚@     ђ  ђ  ђ  ђ  ’  @  A$""""Ђ ђ  Ђ  Ђ Ђ ђ    $   $  @   $     H B            @    Ѓ H   @ЂЂ        Ѓ             @ H  @        еН)Б*&‡л!
 Н3#"&‡Гl‡! 9Нл"еНў‡БЙ! 9Нл" ЂН“"ЪМ‡!- еН)Б! 9е! 9Нл"НЭ"Нр"! 9Нл"цН“"Тп‡! 9Нл"л!
 Н3#еНў‡Б! 9Нл"л!
 Н3#л0 еН)БЙ                  €  H  "ЂH" @ђ   ‚@‘	H  	 @ @  B$	      ‚@     ђ  ђ  ђ  ђ  ’  @  A$""""Ђ ђ  Ђ  Ђ Ђ ђ    $   $  @   $     H B            @    Ѓ H   @ЂЂ        Ѓ             @ H  @ ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееCP/M Utilities - 
Directory of files on the disc
Erase files from the disc
Change name of files on the disc
Return to Utilities menu
Number of files = 
 or <Esc> to return
Directory of files on the disc
Return to Utilities Menu
Rename File
Current name is
Specify CP/M source drive
Specify Destination CP/M drive
Hard disc drive
Memory drive
Press 'Y' to erase any other to abort
Now enter new name, ESC aborts
- *** ERASED ***
Press ESC to abort
Erase complete
CP/M Source utilities
CP/M Destination utilities
List filesizes
Sorted directory of files on disc
Format disc
Verify disc
- *** UNABLE TO ERASE ***
Set Source User Number
Set Destination User Number
Please type new User Number (0 - 63 or '*')
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее ‹
                                                                                                                             Copyright Timeclaim Ltd 1989 05.2004.01  DEVELOP _У                                                                            Г,Ђ                                         ! 9Нл""'Ђ! 9Нл"уя|µВJЂНєЃЙ! 9Нл"ГpЃ*'Ђ 6#6 *'Ђ 6 #6 *'ЂеН%€Б#НN"КЂ!яяЙ!Ђе:)ЂНж"С}!Ђ6:ГќЃ*Ђ|µКБЂ!  е*#ЂеНь.ББ*ЂеНЅБ!  е!  "ЂеНь.ББГќЃН¤Ѓ"*Ђе!яяН:"КШЂ!яяЙ**ЂеН#„Б#НN"КлЂ!яяЙ*'Ђ Нл"е**ЂеНББГќЃ!  е*#ЂеНь.ББ!Ђе!ЎЃеН‘ББ"Ђ#НN"КDЃ!  е!  "ЂеНь.ББ!Ђе!0 еН‡ББЙ!  е!  еНь.ББГќЃНЁѓГќЃ*'Ђ 6#6 !яяЙГќЃГќЃНш"TЂ  ”Ђ ”Ђ ”Ђ ”Ђ ”Ђ ДЂ	 Ѓ
 TЃ ZЃ   !  ЙWB *'Ђ
 Нл"еН“БЙ      *'Ђ
 Нл"еН“Б"¶Ѓе!яяНX"К+‚*¶ЃНл"#|µВъЃ*'Ђ Нл"е*¶ЃеНББНЙѓЙ*¶Ѓ Нл"е*¶ЃНл"еН1‚ББ"ёЃ*'Ђ Нл"е*¶ЃеНББГєЃ*ёЃЙ  ! 9Нл"|µКТ‚! 9Нл"л*ЂН¬"КX‚! 9Нл"Г[‚*Ђ"/‚! 9Нл"е*Ђе*/‚еНќ-БББ*Ђл*/‚"Ђ! 9еНл"л*/‚Нр"*Ђе*/‚НУ""Ђ*Ђл*/‚"Ђ! 9еНл"е*/‚НУ"Нр"*Ђ|µВП‚НЬ‚#НN"КП‚!яяЙГ1‚!  Й      *Ђл!Ђ Н.#"Ш‚Н2"К¤ѓ*Ш‚Ђ Н#"Ш‚*'Ђ Нл""Ц‚"Ђ*Ц‚л*Ш‚"Ц‚!  е*#ЂеНь.ББ*Ђе*Ђе*Ш‚еНZБББе*Ш‚НX"КUѓ!  е!  еНь.ББ! еНpБЙ!  е!  еНь.ББ*Ђл!Ђ Н.#л"Ъ‚"Ђ*Ц‚е*Ђе*Ъ‚еНќ-БББ*Ђл*Ъ‚"Ђ*'Ђ Нл"е*ЂНУ""Ђ!  Й!  "Ђ*'Ђ Нл""Ђ*'Ђ Нл""ЂЙНЬ‚#НN"КЧѓ!яяЙ*Ђ|µК	„*Ђ#"Ђ+ЂяЪыѓ*Ђ#"Ђ+6ГЯѓНЬ‚#НN"К	„!яяЙ!  Й                      *'Ђ 6Ђ#6 ! 9Нл" Нл""„‰ Не""%Ђ!„е*„е! еН‰.БББ!„еНц„Б"#Ђ!„е!ЂеНw†ББ*!Ђ|µКК„*„е!j†еН{ЉББ*#ЂцН“"Ъў„*„е!o†еН.ББ*#Ђе*„е*„еНw.БСеНЕ‰ББ*„е!q†еН.ББГП„*„6 *„е*„еНw.БСе!Ђе! еН‰.БББ!  Й      !  "р„! 9Нл"еНw.Б+"т„*т„  Нg"К.…! 9Нл"л*т„Не"¤яН2"Н2"К>…*т„+"т„Г…! 9Нл"л*т„Не"¤яНN"К †! 9Нл"л*т„6 ! 9Нл"л*т„ъяе!j†е! еН,,БББНN"К¤…! 9Нл"л*т„++Не"еН­‰Б+НN"Н2"КГ…! 9Нл"л*т„+Не"еН­‰Б+НN"Н2"КЯ…! 9Нл"л*т„++еН‰Б"р„*р„  Нv"Вф…*р„? Нw"Н2"К †!  "р„!  "ф„*т„#"т„л! 9Нл"Не"Н2"КF†*ф„#"ф„+л! 9Нл"е! 9Нл"л*т„Не"С}Г†! 9Нл"л*ф„6 *!Ђ ЂН“"Тf†*!Ђ"р„*р„ЙUSER 0 \     !  "s†!  "u†*u†шН“"Ъ,‡Гќ†*u†#"u†+Гѓ†! 9Нл"Не"|µВµ†! "s†Г,‡! 9Нл"Не"Тя|µВЛ†Г,‡! 9Нл"е! 9Нл"Не"еНР#БС}! 9еНл"#Нр"+е! 9Нл"Не"еН ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее€Б+НN"К‡! 9Нл"Не"Г‡!- С}! 9еНл"#Нр"+Г’†*s†НN"К€! 9еНл"#Нр"+6.! 9Нл"Не"Тя|µВg‡! 9еНл"#Нр"+ГD‡!  "u†*u†эН“"Ъ€Г‡‡*u†#"u†+Гm‡! 9Нл"Не"НN"ВЁ‡! 9Нл"Не"ТяНN"Н2"К±‡Г€! 9Нл"е! 9Нл"Не"еНР#БС}! 9еНл"#Нр"+е! 9Нл"Не"еН €Б+НN"Кь‡! 9Нл"Не"Гя‡!- С}! 9еНл"#Нр"+Г|‡! 9Нл"6 !  Й‰€    *€еНzБ"!€е!яяН:"КH€*€е! еН‡ББЙ*!€е! ге!)Ђге!!Ђге!
 9Нл" Нл"ге!  ге!u€гйБББББ"#€*!€еНу*Б*#€ЙCPM.OV1 "'*+,:;<>=?_.  ! 9Не"  Нf"ВЅ€! 9Не"Z Нw"Н2"КЗ€!  Й! 9Не"їН“"ТЫ€! Й!яя"ћ€*ћ€#"ћ€уН“"Ъ‰*ћ€‘€Не"е! 9Не"Н:"К‰!  ЙГб€! Й    ! "‰!  "‰! 9Нл"Не"ГF‰!яя"‰! 9еНл"#Нр"ГS‰Нш"1‰- 7‰+   ! 9Нл"Не"0 Нg"Кv‰! 9Нл"Не"9 Нf"Н2"Кў‰*‰
 Н#е! 9еНл"#Нр"+Не"СРя"‰ГS‰*‰л*‰Н#Й! 9~!  ю0Шю:Р,Й        ! 9Нл""ї‰  Нv"Кб‰*ї‰НЭ""ї‰! 9Нл""Б‰"Г‰*Б‰#"Б‰+е*ї‰л!
 Н3#л0 С}*ї‰л!
 Н3#"ї‰|µВо‰! 9Нл" ЂН“"Ъ5Љ*Б‰#"Б‰+6-*Б‰6 *Б‰+"Б‰л*Г‰Н«"КsЉ*Г‰Не""Ѕ‰*Г‰#"Г‰+е*Б‰Не"С}*Б‰е*Ѕ‰С}Г:Љ! 9Нл"ЙБбСХеЕ+#~·В‚ЉЙ       Ђ    D   @" Ђ@ЂD Ђ  H 	€€€€Ђ   ЂH € @$ $ €"  D"  ђ @ ‚@$$DD ‚    $D Ђ$ BD€$      HЂ"DB"	€ЂHD Ђ      $ Ђ @ Ђ @ @ Ђ"@$ A€ D   ‚$Ђ $H€ H        ЂЂ      	 ’"   Ђ        @ Ѓ H  Ђ   	         ‘ ’  Ѓ  ‚ "       HЂ    Ђ$€@   $A€$! €   @ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее ш                                                                                                                             Copyright Timeclaim Ltd 1989 05.2004.01  DEVELOP _У                                                                            Г·Ђ                                                                                                                                                                                ZЃ  *іЂе!SЂе! еН*БББ"±Ђ#НN"КбЂ*іЂе! еН‡ББЙ!
 9Нл"е!
 9Нл"е!
 9Нл"е!
 9Нл"е!
 9Нл"еНТ†БББББ"µЂ*±ЂеН~Б*µЂ#НN"К*Ѓ!яяЙ! 9Нл"Нл""ЇЂ! 9Нл"Н2"КVЃ! 9Нл"Не"еН§ЃБ"µЂ*µЂЙCPM.MS1                                   І† ???????????                     *„Ѓе!»†еН‘ББ"‚Ѓ#НN"КМЃ*„Ѓе!0 еН‡ББЙ! е!Ђ еНь.ББ! "|Ѓ!  "ЂЃ! е!  еНь.ББ"zЃ! е! 9Не"& }жпoїяеНь.ББ*ЇЂ##|µВ$‚!? }2†ЃГ1‚!  е*ЇЂеНь.ББ! 9Не"& }жпoіяНN"КQ‚! "xЃГГ‚! 9Не"& }жпoїя Н#л*O- Нл" Н«"Кѓ‚! Г†‚! "xЃ! 9Не"& }жпoїя Н#л*O-##Не"л!Ђ лНМ"л*xЃН#л! Н№""xЃ*|Ѓе!†ЃеНь.ББ"vЃ#Н2"КќѓНюѓНN"К‡ѓ!яя"~Ѓ! 9Не"& }жoН2"Кѓ*ЇЂ##Н2"Н2"КCѓ!bЃеНw.Б+"~Ѓ*~Ѓ  Нg"К3ѓ*~ЃbЃНе"¤яН2"Н2"КCѓ*~Ѓ+"~ЃГѓ! е*zЃеНь.ББ*‚Ѓе*~Ѓ#"~ЃbЃеНvББ! е! 9Не"& }жпoїяеНь.ББ*ЂЃ#"ЂЃ! е!Ђ еНь.ББ! "|ЃГГ‚! е*zЃеНь.ББ! е*‚ЃеНRББ!  е!  еНь.ББ*‚ЃеНЅБ"‚Ѓ*ЂЃ|µВтѓ*„ЃеНЄ,Б!яяе!  е! еНзБББЙ*ЂЃЙ        *vЃ)))))Ђ "цѓ	 #Не"& }жЂoН2"В4„*цѓ Не"& л*xЃНf"Н2"ВI„*цѓНе"& яНN"Н2"КS„!яяЙ!bЃ"шѓ! "ъѓ!  "ьѓ*цѓ	 е*ъѓ+"ъѓСНе"& }жoаяНN"К’„*ъѓ  Нg"Н2"К›„Гe„*ъѓ ЂН“"Т…! "ьѓ*шѓ#"шѓ+е*цѓ	 л*ъѓНе"& }жoС}*ъѓ+"ъѓ ЂН“"Т…*шѓ#"шѓ+е*цѓ	 л*ъѓНе"& }жoС}ГО„*ьѓ|µК…*шѓ#"шѓ+6.! "ъѓ*цѓ#е*ъѓ+"ъѓСНе"& }жoаяНN"КD…*ъѓ  Нg"Н2"КM…Г…*ъѓ ЂН“"ТЁ…*шѓ#"шѓ+е*цѓ#л*ъѓНе"& }жoС}*ъѓ+"ъѓ ЂН“"ТЁ…*шѓ#"шѓ+е*цѓ#л*ъѓНе"& }жoС}Гw…*ЇЂ|µК†*шѓ#"шѓ+6\*шѓ#"шѓ+е*цѓНе"л!
 Н3#л0 С}*шѓ#"шѓ+е*цѓНе"л!
 Н3#0 С}*шѓе!ѕ†еНВЌББ!ѕ†еНw.Бл*шѓ"шѓ*шѓ#"шѓ+6 !яя"ъѓ!bЃеНw.Б"ьѓ*ъѓ#"ъѓе*ьѓ+"ьѓСНw"К®†*ъѓbЃе*ъѓbЃНе"е*ьѓbЃНе"СС}*ьѓbЃе*ъѓbЃНе"е*ьѓbЃНе"НУ"С}*ъѓbЃе*ъѓbЃНе"е*ьѓbЃНе"НУ"С}Г-†!  ЙAMIE.DIR WC RESU              Љ!  е! 9Нл"Н:"Кз†!яяЙ! е! 9Нл"е!Ђе!+ЂеНЄББББ"Е†*Е†е!Ђе!ЉеН+БББ"Й†#НN"КB‡! 9Нл"е! 9Нл")іНл"A С}Г€Н ‹*Й†)+ЂНл""О†*О†Не"|µВљ‡*ЏЂ|µК‰‡!
 9Нл"е!
 9Нл"еНoЉББ#НN"К†‡!яяЙГ—‡*Р†е! еН‡ББЙГ€*О†е*О†Не"еНР#БС}*О†Не"еН&ЉБ|µКР‡! 9Нл"е*О†Не"С}Г€*Р†"О†*О†Не"Бя|µКп‡*О†#"О†ГЦ‡*О†е!
 9Нл"Не"С}*Р†е! еН‡ББ*О†6?!яяЙ!  е! 9Нл"Н:"К=€! 9Нл"еНе"}цoС}!  Й!  "Г†*Е†е!Ђе!!ЉеН+БББ"Й†#Н2"КЉ*Й†)+ЂНл"Не"Ця|µВ€!юя"З†Гю‰*Й†)+ЂНл"Не"|µКЁ€*Й†)+ЂНл"еНЌБ"З†Гю‰!яя"З†*З†#НN"Кз‰!
 9Нл" )SЂНл""1*ЌЂ"3!  е!  е! е!1е! еНWБББББН(НР!Л†е! еН!ЊББ|µК‰Н&(!  "З†!яя"Г†Гз‰Н&(!Л†еНw.Б|µВ3‰!  "З†Гз‰:Л†Нж"Ця|µВK‰!юя"З†Гз‰!  "З†*З† Нv"Кj‰*З†Л†Не"Н2"Н2"К–‰*З†#"З†+Л†Не"еНІЌБНN"К“‰!яя"З†Г–‰ГQ‰!яяе*З†НX"К®‰!Л†еНЌБ"З†!яяе*З†Н:"ВД‰*З†  Нv"Н2"ВУ‰*З†? Нw"Н2"Кд‰! еНpБ"З†Г®€! е! е!  е!  еН!ББББГЉ!  "З†! 9Нл"е*З†Нр"*Г†ЙDV:? DV UN   !  "$Љ*$Љ)ЏЂНл"|µКaЉ*$Љ#"$Љ+)ЏЂНл"е! 9Не"Н:"К^Љ! ЙГ,Љ!  Й          ! 9Нл"|µКЃЉ*kЂГ„Љ*iЂ"1!феНо)Б"gЉ"eЉе!яяН:"КЁЉ! еНpБЙ!  "kЉ! "mЉ*kЉ)ЏЂНл"|µК[‹*mЉ#"mЉ+)1е*gЉНр"*kЉ)ЏЂНл"іяНN"КуЉ*oЂГцЉ*mЂ"iЉ*gЉе*iЉееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее#"iЉ+Не"С}|µК‹*gЉ#"gЉ+ГщЉ*gЉ#"gЉ+6 *gЉ#"gЉ+е*kЉ)ЏЂНл"С}*gЉ#"gЉ+6:*gЉ#"gЉ+6 *kЉ#"kЉ+ГґЉ*mЉ+е!  еН»!ББ"mЉ*eЉеНу*Б*mЉ#НN"К‚‹!яяЙ! 9Нл"е*mЉ)ЏЂНл"С}!  Й    !  "њ‹! "ћ‹*іл*ћ‹Нv"Кв‹ГЗ‹*ћ‹#"ћ‹+Г¬‹*њ‹#"њ‹+)ЏЂе*ћ‹A Нр"Гј‹НТЌ|µКь‹*њ‹#"њ‹+)ЏЂ6M#6 *њ‹)ЏЂ6 #6 *њ‹|µКЊ!  ГЊ!яяЙ      ! 9еНл"+Нр"! 9Нл""Њ!  "Њ*ЊеНо("ЊС}*Њ  Нv"В_Њ*Њ Нg"Н2"КйЊ*ЊГНЊ*Њ+"Њ#|µВ{ЊГ-Њ*Њ+"Њ!ЌеН„'БГжЊ! 9Нл"6 *Њ+"Њ#|µК®Њ!ЌеН„'БГ–Њ*Њея|µВѕЊ! ЙГ-Њ*Њ6 !  ЙГжЊНш"kЊ kЊ ЌЊ –Њ БЊ   ГЌ! 9Нл"л*ЊНv"КЌ*Њ#"Њ+Не"еН)Б*Њ#"ЊГ=ЊЙ      ! "Ќ!  "Ќ! 9Нл"Не"ГKЌ!яя"Ќ! 9еНл"#Нр"ГXЌНш"6Ќ- <Ќ+   ! 9Нл"Не"0 Нg"К{Ќ! 9Нл"Не"9 Нf"Н2"К§Ќ*Ќ
 Н#е! 9еНл"#Нр"+Не"СРя"ЌГXЌ*Ќл*ЌН#Й! 9~!  ю0Шю:Р,ЙБбСХеЕ+#~·ВЙЌЙ! еНпЌБ. |жg|µКлЌ! ГоЌ!  Й! 9NН Й                      D $         DЂ        DЂ       @ђ   Ђ     Ђ     $@ H Ђ  HЂI  ‘ @"$    "  H Ђ B@   Ђ  ђ ЂH ‚	  ђ$	ЂЂ €€@@ HHЂHD  $ I ‘@ DD! !"„  " HЂH	$„Ђђ! $ $$Ђ    @   @	 @Ђ   I$„  Ђ@ђ HЂ$Ђ	@       $DD D HЂ‰Ѓ  Ђ    ЂЃ ‚A A$ A ђ	 "  A$$D$ H Ђ   ‚ A   !  @Ђ  $ђ H   " 	$‘"$A€ €"$  Ђ  ’"D! HH„ ‚   	Ђ	$A$H €$Ђ@ђDD@ЂHЂђ  Ђ !     ђ   D    ЂЂ                D $         DЂ        DЂ       @ђ   Ђ     Ђ     $@ H Ђ  HЂI  ‘ @"$    "  H Ђ B@   Ђ  ђ ЂH ‚	  ђ$	ЂЂ €€@@ HHЂHD  $ I ‘@ DD! !"„  " HЂH	$„Ђђ! $ $$Ђ    @   @	 @Ђ   I$„  Ђ@ђ HЂ$Ђ	@       ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее                                                                                                                              Copyright Timeclaim Ltd 1989 05.2004.01  DEVELOP _У                                                                            ГЂ     ! 9Нл""Ђ! 9Нл"}2Ђ! 9Нл""Ђ!
 9Нл"ГђЂ!  е! 9Нл"еНљ‚ББЙ! 9Нл"еН”БЙ! 9Нл"еНк†БЙ! 9Нл"еН±‰БЙ! е! 9Нл"еНљ‚ББЙ! 9Нл"еН¶ЂБЙ!яяЙГ°ЂНш"1Ђ  CЂ PЂ ]Ђ jЂ |Ђ   Г‰ЂЙ     !яя"ґЂ*ґЂ#НN"КрЃ! 9Нл" )л*ЂНл""1*Ђ: Нл""3!  е!  е! е!1е! еНWБББББН(!±Ђе! еН1™ББН2"В'Ѓ!±ЂеНw.БНN"Н2"К9ЃН&(!яя"ґЂГрЃН&(:±ЂНж"Ця|µВTЃ!юя"ґЂГрЃ!  "ґЂ*ґЂ Нv"КsЃ*ґЂ±ЂНе"Н2"Н2"КџЃ*ґЂ#"ґЂ+±ЂНе"еН›БНN"КњЃ!яя"ґЂГџЃГZЃ!яяе*ґЂНX"К·Ѓ!±ЂеН}љБ"ґЂ!яяе*ґЂН:"ВНЃ*ґЂ  Нv"Н2"ВЬЃ*ґЂ? Нw"Н2"КнЃ! еНpБ"ґЂГјЂ*ґЂеН‚Б"ґЂНѕ'*ґЂЙ!яяе! 9Нл"НX"К`‚Н(! е!$ еНb(ББ! 9Нл"##|µВ<‚!d‚еН„'БГU‚!m‚еН„'Б! 9Нл"е! еН§›ББН(! 9Нл"Й*ЂЙALL USER USER                                         *Ђ##НN"К«‚! Г®‚! "‚‚:ЂНж"еНЕЌБ"x‚"|‚#НN"КТ‚!яя"v‚Г„! 9Нл"+НN"Км‚*|‚еН3„Б#НN"Н2"Кы‚!яя"v‚Г„!Ё†е!±†еН‘ББ"t‚*|‚яН“"Т„Нѕ'НD'шя"Ђ‚*Ђ‚  Нw"К9ѓ*|‚  Нw"Н2"К®ѓ!  "z‚*‚‚л*z‚Нv"К[ѓ*|‚  Нw"Н2"К¤ѓ*t‚е!†‚е! еНгБББ!†‚еН…Б*z‚#"z‚л*‚‚Нw"К’ѓ!ґ†Г•ѓ!є†еН„'Б*|‚+"|‚ГEѓ*Ђ‚+"Ђ‚Г$ѓНD'++е!  еНb(ББ*|‚|µВпѓ*Ђ
 Нл"еН„'Б*x‚еН!њБ!є†еН„'Б*ЗеН„'БГчѓ*ГеН„'БНРН±(ея|µВ	„Г„Гѓ*t‚еНЅБНѕ'!  "v‚!Ё†еНЄ,Б*v‚Й          ! 9Нл")еНо)Б")„е!яяН:"К[„! еНpБ"/„ГЂ…!Ё†е*)„е! 9Нл"еН*БББ"+„#НN"КЋ„!Ё†е!. еН‡ББ"/„ГЂ…*Ђ##|µВЛ„!  "-„! 9Нл"л*-„Нv"КЛ„*-„#"-„+)л*)„еНл" Нр"Гћ„*)„е! 9Нл"еНџњББ!Ё†е!ј†еН‘ББ"1„#НN"К…!Ё†е! еН‡ББ"/„ГЂ…*Ђ##|µВC…!  "-„! 9Нл"л*-„Нv"КC…*-„#"-„+)л*)„еНл"щяНр"Г…!  "-„! 9Нл"л*-„Нv"Кx…*1„е*-„#"-„+)л*)„Нл"еНvББГI…*1„еНЅБ*+„еН~Б*)„еНу*Б!  Й    !  "–…! 9Нл"Не"Тя|µКт…*–…#"–…! 9еНл"#Нр"+Не"еН)Б! 9Нл"Не"|µВп…! 9Нл"6.! 9Нл"#6 Гћ…*Ђ##НN"К†! Г†! "”…*–…#"–…+л*”…Нw"К&†!  еН)БГ	†! 9Нл"#Не"НN"КB†!ї†еН„'БГ§†! 9еНл"#Нр"+Не"еН)Б!  "–…! 9Нл"Не"|µК‹†*–…#"–…! 9еНл"#Нр"+Не"еН)БГ]†*–…#"–…+эН“"Ъ§†!  еН)БГ‹†ЙAMIE.DIR RC   |   
 WC                                            *Ђ##НN"Кы†! Гю†! "в†:ЂНж"еНЕЌБ"и†#НN"К‡!яяЙ*и†еНо)Б"Ж†е!яяН:"К8‡! еНpБЙ*Ж†е*и†еНє—ББ#НN"КX‡*Ж†еНу*Б!яяЙ*Ђ Нл""1*Ђ Нл""3!  е!  е! е!1е!  еНWБББББНРН±(еНР#Б§я|µК®‡*Ж†еНу*Б!яяЙНѕ'! е! е!  е!  еН!ББББ!G‰е!P‰еН‘ББ"Д†:ЂНж"& }жпo}2И†!: }2Й†!  "Ю†"д†*и†л*Ю†Нv"Кц€Г€*Ю†#"Ю†+Гш‡Н‘(ея|µВ"€Гц€*д†|µВT€Нѕ'*Ђ$ Нл"еН„'Б!S‰еН„'БНD'"д†*д†чя"д†*Д†е!К†е! еНгБББ*Ж†л*Ю†~·Ку€!К†еНw.Б"а†!К†еН„'Б*а†#"а†+л*в†Нw"КЈ€!  еН)БГ†€!  е!И†еНН–БеНь.ББ!И†еНЄ,БНN"КХ€*Ђ" Нл"еН„'БГд€*Ђ4 Нл"еН„'Б!S‰еН„'Б*д†+"д†Г€!U‰еН„'Б*Ђ& Нл"еН„'Б!X‰еН„'Б*ЗеН„'БНРН±(Нѕ'*Ж†еНу*Б*Д†еНЅБ!  е!  еНь.ББ!  ЙAMIE.DIR RC 
 

  -                                                                                       :ЂНж"еНЕЌБ"h‰#НN"КК‰!яяЙ*h‰еНо)Б"j‰е!яяН:"Ки‰! еНpБЙ*j‰е*h‰еНє—ББ"f‰#НN"КЉГhЌ!  "f‰Нѕ'!tЌе!}ЌеН‘ББ"\‰*Ђ Нл""n‰*Ђ Нл""p‰!ќ‰"r‰*Ђ  Нл""t‰:ЂНж"& }жпo}2v‰}2›‰!: }2w‰}2њ‰*\‰е!ќ‰е! еНгБББ!  "`‰*h‰л*`‰Нv"КPЌ*j‰л*`‰Не"Н2"К*Ќ!…‰е!›‰еН‡њББ!њ‰"l‰*l‰#"l‰Не"|µКиЉ*l‰Не"  Нv"ВЪЉ*l‰Не"_ Нw"Н2"КеЉ*l‰6їГ°Љ!  е!  е! е!n‰е! еНWБББББ!›‰е!…‰еН‡њББН(!x‰е! еН1™ББ"b‰Н&(*b‰|µК2‹ГPЌ!яя"b‰*b‰#"b‰е!v‰еНw.БСНw"Кl‹*b‰v‰е*b‰v‰Не"еНР#БС}Г8‹!›‰еНН–Б"d‰##НN"КІ‹!›‰е!4 еН‡ББ*`‰#"`‰л*h‰Нw"КЇ‹*\‰е!ќ‰е! еНгБББГ'Ќ!  е*d‰еНь.ББ!v‰еНw.Б Нw"Ка‹!›‰е!v‰еНZ.ББН2"Н2"КЌ!v‰еНи’Б#НN"К|Њ!| }2v‰!  "b‰*b‰#"b‰v‰Не"|µК.Њ*b‰v‰е*b‰#v‰Не"С}ГЊ*b‰+"b‰v‰6|*b‰#"b‰v‰6 !v‰е! еН‡ББ:ЂНж"& }жпo}2v‰!: }2w‰!›‰е!…‰еН‡њББГЌ!v‰е!}ЌеН‘ББ"^‰#Н2"К»Њ*^‰еНЅБ"^‰!x‰е! еН‡ББ!›‰е!…‰еН‡њББГЌ!›‰е!v‰еН)љББ ЂН“"ЪЮЊ!›‰е!4 еН‡ББ*`‰#"`‰л*h‰Нw"КЌ*\‰е!ќ‰е! еНгБББГ'Ќ*`‰#"`‰л*h‰Нw"К'Ќ*\‰е!ќ‰е! еНгБББГMЌ*`‰#"`‰л*h‰Нw"КMЌ*\‰е!ќ‰е! еНгБББГЉ*\‰еНЅБНѕ'!  е!  еНь.ББ*j‰еНу*Б*f‰ЙAMIE.DIR RC                                   Р’ ???????????                     *ўЌе!Щ’еН‘ББ" Ќ#НN"КкЌ*ўЌе!0 еН‡ББЙ! е!Ђ еНь.ББ! "љЌ!  "ћЌ! е!  еНь.ББ"Ќ! е! 9Не"& }жпoїяеНь.ББ*Ђ##|µВBЋ!? }2¤ЌГOЋ!  е*ЂеНь.ББ! 9Не"& }жпoіяНN"КoЋ! "–ЌГбЋ! 9Не"& }жпoїя Н#л*O- Нл" Н«"КЎЋ! Г¤Ћ! "–Ќ! 9Не"& }жпoїя Н#л*O-##Не"л!Ђ лНМ"л*–ЌН#л! Н№""–Ќ*љЌе!¤ЌеНь.ББ"”Ќ#Н2"К»ЏНђНN"КҐЏ!яя"њЌ! 9Не"& }жoН2"К"Џ*Ђ##Н2"Н2"КaЏ!ЂЌеНw.Б+"њЌ*њЌ  Нg"КQЏ*њЌЂЌНе"¤яН2"Н2"КaЏ*њЌ+"њЌГ4Џ! е*ЌеНь.ББ* Ќе*њЌ#"њЌЂЌеНvББ! е! 9Не"& }жпoїяеНь.ББ*ћЌ#"ћЌ! е!Ђ еНь.ББ! "љЌГбЋ! е*ЌеНь.ББ! е* ЌеНRББ!  е!  еНь.ББ* ЌеНЅБ" Ќ*ћЌ|µВђ*ўЌеНЄ,Б!яяе!  е! еНзБББЙ*ћЌЙ        *”Ќ)))))Ђ "ђ	 #Не"& }жЂoН2"ВRђ*ђ Не"& л*–ЌНf"Н2"Вgђ*ђНе"& яНN"Н2"Кqђ!яяЙ!ЂЌ"ђ! "ђ!  "ђ*ђ	 е*ђ+"ђСНе"& }жoаяНN"К°ђ*ђ  Нg"Н2"К№ђГѓђ*ђ ЂН“"Т ‘! "ђ*ђ#"ђ+е*ђ	 л*ђНе"& }жoС}*ђ+"ђ ЂН“"Т ‘*ђ#"ђ+е*ђ	 л*ђНе"& }жoС}Гмђ*ђ|µК2‘*ђ#"ђ+6.! "ђ*ђ#е*ђ+"ђСНе"& }жoаяНN"Кb‘*ђ  Нg"Н2"Кk‘Г8‘*ђ ЂН“"ТЖ‘*ђ#"ђ+е*ђ#л*ђНе"& }жoС}*ђ+"ђ ЂН“"ТЖ‘*ђ#"ђ+е*ђ#л*ђНе"& }жoС}Г•‘*Ђ|µК0’*ђ#"ђ+6\*ђ#"ђ+е*ђНе"л!
 Н3#л0 С}*ђ#"ђ+е*ђНе"л!
 Н3#0 С}*ђе!Ь’еН‡њББ!Ь’еНw.Бл*ђ"ђ*ђ#"ђ+6 !яя"ђ!ЂЌеНw.Б"ђ*ђ#"ђе*ђ+"ђСНw"КМ’*ђЂЌе*ђЂЌНе"е*ђЂЌНе"СС}*ђЂЌе*ђЂЌНе"е*ђЂЌНе"НУ"С}*ђЂЌе*ђЂЌНе"е*ђЂЌНе"НУ"С}ГK’!  ЙAMIE.DIR WC RESU        ! "г’*г’#"г’л! 9Нл"Неееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее"}2з’Н2"К“:з’Нж"ТяН2"Н2"К6“:з’Нж"еНS–БНN"К3“!яяЙГо’*г’хН“"ТF“!яяЙ:з’Нж"|µВU“!  Й*г’"е’*е’#"е’л! 9Нл"Не"}2з’Н2"КЈ“:з’Нж"еНS–БНN"В–“:з’Нж"ТяНN"Н2"К “!яяЙГ[“*г’ л*е’Нf"Кє“!  ГЅ“!яяЙ                                                                          :ЂНж"еНЕЌБ"в“#НN"К!”!яяЙ!0–е!9–еН‘ББ"ѕ“:ЂНж"& }жпo}2А“!: }2Б“НD'шя"Ю“Нѕ'!  "Ш“*в“л*Ш“Нv"КК•Гu”*Ш“#"Ш“Г[”Н‘(ея|µВ„”ГК•*Ю“|µВ»”!<–еН„'Б*ГеН„'БНРН±(ея|µВ®”ГК•НD'шя"Ю“Нѕ'*ѕ“е!В“е! еНгБББ!  е!А“еНН–Б"Ц“еНь.ББ!А“е!д“еН«-ББ! е!Ђ еНь.ББ! е!д“еНь.ББ!# е!д“еНь.ББ!=–еН„'Б*Ђ##|µВT•!?–еН„'Б*Ц“цН“"ЪD•!0 еН)Б*Ц“еН!њБ!\ еН)Б!В“еН„'Б!В“еНw.Б ХНУ""Ь“*Ь“яН“"Т’•Г‡•*Ь“+"Ь“Гn•!. еН)БГ}•!”Не"&  Н#е!”Не"& СН1ЕХЂ   Н
/ЕХН"›ББ*Ю“+"Ю“Гk”*в“е*Ш“Н:"К–!<–еН„'Б*Ђ
 Нл"еН„'Б!  еН)Б*в“еН!њБ!=–еН„'Б*ЗеН„'БНРН±(Нѕ'*ѕ“еНЅБ!  е!  еНь.ББ!  ЙAMIE.DIR RC 

 USER "'*+,:;<>=?_.  ! 9Не"  Нf"Вp–! 9Не"Z Нw"Н2"Кz–!  Й! 9Не"їН“"ТЋ–! Й!яя"Q–*Q–#"Q–уН“"ЪГ–*Q–D–Не"е! 9Не"Н:"КА–!  ЙГ”–! Й      *Ђ"З–! 9Нл"еНw.Б+"Й–*Й– Нg"К—! 9Нл"л*Й–Не"¤яН2"Н2"К—*Й–+"Й–Гг–! 9Нл"л*Й–Не"¤яНN"КR—! 9Нл"л*Й–6 ! 9Нл"л*Й–++еН}љБ"З–! "Л–*Й–#"Й–л! 9Нл"Не"Н2"К—*Л–#"Л–+л! 9Нл"е! 9Нл"л*Й–Не"С}ГX—! 9Нл"л*Л–6 *З–Й        ™      ! 9Нл""¶—*¶—|µВд—*НN"Ка—! еНpБГг—!яяЙ*¶—)еНо)Б"°—е!яяН:"К! еНpБЙ*І—е*°—е*¶—еН*БББ"ё—#НN"К5*°—еНу*Б*І—е!. еН‡ББЙ*°—е*¶—еНџњББ*І—е!'™еН‘ББ"ґ—!  "¬—*¶—л*¬—Н«"К‹Гr*¬—#"¬—ГX*ґ—е*¬—)л*°—Нл"еНvББГh*ґ—еНЅБ*|µКЅ! 9Нл"е*¶—"aе! еН.БББ!  "Є—Гъ*"W*°—"Y*¶—"[! 9Нл""]!я"_! "c!Wе!  е!  еНsБББ"Є—*°—еНу*Б*ё—еН~Б*Є—#НN"К™*Є—Г™*aЙAMIE.DIR WCD       ! 9еНл"+Нр"! 9Нл""/™!  "+™*/™еНо("-™С}*-™  Нv"Вo™*-™ Нg"Н2"Кщ™*-™ГЭ™*+™+"+™#|µВ‹™Г=™*/™+"/™!%љеН„'БГц™! 9Нл"6 *+™+"+™#|µКѕ™!%љеН„'БГ¦™*-™ея|µВО™! ЙГ=™*/™6 !  ЙГц™Нш"{™ {™ ќ™ ¦™ С™   Г!љ! 9Нл"л*+™Нv"К!љ*/™#"/™+Не"еН)Б*+™#"+™ГM™Й  !Кя9щ!8 9Нл"е! 9 еН«-ББ!: 9Нл"е! 9еН«-ББ! е!Ђ еНь.ББ! е! 9еНь.ББл!6 9щлЙ    ! "{љ!  "yљ! 9Нл"Не"Г«љ!яя"{љ! 9еНл"#Нр"ГёљНш"–љ- њљ+   ! 9Нл"Не"0 Нg"КЫљ! 9Нл"Не"9 Нf"Н2"К›*yљ
 Н#е! 9еНл"#Нр"+Не"СРя"yљГёљ*{љл*yљН#Й! 9~!  ю0Шю:Р,Й! 9Н¬0ЕХ!  Н%1Н°ќКR›!- еН)Б! 9е! 9Н¬0НЋ0бНє0! 9Н¬0ЕХ!	 Н%1Н¶ќКЂ›! 9Н¬0ЕХ!
 Н%1Нv/ЕХН"›ББ! 9Н¬0ЕХ!
 Н%1Нq/ЕХ!0 Н%1НЃ0ЕХН)ББЙ  ! "Ґ›! 9еНл"+Нр"#юН“"ТТ›*Ґ›
 Н#"Ґ›Г­›! 9Нл"|µВл›*Ґ›л!
 Н3#"Ґ›! 9Нл"л*Ґ›Нw"Књ!  еН)Б*Ґ›л!
 Н3#"Ґ›Гл›! 9Нл"еН!њБЙ! 9Нл" ЂН“"ЪKњ!- еН)Б! 9е! 9Нл"НЭ"Нр"! 9Нл"цН“"Тnњ! 9Нл"л!
 Н3#еН!њБ! 9Нл"л!
 Н3#л0 еН)БЙБбСХеЕ+#~·ВЋњЙ        ! 9Нл"л! Н3#"—њ*—њяН“"ТЇќГПњ*—њл! Н3#"—њГ°њ*—њ"™њ! 9Нл"л*™њНv"К¬ќГуњ*™њ#"™њГХњ*™ње*—њНУ""›њ*›њ ЂН“"Т©ќГќ*›ње*—њНУ""›њГ ќ*›њ)л! 9Нл"Нл"е*›њл*—њ)л! 9Нл"Нл"еНZ.ББяН“"Т¦ќ*›њ)л! 9Нл"Нл""ќњ*›њ)л! 9Нл"е*›њл*—њ)л! 9Нл"Нл"Нр"*›њл*—њ)л! 9Нл"е*ќњНр"ГќГйњГїњЙ! Нш0! еНгќбхН	1ВЙќсГСќс! ТСќ-СББХ-Й! Нш0! Г№ќ! 9~“_#~љW#~™O#~hgGх|­тћс?ЙсЙЙ  @ Ђ     Ђ€€Ѓ        ‚  ђHђ ‘ ’" $ @	" Ђ     ђ            ђ"@‚@" A$@$  	H ‘ DDH’$ 	 "   ’ 	    $@ $ $Ѓ ‚D $ B $ $Ѓ ‚D  ЂH€       ‘      H ‘  @@      $@         ђ" "          H    " 	"	" HA  H  €$Ђ€A  D $ 	 $ЂЂ   ЂЂ               " "!A@$ 	$ "D D 		"@Ђ!  "BA" HH "@"	 @Ђ@" €Hђ	!‰H  " $ЂD$D ђ €‚D "	 H€$@                      Ѓ@Ђ        ‚      ‘ Ѓ ‚  H $ DЃ €ђ    €  @  		       @  $@ @ђ$B  ! !"!  ђ$D! 	„ „€"  €@ D " $D@’@„Ђђ ђђ    € $ ЃЂ@ЂЃ$@ A @ђ $@          D ђ Ѓ @$A$H ’   $@ Ђ    ЂЃ    ЂI H   "H‚@@  €Ђ  @            @ @    $ @ $H  ЂA"  ‘    Ђ  @D@@ЂA"	"H„ $    H     H@    	Ђ	$A$H €$Ђ@ђDD@ЂHЂђ            Ђ !     ђ   D                  $@Ђ  ђ  Ђ             @H‘$A D@ "    @   ’ Ѓ      		       @  $@ @ђ$B  ! !"!  ђ$D! 	„ „€"  €@ D " $D@’@„Ђђ ђђ    € $ ЃЂ@ЂЃ$@ A @ђ $@          D ђ Ѓ @$A$H ’   $@ Ђ    ЂЃ    ЂI H   "H‚@@  €Ђ  @            @ @    $ @ $H  ЂA"  ‘    Ђ ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:$1.c[g2
c $1
era $1.c
m80 =$1
era $1.mac
lib cpm[i]=cpm.irl,$1
era $1.rel
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:cpm$1.c[g2
c cpm$1
era cpm$1.c
m80 =cpm$1
era cpm$1.mac
xp c:[g2]=cpm$1.rel
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:cpm.h[g2
pip m:=c:cpmbl1.sub[g2
pip m:=c:getatr.c[g2
c getatr
era getatr.c
m80 =getatr
era getatr.mac
lib cpm[i]=getatr
era getatr.rel
x cpmbl1 rddata
x cpmbl1 selprc
x cpmbl1 setdrf
x cpmbl1 getfnm
x cpmbl1 inpdrv
x cpmbl1 getvfd
x cpmbl1 wtdata
x cpmbl1 wtrec
x cpmbl1 dmpbuf
x cpmbl1 bfinit
x cpmbl1 endit
x cpmbl1 getvdt
x cpmbl1 sieve
x cpmbl1 outdrv
x cpmbl1 chsefn
x cpmbl1 setusr
x cpmbl1 dspusr
x cpmbl1 dir
x cpmbl1 erase
x cpmbl1 ren
x cpmbl1 getdir
x cpmbl1 fnchek
x cpmbl1 mandrv
x cpmbl1 swclse
x cpmbl1 swopen
x cpmbl1 szefil
x cpmbl1 getdv
x cpmbl1 dvalid
x cpmbl1 dvfrop
x cpmbl1 gvaldv
x cpmbl1 isfchr
x cpmbl1 chuser
xp c:[g2]=cpm.irl
era cpm.irl
era cpmbl1.sub
pip m:=c:cpmbl2.sub[g2]
x cpmbl2 inp
x cpmbl2 man
x cpmbl2 out
x cpmbl2 ov1
x cpmbl2 ov2
era cpm.h
era cpmbl2.sub
era cpmbld.sub
rv
x cpmbl1 chsefn
x cpmbl1 setusr
x cpmbl1 dspusr
x cpmbl1 dir
x cpmbl1 erase
x cpmbl1 ren
x cpmbl1 getdir
x cpmbl1 fncееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CPMINP)
.paЉ*/
#include	"dd.h"
#include	"cpm.h"

FILE	dirfd = 0,		/* File descriptor for directory file	*/
	inpfd = 0;		/*  "       "       "  input     file	*/

WORD	cur_file,		/* Current file in file list		*/
	cpm_user,		/* Current CP/M User number		*/
	user,			/* Copy of Current CP/M User Number	*/
	tot_files;		/* Total number of files in list	*/

BYTE	filnam[20];		/* Name of current file			*/

BYTE	*spdname = "AMIE.DIR",	/* Name of temporary directory file	*/
	*sel_frame = 0;		/* Address of allocated answer frame	*/

BYTE	cpm_drive;		/* Holds drive letter of source drive	*/

/*======================================================================*/
STATUS                                /*				*/
inp(comd,lev)                         /* Start of the CP/M input driver */
WORD	comd;				/* Command to be actioned	*/
struct	lvl	*lev;			/* AMIE Level structure		*/
/*===============================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее=======================*/
/*USE
Portability	Level 1
Parent module	CPMINP CP/M INPUT DRIVER
Module Version	04.01
AMIE version 	05.20
Revision History:-
12/03/91 V04.01 issued - ICFO
         GETDIR / CRTONAM rewritten - ICFO
13/12/90 V04.00 issued - ICFO
10/07/89 V03.01 issued - ICFO
         Change in 'getfnm' to allow for maximum length of a file
         name - ICFO
28/04/89 V03.00 issued - ICFO
17/04/89 User numbers added - ICFO
07/07/88 V02.00 issued (tidied to keep in step with documentation) - ICFO
01/02/88 AMIE Version 5
         'tlibv' introduced - ICFO
08/09/87 'spclose' action modified, no action commands commented
04/08/87 Version number added
21/05/87 Minor mods DAR
13/02/87 AMIE modifications - DAR
08/12/86 Queueing version - DAR
*/

{

LOCAL
WORD	i,		/* Loop counter					*/
	n;		/* Number of bytes in 'filnam'			*/

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Data call put here for speed						*/
if (comd == DATA)  return(rd_data(lev));

/* Action the command passed from the copy controller			*/
switch (comd) {

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

   case CONNECT:	/* Establish transfer connection & init driver	*/
	lev->levchk = 1;		/* ID ourself as a level 1 drvr	*/
	lev->expf = 1;			/* Expansion fact - 1 + EOF pkt	*/
	if ((tot_files = inpdrv(lev)) == FAIL)  return(FAIL);

	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case RELEASE:	/* Transfer termination sequences		*/
    case DISCONN:
    case ABORT:

/* Close files if open							*/
	if (dirfd != 0)  spclose(dirfd);
	if (inpfd != 0)  spclose(inpfd);
	dirfd = inpfd = 0;

/* Free off any alloced areas						*/
	sel_frame = spfree(sel_frame);

/* Erase the directory file						*/
	unlink(spdname);

	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case SELECT_FILE:		/* Get a filename from the file list	*/

	*filnam = 0;		/* Make current filename a null string	*/

/* Call selection function to fill filnam with the next	filename for 	*/
/* transfer								*/
	return(sel_proc(lev));
					
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case READ_ATTR:	/* Read VFS attributes & pass across to output	*/

	get_attr(lev);

/* Remove User Number from file name and set user number if necessary	*/
	bdos(SETUSR,user = chuser(filnam));

 	if ((inpfd = spopen(filnam,"RB")) == FAIL) {
	    inpfd = 0;
	    bdos(SETUSR,0);
	    return(flerr(filnam,3));
	}

	lev->bfsize = 0;
	bdos(SETUSR,0);
	return(SUCCESS);

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case ABORT_DATA:		/* Abort data transfer			*/
    case CLOSE_FILE:		/* Close the input file			*/
	inpfd = spclose(inpfd);
	bdos(SETUSR,0);		/* Restore the User Number to zero	*/
	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case RESTART:	/* Restart the data transfer from beginning	*/

	lev->err_action = ABORT_DATA;
	return((spseek(inpfd,0L,0)));

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/************************************************************************/
/* Options requiring no action commented out				*/
/*	case OPEN_FILE:		/* Open data file			*/
/*	case BEGIN_DATA:	/* Start data transfer			*/
/*	case END_DATA:		/* End data transfer			*/
/*	case REL_FILE:		/* Release currently selected file	*/
/*		break;							*/
/************************************************************************/


}

return(SUCCESS);

}

/*======================================================================*/
******/
/* Options requiring no action commented out				*/
/*	case OPEN_FILE:		/* Open data file			*/
/*	case BEGIN_DATA:	/* Start data transfer			*/
/*	case END_DATA:		/* End data transfer			*/
/*	case REL_FILE:		/* Release currently selected file	*/ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…ђФRS” TD•$dH%9ACUR_FIЃђФWХTаEU4U(Q=Q}&FILNAMЃ”ФђS`e4TЕфe(A5}JINP”  Mv@@                                   .h        9fЂ ›ь2|Z°Є0 „ іip•љ  0Y"  rН§А;@! ,Ъ–  #`Њl ЂЂ–mU „Ђ‘°F6 @@Л6ІЂ9Y  EBЂlР •bЂ/чы%‡r@e± ШРU  >-YVt U@ ¬Р ‚* @Е«*ЦЂ
Ё•›fЂ"  E@ЂT  UHЂ¬Р ‚"¤@Є@ еfЂ ЙЂ С• ЂЂ–mu rі@ $B Y·`КН  " К!ЎЂVh  БPЂ+4  `°D40К!єА.Vh  Б`€Ё Ќ›`@TдB  Ё „@ r€@ +6юЂ0X" еЂАVh  Б`ІD   е›y@ Ђ dl ЌЂ К!  ¬ЪNБ`€@ LµhU@Ђ¬ЫT БP Ђ еЂ VmR`°Xw$B Yґш" FАсШ * @P€    ­Q  еfЂ ‚ЙaЬђh T     XР ЖЂ А0 
 ј  ђZЂ*Р,]@B    B  2H$ТI\D$”Ђ"3B‹”ХТUг-А1	=N2&PЛ““Х#> !UMJ:HђФWСЈ АA5}UN:ђХT—С’c  I5: QT‘‘#ЎЂ%1962hQ“T”Ј  	є0 ‘СS“QTг  953Т‘СUРU#/@) є:R ТS”#/ %9AIZ:RS”‘#(@I}R:D”СSС”Ј;ЂM1}AJ2ѕ”ФУФг¤ MA963v”Ф”‘Qc!@9MA=A:3,”ФСQRг  Q1%	Z:•ХС’c8АU91%9.:TСT§   ћ“Х#> !UMJ:HђФWСЈ АA5}UN:ђХT—С’c  I5: QT‘‘#ЎЂ%1962hQ“T”Ј  	є0 ‘СS“QTг  953Т‘СUРU#ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:cpm$1.rel[g2
link cpm.$1=cpm$1[op,g$1,l8000],cpm.irl[s],amlib.irl[s],amdum,tlib.irl[s]
era cpm$1.rel
prlpat cpm.$1 $2 $3 0 $4
prltrm cpm.$1
xp c:[g2]=cpm.$1
symsort cpm
era cpm.sym
era cpm.srt
CTPUTУ  C     H               CTREAД  C     I               	CVT     C     J               CPMINP  C     %h l             
DCOPY   C     N               DDISC   ERR   O               DDISC   MS1   P               DDISC   MS2   Q               ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееpip m:=c:cpmln1.sub[g2
pip m:=c:cpm.irl[g2
x cpmln1 inp $1 $2 $3
x cpmln1 man $1 $2 $3
x cpmln1 out $1 $2 $3
x cpmln1 ov1 $1 $2 $3
x cpmln1 ov2 $1 $2 $3
era cpm.irl
era cpmln1.sub
era cpmlnk.sub
CPMLN1  SUB   &               CPMLNK  SUB                    ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CPMMAN)
.paЉ*/
#include	"dd.h"
#include	"cpm.h"

#define		NON_FLOPPY	2

BYTE	*menu_opt[N_MESS],	/* Pointers to text messages in 'text'	*/
	*switches,		/* Points to switch list for this driver*/
	cpm_drive;		/* Holds drive letter for this driver	*/

WORD	td,			/* Switch list descriptor		*/
	cpm_user;		/* Current User number			*/

EXTERN
WORD	floppy[];		/* Holds source and dest. drive numbers	*/

/*======================================================================*/
WORD                                          /*			*/
man(target)                                   /* CP/M Utilities Manager */
WORD	target;			/* 0 for source; 1 for destination	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMMAN CP/M UTILITIES MANAGER
Module Version	04.01
AMIE version	05.20
Revision History:-
12/03/91 V04.01 issued - ICFO
         Bug which screwed upееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее rename and erase if 'all users'
         selected has been fixed
         (Changes in REN.C and ERASE.C) - ICFO
         GETDIR / CRTONAM rewritten - ICFO
         Check for valid file name also includes check for embedded
         space character
         (Change in FNCHEK.C) - ICFO
13/12/90 V04.00 issued - ICFO
10/07/89 V03.01 issued - ICFO
28/04/89 V03.00 issued - ICFO
12/04/89 User numbers and sorted directory added and general tidy
         up - ICFO
07/07/88 V02.00 issued (tidied to keep in step with documentation) - ICFO
01/02/88 AMIE Version 5
         'tlibv' introduced - ICFO
04/08/87 Version numbers added
25/03/87 Extracted from dvspec listing - DAR
23/02/87 Disk reset added after every main menu selection
21/01/87 Call to clear screen changed to 'clrs'
15/01/87 Screen cleared before entry to processing routines
14/01/87 Facility to 'erase' and 'rename' files on Source discs
	 removed
13/01/87 Started
*/

/* This routine controls the CP/M Utilities.  It enables the user to 	*/
/* display directories, erase files and rename files.			*/

{

LOCAL
WORD	choice,			/* Option selected from the menu	*/
	optno,
	text,
	utype,			/* Type of utility			*/
				/* 0 - source  1 - dest			*/
				/* 2 - dest on non floppy drive		*/
	n;

LOCAL
STATUS	rv;			/* Return value				*/

STATIC
WORD	optarr[] = { 5, 9, 7 },	/* Number of options per utype		*/
	ocode[][9] = {		/* Option string numbers		*/
		{ 1, 23, 22, 27, 8 },		/* Source		*/
		{ 1, 23, 22, 28, 2, 3, 24, 25, 8 },/* Destination	*/
		{ 1, 23, 22, 28, 2, 3,  8 }	/* Non-floppy disc	*/
	};

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Read in the Menu Text						*/
if ((text = opn_txt("CPM.MS1",menu_opt,N_MESS)) == FAIL)
					       return(flerr("CPM.MS1",3));

/* Set up pointer to the switches					*/
if ((rv = sw_open(target)) == FAIL)  CLEANUP;

/* Set up CP/M drive specifier						*/
if ((rv = mandrv(target)) == FAIL)  CLEANUP;

/* Release switches from use						*/
sw_close();

/* Display current User Number						*/
disp_user(cpm_user = 0);

/* Calculate the type of utility to offer				*/
if ((utype = target) == DEST) {
    if ((cpm_drive & 0xef) - 'A' != floppy[DEST])  utype = NON_FLOPPY;
}

choice = 0;
while (choice != FAIL) {
    optno = optarr[utype];
    n = 0;
    while (n < optno)  dframe[n] = menu_opt[ocode[utype][n++]];
    choice = bigmen(optno,dframe,15);

/* Reset disk system in case disc has been changed			*/
    n = bdos(0x19,0);		/* Get default disk			*/
    bdos(0x0d,0);		/* Reset				*/
    bdos(0x0e,n);		/* Set default disk back to what it was	*/

    clrs();
    if (choice == (optno - 1))  choice = FAIL;
    if (choice != FAIL) {
	switch (choice) {
	    case 0:		/* Directory listing			*/
		choose_fn(0,0,target);	
		break;

	    case 1:		/* Sorted directory listing		*/
		choose_fn(0,4,target);
		break;

	    case 2:		/* File sizes				*/
		choose_fn(0,1,target);	
		break;

	    case 3:		/* Set user number			*/
		cpm_user = choose_fn(0,5,target);
		break;

	    case 4:		/* Erase files				*/
		choose_fn(0,2,target);	
		break;

	    case 5:		/* Rename files				*/
		choose_fn(0,3,target);	
		break;

	    case 6:		/* Format disc,initialise & verify	*/

/* Issue format warning							*/
		if (choose_fn(1,8,target) == FAIL)  break;

/* Format disk								*/
		if (choose_fn(1,1,target) == FAIL)  break;

/* Initialise disk							*/
		if (choose_fn(1,3,target) == FAIL)  break;

/* Verify disk								*/
		if (choose_fn(1,2,target) == FAIL)  break;

/* Issue format/ init / verify complete 				*/
		if (choose_fn(1,12,target) == FAIL)  break;
		break;

	    case 7:		/* Verify disc				*/

/* Issue verify start warning						*/
		if (choose_fn(1,6,target) == FAIL)  break;

/* Verify disk								*/
		choose_fn(1,2,target);
		break;

		default:
		break;
	}
    }
}

choose_fn(-1,0,0);

rv = SUCCESS;

cleanup:

cls_txt(text);

move(4,36);			/* Clear user number display		*/
putstr("        ");

bdos(SETUSR,0);

clrs();

return(rv);

}

/*======================================================================*/
,6,target) == FAIL)  break;

/* Verify disk								*/
		choose_fn(1,2,target);
		break;

		default:
		break;
	}
    }
}

choose_fn(-1,0,0);

rv = SUCCESS;

cleanup:

cls_txt(text);

move(4,36);			/* Clear user number display		*/
putstrееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…ђФSPS dФTеUфшM]%Q"CPM_DRЂ• d5ХхU85:P 5р                                                                                          @ p   Ђ°             А` p   АЂ d   @p X   Ђ 0       ѕеР („< rі@ ‚"Ёа6h  К¶ ѕеЂАVh  Б`ІD   ељ  9Y  ES@lЫD К№А;\! ,Ыt еfЂ M іn0*уЂ0нp4  Ђ *‚ еfЂ  9fЭ0I іnш*“ Ћ©р4   ®gyј"ї†\ў©    Н  TB ЄHґB  Є ЄЎЂЩ  *ЛЉЄH ¤#SА,Ыф "Ё   ERАUЦ*©`Р •bЂEU, R  .QUI „ЂР  #U@.QUK €ЄX ¬RСіiш¤#@ ,ЪфН  u(UQ@ўёеѓАVh  Б`°DU B 9D  •љ  0X"*– !Ђў КНµ ,„ rЉЄX•›n X,h  *Ё ·(ЄЎЂ3@ UаїЯв*† *Ё`6m1eY01UC aЦ°1  еЂ Q 9fШ +4  `°X,;&!  ў К! ,ЫъеfР&‚ГІ`b К! Ђў0 rНўАNVm`°X,;&!  ў(К! ,Ъ^еfУ0&‚"Ё ;&!  ўК! ,ЪђеfФА&‚ГІ`b К!Ђў0 rН¬ЂNVmh`°X,;&! Ђў@К! ,ЪъеfШ&‚#fРU©aЩ01 еЂ@Q 9fЩ`'+6Н0X,6РЃ2®HЙЃ€@ („ r€@АЛ6Ы9Y¶и	‚Б`€Щ·	•z@vLB 9D  ”B Y·X	КН»@LFНј LЄГІ`bК! ў0 rНѕАNVmъ`°X"6meRђ6“aЩ01 еЃЂQ 9fС`7+6Ќ°X,6ђЃІЄ`ЙЃ€@ („ r€@АЛ6њЃ№Yґф‚Б`°мЙЃ°м4  ѕ   	 Ђ)NАЂ`
® W  (ДЃЂ°   u”[&ГҐЂ"ыэК!  ў КН« lB  Єh ЄЈЂ9Y  B 9D"@•љ  0X"ОеfЂ Ђ еЂ VmЕ`°Y·(US@$2Ѓ4\M)Њ@ Ђ@  Л`.SWITCЊкД$Dх8МёBIGMENЊ© Д2дuHЛ8C.MULTЊўФ2ддхHИPC.SXTЊСЃд4„фх4XОИCLRSЊЩЃд4Е5хE€йрCPM_DRЋ Ђd5ХхU8МxDFRAMEЊщ dD•5хXОЁ
E.ЊтЂґRгНЂFLERRЊЊ дdДхА G.Њ  dtTдФU8А GENMFЊ¬Ѓ¤‚имXMANЊлЂdФдE%hи MENU_OЊЯЃДФхdXИШ
N.ЊМ dхехE€О@PUTSTRЊВЂҐийаSWITCHЊф e5uф4ДшНрSW_OPEЋџЂ%DHА TLIBVњ   ћMULTЊўФ2ддхHИPC.SXTЊСЃд4„фх4Xееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CPMOUT)
.paЉ*/
#include	"dd.h"
#include	"cpm.h"

FILE	outfd = 0;	/* File descriptor for output file		*/

/* This structure contains the output filename				*/
struct fname	{
	BYTE	preamble[2];
	BYTE	name[20];
} filnam;

/* Buffer control block							*/
UWORD	bftaken,
	bfleft;

BYTE	*bptr;		/* Current pointer into output buffer		*/

WORD	cpm_user,	/* CP/M User Number as input by operator	*/
	user,		/* Copy of CP/M User Number			*/
	organised;	/* Type of source file organisation 		*/

struct	lvl	*lev;	/* Level descriptor for global use in driver	*/

BYTE	cpm_drive;	/* Holds destination drive letter		*/

/*======================================================================*/
STATUS                               /*					*/
out(comd,clev)                       /* Start of the CP/M output driver */
WORD	comd;				/* Command to be actioned	*/
struct	lvl	*clev;			/* Parameters			*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CP/M OUTPUT DRIVER
Module Version	04.01
AMIE version 	05.20
Revision History:-
12/03/91 V04.01 issued - ICFO
13/12/90 V04.00 issued - ICFO
10/07/89 V03.01 issued - ICFO
28/04/89 V03.00 issued - ICFO
26/04/89 User Numbers added - ICFO
07/07/88 V02.00 issued (tidied to keep in step with documentation) - ICFO
07/09/87 directory full message replaces unable to open
	 bad open handling sets outfd to 0 again
	 code tidied
04/08/87 version numbers added
13/02/87 modified for minflop output - DAR
08/12/86 queueing version - DAR
*/

{

LOCAL
struct	pkthdr	*vfdpkt;	/* pointer to a packet containing a VFD	*/

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* NB all error handling assumes that copy manager sets err_action to 	*/
/* DISCONN before entry							*/

/* Make level descriptor global						*/
lev = clev;

/* Put here for speed							*/
if (comd == DATA)  return(wt_data());

/* Action the command passed from the copy controller			*/
switch (comd) {

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case CONNECT:	/* Establish transfer connection & init driver	*/
	lev->levchk = 6;	/* ID ourself as a level 1 driver	*/
	lev->expf = 0;		/* Expansion factor - none		*/

/* Initialise filename drive specifier					*/
	if (outdrv(lev) == FAIL)  return(FAIL);
	filnam.preamble[0] = cpm_drive;
	filnam.preamble[1] = ':';
	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case ABORT_DATA:		/* Abort data transfer			*/
    case CLOSE_FILE:		/* Close the input file			*/
    case RELEASE:		/* Transfer termination sequences	*/
    case DISCONN:
    case ABORT:

/* If the file is still open then close it				*/
	if (outfd != 0) {
	    bdos(SETUSR,user);
	    spclose(outfd);
	    bdos(SETUSR,outfd = 0);
	}
	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case READ_ATTR:		/* Read VFS attributes 			*/

/* Get VFD packet from input queue					*/
	if ((vfdpkt = get_vfd()) == (BYTE *) FAIL)  return(FAIL);

/* Process the VFD							*/
	if ((get_vdets(vfdpkt)) == FAIL)  return(FAIL);

/* Put VFD packet on output queue					*/
	queue(lev->out_q,vfdpkt);
	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case OPEN_FILE:		/* Open the destination file for output	*/

/* If it fails suggest that it could be directory full			*/
	bdos(SETUSR,user);
	if ((outfd = spopen(filnam.preamble,"WB")) == FAIL) {
	    bdos(SETUSR,outfd = 0);
	    return(flerr(filnam.name,48));
	}
	bdos(SETUSR,0);
	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case BEGIN_DATA:		/* Start data transfer			*/
	bfinit();		/* Initialise the buffers		*/
	break;

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    case RESTART:	/* Restart the data transееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееfer from beginning	*/
	lev->err_action = ABORT_DATA;
	return(FAIL);	/* No seek in write mode yet allowed		*/
	break;

/************************************************************************/
/*	Options requiring no action commented out			*/
/*	case END_DATA:		/* end data transfer			*/
/*	case REL_FILE:		/* release currently selected file	*/
/*	case SELECT_FILE:	/* get a filename from the file list	*/
/*		break;							*/
/************************************************************************/

}

return(SUCCESS);

}

/*======================================================================*/
********************************************************************/
/*	Options requiring no action commented out			*/
/*	case END_DATA:		/* end data transfer			*/
/*	case REL_FILE:		/* release currently selected file	*/
/*	case SELECT_FILE:	/* get a filename from the file list	*/
/*		break;							*/
/************************************************************************/ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…ђФSХU TхUDdH%196BFTAKEЃђ‘“Q• D%E(A5}UNUSERЃ“Ф‘РS’`4ДUhA5}JOUT”  Mh@@                                              rН  Tђ B Yґё "у†O‹VG fЂ ‘ 9fУЂmR@ € „c` Є’ B@ ИШ # TђКН  "6h  КЇЂыэ’! @QХ& fЂ иHC@АГ¦љ–ИЂKd@%І ЩU  >-YVш B  9ETЂКН  ,U  rі@ „@ r€@   rіm‚Гі@,Р  EIАўыэљ  2®Ё …юяdЉ©8•љ  0DlЪж КЅ ыэ’*¤Ђ` 2Н©ЂQU' rі@ ‡fЂD" ”UH ¬Ыt Б`€h”CgЂ\¬Р ‚БP 6пЂ2Є„@ r€@   rіh@‚! ЂQА еfЂ $B  9D  •›KАX,љfЂ ;4*¤Ђ  26€ЖАэюЙaЩ љfЂ D   І  р‘ Ђ,€ d@ @"  \ HяЂЂD Єа!    !  %r2Ь‹”ХТUг)@1	=N2¤ђ‘’S’U#Ј@	1R:0ђ‘•RСcЈЂ	AQJ2<PЛ““Х#0Ђ№MaR:LђФWСЈЈАA5}UN0 ‘”ђSQc9Ђ	є:‘’SђSc'Ђ51IJ0  ‘ЛЈ  95N0 QСS“QЈ;@Q}Y3„‘СUХ‘Ј> 	 є:H УUЈ¤@=I9&:R УХU#-А=UQIZ: SХU‘#? EUU3V”ФУФг" 9MA=A:0 UP•Ј¤ UMJ2€•ХСU'   ћ	=N2¤ђ‘’S’U#Ј@	1R:0ђ‘•RСcЈЂ	AQJ2<PЛ““Х#0Ђ№Maееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CPMOV1)
.paЉ*/
#include	"dd.h"
#include	"cpm.h"

BYTE	*swnames[20],		/* Switch names				*/
	*swvals[20],		/* Switch values			*/
	*cpmsgs[N_MESS];	/* CP/M messages			*/ 

WORD	valdrvs[16],		/* Holds valid drive nos		*/
	cpm_user,		/* CP/M User number			*/
	msgbase,		/* Loading base for messages		*/
	opn_txt();		/* Text loader				*/

/*======================================================================*/
STATUS                                             /*			*/
ov1(target,cpmdrv,cpmusr,switches,gendir)          /* Sort out switches */
WORD	target;			/* SOURCE or DEST 			*/
BYTE	*cpmdrv;		/* Address of target CP/M drive	ID	*/
WORD	*cpmusr;		/* Addresss of CP/M User number		*/
BYTE	*switches;		/* Pointer to switch list		*/
BOOLEAN	gendir;			/* Generate file list in AMIE.DIR Y/N	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	All CP/M Processors
Module Version	04.01
AMIE version 	05.20
Revision History:-
12/03/91 V04.01 issued - ICFO
13/12/90 V04.00 issued - ICFO
         Only adds a '.' to a filename if there is an extension - ICFO
         (Change in GETDIR / CRTONAM) - ICFO
10/07/89 V03.01 issued - ICFO
28/04/89 V03.00 issued - ICFO
17/04/89 User Numbers added - ICFO
07/07/88 V02.00 issued (tidied to keep in step with documentation) - ICFO
01/02/88 AMIE version 5
         'tlibv' introduced - ICFO
04/08/87 version numbers added
25/03/87 Extracted from dvspec listing - DAR
*/

{

STATIC
BYTE	*mfile = "CPM.MS1";	/* Name of message file			*/

LOCAL
WORD	rv;			/* Return value				*/

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Load text								*/
if ((msgbase = opn_txt(mfile,cpmsgs,N_MESS)) == FAIL)
						   return(flerr(mfile,3));

/* Run the function to identify the source/dest drive			*/
rv = getdv(target,cpmdrv,cpmusr,switches,gendir);

cls_txt(msgbase);	/* ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееFree the message area			*/

if (rv == FAIL)  return(FAIL);

/* Create directory file returning number of entries in it or FAIL	*/
cpm_user = *cpmusr;
if (gendir != FALSE)  rv = getdir(*cpmdrv);

return(rv);	/* Return operation SUCCESS or FAIL			*/

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…ђФSХЊ`e5tдФXM]Y1NCPMSGSЃ•ђS• d5ХхU85M	NOV1”  MWА@                                                                                                                                                                                                     *ё  *¶ QP r€CА+4  `°X"+\ #fЂ «ј *¶ Q еfЂ $B
 Y  ”B
 Y·ЊК! ,ЫЦ е‚Ђ–mу r€A@Л6эЂ9Y  ‚Б`°DVИ UkЂ¬Р ‚*¶@6mЛ eRpэюЙЃЂ–mfТА¬ ЂЂ–m/fЂ Є¦! ,ЪrН  ¬Р ‚"¶@«d Й!”	ўвiLb ЊЏ Ф2ддхHИ°CLS_TXЋЁ d5Х4u8н`CPM_USЊ  dDe$ФXЙаE.0ЊмЂTdДU%(КH
G.Њ  dtTдФU8А GENMFЊ¦ЂдtUDD•(И8GETDVЊЈ ¤‚инpMSGBASЊаЂdхехE€н OV1ЋЂ e5tдФXй@SWVALSЊ  UDД”%hм`VALDRVњ   ћ¶@6                                                                                                                                   *ё  *¶ QP r€CА+4  `°X"+\ #fЂ «ј *¶ Q еfЂ $B
 Y  ”B
 Y·ЊК! ,ЫЦ е‚Ђ–mу r€A@Л6эЂ9Y  ‚Б`°DVИ UkЂ¬Р ‚*¶@6mЛ eRpэюЙЃЂ–mfТА¬ ЂЂ–m/fЂ Є¦! ,ЪrН  ¬Р ‚"¶@«d Й!”	ўвiLb ЊЏ Ф2ддхHИ°CLS_TXЋЁ d5Х4u8н`CPM_USЊ  dDe$ФXЙаE.0ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(CPMOV2)
.paЉ*/
#include	"portab.h"

BYTE	**menu_opt,		/* Pointer to array of text pointers	*/
	cpm_drive;		/* CP/M drive letter of required drive	*/

WORD	cpm_user;		/* Current User number			*/

/*======================================================================*/
STATUS                                             /*			*/
ov2(comd,msgs,cpmdrv,cpmuser,target)               /* Utility functions */
WORD	comd;			/* Command code of required utility	*/
BYTE	**msgs,			/* Array of messages			*/
	*cpmdrv;		/* Address of target CP/M drive	ID	*/
WORD	cpmuser,		/* Current User number			*/
	target;			/* SOURCE or DEST 			*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CP/M Utilities
Module Version	04.01
AMIE version 	05.20
Revision History:-
12/03/91 V04.01 issued - ICFO
13/12/90 V04.00 issued - ICFO
         File names without extension are printed correctly
         (Change in DIR.C / PUT_FN) - ICFO
10/07/89 V03.01 issued - ICFO
28/04/89 V03.00 issued - ICFO
15/04/89 User numbers introduced - ICFO
13/04/89 Sorted directories introduced (case 4) - ICFO
07/07/88 V02.00 issued (tidied to keep in step with documentation) - ICFO
04/09/87 Created DAR
*/

{

/* Called by the CP/M utility manager to provide directory, filesize	*/
/* erase and rename functions						*/

VOID	tlibv();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

menu_opt = msgs;
cpm_drive = cpmdrv;
cpm_user = cpmuser;

switch (comd) {

    case 0:
	return(dsk_dir(FALSE,target));

    case 1:
	return(sizefil(target));

    case 2:
	return(erase(target));

    case 3:
	return(ren(target));

    case 4:
	return(dsk_dir(TRUE,target));

    case 5:
	return(set_user(target));

    default:
	return(FAIL);
}

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…ђФSХЊ dФTеUфшA5}JCPM_USЂУХЊҐ  Zа      A Л4  P  9fР иКЃ @ЂЛ6Љ Ё „ іhшЖЂ@ („ іiH•љ  0X,‘ 9fУp+4  `ІD   е›Q@¬Р ‚ЙЂЂ–mR rі@ $B 9D @ е›WА¬Ъv Б`ІD   е›\ ¬Р ‚ЙїЯм–­ fЂ ё   Ё  M  *Р YА Ђ
т    ; ЙЊЗ bе5t•D8иCPM_DRЋЃЂd5ХхU8Л DSK_DIЊ« TU$4XА G.Њї $‚ии MENU_OЋ‚Ђ4хc(ЛRENЊБ e4UEхU8КHSIZEFIЊ  UDД”%iА  ћ(„ іiH•љ  0X,‘ 9fУp+4  `ІDSELPRC  C     	°              SETDRF  C     ±              SETUSR  C     І              SIEVE   C     і              ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                                  CPM(DIR)
.paЉ*/
#include	"dd.h"
#include	"cpm.h"

EXTERN
BYTE	**menu_opt,	/* Messages for CP/M Utilities			*/
	cpm_drive;	/* Drive letter in question			*/

EXTERN
WORD	cpm_user;	/* Current User number				*/

/*======================================================================*/
STATUS                          /*					*/
dsk_dir(sorted,target)          /* Print the directory of the CP/M disc */
BOOLEAN	sorted;			/* FALSE - not sorted, TRUE - sorted	*/
WORD	target;			/* 0 for source, 1 for destination	*/
/*======================================================================*/
/*USE
Portability	Level 1
Paremt Module	CPMMAN UTILITY PROCESSOR
Revision history:
13/12/90 File names which do not have an extension are printed correctly
         allowing for the changes in GETDIR.C - ICFO
25/04/89 All user number code moved into 'getdir' - ICFO
14/04/89 User numbers added - ICFO
13/04/89 'No files on disc' changedееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее to WARNING - ICFO
         'sorted' added - ICFO
         Type of function changed to STATUS - ICFO
18/05/88 'kflush' added before each call to 'getkey' - ICFO
07/09/87 Now uses getdir not setdir - DAR
04/09/87 Menu_opt declaration changed to BYTE** - DAR
18/03/87 Uses 'lppage' function to get screen height
12/03/87 Bug fix multi page dir listing errorred BR245 - DAR
22/02/87 Drive specification now <minflop{+1}> or switch spec -  DAR
23/01/87 Screen length calculations now use LINES not LPPAGE
22/01/87 Call to 'putstr(DELEOL)' changed to 'clreol'
21/01/87 Call to clear screen changed to 'clrs'
15/01/87 Redone to use 'setdir' to give a sorted directory
13/01/87 Created from 'cpmdir' - the version from the old user
         interface
24/06/87 Modified - DAR
*/

/* This routine displays a CP/M directory on the screen			*/

{

LOCAL
FILE	file;		/* Pointer to open file				*/

LOCAL
STATUS	rv;		/* Return value					*/

LOCAL
WORD	nfiles,		/* Number of files in the directory		*/
	i,		/* Counter of entries in line			*/
	flc,		/* File counter					*/
	col,		/* Column counter				*/
	plen,		/* Page length					*/
	entpln,		/* Entries per line				*/
	fldw;		/* Field width					*/


LOCAL
BYTE	fn[20];		/* File name to be printed			*/

STATIC
STATUS	sort_dir();

STATIC
VOID	put_fn();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

entpln = (cpm_user == -2) ? ENTPLN - 1 : ENTPLN;

/* Set up "AMIE.DIR"							*/
if ((flc = nfiles = getdir(cpm_drive)) == FAIL) {
    rv = FAIL;
    CLEANUP;
}

/* Sort the directory if required					*/
if (sorted == TRUE && sort_dir(flc) == FAIL) {
    rv = FAIL;
    CLEANUP;
}

/* Open "AMIE.DIR" ready for reading					*/
file = spopen("AMIE.DIR","RC");

while (flc > 0 ) {

/* Output a screen							*/
    clrs();
    plen = lppage() - 8;
    while (plen > 0 && flc > 0) {

/* Output a line							*/
	i = 0;
	while (i < entpln && flc > 0) {
	    getstr(file,fn,20);
	    put_fn(fn);
	    putstr((++i < entpln) ? "  |  " : "\n");
	    --flc;
	}
	--plen;
    }

/* At this stage we have run out of screen or files so move to bottom	*/
/* of screen & suggest an action					*/
    move(lppage() - 2,0);

    if (flc == 0) {
	putstr(menu_opt[MAXOPT + 1]);/* "Number of files*/
	putnum(nfiles);
	putstr("\n");
	putstr(genmes[5]);/* "Press any key to continue"*/
    }
    else putstr(genmes[3]);	/* Any key to continue ESC aborts	*/

    kflush();
    if (getkey() == ESC) break;
}
spclose(file);
clrs();

rv = SUCCESS;

cleanup:

/* Make sure AMIE.DIR is erased						*/
unlink("AMIE.DIR");

return(rv);

}

/*======================================================================*/
/*
.he                                                       CPM(DIR / SORT_DIR)
.paЉ*/
/*======================================================================*/
STATIC STATUS                                          /*		*/
sort_dir(nfiles)                                       /* Sort AMIE.DIR */
WORD	nfiles;				/* Number of files in AMIE.DIR	*/
/*======================================================================*/

{

LOCAL
BYTE	**n_ptrs;		/* Pointers to names			*/

LOCAL
WORD	text,			/* Descriptor for "AMIE.DIR"		*/
	i;			/* Loop counter				*/

LOCAL
STATUS	rv;			/* Return value				*/

LOCAL
FILE	file;			/* File descriptor for "AMIE.DIR"	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Allocate space for the pointers to the File Names from AMIE.DIR	*/
if ((n_ptrs = (BYTE **) alloc(nfiles * sizeof(BYTE *))) == (BYTE **)FAIL){
    rv = nferr(1);
    CLEANUP;
}

/* Read in the File Names						*/
if ((text = opn_txt("AMIE.DIR",n_ptrs,nfiles)) == FAIL) {
    rv = flerr("AMIE.DIR",46);
    CLEANUP;
}

/* If the operator has requested '*' files set pointers to just after	*/
/* the use number string (USERnn\)					*/
if (cpm_user == -2) {
    i = 0;
    while (i < nfiles)  *(n_ptrs + i++) += 7;	/* sizeof("USERnn\\");	*/
}

/* Sort the names							*/
sort(n_ptrs,nfiles);

/* Rewrite the file							*/
if ((file = spopen("AMIE.DIR","WC")) == FAIL) {
    rv = flerr("AMIE.DIR",3);
    CLEANUP;
}

/* If the operator has requested '*' files reset pointers		*/
if (cpm_user == -2) {
    i = 0;
    while (i < nfiles)  *(n_ptrs + i++) -= 7;	/* sizeof("USERnn\\");	*/
}

i = 0;
while (i < nfiles)  fputs(file,*(n_ptrs + i++));
spclose(file);

cleanup:

/* Release the allocated memory						*/
cls_txt(text);
free(n_ptrs);

return(SUCCESS);

}

/*======================================================================*/
/*
.he                                                       CPM(DIR / PUT_FN)
.paЉ*/
/*======================================================================*/
STATIC VOID                                      /*			*/
put_fn(fn)                                       /* Display a File Name */
BYTE	*fn;					/* File Name to display	*/
/*======================================================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее*/

{

LOCAL
WORD	j,			/* Alignment counter			*/
	i;			/* Loop counter				*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

i = 0;
while (*fn != '.') {
    ++i;
    putvid(*fn++);
    if (*fn == '\0') {
	*fn = '.';
	*(fn + 1) = '\0';
    }
}

j = (cpm_user == -2) ? 15 : 8;
while (i++ < j)  putvid(' ');

if (*(fn + 1) == NULL)  putstr("    ");
else {
    putvid(*fn++);
    i = 0;
    while (*fn != NULL) {
	++i;
	putvid(*fn++);
    }
    while (i++ < 3)  putvid(' ');
}

/* Let C/80 supply the return						*/

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(DMPBUF)
.paЉ*/
#include	"dd.h"
#include	"cpm.h"

struct fname	{
	BYTE	preamble[2];
	BYTE	name[20];
} ;

EXTERN
struct	lvl	*lev;	/* level descriptor structure for this driver	*/

EXTERN
struct	fname	filnam;	/* CP/M filename				*/

EXTERN
UWORD	bftaken,	/* counts no of bytes taken from buffer		*/
	bfleft;		/* counts no of bytes left in buffer		*/

EXTERN
WORD	user;		/* CP/M User Number				*/

EXTERN
BYTE	*bptr;		/* buffer pointer				*/

EXTERN
FILE	outfd;		/* file descriptor for output file		*/

/*======================================================================*/
WORD                                         /*				*/
dump_buff()                                  /* Dump the buffer to disc */
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMOUT CP/M output driver
Revision History:-
26/04/89 User numbers incorporated - ICFO
16/02/87 Pointer used for 'spwrite' changed to 'bptr' from 'sptr' - DAR
24/03/87 End of disk error output changed - DAR
14/05/87 Modified to use 'cpymem' function - DAR
*/

{

LOCAL
BYTE	*sptr;		/* Character pointer used in buffer manipulation*/

LOCAL
UWORD	to_go,		/* Number of bytes to write from buffer		*/
	remain;		/* Number of bytes not written from buffer	*/


/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* If there are any whole 128 byte blocks to be written do so		*/
if ((to_go = bftaken / 128) != 0) {

/* 'togo' contains number of 128 byte blocks.. convert to bytes		*/
    to_go *= 128;

/* Point buffer & utility pointers to start of output buffer		*/
    bptr = sptr = lev->buff;

/* Point utility pointer at start of data not to be sent		*/
    sptr += to_go;

/* Write the data to the output file erroring if necessary		*/
/* Error is probably 'disc full'					*/
    bdos(SETUSR,user);
    if ((spwrite(outfd,bptr,to_go)) != to_go) {
	bdos(SETUSR,0);
	return(nferr(28));
    }
    bdos(SETUSR,0);

/* Update buffer control variables				*/
    bftaken = remain = bftaken % 128;

/* Move remaining data to start of buffer			*/
    cpymem(sptr,bptr,remain);
    bptr += remain;

/* Calculate space left in buffer				*/
    bfleft = lev->bfsize - bftaken;
}

return(SUCCESS);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(DSPUSR)
.pa
*/
#include	"portab.h"

EXTERN
WORD	cpm_user;		/* Current user number			*/

/*======================================================================*/
WORD                                 /*					*/
disp_user(n)                         /* Display the current user number */
WORD	n;					/* Current user number	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPMMAN UTILITY MANAGER
Revision History:
25/04/89 Displays suitable message if user number is -2 - ICFO
14/04/89 Started - ICFO
*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

if (n != (WORD) FAIL) {
    hil_on();
    move(4,36);
    if (n == -2)  putstr("ALL USER");
    else {
	putstr("USER  ");
	putrjn(n,2);
    }
    hil_off();
    return(n);
}

return(cpm_user);

}

/*======================================================================*/
4/89 Started - ICFO
*/

{

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

if (n != (WORD) FAIL) {
    hil_on();
    move(4,36);
    if (n == -2)  putstr("ALL USER");
    else {
	putstr("USER  ");
	putrjn(n,2);
    }
    hil_off();
    return(n);
}

return(cpm_user);

}

/*===========================================================ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                             AMIE (DVALID)
.paЉ.po6
*/
#include dd.h	/* standard device driver header			*/

/*======================================================================*/
BOOLEAN
dvalid(c)	/* is a drive letter valid for this transfer		*/
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = DVSPEC CP/M initialisation
Revision History:-
25/3/87		Extracted from dvspec listing - DAR
*/
BYTE	c;	/* drive letter						*/
{

LOCAL
WORD	index;	/* indexes into valdrvs					*/

EXTERN
WORD	valdrvs[];	/* array of valid drive letters			*/

index = 0;	/* start at valdrv 0					*/

/* search valdrvs for a match with c					*/
while(valdrvs[index]){
	if(valdrvs[index++] == c) return(TRUE);	/* match found		*/
}

return(FALSE);	/* no match found					*/
}		
/*===================== END OF DVALID ==================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                         AMIE (DV_FROM_OP)
.paЉ.po6
*/
#include dd.h	/* standard device driver header			*/
/*======================================================================*/
STATUS
dv_from_op(target,cpmdrv)	/* get drive ID from operator		*/
/*======================================================================*/
/*USE
Portability   = level 1
Parent module = DVSPEC CP/M initialisation
Revision History:-
25/3/87		Extracted from dvspec listing - DAR
*/

WORD	target;		/* SOURCE - 0   DEST - 1			*/
BYTE	*cpmdrv;	/* pointer to place to put drive ID		*/
{

EXTERN
BYTE	*cpmsgs[];	/* CP/M specific messages			*/

EXTERN
WORD	valdrvs[];	/* array of valid drive letters			*/

LOCAL
BYTE	*txtbase,	/* area used to contain text			*/
	*tptr,		/* text pointer					*/
	*sptr;		/* used to copy text from cpm messages		*/

LOCAL
WORD	index,		/* index used to access valdrvs			*/
	n;		/* dframe index					*/

/* menu title								*/
dframe[0] = targееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееet ? cpmsgs[12] : cpmsgs[11];

/* alloc space for the menu text					*/
if((txtbase = tptr = spalloc(500)) == (BYTE *) FAIL)
	return(nferr(1));

index = 0;	/* look at valdrvs 0 first				*/
n = 1;		/* putting message in dframe 1 to start			*/

/* loop through all the non floppy drives avail creating menu options	*/
while(valdrvs[index]){

	dframe[n++] = tptr;	/* menu option points to startof string	*/

	/* source string = memory drive or winchester			*/
	sptr = (valdrvs[index] == 'M') ? cpmsgs[14] : cpmsgs[13];

	/* copy drive description into menu option			*/
	while(*tptr = *sptr++) tptr++;
	*tptr++ = ' ';

	*tptr++ = valdrvs[index];	/* add the drive letter		*/
	*tptr++ = ':';			/* and a colon			*/
	*tptr++ = 0;			/* terminate the string		*/
	index++;
}

/* call menu function to select drive					*/
n = genmen(n-1,0);

/* free text								*/
spfree(txtbase);

/* ESC hit in menu choice						*/
if(n == FAIL) return(FAIL);

/* set up the cpm drive reqd						*/
*cpmdrv = valdrvs[n];

return(SUCCESS);
}
/*===================== END OF DV_FROM_OP ==============================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                            S.P.I.T(ENDIT)
.pa
*/
#include	"dd.h"

/*======================================================================*/
WORD                                   /*				*/
end_it_all()                           /* Dump the final buffer to disc */
/*======================================================================*/

{

EXTERN
UWORD	bftaken;	/* no of valid bytes in the buffer		*/

EXTERN
BYTE	*bptr;		/* current buffer pointer			*/


/* Routines called							*/
STATUS	dump_buff();		/* Dump buffer to disc			*/

/* dump as many 128 byte blocks of data from the buffer as possible	*/
if ((dump_buff()) == FAIL) return(FAIL);

/* if there are any bytes left in buffer create a last block. pad the	*/
/* non data bytes with the 1A HEX EOF character				*/

if (bftaken) {
	while (bftaken++ < 128) *bptr++ = 0x1a;	/* pad out with 1A	*/
	if ((dump_buff()) == FAIL)
		return(FAIL);/* write final sector	*/
}

return(SUCCESS);

}

/*===================== end of end_it_all ==============================*/
/* Routines called:- dump_bu						*/
/*======================================================================*/
st block. pad the	*/
/* non data bytes with the 1A HEX EOF character				*/

if (bftaken) {
	while (bftaken++ < 128) *bptr++ = 0x1a;	/* pad out with 1A	*/
	if ((dump_buff()) == FAIL)
		return(FAIL);/* write final sector	*/
}

return(SUCCESS);

}ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                                CPM(ERASE)
.pa
*/
#include	"dd.h"
#include	"cpm.h"

EXTERN
BYTE	cpm_drive,	/* drive letter of CP/M drive in use		*/
	**menu_opt;	/* CP/M specific messages			*/

EXTERN
WORD	cpm_user;	/* Current User number				*/

/*======================================================================*/
WORD                               /*					*/
erase(target)                      /* Erase files from Destination disc */
WORD	target;		/* 0 for Source, 1 for Destination		*/
			/* Not used by this routine			*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPM Utilities
Revision History:
12/03/91 Declaration of 'fn' changed from '[20]' to '[22]' to allow
         room for 'D:USER00\ABCDEFGH.IJK' plus the terminating
         blank - ICFO
25/04/89 '*' catered for - ICFO
14/04/89 User areas added - ICFO
18/05/88 'kflush' added before each call to 'getkey' - ICFO
17/05/88 ' - ' added between 'erase complete' and ' Press any key to
         continue' messages (BR469) - ICFO
07/09/87 Now uses 'getdir' not 'setdir' DAR
24/06/87 Minor mods DAR
11/03/87 ERASED message output after 'unlink' call - DAR
22/02/87 Drive specification now <minflop{+1}> or switch spec -  DAR
         Erase confirmation after selection added
21/01/87 Call to clear screen changed to 'clrs'
14/01/87 Started
*/

{

/* This routine tags the files to be erased and then erases them all	*/

LOCAL
FILE	file;		/* Pointer to open file				*/

LOCAL
BYTE	*sel_frame,	/* Pointer to the Menu Frame			*/
	fn[22];		/* Array to hold a filename			*/

LOCAL
WORD	i,		/* General counter				*/
	n,
	sp,		/* Number of spaces to align 'erased' message	*/
	lcount,		/* Counts lines output				*/
	disc,		/* Storage for default disc			*/
	tot_files;	/* Count of the number of files on the disc	*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

sp = (cpm_user == -2) ? 23 : 14;

/* Create "AMIE.DIR"							*/
if ((tot_files = getdir(cpm_drive)) == FAIL)  return(FAIL);

/* Create the Menu Frame						*/
if ((sel_frame = alloc(tot_files)) == (BYTE *) FAIL)  return(nferr(1));

/* Set up the Menu Frame with the tags of all files to be erased	*/
if (sel_file(sel_frame,tot_files) == FAIL) {
    free(sel_frame);
    return(FAIL);
}

/* Get erase confirmation						*/
dframe[0] = menu_opt[2];
dframe[1] = menu_opt[15];
dialog(NULL,NULL,2,dframe,0);

kflush();
if (toupper(getkey()) != 'Y'){
    free(sel_frame);
    return(FAIL);
}

/* Output a "Please Wait" message					*/
clrs();
chat(19,20,NULL,NULL);

/* Open "AMIE.DIR" ready for reading					*/
file = spopen("AMIE.DIR","RC");

/* Set up drive ID							*/
fn[0] = cpm_drive & 0xef;
fn[1] = ':';

/* Erase the files							*/
for (lcount = i = 0; i < tot_files; i++) {

/* Check for escape key							*/
    if (const() == ESC)  break;

/* Check for end of screen						*/
    if (lcount == 0) {
	clrs()ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;
	putstr(menu_opt[18]);		/* ESC aborts message		*/
	putstr("\n");
	lcount = lppage();
	lcount -= 9;
    }

/* Read next filename							*/
    getstr(file,&fn[2],20);

/* If it was selected erase it						*/
    if (sel_frame[i]) {
	n = strlen(&fn[2]);
	putstr(&fn[2]);
	while(n++ < sp)  putvid(' ');
	bdos(SETUSR,chuser(fn));
	if (unlink(fn) == SUCCESS)  putstr(menu_opt[17]);/* "erased" 	*/
	else putstr(menu_opt[26]);		/* Unable to erase 	*/
	putstr("\n");
	--lcount;
    }
}
putstr("\n\n");
putstr(menu_opt[19]);
putstr(" - ");
putstr(genmes[5]);	/* Press any key to continue			*/
kflush();
getkey();
clrs();

/* Release memory and return						*/
free(sel_frame);
spclose(file);

bdos(SETUSR,0);

return(SUCCESS);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(FNCHEK)
.pa
*/
#include	"dd.h"

/*======================================================================*/
WORD                                   /*				*/
fnchek(c)                              /* Check CP/M File Specification */
BYTE	*c;				/* Pointer to a CP/M file name	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent Module	CPM
Revision History:
12/03/91 Listing brought up to standard - ICFO
         Returns FAIL if file name or extension has space
         character - ICFO
12/03/87 Correction to extension check - DAR
15/01/87 Taken from TAPE
04/11/86 Started
*/

{

/* This routine checks the fields of a CP/M file specification to	*/
/* ensure that the field lengths are valid and the characters are	*/
/* alphanumeric or '?' or '*'						*/
/* Returns SUCCESS if ok, FAIL otherwise				*/

STATIC
WORD	i,j,k;		/* General counters				*/

STATIC
BYTE	c1;		/* Store for a character			*/

/* Routines called							*/
BOOLEAN	isfchr();	/* Check for valid characters			*/

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Check the File Name							*/
/* Find either '.' or the end of the string and ensure that all 	*/
/* intervening characters are valid					*/
j = 1;
while ((c1 = *(c + ++j)) != NULL && c1 != '.')
				   if (isfchr(c1) == FALSE)  return(FAIL);

if (j > 10)  return(FAIL);
if (c1 == NULL)  return(SUCCESS);			/* No extension	*/

/* Check the Extension							*/
/* Find the end of the string and ensure that all intervening		*/
/* characters are alphanumeric						*/
k = j;
while ((c1 = *(c + ++k)) != NULL)
		      if (isfchr(c1) == FALSE || c1 == '.')  return(FAIL);

return((k <= j + 4) ? SUCCESS : FAIL);

}

/*======================================================================*/
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(GETATR)
.pa
*/
#include	"dd.h"

EXTERN
BYTE	filnam[];		/* Name of current file			*/

EXTERN
FILE	inpfd;			/* File descriptor of input file	*/

/*======================================================================*/
STATUS               /*							*/
get_attr(lev)	     /* Get source file attributes, set up virtual file	*/
struct	lvl	*lev;				/* AMIE Level structure	*/
/*======================================================================*/
/*USE
Portability	Level 1
Parent module	CPMINP CP/M input driver
Revision History:-
17/04/89 User numbers added and brought up to date - ICFO
08/09/87 Tidy up unecessary declarations
21/05/87 Uses direct queueing functions
*/

{

LOCAL
struct	pkthdr	*vfdpkt;

LOCAL
struct	tvfd	*vfd;

LONG	filesize();

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Get empty packet from pool & create a VFD in it			*/
(vfdpkt = qget(lev->in_q))->d_bytes = sizeof(struct tvfd);
vfdpkt->d_freesp -= sizeof(struct tvfd);

/* Point at VFD								*/
/* Zero all structure elements ie set to all default			*/
setmem(vfd = vfdpkt->d_start,sizeof(struct tvfd),0);

/* Put filename into descriptor						*/
strcpy(vfd->v_ifile,&filnam[2]);/* Copy input filename to virtual fd	*/

/* Put filesize into VFD						*/
vfd->v_fsize = vfd->v_fmaxsze = filesize(inpfd);

/* Put VFD on the output Q						*/
queue(lev->out_q,vfdpkt);

return(SUCCESS);

}

/*======================================================================*/
ents ie set to all default			*/
setmem(vfd = vfdpkt->d_start,sizeof(struct tvfd),0);

/* Put filename into descriptor						*/
strcpy(vfd->v_ifile,&filnam[2]);/* Copy input filename to virtual fd	*/

/* Put filesize into VFD						*/
vfd->v_fsize = vfd->v_fmaxsze = filesize(inpfd);

/* Put VFD on the output Q						*/
queue(lev->out_q,vfdpkt);

return(SUCCESS);

}

/*=ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*
.he                                                               CPM(GETDIR)
.pa
*/
#include	"dd.h"
#include	"disc.h"
#include	"cpm.h"

#define		M_N_EXT		8

/* Define a CP/M fcb for use in directory name retrieval		*/
struct fcb {
	BYTE	drv;
	BYTE	name[8];
	BYTE	extn[3];
	BYTE	ext;
	BYTE	rest[20];
} ;

EXTERN
WORD	cpm_user;		/* Current CP/M User number		*/
	
EXTERN
struct	dpblk	*dpb;		/* Pointer to Disc Parameter Blocks	*/

STATIC
BYTE	string[20];		/* Room for 'USER00\ABCDEFGH.IJK' + NULL*/

STATIC
WORD	code,			/* Return code from BDOS		*/
	n_ext;			/* Number of CP/M (16k) extents per	*/
				/* actual extent			*/

/*======================================================================*/
WORD                       /*						*/
getdir(drive)              /* Create file of all source drive filenames */
BYTE	drive;		/* Drive letter from which directory is taken	*/
/*======================================================================*/
/*USE
Portability	Level 4 (Pokesееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее about in CP/M directory entries)
Parent Module	CPM INPUT and UTILITY PROCESSORS
12/03/91 'string' made static global and removed from call to
         'crtonam' - ICFO
         'code' made static global and removed from call to
         'crtonam' - ICFO
         Main loop of 'crtonam' rewritten - ICFO
13/12/90 Only adds a '.' to the filename if there is an extension - ICFO
28/04/89 'crtonam' included as 'static' - ICFO
         Check for first extent modified to allow for multiple
         CP/M (16k) extents per actual extent - ICFO
25/04/89 This function sets the user number - ICFO
17/04/89 If selected user is not User 0 set the user number in the
         file name (change in 'crtonam') - ICFO
14/04/89 Tidied up and calls to error handler preceded by setting of
         User to zero - ICFO
07/09/87 'crtonam' returns FAIL if file is set to $SYS
03/04/87 'crtonam' rewritten DAR
13/02/87 Modified for minflop operation - DAR
*/

{

LOCAL
WORD	cur_disc,	/* Current default disc				*/
	mode,		/* Search mode = 11H or 12H ie. search 1st/next	*/
	n;		/* Working counter				*/

LOCAL
UWORD	tot;			/* Number of files found		*/

LOCAL
FILE	dirfd;			/* File descriptor for directory file	*/

STATIC
BYTE	*dirfname = "AMIE.DIR";	/* Name of directory file		*/

STATIC
STATUS	crtonam();		/* Create name from Directory Entry	*/

/* Ambiguous FCB used in search 1st/next ops drive id set later		*/
STATIC
struct	fcb	afcb = { 0,"????????","???", 0 };

/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

/* Open up the directory file for writing				*/
if ((dirfd = spopen(dirfname,"WC")) == OPENFAIL)
					       return(flerr(dirfname,48));

bdos(0x1a,0x80);	/* Set default DMA				*/
mode = 0x11;		/* Mode to search 1st				*/
tot = 0;

/* Select new default drive						*/
cur_disc = bdos(GETDISC,0);	/* 'A' = 0, 'B' = 1 etc			*/
bdos(SETDISC,(drive & 0xef) - 'A');

/* Sort out the user number.  If '*' specified then set 'drive		*/
/* specifier' to '?' for BDOS Search / Next function or else set the	*/
/* required user number							*/
if (cpm_user == -2)  afcb.drv = '?';
else		     bdos(SETUSR,cpm_user);

/* Compute the number of CP/M extents per actual extent			*/

/* This needs a bit of explanation.  According to all the documentation */
/* each  directory entry holds the numbers of the allocation blocks for */
/* one extent.   Each extent is defined as 16k.   See for example  Andy */
/* Johnson-Laird's  program  for finding lost files on page 416 of  the */
/* CP/M Programmer's Handbook.   In Figure 11-5 on page 419 it  clearly */
/* tests  for  the extent number being zero for the first extent  of  a */
/* file.   On the MFB this ain't necessarily so.   An extent can be 32k */
/* (on drives B and C) or 64k on drive M (with an 8k Allocation Block). */
/* Thus  a directory entry can contain more than 1 CP/M 16k extent  and */
/* it  is  the 16k extents which are counted in Byte 12 of a  directory */
/* entry.   So  on Drive C a 20K file will have one extent  numbered  1 */
/* (not,  repeat not,  0).   On drive M a 63k file will have one extent */
/* numbered  3.   In  order to detect the first extent therefore it  is */
/* necessary  to determine how many CP/M 16k extents are in  an  actual */
/* extent.								*/

/* NOTE For Drive 'M' the value of 8 is hardwired from the BIOS as I	*/
/* cannot find any way to read it from the BIOS tables.  When the	*/
/* Allocation Block size of Drive M is changed this must also be changed*/
if ((drive & 0xef) == 'M')  n_ext = M_N_EXT;
else {
    n_ext = (dpb[(drive & 0xef) - 'A'].dpb_dsm < 256) ? 2 : 1;
    n_ext = ((128 << dpb[(drive & 0xef) - 'A'].dpb_bsh) * n_ext) >> 11;
}

/* Repeat search 1st/nxt ops until no more files left			*/
while ((code = bdos(mode,&afcb)) != -1)	{

/* Create filename in string from returned FCB write to file if not sys	*/
    if (crtonam() == SUCCESS) {

/* Remove User Number if called from Utilities and User not '*'		*/
	n = -1;
	if ((drive & 0x10) != 0 && cpm_user != -2) {
	    n = strlen(string) - 1;
	    while (n >= 0 && *(string + n) != '\\')  --n;
	}

/* Write the filename to the disk					*/
	bdos(SETDISC,cur_disc);
	fputs(dirfd,string + ++n);
	bdos(SETDISC,(drive & 0xef) - 'A');
	++tot;				/* Increment the file total	*/
    }

    bdos(0x1a,0x80);		/* Set default DMA			*/
    mode = 0x12;		/* Ensure mode is search next		*/
}

/* Tag on a EOF char for good measure					*/
bdos(SETDISC,cur_disc);		/* Reset the default disc		*/
spputc(0x1a,dirfd);

bdos(SETUSR,0);

dirfd = spclose(dirfd);

if (tot == 0) {
    unlink(dirfname);
    return(err_handle(WARNING,NULLPTR,20));
}

return(tot);

}

/*======================================================================*/
/*
.he                                                     CPM(GETDIR / CRTONAM)
.pa
*/
/*======================================================================*/
STATIC STATUS                    /*					*/
crtonam()                        /* Generate filename from DMAееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее